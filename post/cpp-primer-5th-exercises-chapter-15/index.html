<!DOCTYPE html>
<html lang="zh-cn" itemscope itemtype="http://schema.org/WebPage">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Cpp-Primer-5th-Exercises-Chapter-15 - 找一个吃麦旋风的理由</title>
  

<meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta name="MobileOptimized" content="width"/>
<meta name="HandheldFriendly" content="true"/>


<meta name="applicable-device" content="pc,mobile">

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">

<meta name="mobile-web-app-capable" content="yes">

<meta name="author" content="zero4drift" />
  <meta name="description" content="Exercise 15.1 1 2 3  // What is a virtual member? // For some member functions, base class demands its derived class defines its own version, then base class defines them as virtual functions.    Exercise 15.2 1 2 3  // members marked as protected could be visted by derived class, while still could not be visited by other user code; // members marked as private could not be visited by derived class and other user code." />

  <meta name="keywords" content="代码, 算法, 工具" />






<meta name="generator" content="Hugo 0.48" />


<link rel="canonical" href="https://zero4drift.github.io/post/cpp-primer-5th-exercises-chapter-15/" />



<link rel="icon" href="/favicon.ico" />











<link rel="stylesheet" href="/sass/jane.min.28854364c052ec02eba4ee5867bc889d3a567cdf337ba3a355c33511d20bee1e.css" integrity="sha256-KIVDZMBS7ALrpO5YZ7yInTpWfN8ze6OjVcM1EdIL7h4=" media="screen" crossorigin="anonymous">





<meta property="og:title" content="Cpp-Primer-5th-Exercises-Chapter-15" />
<meta property="og:description" content="Exercise 15.1 1 2 3  // What is a virtual member? // For some member functions, base class demands its derived class defines its own version, then base class defines them as virtual functions.    Exercise 15.2 1 2 3  // members marked as protected could be visted by derived class, while still could not be visited by other user code; // members marked as private could not be visited by derived class and other user code." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://zero4drift.github.io/post/cpp-primer-5th-exercises-chapter-15/" /><meta property="article:published_time" content="2018-07-11T19:54:00&#43;08:00"/>
<meta property="article:modified_time" content="2019-01-14T22:23:55&#43;08:00"/>
<meta itemprop="name" content="Cpp-Primer-5th-Exercises-Chapter-15">
<meta itemprop="description" content="Exercise 15.1 1 2 3  // What is a virtual member? // For some member functions, base class demands its derived class defines its own version, then base class defines them as virtual functions.    Exercise 15.2 1 2 3  // members marked as protected could be visted by derived class, while still could not be visited by other user code; // members marked as private could not be visited by derived class and other user code.">


<meta itemprop="datePublished" content="2018-07-11T19:54:00&#43;08:00" />
<meta itemprop="dateModified" content="2018-07-11T19:54:00&#43;08:00" />
<meta itemprop="wordCount" content="6146">



<meta itemprop="keywords" content="C&#43;&#43;,cpp-primer," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Cpp-Primer-5th-Exercises-Chapter-15"/>
<meta name="twitter:description" content="Exercise 15.1 1 2 3  // What is a virtual member? // For some member functions, base class demands its derived class defines its own version, then base class defines them as virtual functions.    Exercise 15.2 1 2 3  // members marked as protected could be visted by derived class, while still could not be visited by other user code; // members marked as private could not be visited by derived class and other user code."/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-112733609-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>



</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">找一个吃麦旋风的理由</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://zero4drift.github.io/">主页</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://zero4drift.github.io/post/">存档</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://zero4drift.github.io/tags/">标签</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://zero4drift.github.io/categories/">分类</a>
          
        
      </li>
    
  </ul>
</nav>


  
    






  <link rel="stylesheet" href="/lib/photoswipe/photoswipe.min.css" />
  <link rel="stylesheet" href="/lib/photoswipe/default-skin/default-skin.min.css" />




<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>

  

  

  <header id="header" class="header container">
    <div class="logo-wrapper">
  <a href="/" class="logo">
    
      找一个吃麦旋风的理由
    
  </a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://zero4drift.github.io/">主页</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://zero4drift.github.io/post/">存档</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://zero4drift.github.io/tags/">标签</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://zero4drift.github.io/categories/">分类</a>
          

        

      </li>
    
    
  </ul>
</nav>

  </header>

  <div id="mobile-panel">
    <main id="main" class="main bg-llight">
      <div class="content-wrapper">
        <div id="content" class="content container">
          <article class="post bg-white">
    
    <header class="post-header">
      <h1 class="post-title">Cpp-Primer-5th-Exercises-Chapter-15</h1>
      
      <div class="post-meta">
        <time datetime="2018-07-11" class="post-time">
          2018-07-11
        </time>
        <div class="post-category">
            <a href="https://zero4drift.github.io/categories/c&#43;&#43;/"> C&#43;&#43; </a>
            
          </div>
        

        
        
          <span id="busuanzi_container_page_pv">
            | 阅读 <span id="busuanzi_value_page_pv"></span>
          </span>
        

        
        
      </div>
    </header>

    
    
<div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">文章目录</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#exercise-15-dot-1">Exercise 15.1</a></li>
<li><a href="#exercise-15-dot-2">Exercise 15.2</a></li>
<li><a href="#exercise-15-dot-3">Exercise 15.3</a></li>
<li><a href="#quote-dot-h">Quote.h</a></li>
<li><a href="#exercise-15-dot-4">Exercise 15.4</a></li>
<li><a href="#exercise-15-dot-5">Exercise 15.5</a></li>
<li><a href="#bulk-quote-dot-h">Bulk_quote.h</a></li>
<li><a href="#exercise-15-dot-6">Exercise 15.6</a></li>
<li><a href="#exercise-15-dot-7">Exercise 15.7</a></li>
<li><a href="#limit-bulk-quote-dot-h">Limit_Bulk_quote.h</a></li>
<li><a href="#exercise-15-dot-8">Exercise 15.8</a></li>
<li><a href="#exercise-15-dot-9">Exercise 15.9</a></li>
<li><a href="#exercise-15-dot-10">Exercise 15.10</a></li>
<li><a href="#exercise-15-dot-11">Exercise 15.11</a></li>
<li><a href="#limit-quote-dot-h">Limit_quote.h</a></li>
<li><a href="#exercise-15-dot-12">Exercise 15.12</a></li>
<li><a href="#exercise-15-dot-13">Exercise 15.13</a></li>
<li><a href="#exercise-15-dot-14">Exercise 15.14</a></li>
<li><a href="#exercise-15-dot-15">Exercise 15.15</a></li>
<li><a href="#bulk-quote-1515-dot-h">Bulk_quote-1515.h</a></li>
<li><a href="#disc-quote-dot-h">Disc_quote.h</a></li>
<li><a href="#exercise-15-dot-16">Exercise 15.16</a></li>
<li><a href="#limit-bulk-quote-1516-dot-h">Limit_Bulk_quote-1516.h</a></li>
<li><a href="#exercise-15-dot-17">Exercise 15.17</a></li>
<li><a href="#exercise-15-dot-18">Exercise 15.18</a></li>
<li><a href="#exercise-15-dot-19">Exercise 15.19</a></li>
<li><a href="#exercise-15-dot-20">Exercise 15.20</a></li>
<li><a href="#exercise-15-dot-21">Exercise 15.21</a></li>
<li><a href="#exercise-15-dot-22">Exercise 15.22</a></li>
<li><a href="#15-dot-21-dot-cpp">15.21.cpp</a></li>
<li><a href="#exercise-15-dot-23">Exercise 15.23</a></li>
<li><a href="#exercise-15-dot-24">Exercise 15.24</a></li>
<li><a href="#exercise-15-dot-25">Exercise 15.25</a></li>
<li><a href="#exercise-15-dot-26">Exercise 15.26</a></li>
<li><a href="#exercise-15-dot-27">Exercise 15.27</a></li>
<li><a href="#exercise-15-dot-28">Exercise 15.28</a></li>
<li><a href="#exercise-15-dot-29">Exercise 15.29</a></li>
<li><a href="#15-dot-28-dot-cpp">15.28.cpp</a></li>
<li><a href="#exercise-15-dot-30">Exercise 15.30</a></li>
<li><a href="#exercise-15-dot-31">Exercise 15.31</a></li>
<li><a href="#exercise-15-dot-32">Exercise 15.32</a></li>
<li><a href="#exercise-15-dot-33">Exercise 15.33</a></li>
<li><a href="#exercise-15-dot-34">Exercise 15.34</a></li>
<li><a href="#exercise-15-dot-36">Exercise 15.36</a></li>
<li><a href="#exercise-15-dot-37">Exercise 15.37</a></li>
<li><a href="#exercise-15-dot-38">Exercise 15.38</a></li>
<li><a href="#exercise-15-dot-39">Exercise 15.39</a></li>
<li><a href="#15-dot-35-dot-h">15.35.h</a></li>
<li><a href="#exercise-15-dot-40">Exercise 15.40</a></li>
<li><a href="#exercise-15-dot-41">Exercise 15.41</a></li>
<li><a href="#15-dot-41-dot-h">15.41.h</a></li>
<li><a href="#exercise-15-dot-42">Exercise 15.42</a></li>
<li><a href="#15-dot-42-dot-h">15.42.h</a></li>
<li><a href="#textquery-1542-dot-h">TextQuery-1542.h</a></li>
</ul></li>
</ul>
</nav>
  </div>
</div>

    
    <div class="post-content">
      

<h2 id="exercise-15-dot-1">Exercise 15.1</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="c1">// What is a virtual member?
</span><span class="c1">// For some member functions, base class demands its derived class defines its own version, then base class defines them as virtual functions.
</span><span class="c1"></span></code></pre></td></tr></table>
</div>
</div>
<h2 id="exercise-15-dot-2">Exercise 15.2</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="c1">// members marked as protected could be visted by derived class, while still could not be visited by other user code;
</span><span class="c1">// members marked as private could not be visited by derived class and other user code.
</span><span class="c1"></span></code></pre></td></tr></table>
</div>
</div>
<h2 id="exercise-15-dot-3">Exercise 15.3</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="c1">// See Quote.h.
</span><span class="c1"></span></code></pre></td></tr></table>
</div>
</div>
<h2 id="quote-dot-h">Quote.h</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="cp">#ifndef QUOTE_H
</span><span class="cp">#define QUOTE_H
</span><span class="cp"></span><span class="k">class</span><span class="err"> </span><span class="nc">Quote</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
  <span class="n">Quote</span><span class="p">()</span> <span class="p">{</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Quote()&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;}</span>
  <span class="n">Quote</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="n">book</span><span class="p">,</span> <span class="kt">double</span> <span class="n">sales_price</span><span class="p">)</span><span class="o">:</span>
  <span class="n">bookNo</span><span class="p">(</span><span class="n">book</span><span class="p">),</span> <span class="n">price</span><span class="p">(</span><span class="n">sales_price</span><span class="p">)</span>
  <span class="p">{</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Quote(cosnt string &amp;, double)&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;}</span>
  <span class="n">string</span> <span class="n">isbn</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span><span class="k">return</span> <span class="n">bookNo</span><span class="p">;}</span>
  <span class="n">Quote</span><span class="p">(</span><span class="k">const</span> <span class="n">Quote</span> <span class="o">&amp;</span><span class="n">q</span><span class="p">)</span>
    <span class="p">{</span><span class="n">bookNo</span> <span class="o">=</span> <span class="n">q</span><span class="p">.</span><span class="n">bookNo</span><span class="p">;</span> <span class="n">price</span> <span class="o">=</span> <span class="n">q</span><span class="p">.</span><span class="n">price</span><span class="p">;</span> <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Quote(const Quote &amp;)&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;}</span>
  <span class="n">Quote</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">Quote</span> <span class="o">&amp;</span><span class="n">q</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="n">bookNo</span> <span class="o">=</span> <span class="n">q</span><span class="p">.</span><span class="n">bookNo</span><span class="p">;</span>
      <span class="n">price</span> <span class="o">=</span> <span class="n">q</span><span class="p">.</span><span class="n">price</span><span class="p">;</span>
      <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Quote &amp;operator=(const Quote &amp;)&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
      <span class="k">return</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="n">Quote</span><span class="p">(</span><span class="n">Quote</span> <span class="o">&amp;&amp;</span><span class="n">q</span><span class="p">)</span>
    <span class="p">{</span><span class="n">bookNo</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">q</span><span class="p">.</span><span class="n">bookNo</span><span class="p">);</span> <span class="n">price</span> <span class="o">=</span> <span class="n">q</span><span class="p">.</span><span class="n">price</span><span class="p">;</span> <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Quote(Quote &amp;&amp;)&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;}</span>
  <span class="n">Quote</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="n">Quote</span> <span class="o">&amp;&amp;</span><span class="n">q</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="n">bookNo</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">q</span><span class="p">.</span><span class="n">bookNo</span><span class="p">);</span>
      <span class="n">price</span> <span class="o">=</span> <span class="n">q</span><span class="p">.</span><span class="n">price</span><span class="p">;</span>
      <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Quote &amp;operator=(Quote &amp;&amp;)&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
      <span class="k">return</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="k">virtual</span> <span class="kt">double</span> <span class="n">net_price</span><span class="p">(</span><span class="n">size_t</span> <span class="n">n</span><span class="p">)</span> <span class="k">const</span>
  <span class="p">{</span><span class="k">return</span> <span class="n">n</span> <span class="o">*</span> <span class="n">price</span><span class="p">;}</span>
  <span class="k">virtual</span> <span class="n">ostream</span> <span class="o">&amp;</span><span class="n">debug</span><span class="p">()</span> <span class="k">const</span>
  <span class="p">{</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;bookNo &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">bookNo</span> <span class="o">&lt;&lt;</span> <span class="s">&#34; price &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">price</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">cout</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">virtual</span> <span class="n">Quote</span><span class="o">*</span> <span class="n">clone</span><span class="p">()</span> <span class="k">const</span> <span class="o">&amp;</span> <span class="p">{</span><span class="k">return</span> <span class="k">new</span> <span class="n">Quote</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">);}</span>
  <span class="k">virtual</span> <span class="n">Quote</span><span class="o">*</span> <span class="n">clone</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="p">{</span><span class="k">return</span> <span class="k">new</span> <span class="n">Quote</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">));}</span>
  <span class="k">virtual</span> <span class="o">~</span><span class="n">Quote</span><span class="p">()</span> <span class="p">{</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;~Quote()&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;};</span>
<span class="k">private</span><span class="o">:</span>
  <span class="n">string</span> <span class="n">bookNo</span><span class="p">;</span>
<span class="k">protected</span><span class="o">:</span>
  <span class="kt">double</span> <span class="n">price</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
<span class="p">};</span>
<span class="kt">double</span> <span class="nf">print_total</span><span class="p">(</span><span class="n">ostream</span> <span class="o">&amp;</span><span class="n">os</span><span class="p">,</span> <span class="k">const</span> <span class="n">Quote</span> <span class="o">&amp;</span><span class="n">item</span><span class="p">,</span> <span class="n">size_t</span> <span class="n">n</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">double</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">item</span><span class="p">.</span><span class="n">net_price</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>
  <span class="n">os</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;ISBN: &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">item</span><span class="p">.</span><span class="n">isbn</span><span class="p">()</span>
     <span class="o">&lt;&lt;</span> <span class="s">&#34; # sold: &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">n</span> <span class="o">&lt;&lt;</span> <span class="s">&#34; total due: &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">ret</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">#endif
</span><span class="cp"></span></code></pre></td></tr></table>
</div>
</div>
<h2 id="exercise-15-dot-4">Exercise 15.4</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="c1">// class Base { ... };
</span><span class="c1">// a. class Derived : public Derived { ... }
</span><span class="c1">// illegal, one class could not derive from itself.
</span><span class="c1">// b. class Derived : private Base { ... }
</span><span class="c1">// illegal, this one as definition considered legal.
</span><span class="c1">// c. class Derived : public Base;
</span><span class="c1">// illegal, declaration of a class should not include its class derivation list.
</span><span class="c1"></span></code></pre></td></tr></table>
</div>
</div>
<h2 id="exercise-15-dot-5">Exercise 15.5</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="c1">// See Bulk_quote.h.
</span><span class="c1"></span></code></pre></td></tr></table>
</div>
</div>
<h2 id="bulk-quote-dot-h">Bulk_quote.h</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="cp">#ifndef BULK_QUOTE_H
</span><span class="cp">#define BULK_QUOTE_H
</span><span class="cp"></span><span class="k">class</span><span class="err"> </span><span class="nc">Bulk_quote</span><span class="o">:</span> <span class="k">public</span> <span class="n">Quote</span>
<span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="k">using</span> <span class="n">Quote</span><span class="o">::</span><span class="n">Quote</span><span class="p">;</span>
 <span class="n">Bulk_quote</span><span class="p">()</span><span class="o">:</span> <span class="n">Quote</span><span class="p">()</span> <span class="p">{</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Bulk_quote()&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;};</span>
 <span class="n">Bulk_quote</span><span class="p">(</span><span class="k">const</span> <span class="n">Bulk_quote</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span><span class="o">:</span> <span class="n">Quote</span><span class="p">(</span><span class="n">b</span><span class="p">),</span> <span class="n">min_qty</span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="n">min_qty</span><span class="p">),</span> <span class="n">discount</span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="n">discount</span><span class="p">)</span>
    <span class="p">{</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Bulk_Quote(const Bulk_quote &amp;)&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;}</span>
 <span class="n">Bulk_quote</span><span class="p">(</span><span class="n">Bulk_quote</span> <span class="o">&amp;&amp;</span><span class="n">b</span><span class="p">)</span><span class="o">:</span> <span class="n">Quote</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">b</span><span class="p">)),</span> <span class="n">min_qty</span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="n">min_qty</span><span class="p">),</span> <span class="n">discount</span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="n">discount</span><span class="p">)</span>
    <span class="p">{</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Bulk_quote(Bulk_quote &amp;&amp;b)&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;}</span>
  <span class="n">Bulk_quote</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">Bulk_quote</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="n">Quote</span><span class="o">::</span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="n">b</span><span class="p">);</span>
      <span class="n">min_qty</span> <span class="o">=</span> <span class="n">b</span><span class="p">.</span><span class="n">min_qty</span><span class="p">;</span>
      <span class="n">discount</span> <span class="o">=</span> <span class="n">b</span><span class="p">.</span><span class="n">discount</span><span class="p">;</span>
      <span class="p">{</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;operator=(const Bulk_quote &amp;)&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;}</span>
      <span class="k">return</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="n">Bulk_quote</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="n">Bulk_quote</span> <span class="o">&amp;&amp;</span><span class="n">b</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="n">Quote</span><span class="o">::</span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">b</span><span class="p">));</span>
      <span class="n">min_qty</span> <span class="o">=</span> <span class="n">b</span><span class="p">.</span><span class="n">min_qty</span><span class="p">;</span>
      <span class="n">discount</span> <span class="o">=</span> <span class="n">b</span><span class="p">.</span><span class="n">discount</span><span class="p">;</span>
      <span class="p">{</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;operator=(Bulk_quote &amp;&amp;)&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;}</span>
      <span class="k">return</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span>
    <span class="p">}</span>
 <span class="n">Bulk_quote</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span> <span class="n">book</span><span class="p">,</span> <span class="kt">double</span> <span class="n">p</span><span class="p">,</span> <span class="n">size_t</span> <span class="n">qty</span><span class="p">,</span> <span class="kt">double</span> <span class="n">disc</span><span class="p">)</span><span class="o">:</span>
  <span class="n">Quote</span><span class="p">(</span><span class="n">book</span><span class="p">,</span> <span class="n">p</span><span class="p">),</span> <span class="n">min_qty</span><span class="p">(</span><span class="n">qty</span><span class="p">),</span> <span class="n">discount</span><span class="p">(</span><span class="n">disc</span><span class="p">)</span> <span class="p">{}</span>
  <span class="kt">double</span> <span class="n">net_price</span><span class="p">(</span><span class="n">size_t</span><span class="p">)</span> <span class="k">const</span> <span class="k">override</span><span class="p">;</span>
  <span class="n">ostream</span> <span class="o">&amp;</span><span class="n">debug</span><span class="p">()</span> <span class="k">const</span> <span class="k">override</span><span class="p">;</span>
  <span class="n">Bulk_quote</span> <span class="o">*</span><span class="nf">clone</span><span class="p">()</span> <span class="k">const</span> <span class="o">&amp;</span> <span class="k">override</span> <span class="p">{</span><span class="k">return</span> <span class="k">new</span> <span class="n">Bulk_quote</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">);}</span>
  <span class="n">Bulk_quote</span> <span class="o">*</span><span class="nf">clone</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="k">override</span> <span class="p">{</span><span class="k">return</span> <span class="k">new</span> <span class="n">Bulk_quote</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">));}</span>
  <span class="o">~</span><span class="n">Bulk_quote</span><span class="p">()</span> <span class="k">override</span> <span class="p">{</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;~Bulk_quote()&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;}</span>
 <span class="k">private</span><span class="o">:</span>
  <span class="n">size_t</span> <span class="n">min_qty</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="kt">double</span> <span class="n">discount</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
<span class="p">};</span>
<span class="kt">double</span> <span class="n">Bulk_quote</span><span class="o">::</span><span class="n">net_price</span><span class="p">(</span><span class="n">size_t</span> <span class="n">cnt</span><span class="p">)</span> <span class="k">const</span>
<span class="p">{</span>
  <span class="k">if</span><span class="p">(</span><span class="n">cnt</span> <span class="o">&gt;=</span> <span class="n">min_qty</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">cnt</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">discount</span><span class="p">)</span> <span class="o">*</span> <span class="n">price</span><span class="p">;</span>
  <span class="k">else</span>
    <span class="k">return</span> <span class="n">cnt</span> <span class="o">*</span> <span class="n">price</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">ostream</span> <span class="o">&amp;</span><span class="n">Bulk_quote</span><span class="o">::</span><span class="n">debug</span><span class="p">()</span> <span class="k">const</span>
<span class="p">{</span>
  <span class="n">Quote</span><span class="o">::</span><span class="n">debug</span><span class="p">();</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34; min_qty &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">min_qty</span> <span class="o">&lt;&lt;</span> <span class="s">&#34; discount &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">discount</span><span class="p">;</span>
  <span class="k">return</span> <span class="n">cout</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">#endif
</span><span class="cp"></span></code></pre></td></tr></table>
</div>
</div>
<h2 id="exercise-15-dot-6">Exercise 15.6</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">Quote</span> <span class="n">a</span><span class="p">(</span><span class="s">&#34;123&#34;</span><span class="p">,</span> <span class="mf">21.1</span><span class="p">);</span>
  <span class="n">Bulk_quote</span> <span class="n">b</span><span class="p">(</span><span class="s">&#34;123&#34;</span><span class="p">,</span> <span class="mf">21.1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">);</span>
  <span class="n">Limit_Bulk_quote</span> <span class="n">c</span><span class="p">(</span><span class="s">&#34;123&#34;</span><span class="p">,</span> <span class="mf">21.1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">);</span>
  <span class="n">print_total</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
  <span class="n">a</span><span class="p">.</span><span class="n">debug</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">print_total</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
  <span class="n">b</span><span class="p">.</span><span class="n">debug</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">print_total</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="mi">6</span><span class="p">);</span>
  <span class="n">c</span><span class="p">.</span><span class="n">debug</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>
<h2 id="exercise-15-dot-7">Exercise 15.7</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="c1">// See Limit_Bulk_quote.h.
</span><span class="c1"></span></code></pre></td></tr></table>
</div>
</div>
<h2 id="limit-bulk-quote-dot-h">Limit_Bulk_quote.h</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="cp">#ifndef LIMIT_BULK_QUOTE_H
</span><span class="cp">#define LIMIT_BULK_QUOTE_H
</span><span class="cp"></span><span class="k">class</span><span class="err"> </span><span class="nc">Limit_Bulk_quote</span><span class="o">:</span> <span class="k">public</span> <span class="n">Quote</span>
<span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="n">Limit_Bulk_quote</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>
 <span class="n">Limit_Bulk_quote</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span> <span class="n">book</span><span class="p">,</span> <span class="kt">double</span> <span class="n">p</span><span class="p">,</span> <span class="n">size_t</span> <span class="n">qty</span><span class="p">,</span> <span class="kt">double</span> <span class="n">disc</span><span class="p">)</span><span class="o">:</span>
  <span class="n">Quote</span><span class="p">(</span><span class="n">book</span><span class="p">,</span> <span class="n">p</span><span class="p">),</span> <span class="n">max_qty</span><span class="p">(</span><span class="n">qty</span><span class="p">),</span> <span class="n">discount</span><span class="p">(</span><span class="n">disc</span><span class="p">)</span> <span class="p">{}</span>
  <span class="kt">double</span> <span class="n">net_price</span><span class="p">(</span><span class="n">size_t</span><span class="p">)</span> <span class="k">const</span> <span class="k">override</span><span class="p">;</span>
  <span class="n">ostream</span> <span class="o">&amp;</span><span class="n">debug</span><span class="p">()</span> <span class="k">const</span> <span class="k">override</span><span class="p">;</span>
 <span class="k">private</span><span class="o">:</span>
  <span class="n">size_t</span> <span class="n">max_qty</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="kt">double</span> <span class="n">discount</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
<span class="p">};</span>
<span class="kt">double</span> <span class="n">Limit_Bulk_quote</span><span class="o">::</span><span class="n">net_price</span><span class="p">(</span><span class="n">size_t</span> <span class="n">cnt</span><span class="p">)</span> <span class="k">const</span>
<span class="p">{</span>
  <span class="k">if</span><span class="p">(</span><span class="n">cnt</span> <span class="o">&lt;=</span> <span class="n">max_qty</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">cnt</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">discount</span><span class="p">)</span> <span class="o">*</span> <span class="n">price</span><span class="p">;</span>
  <span class="k">else</span>
    <span class="k">return</span> <span class="n">max_qty</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">discount</span><span class="p">)</span> <span class="o">*</span> <span class="n">price</span> <span class="o">+</span> <span class="p">(</span><span class="n">cnt</span> <span class="o">-</span> <span class="n">max_qty</span><span class="p">)</span> <span class="o">*</span> <span class="n">price</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">ostream</span> <span class="o">&amp;</span><span class="n">Limit_Bulk_quote</span><span class="o">::</span><span class="n">debug</span><span class="p">()</span> <span class="k">const</span>
<span class="p">{</span>
  <span class="n">Quote</span><span class="o">::</span><span class="n">debug</span><span class="p">();</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34; max_qty &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">max_qty</span> <span class="o">&lt;&lt;</span> <span class="s">&#34; discount &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">discount</span><span class="p">;</span>
  <span class="k">return</span> <span class="n">cout</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">#endif
</span><span class="cp"></span></code></pre></td></tr></table>
</div>
</div>
<h2 id="exercise-15-dot-8">Exercise 15.8</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="c1">// static type
</span><span class="c1">// which is used in declaration of variable, or evaluated from expression;
</span><span class="c1">// known in compile process.
</span><span class="c1">// dynamic type
</span><span class="c1">// which is the type of object allocated in memory and represented by variable or expression;
</span><span class="c1">// known until run-time.
</span><span class="c1"></span></code></pre></td></tr></table>
</div>
</div>
<h2 id="exercise-15-dot-9">Exercise 15.9</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="c1">// When bind a pointer of a reference of base class type to a object of derived class type, the static type is different from the dynamic type.
</span><span class="c1">// class Base { ... };
</span><span class="c1">// class Derived: public Base { ... };
</span><span class="c1">// int f(const Base &amp;b) { ... }
</span><span class="c1">// Derived d;
</span><span class="c1">// Base &amp;b = d;
</span><span class="c1">// Base *p = &amp;d;
</span><span class="c1">// f(d);
</span><span class="c1"></span></code></pre></td></tr></table>
</div>
</div>
<h2 id="exercise-15-dot-10">Exercise 15.10</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="c1">// ifstream object if passed in as argument to read function of Sales_data object;
</span><span class="c1">// read function&#39;s first parameter&#39;s type is &#39;istream &amp;&#39;;
</span><span class="c1">// while ifstream class type is derived from istream class type;
</span><span class="c1">// then this parameter could be initialized by ifstream object, binded to the istream sub-object of ifstream object;
</span><span class="c1"></span></code></pre></td></tr></table>
</div>
</div>
<h2 id="exercise-15-dot-11">Exercise 15.11</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="c1">// See Quote.h, Bulk_quote.h and Limit_quote.h.
</span><span class="c1"></span></code></pre></td></tr></table>
</div>
</div>
<p><a href="#bulk-quote-dot-h">Bulk_quote.h</a></p>

<p><a href="#quote-dot-h">Quote.h</a></p>

<h2 id="limit-quote-dot-h">Limit_quote.h</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++">
</code></pre></td></tr></table>
</div>
</div>
<h2 id="exercise-15-dot-12">Exercise 15.12</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="c1">// Unnecessary;
</span><span class="c1">// &#39;final&#39; implicitly means that this function is a override virtual function of the virtual function within base class.
</span><span class="c1">// Am I right?
</span><span class="c1">// Emacs &amp; cquery &amp; flycheck do not warn me when I replace override with final.
</span><span class="c1"></span></code></pre></td></tr></table>
</div>
</div>
<h2 id="exercise-15-dot-13">Exercise 15.13</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="k">class</span><span class="err"> </span><span class="nc">base</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
  <span class="n">string</span> <span class="n">name</span><span class="p">()</span> <span class="p">{</span><span class="k">return</span> <span class="n">basename</span><span class="p">;}</span>
  <span class="k">virtual</span> <span class="kt">void</span> <span class="n">print</span><span class="p">(</span><span class="n">ostream</span> <span class="o">&amp;</span><span class="n">os</span><span class="p">)</span> <span class="p">{</span><span class="n">os</span> <span class="o">&lt;&lt;</span> <span class="n">basename</span><span class="p">;};</span>
<span class="k">private</span><span class="o">:</span>
  <span class="n">string</span> <span class="n">basename</span><span class="p">;</span>
<span class="p">};</span>
<span class="k">class</span><span class="err"> </span><span class="nc">derived</span><span class="o">:</span> <span class="k">public</span> <span class="n">base</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
  <span class="c1">// void print(ostream &amp;os) {print(os); os &lt;&lt; &#34; &#34; &lt;&lt; i;} // call itself within function body causes infinite recursion.
</span><span class="c1"></span>  <span class="kt">void</span> <span class="n">print</span><span class="p">(</span><span class="n">ostream</span> <span class="o">&amp;</span><span class="n">os</span><span class="p">)</span> <span class="k">override</span> <span class="p">{</span><span class="n">base</span><span class="o">::</span><span class="n">print</span><span class="p">(</span><span class="n">os</span><span class="p">);</span> <span class="n">os</span> <span class="o">&lt;&lt;</span> <span class="s">&#34; &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">i</span><span class="p">;}</span>
<span class="k">private</span><span class="o">:</span>
  <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></td></tr></table>
</div>
</div>
<h2 id="exercise-15-dot-14">Exercise 15.14</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">base</span> <span class="n">bobj</span><span class="p">;</span>
  <span class="n">derived</span> <span class="n">dobj</span><span class="p">;</span>
  <span class="n">base</span> <span class="o">*</span><span class="n">bp1</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">bobj</span><span class="p">;</span>
  <span class="n">base</span> <span class="o">*</span><span class="n">bp2</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">dobj</span><span class="p">;</span>
  <span class="n">base</span> <span class="o">&amp;</span><span class="n">br1</span> <span class="o">=</span> <span class="n">bobj</span><span class="p">;</span>
  <span class="n">base</span> <span class="o">&amp;</span><span class="n">br2</span> <span class="o">=</span> <span class="n">dobj</span><span class="p">;</span>
  <span class="n">bobj</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">cout</span><span class="p">);</span>		<span class="c1">// base::print
</span><span class="c1"></span>  <span class="n">dobj</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">cout</span><span class="p">);</span>		<span class="c1">// derived::print
</span><span class="c1"></span>  <span class="n">bp1</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">();</span>			<span class="c1">// base::name
</span><span class="c1"></span>  <span class="n">bp2</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">();</span>			<span class="c1">// base::name
</span><span class="c1"></span>  <span class="n">br1</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">cout</span><span class="p">);</span> 		<span class="c1">// base::print
</span><span class="c1"></span>  <span class="n">br2</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">cout</span><span class="p">);</span>		<span class="c1">// derived::print
</span><span class="c1"></span><span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>
<h2 id="exercise-15-dot-15">Exercise 15.15</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="c1">// See Disc_quote.h and Bulk_quote-1515.h.
</span><span class="c1"></span></code></pre></td></tr></table>
</div>
</div>
<h2 id="bulk-quote-1515-dot-h">Bulk_quote-1515.h</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="cp">#ifndef BULK_QUOTE_H
</span><span class="cp">#define BULK_QUOTE_H
</span><span class="cp"></span><span class="k">class</span><span class="err"> </span><span class="nc">Bulk_quote</span><span class="o">:</span> <span class="k">public</span> <span class="n">Disc_quote</span>
<span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="n">Bulk_quote</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>
 <span class="n">Bulk_quote</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span> <span class="n">book</span><span class="p">,</span> <span class="kt">double</span> <span class="n">p</span><span class="p">,</span> <span class="n">size_t</span> <span class="n">qty</span><span class="p">,</span> <span class="kt">double</span> <span class="n">disc</span><span class="p">)</span><span class="o">:</span>
  <span class="n">Disc_quote</span><span class="p">(</span><span class="n">book</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">qty</span><span class="p">,</span> <span class="n">disc</span><span class="p">)</span> <span class="p">{}</span>
  <span class="kt">double</span> <span class="n">net_price</span><span class="p">(</span><span class="n">size_t</span><span class="p">)</span> <span class="k">const</span> <span class="k">override</span><span class="p">;</span>
  <span class="n">ostream</span> <span class="o">&amp;</span><span class="n">debug</span><span class="p">()</span> <span class="k">const</span> <span class="k">override</span><span class="p">;</span>
<span class="p">};</span>
<span class="kt">double</span> <span class="n">Bulk_quote</span><span class="o">::</span><span class="n">net_price</span><span class="p">(</span><span class="n">size_t</span> <span class="n">cnt</span><span class="p">)</span> <span class="k">const</span>
<span class="p">{</span>
  <span class="k">if</span><span class="p">(</span><span class="n">cnt</span> <span class="o">&gt;=</span> <span class="n">quantity</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">cnt</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">discount</span><span class="p">)</span> <span class="o">*</span> <span class="n">price</span><span class="p">;</span>
  <span class="k">else</span>
    <span class="k">return</span> <span class="n">cnt</span> <span class="o">*</span> <span class="n">price</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">ostream</span> <span class="o">&amp;</span><span class="n">Bulk_quote</span><span class="o">::</span><span class="n">debug</span><span class="p">()</span> <span class="k">const</span>
<span class="p">{</span>
  <span class="n">Quote</span><span class="o">::</span><span class="n">debug</span><span class="p">();</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34; min_qty &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">quantity</span> <span class="o">&lt;&lt;</span> <span class="s">&#34; discount &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">discount</span><span class="p">;</span>
  <span class="k">return</span> <span class="n">cout</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">#endif
</span><span class="cp"></span></code></pre></td></tr></table>
</div>
</div>
<h2 id="disc-quote-dot-h">Disc_quote.h</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="k">class</span><span class="err"> </span><span class="nc">Disc_quote</span><span class="o">:</span> <span class="k">public</span> <span class="n">Quote</span>
<span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="n">Disc_quote</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>
  <span class="n">Disc_quote</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="n">book</span><span class="p">,</span> <span class="kt">double</span> <span class="n">price</span><span class="p">,</span>
	   <span class="n">size_t</span> <span class="n">qty</span><span class="p">,</span> <span class="kt">double</span> <span class="n">disc</span><span class="p">)</span><span class="o">:</span>
  <span class="n">Quote</span><span class="p">(</span><span class="n">book</span><span class="p">,</span> <span class="n">price</span><span class="p">),</span> <span class="n">quantity</span><span class="p">(</span><span class="n">qty</span><span class="p">),</span> <span class="n">discount</span><span class="p">(</span><span class="n">disc</span><span class="p">)</span> <span class="p">{}</span>
  <span class="kt">double</span> <span class="n">net_price</span><span class="p">(</span><span class="n">size_t</span><span class="p">)</span> <span class="k">const</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
 <span class="k">protected</span><span class="o">:</span>
  <span class="n">size_t</span> <span class="n">quantity</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="kt">double</span> <span class="n">discount</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></td></tr></table>
</div>
</div>
<h2 id="exercise-15-dot-16">Exercise 15.16</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="c1">// See Limit_Bulk_quote-1516.h.
</span><span class="c1"></span></code></pre></td></tr></table>
</div>
</div>
<h2 id="limit-bulk-quote-1516-dot-h">Limit_Bulk_quote-1516.h</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="cp">#ifndef LIMIT_BULK_QUOTE_H
</span><span class="cp">#define LIMIT_BULK_QUOTE_H
</span><span class="cp"></span><span class="k">class</span><span class="err"> </span><span class="nc">Limit_Bulk_quote</span><span class="o">:</span> <span class="k">public</span> <span class="n">Disc_quote</span>
<span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="n">Limit_Bulk_quote</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>
 <span class="n">Limit_Bulk_quote</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span> <span class="n">book</span><span class="p">,</span> <span class="kt">double</span> <span class="n">p</span><span class="p">,</span> <span class="n">size_t</span> <span class="n">qty</span><span class="p">,</span> <span class="kt">double</span> <span class="n">disc</span><span class="p">)</span><span class="o">:</span>
  <span class="n">Disc_quote</span><span class="p">(</span><span class="n">book</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">qty</span><span class="p">,</span> <span class="n">disc</span><span class="p">)</span> <span class="p">{}</span>
  <span class="kt">double</span> <span class="n">net_price</span><span class="p">(</span><span class="n">size_t</span><span class="p">)</span> <span class="k">const</span> <span class="k">override</span><span class="p">;</span>
  <span class="n">ostream</span> <span class="o">&amp;</span><span class="n">debug</span><span class="p">()</span> <span class="k">const</span> <span class="k">override</span><span class="p">;</span>
<span class="p">};</span>
<span class="kt">double</span> <span class="n">Limit_Bulk_quote</span><span class="o">::</span><span class="n">net_price</span><span class="p">(</span><span class="n">size_t</span> <span class="n">cnt</span><span class="p">)</span> <span class="k">const</span>
<span class="p">{</span>
  <span class="k">if</span><span class="p">(</span><span class="n">cnt</span> <span class="o">&lt;=</span> <span class="n">quantity</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">cnt</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">discount</span><span class="p">)</span> <span class="o">*</span> <span class="n">price</span><span class="p">;</span>
  <span class="k">else</span>
    <span class="k">return</span> <span class="n">quantity</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">discount</span><span class="p">)</span> <span class="o">*</span> <span class="n">price</span> <span class="o">+</span> <span class="p">(</span><span class="n">cnt</span> <span class="o">-</span> <span class="n">quantity</span><span class="p">)</span> <span class="o">*</span> <span class="n">price</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">ostream</span> <span class="o">&amp;</span><span class="n">Limit_Bulk_quote</span><span class="o">::</span><span class="n">debug</span><span class="p">()</span> <span class="k">const</span>
<span class="p">{</span>
  <span class="n">Quote</span><span class="o">::</span><span class="n">debug</span><span class="p">();</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34; max_qty &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">quantity</span> <span class="o">&lt;&lt;</span> <span class="s">&#34; discount &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">discount</span><span class="p">;</span>
  <span class="k">return</span> <span class="n">cout</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">#endif
</span><span class="cp"></span></code></pre></td></tr></table>
</div>
</div>
<h2 id="exercise-15-dot-17">Exercise 15.17</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">Disc_quote</span> <span class="n">d</span><span class="p">;</span>
  <span class="c1">// variable type &#39;Disc_quote&#39; is an abstract class
</span><span class="c1"></span><span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>
<h2 id="exercise-15-dot-18">Exercise 15.18</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="c1">// Base *p = &amp;dl;
</span><span class="c1">// d1: Pub_Derv
</span><span class="c1">// legal
</span><span class="c1">// p = &amp;d2;
</span><span class="c1">// d2: Priv_Derv
</span><span class="c1">// illegal, for the derivation access specifier of Priv_Derv is private, conversion from Priv_Derv to its base class Base is forbidden;
</span><span class="c1">// p = &amp;d3;
</span><span class="c1">// d3: Prot_Derv
</span><span class="c1">// illegal, for the derivation access spedifier of Prot_Derv is protected, conversion from Priv_Derv to its base class Base is forbidden;
</span><span class="c1">// p = &amp;dd1;
</span><span class="c1">// dd1: Derived_from_Public
</span><span class="c1">// legal
</span><span class="c1">// p = &amp;dd2;
</span><span class="c1">// dd2: Derived_from_Private
</span><span class="c1">// illegal, same reason as the second one;
</span><span class="c1">// p = &amp;dd3;
</span><span class="c1">// dd3: Derived_from_Protected
</span><span class="c1">// illegal, same reason as the third one.
</span><span class="c1"></span></code></pre></td></tr></table>
</div>
</div>
<h2 id="exercise-15-dot-19">Exercise 15.19</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="c1">// void memfcn(Base &amp;b) { b = &amp;this; }
</span><span class="c1">// as member function
</span><span class="c1">// for Base:
</span><span class="c1">// legal;
</span><span class="c1">// for Pub_Derv:
</span><span class="c1">// legal;
</span><span class="c1">// for Pro_Derv;
</span><span class="c1">// legal;
</span><span class="c1">// for Priv_Derv:
</span><span class="c1">// legal;
</span><span class="c1">// for Derived_from_Public:
</span><span class="c1">// legal;
</span><span class="c1">// for Derived_from_Private:
</span><span class="c1">// illegal;
</span><span class="c1">// for the derivation access specifier of Priv_Derv is private, member or friend of derivaed class of Priv_Derv would nerver call the conversion from Derived_from_private to Base class.
</span><span class="c1">// for Derived_from_Protected:
</span><span class="c1">// legal;
</span><span class="c1"></span></code></pre></td></tr></table>
</div>
</div>
<h2 id="exercise-15-dot-20">Exercise 15.20</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="k">class</span><span class="err"> </span><span class="nc">Base</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
  <span class="kt">void</span> <span class="n">memfcn</span><span class="p">(</span><span class="n">Base</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span> <span class="p">{</span><span class="n">b</span> <span class="o">=</span> <span class="o">*</span><span class="k">this</span><span class="p">;}</span>
  <span class="kt">void</span> <span class="n">pub_mem</span><span class="p">();</span>
<span class="k">protected</span><span class="o">:</span>
  <span class="kt">int</span> <span class="n">prot_mem</span><span class="p">;</span>
<span class="k">private</span><span class="o">:</span>
  <span class="kt">char</span> <span class="n">priv_mem</span><span class="p">;</span>
<span class="p">};</span>
<span class="k">struct</span> <span class="nl">Pub_Derv</span><span class="p">:</span> <span class="k">public</span> <span class="n">Base</span>
<span class="p">{</span>
  <span class="kt">void</span> <span class="n">memfcn</span><span class="p">(</span><span class="n">Base</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span> <span class="p">{</span><span class="n">b</span> <span class="o">=</span> <span class="o">*</span><span class="k">this</span><span class="p">;}</span>
  <span class="kt">int</span> <span class="n">f</span><span class="p">()</span> <span class="p">{</span><span class="k">return</span> <span class="n">prot_mem</span><span class="p">;}</span>
<span class="p">};</span>
<span class="k">struct</span> <span class="nl">Priv_Derv</span><span class="p">:</span> <span class="k">private</span> <span class="n">Base</span>
<span class="p">{</span>
  <span class="kt">void</span> <span class="n">memfcn</span><span class="p">(</span><span class="n">Base</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span> <span class="p">{</span><span class="n">b</span> <span class="o">=</span> <span class="o">*</span><span class="k">this</span><span class="p">;}</span>
  <span class="kt">int</span> <span class="n">f1</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span><span class="k">return</span> <span class="n">prot_mem</span><span class="p">;}</span>
<span class="p">};</span>
<span class="k">struct</span> <span class="nl">Prot_Derv</span><span class="p">:</span> <span class="k">protected</span> <span class="n">Base</span>
<span class="p">{</span>
  <span class="kt">void</span> <span class="n">memfcn</span><span class="p">(</span><span class="n">Base</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span> <span class="p">{</span><span class="n">b</span> <span class="o">=</span> <span class="o">*</span><span class="k">this</span><span class="p">;}</span>
  <span class="kt">int</span> <span class="n">f2</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span><span class="k">return</span> <span class="n">prot_mem</span><span class="p">;}</span>
<span class="p">};</span>
<span class="k">struct</span> <span class="nl">Derived_from_Public</span><span class="p">:</span> <span class="k">public</span> <span class="n">Pub_Derv</span>
<span class="p">{</span>
  <span class="kt">void</span> <span class="n">memfcn</span><span class="p">(</span><span class="n">Base</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span> <span class="p">{</span><span class="n">b</span> <span class="o">=</span> <span class="o">*</span><span class="k">this</span><span class="p">;}</span>
  <span class="kt">int</span> <span class="n">use_base</span><span class="p">()</span> <span class="p">{</span><span class="k">return</span> <span class="n">prot_mem</span><span class="p">;};</span>
<span class="p">};</span>
<span class="k">struct</span> <span class="nl">Derived_from_Private</span><span class="p">:</span> <span class="k">public</span> <span class="n">Priv_Derv</span>
<span class="p">{</span>
  <span class="kt">void</span> <span class="n">memfcn</span><span class="p">(</span><span class="n">Base</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span> <span class="p">{</span><span class="n">b</span> <span class="o">=</span> <span class="o">*</span><span class="k">this</span><span class="p">;}</span> <span class="c1">// illegal
</span><span class="c1"></span>  <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
<span class="p">};</span>
<span class="k">struct</span> <span class="nl">Derived_from_Protected</span><span class="p">:</span> <span class="k">public</span> <span class="n">Prot_Derv</span>
<span class="p">{</span>
  <span class="kt">void</span> <span class="n">memfcn</span><span class="p">(</span><span class="n">Base</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span> <span class="p">{</span><span class="n">b</span> <span class="o">=</span> <span class="o">*</span><span class="k">this</span><span class="p">;}</span>
  <span class="kt">int</span> <span class="n">use_base</span><span class="p">()</span> <span class="p">{</span><span class="k">return</span> <span class="n">prot_mem</span><span class="p">;}</span>
<span class="p">};</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">Pub_Derv</span> <span class="n">d1</span><span class="p">;</span>
  <span class="n">Priv_Derv</span> <span class="n">d2</span><span class="p">;</span>
  <span class="n">Prot_Derv</span> <span class="n">d3</span><span class="p">;</span>
  <span class="n">Derived_from_Public</span> <span class="n">dd1</span><span class="p">;</span>
  <span class="n">Derived_from_Private</span> <span class="n">dd2</span><span class="p">;</span>
  <span class="n">Derived_from_Protected</span> <span class="n">dd3</span><span class="p">;</span>

  <span class="n">Base</span> <span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">d1</span><span class="p">;</span>		<span class="c1">// legal;
</span><span class="c1"></span>  <span class="n">p</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">d2</span><span class="p">;</span>			<span class="c1">// illegal;
</span><span class="c1"></span>  <span class="n">p</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">d3</span><span class="p">;</span>			<span class="c1">// illegal;
</span><span class="c1"></span>  <span class="n">p</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">dd1</span><span class="p">;</span>			<span class="c1">// legal;
</span><span class="c1"></span>  <span class="n">p</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">dd2</span><span class="p">;</span>			<span class="c1">// illegal;
</span><span class="c1"></span>  <span class="n">p</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">dd3</span><span class="p">;</span>			<span class="c1">// illegal;
</span><span class="c1"></span><span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>
<h2 id="exercise-15-dot-21">Exercise 15.21</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="k">class</span><span class="err"> </span><span class="nc">Employee</span>
<span class="p">{</span>
<span class="k">private</span><span class="o">:</span>
  <span class="n">string</span> <span class="n">name</span><span class="p">;</span>
  <span class="n">string</span> <span class="n">department</span><span class="p">;</span>
  <span class="n">string</span> <span class="n">address</span><span class="p">;</span>
  <span class="n">string</span> <span class="n">contact</span><span class="p">;</span>
<span class="k">protected</span><span class="o">:</span>
  <span class="kt">int</span> <span class="n">salary</span><span class="p">;</span>
<span class="k">public</span><span class="o">:</span>
  <span class="n">Employee</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>
  <span class="n">Employee</span><span class="p">(</span><span class="n">string</span> <span class="n">n</span><span class="p">,</span> <span class="n">string</span> <span class="n">d</span><span class="p">,</span> <span class="n">string</span> <span class="n">a</span><span class="p">,</span> <span class="n">string</span> <span class="n">c</span><span class="p">,</span> <span class="kt">int</span> <span class="n">s</span><span class="p">)</span><span class="o">:</span>
    <span class="n">name</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">department</span><span class="p">(</span><span class="n">d</span><span class="p">),</span> <span class="n">address</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">contact</span><span class="p">(</span><span class="n">c</span><span class="p">),</span> <span class="n">salary</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="p">{}</span>
  <span class="n">string</span> <span class="n">get_name</span><span class="p">()</span> <span class="p">{</span><span class="k">return</span> <span class="n">name</span><span class="p">;}</span>
  <span class="n">string</span> <span class="n">get_department</span><span class="p">()</span> <span class="p">{</span><span class="k">return</span> <span class="n">department</span><span class="p">;}</span>
  <span class="n">string</span> <span class="n">get_address</span><span class="p">()</span> <span class="p">{</span><span class="k">return</span> <span class="n">address</span><span class="p">;}</span>
  <span class="n">string</span> <span class="n">get_contact</span><span class="p">()</span> <span class="p">{</span><span class="k">return</span> <span class="n">contact</span><span class="p">;}</span>
  <span class="k">virtual</span> <span class="kt">int</span> <span class="n">get_payment</span><span class="p">()</span> <span class="p">{</span><span class="k">return</span> <span class="n">salary</span><span class="p">;}</span>
<span class="p">};</span>
<span class="k">class</span><span class="err"> </span><span class="nc">Manager</span><span class="o">:</span> <span class="k">public</span> <span class="n">Employee</span>
<span class="p">{</span>
<span class="k">protected</span><span class="o">:</span>
  <span class="kt">int</span> <span class="n">bonus</span><span class="p">;</span>
<span class="k">public</span><span class="o">:</span>
  <span class="n">Manager</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>
  <span class="n">Manager</span><span class="p">(</span><span class="n">string</span> <span class="n">n</span><span class="p">,</span> <span class="n">string</span> <span class="n">d</span><span class="p">,</span> <span class="n">string</span> <span class="n">a</span><span class="p">,</span> <span class="n">string</span> <span class="n">c</span><span class="p">,</span> <span class="kt">int</span> <span class="n">s</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span><span class="o">:</span>
    <span class="n">Employee</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">s</span><span class="p">),</span> <span class="n">bonus</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="p">{}</span>
  <span class="kt">int</span> <span class="n">get_payment</span><span class="p">()</span> <span class="k">override</span> <span class="p">{</span><span class="k">return</span> <span class="n">salary</span> <span class="o">+</span> <span class="n">bonus</span><span class="p">;}</span>
<span class="p">};</span>
<span class="k">class</span><span class="err"> </span><span class="nc">CEO</span><span class="o">:</span> <span class="k">public</span> <span class="n">Manager</span>
<span class="p">{</span>
<span class="k">protected</span><span class="o">:</span>
  <span class="kt">int</span> <span class="n">share</span><span class="p">;</span>
<span class="k">public</span><span class="o">:</span>
  <span class="n">CEO</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>
  <span class="n">CEO</span><span class="p">(</span><span class="n">string</span> <span class="n">n</span><span class="p">,</span> <span class="n">string</span> <span class="n">d</span><span class="p">,</span> <span class="n">string</span> <span class="n">a</span><span class="p">,</span> <span class="n">string</span> <span class="n">c</span><span class="p">,</span> <span class="kt">int</span> <span class="n">s</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">,</span> <span class="kt">int</span> <span class="n">sh</span><span class="p">)</span><span class="o">:</span>
    <span class="n">Manager</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">b</span><span class="p">),</span> <span class="n">share</span><span class="p">(</span><span class="n">sh</span><span class="p">)</span> <span class="p">{}</span>
  <span class="kt">int</span> <span class="n">get_payment</span><span class="p">()</span> <span class="k">override</span> <span class="p">{</span><span class="k">return</span> <span class="n">salary</span> <span class="o">+</span> <span class="n">bonus</span> <span class="o">+</span> <span class="n">share</span><span class="p">;}</span>
<span class="p">};</span>
</code></pre></td></tr></table>
</div>
</div>
<h2 id="exercise-15-dot-22">Exercise 15.22</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="c1">// See 15.21.cpp.
</span><span class="c1"></span></code></pre></td></tr></table>
</div>
</div>
<h2 id="15-dot-21-dot-cpp">15.21.cpp</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="k">class</span><span class="err"> </span><span class="nc">Employee</span>
<span class="p">{</span>
<span class="k">private</span><span class="o">:</span>
  <span class="n">string</span> <span class="n">name</span><span class="p">;</span>
  <span class="n">string</span> <span class="n">department</span><span class="p">;</span>
  <span class="n">string</span> <span class="n">address</span><span class="p">;</span>
  <span class="n">string</span> <span class="n">contact</span><span class="p">;</span>
<span class="k">protected</span><span class="o">:</span>
  <span class="kt">int</span> <span class="n">salary</span><span class="p">;</span>
<span class="k">public</span><span class="o">:</span>
  <span class="n">Employee</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>
  <span class="n">Employee</span><span class="p">(</span><span class="n">string</span> <span class="n">n</span><span class="p">,</span> <span class="n">string</span> <span class="n">d</span><span class="p">,</span> <span class="n">string</span> <span class="n">a</span><span class="p">,</span> <span class="n">string</span> <span class="n">c</span><span class="p">,</span> <span class="kt">int</span> <span class="n">s</span><span class="p">)</span><span class="o">:</span>
    <span class="n">name</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">department</span><span class="p">(</span><span class="n">d</span><span class="p">),</span> <span class="n">address</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">contact</span><span class="p">(</span><span class="n">c</span><span class="p">),</span> <span class="n">salary</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="p">{}</span>
  <span class="n">string</span> <span class="n">get_name</span><span class="p">()</span> <span class="p">{</span><span class="k">return</span> <span class="n">name</span><span class="p">;}</span>
  <span class="n">string</span> <span class="n">get_department</span><span class="p">()</span> <span class="p">{</span><span class="k">return</span> <span class="n">department</span><span class="p">;}</span>
  <span class="n">string</span> <span class="n">get_address</span><span class="p">()</span> <span class="p">{</span><span class="k">return</span> <span class="n">address</span><span class="p">;}</span>
  <span class="n">string</span> <span class="n">get_contact</span><span class="p">()</span> <span class="p">{</span><span class="k">return</span> <span class="n">contact</span><span class="p">;}</span>
  <span class="k">virtual</span> <span class="kt">int</span> <span class="n">get_payment</span><span class="p">()</span> <span class="p">{</span><span class="k">return</span> <span class="n">salary</span><span class="p">;}</span>
<span class="p">};</span>
<span class="k">class</span><span class="err"> </span><span class="nc">Manager</span><span class="o">:</span> <span class="k">public</span> <span class="n">Employee</span>
<span class="p">{</span>
<span class="k">protected</span><span class="o">:</span>
  <span class="kt">int</span> <span class="n">bonus</span><span class="p">;</span>
<span class="k">public</span><span class="o">:</span>
  <span class="n">Manager</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>
  <span class="n">Manager</span><span class="p">(</span><span class="n">string</span> <span class="n">n</span><span class="p">,</span> <span class="n">string</span> <span class="n">d</span><span class="p">,</span> <span class="n">string</span> <span class="n">a</span><span class="p">,</span> <span class="n">string</span> <span class="n">c</span><span class="p">,</span> <span class="kt">int</span> <span class="n">s</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span><span class="o">:</span>
    <span class="n">Employee</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">s</span><span class="p">),</span> <span class="n">bonus</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="p">{}</span>
  <span class="kt">int</span> <span class="n">get_payment</span><span class="p">()</span> <span class="k">override</span> <span class="p">{</span><span class="k">return</span> <span class="n">salary</span> <span class="o">+</span> <span class="n">bonus</span><span class="p">;}</span>
<span class="p">};</span>
<span class="k">class</span><span class="err"> </span><span class="nc">CEO</span><span class="o">:</span> <span class="k">public</span> <span class="n">Manager</span>
<span class="p">{</span>
<span class="k">protected</span><span class="o">:</span>
  <span class="kt">int</span> <span class="n">share</span><span class="p">;</span>
<span class="k">public</span><span class="o">:</span>
  <span class="n">CEO</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>
  <span class="n">CEO</span><span class="p">(</span><span class="n">string</span> <span class="n">n</span><span class="p">,</span> <span class="n">string</span> <span class="n">d</span><span class="p">,</span> <span class="n">string</span> <span class="n">a</span><span class="p">,</span> <span class="n">string</span> <span class="n">c</span><span class="p">,</span> <span class="kt">int</span> <span class="n">s</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">,</span> <span class="kt">int</span> <span class="n">sh</span><span class="p">)</span><span class="o">:</span>
    <span class="n">Manager</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">b</span><span class="p">),</span> <span class="n">share</span><span class="p">(</span><span class="n">sh</span><span class="p">)</span> <span class="p">{}</span>
  <span class="kt">int</span> <span class="n">get_payment</span><span class="p">()</span> <span class="k">override</span> <span class="p">{</span><span class="k">return</span> <span class="n">salary</span> <span class="o">+</span> <span class="n">bonus</span> <span class="o">+</span> <span class="n">share</span><span class="p">;}</span>
<span class="p">};</span>
</code></pre></td></tr></table>
</div>
</div>
<h2 id="exercise-15-dot-23">Exercise 15.23</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="k">class</span><span class="err"> </span><span class="nc">Base</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
  <span class="k">virtual</span> <span class="kt">int</span> <span class="n">fcn</span><span class="p">();</span>
<span class="p">};</span>
<span class="k">class</span><span class="err"> </span><span class="nc">D1</span><span class="o">:</span> <span class="k">public</span> <span class="n">Base</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
  <span class="kt">int</span> <span class="n">fcn</span><span class="p">()</span> <span class="k">override</span><span class="p">;</span>
  <span class="kt">int</span> <span class="nf">fcn</span><span class="p">(</span><span class="kt">int</span><span class="p">);</span>
  <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">f2</span><span class="p">();</span>
<span class="p">};</span>
<span class="k">class</span><span class="err"> </span><span class="nc">D2</span><span class="o">:</span> <span class="k">public</span> <span class="n">D1</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
  <span class="kt">int</span> <span class="n">fcn</span><span class="p">(</span><span class="kt">int</span><span class="p">);</span>
  <span class="kt">int</span> <span class="nf">fcn</span><span class="p">()</span> <span class="k">override</span><span class="p">;</span>
  <span class="kt">void</span> <span class="nf">f2</span><span class="p">()</span> <span class="k">override</span><span class="p">;</span>
<span class="p">};</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">Base</span> <span class="n">bobj</span><span class="p">;</span>
  <span class="n">D1</span> <span class="n">d1obj</span><span class="p">;</span>
  <span class="n">D2</span> <span class="n">d2obj</span><span class="p">;</span>
  <span class="n">Base</span> <span class="o">*</span><span class="n">bp1</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">bobj</span><span class="p">,</span> <span class="o">*</span><span class="n">bp2</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">d1obj</span><span class="p">,</span> <span class="o">*</span><span class="n">bp3</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">d2obj</span><span class="p">;</span>
  <span class="c1">// ...
</span><span class="c1"></span>  <span class="n">bp2</span><span class="o">-&gt;</span><span class="n">fcn</span><span class="p">();</span>			<span class="c1">// D1::fcn()
</span><span class="c1"></span>  <span class="c1">// ...
</span><span class="c1"></span>  <span class="c1">// others stay unchanged
</span><span class="c1"></span><span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>
<h2 id="exercise-15-dot-24">Exercise 15.24</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="c1">// Base class and its derived class require a virtual destructor;
</span><span class="c1">// a virtual destructor of class type should release the resource occupied by the object of that type.
</span><span class="c1"></span></code></pre></td></tr></table>
</div>
</div>
<h2 id="exercise-15-dot-25">Exercise 15.25</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="c1">// Due to the fact that we have defined a constructor with paremeters for Disc_quote class, then there would be no default constructor fot this class;
</span><span class="c1">// but there is a default constructor defined within Bulk_quote class, which is a derived class of Disc_quote; when this constructor is called, it would call the default constructor of Disc_quote class to construct a Disc_quote sub-object;
</span><span class="c1">// so we must define a default constructor for Disc_quote class, or the calling of default constructor of Bulk_quote would fail.
</span><span class="c1"></span></code></pre></td></tr></table>
</div>
</div>
<h2 id="exercise-15-dot-26">Exercise 15.26</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="c1">// See Quote.h and Bulk_quote.h.
</span><span class="c1"></span><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">Quote</span> <span class="n">q</span><span class="p">;</span>
  <span class="c1">// Bulk_quote b;
</span><span class="c1"></span>  <span class="c1">// Quote q2 = q;
</span><span class="c1"></span>  <span class="c1">// Quote q3 = std::move(q);
</span><span class="c1"></span>  <span class="c1">// q = q2;
</span><span class="c1"></span>  <span class="c1">// q = std::move(q3);
</span><span class="c1"></span>  <span class="c1">// Bulk_quote b2 = b;
</span><span class="c1"></span>  <span class="c1">// Bulk_quote b3 = std::move(b);
</span><span class="c1"></span>  <span class="c1">// b = b2;
</span><span class="c1"></span>  <span class="c1">// b = std::move(b2);
</span><span class="c1"></span><span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>
<p><a href="#bulk-quote-dot-h">Bulk_quote.h</a></p>

<p><a href="#quote-dot-h">Quote.h</a></p>

<h2 id="exercise-15-dot-27">Exercise 15.27</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="c1">// See Bulk_quote.h.
</span><span class="c1"></span></code></pre></td></tr></table>
</div>
</div>
<p><a href="#bulk-quote-dot-h">Bulk_quote.h</a></p>

<h2 id="exercise-15-dot-28">Exercise 15.28</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">vector</span><span class="o">&lt;</span><span class="n">Quote</span><span class="o">&gt;</span> <span class="n">basket1</span><span class="p">;</span>
  <span class="n">basket1</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">Bulk_quote</span><span class="p">(</span><span class="s">&#34;123&#34;</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mf">0.10</span><span class="p">));</span>
  <span class="n">basket1</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">Bulk_quote</span><span class="p">(</span><span class="s">&#34;234&#34;</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">));</span>
  <span class="kt">double</span> <span class="n">total</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
  <span class="k">for</span><span class="p">(</span><span class="k">const</span> <span class="k">auto</span> <span class="o">&amp;</span><span class="nl">p</span> <span class="p">:</span> <span class="n">basket1</span><span class="p">)</span>
    <span class="n">total</span> <span class="o">+=</span> <span class="n">p</span><span class="p">.</span><span class="n">net_price</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">total</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">string</span><span class="p">(</span><span class="s">&#34;=&#34;</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">vector</span><span class="o">&lt;</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Quote</span><span class="o">&gt;&gt;</span> <span class="n">basket2</span><span class="p">;</span>
  <span class="n">basket2</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">Bulk_quote</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&#34;123&#34;</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mf">0.10</span><span class="p">));</span>
  <span class="n">basket2</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">Bulk_quote</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&#34;234&#34;</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">));</span>
  <span class="n">total</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
  <span class="k">for</span><span class="p">(</span><span class="k">const</span> <span class="k">auto</span> <span class="o">&amp;</span><span class="nl">p</span> <span class="p">:</span> <span class="n">basket2</span><span class="p">)</span>
    <span class="n">total</span> <span class="o">+=</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">net_price</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">total</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>
<h2 id="exercise-15-dot-29">Exercise 15.29</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="c1">// See 15.28.cpp.
</span><span class="c1">// The output is different from the previous one;
</span><span class="c1">// for the first version of basket&#39;s element type is Quote, when pushed a Bulk_quote object into this vector, a Quote object as a copy of the Qutoe part of Bulk_quote object is pushed in, at last we call the Quote&#39;s net_price version;
</span><span class="c1">// for the next version of basket&#39;s element type is shared_ptr&lt;quote&gt;, a shared_ptr&lt;quote&gt; could be binded to a Bulk_quote object because Bulk_quote public derived from Quote class, then the version of net_price is determined by object&#39;s dynamic type.
</span><span class="c1"></span></code></pre></td></tr></table>
</div>
</div>
<h2 id="15-dot-28-dot-cpp">15.28.cpp</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">vector</span><span class="o">&lt;</span><span class="n">Quote</span><span class="o">&gt;</span> <span class="n">basket1</span><span class="p">;</span>
  <span class="n">basket1</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">Bulk_quote</span><span class="p">(</span><span class="s">&#34;123&#34;</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mf">0.10</span><span class="p">));</span>
  <span class="n">basket1</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">Bulk_quote</span><span class="p">(</span><span class="s">&#34;234&#34;</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">));</span>
  <span class="kt">double</span> <span class="n">total</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
  <span class="k">for</span><span class="p">(</span><span class="k">const</span> <span class="k">auto</span> <span class="o">&amp;</span><span class="nl">p</span> <span class="p">:</span> <span class="n">basket1</span><span class="p">)</span>
    <span class="n">total</span> <span class="o">+=</span> <span class="n">p</span><span class="p">.</span><span class="n">net_price</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">total</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">string</span><span class="p">(</span><span class="s">&#34;=&#34;</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">vector</span><span class="o">&lt;</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Quote</span><span class="o">&gt;&gt;</span> <span class="n">basket2</span><span class="p">;</span>
  <span class="n">basket2</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">Bulk_quote</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&#34;123&#34;</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mf">0.10</span><span class="p">));</span>
  <span class="n">basket2</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">Bulk_quote</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&#34;234&#34;</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">));</span>
  <span class="n">total</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
  <span class="k">for</span><span class="p">(</span><span class="k">const</span> <span class="k">auto</span> <span class="o">&amp;</span><span class="nl">p</span> <span class="p">:</span> <span class="n">basket2</span><span class="p">)</span>
    <span class="n">total</span> <span class="o">+=</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">net_price</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">total</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>
<h2 id="exercise-15-dot-30">Exercise 15.30</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="k">class</span><span class="err"> </span><span class="nc">Basket</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
  <span class="kt">void</span> <span class="n">add_item</span><span class="p">(</span><span class="k">const</span> <span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Quote</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">sale</span><span class="p">)</span>
  <span class="p">{</span><span class="n">items</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">sale</span><span class="p">);}</span>
  <span class="kt">void</span> <span class="n">add_item</span><span class="p">(</span><span class="k">const</span> <span class="n">Quote</span> <span class="o">&amp;</span><span class="n">sale</span><span class="p">)</span>
  <span class="p">{</span><span class="n">items</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Quote</span><span class="o">&gt;</span><span class="p">(</span><span class="n">sale</span><span class="p">.</span><span class="n">clone</span><span class="p">()));}</span>
  <span class="kt">void</span> <span class="n">add_item</span><span class="p">(</span><span class="n">Quote</span> <span class="o">&amp;&amp;</span><span class="n">sale</span><span class="p">)</span>
  <span class="p">{</span><span class="n">items</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Quote</span><span class="o">&gt;</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">sale</span><span class="p">).</span><span class="n">clone</span><span class="p">()));}</span>
  <span class="kt">double</span> <span class="n">total_receipt</span><span class="p">(</span><span class="n">ostream</span> <span class="o">&amp;</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
<span class="k">private</span><span class="o">:</span>
  <span class="k">static</span> <span class="kt">bool</span> <span class="n">compare</span><span class="p">(</span><span class="k">const</span> <span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Quote</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">lhs</span><span class="p">,</span>
		    <span class="k">const</span> <span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Quote</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">rhs</span><span class="p">)</span>
  <span class="p">{</span><span class="k">return</span> <span class="n">lhs</span><span class="o">-&gt;</span><span class="n">isbn</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">rhs</span><span class="o">-&gt;</span><span class="n">isbn</span><span class="p">();}</span>
  <span class="n">multiset</span><span class="o">&lt;</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Quote</span><span class="o">&gt;</span><span class="p">,</span> <span class="k">decltype</span><span class="p">(</span><span class="n">compare</span><span class="p">)</span><span class="o">*&gt;</span>
  <span class="n">items</span><span class="p">{</span><span class="n">compare</span><span class="p">};</span>
<span class="p">};</span>
<span class="kt">double</span> <span class="n">Basket</span><span class="o">::</span><span class="n">total_receipt</span><span class="p">(</span><span class="n">ostream</span> <span class="o">&amp;</span><span class="n">os</span><span class="p">)</span> <span class="k">const</span>
<span class="p">{</span>
  <span class="kt">double</span> <span class="n">sum</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
  <span class="k">for</span><span class="p">(</span><span class="k">auto</span> <span class="n">iter</span> <span class="o">=</span> <span class="n">items</span><span class="p">.</span><span class="n">cbegin</span><span class="p">();</span>
      <span class="n">iter</span> <span class="o">!=</span> <span class="n">items</span><span class="p">.</span><span class="n">cend</span><span class="p">();</span>
      <span class="n">iter</span> <span class="o">=</span> <span class="n">items</span><span class="p">.</span><span class="n">upper_bound</span><span class="p">(</span><span class="o">*</span><span class="n">iter</span><span class="p">))</span>
    <span class="p">{</span><span class="n">sum</span> <span class="o">+=</span> <span class="n">print_total</span><span class="p">(</span><span class="n">os</span><span class="p">,</span> <span class="o">**</span><span class="n">iter</span><span class="p">,</span> <span class="n">items</span><span class="p">.</span><span class="n">count</span><span class="p">(</span><span class="o">*</span><span class="n">iter</span><span class="p">));}</span>
  <span class="n">os</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Total Sale: &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">sum</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="k">return</span> <span class="n">sum</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">Basket</span> <span class="n">basket</span><span class="p">;</span>
  <span class="n">basket</span><span class="p">.</span><span class="n">add_item</span><span class="p">(</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">Quote</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&#34;123&#34;</span><span class="p">,</span> <span class="mi">50</span><span class="p">));</span>
  <span class="n">basket</span><span class="p">.</span><span class="n">add_item</span><span class="p">(</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">Quote</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&#34;234&#34;</span><span class="p">,</span> <span class="mi">60</span><span class="p">));</span>
  <span class="n">basket</span><span class="p">.</span><span class="n">total_receipt</span><span class="p">(</span><span class="n">cout</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>
<h2 id="exercise-15-dot-31">Exercise 15.31</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="c1">// Query(s1) | Query(s2) &amp; ~Query(s3);
</span><span class="c1">// returns a Query object binded to a AndQuery object;
</span><span class="c1">// Query(s1) | Query(s2) returns a Query object binded to a OrQuery object;
</span><span class="c1">// ~Query(s3) returns a Query object binded to a NotQuery object;
</span><span class="c1">// the base level are all WordQuery objects.
</span><span class="c1">// Query(s1) | (Query(s2) &amp; ~Query(s3));
</span><span class="c1">// returns a Query object binded to a OrQuery object
</span><span class="c1">// Query(s1) returns a Query object binded to WordQuery object;
</span><span class="c1">// (Query(s2) &amp; ~Query(s3)) returns a Query object binded to a AndQuery object;
</span><span class="c1">// ~Query(s3) returns a Query object binded to a NotQuery object;
</span><span class="c1">// the base level are all WordQuery objects.
</span><span class="c1">// (Query(s1) &amp; (Query(s2)) | (Query(s3) &amp; Query(s4)))
</span><span class="c1">// returns a Query object binded to OrQuery object
</span><span class="c1">// (Query(s1) &amp; (Query(s2))) returns a Query object binded to a AndQuery object;
</span><span class="c1">// (Query(s3) &amp; Query(s4)) returns a Query object binded to a AndQuery object;
</span><span class="c1">// the base level are all WordQuery objects.
</span><span class="c1"></span></code></pre></td></tr></table>
</div>
</div>
<h2 id="exercise-15-dot-32">Exercise 15.32</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="c1">// When a Query class type object is copied:
</span><span class="c1">// would call the synthesized copy constructor of Query class, then the copy constructor of shared_ptr&lt;Query_base&gt; is called to constructor the new Query object&#39;s data member q, and the use count of both shared_ptr objects increase by 1;
</span><span class="c1">// move
</span><span class="c1">// since shared_ptr&lt;Query_base&gt; has a move constructor and there is no self-defined copy control members within Query, there is a synthesized move constructor, it is called to move construct the new Query object&#39;s data member q, the use-count stay unchanged;
</span><span class="c1">// assignment
</span><span class="c1">// synthesized copy-assignment operator or synthesized move-assignment operator: depenes on whether it is copy assignment or move assignment, this would call copy-assignment operator or move-assignment operator of shared_ptr&lt;Query_base&gt; to assign the left Query object&#39;s data member q, and use count increase by 1 or stay unchanged;
</span><span class="c1">// destruction
</span><span class="c1">// synthesized destructor: just call the destructor of shared_ptr&lt;Query_base&gt; member; depends on the use-count of this shared_ptr object, if it comes to 0 the destructor of the pointed object would be called(which destructor relies on its dynamic type).
</span><span class="c1"></span></code></pre></td></tr></table>
</div>
</div>
<h2 id="exercise-15-dot-33">Exercise 15.33</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="c1">// This exercise should specify that the object is of derived class type whose base class is Query_base
</span><span class="c1">// call the derived class type object&#39;s own copy control members;
</span><span class="c1">// thus would call the synthesized version of copy control members of Query_base.
</span><span class="c1"></span></code></pre></td></tr></table>
</div>
</div>
<h2 id="exercise-15-dot-34">Exercise 15.34</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="c1">// Query q = Query(&#34;fiery&#34;) &amp; Query(&#34;bird&#34;) | Query(&#34;wind&#34;)
</span><span class="c1">// a
</span><span class="c1">// constructor:
</span><span class="c1">// Query(const string &amp;);
</span><span class="c1">// WordQuery(const string &amp;);
</span><span class="c1">// AndQuery(const Query &amp;, cosnt Query &amp;);
</span><span class="c1">// OrQuery(const Query &amp;, const Query &amp;);
</span><span class="c1">// BinaryQuery(const Query &amp;, const Query &amp;, string);
</span><span class="c1">// Query_base();
</span><span class="c1">// Query(shared_ptr&lt;Query_base&gt;)
</span><span class="c1">// b
</span><span class="c1">// Query::rep() // missed in first attempt
</span><span class="c1">// BinaryQuery::rep()
</span><span class="c1">// WordQuery::rep()
</span><span class="c1">// c
</span><span class="c1">// OrQuery::eval
</span><span class="c1">// AndQuery::eval
</span><span class="c1">// WordQuery::eval
</span><span class="c1"></span></code></pre></td></tr></table>
</div>
</div>
<h2 id="exercise-15-dot-36">Exercise 15.36</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">Query</span> <span class="n">q</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span><span class="s">&#34;fiery&#34;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">Query</span><span class="p">(</span><span class="s">&#34;bird&#34;</span><span class="p">)</span> <span class="o">|</span> <span class="n">Query</span><span class="p">(</span><span class="s">&#34;wind&#34;</span><span class="p">);</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">q</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>
<h2 id="exercise-15-dot-37">Exercise 15.37</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="c1">// Change the parameter type of &#39;const Query &amp;&#39; to &#39;shared_ptr&lt;Query_base&gt;&#39; for NotQuery, BinaryQuery, AndQuery and OrQuery class&#39;s constructor, use passed in argument to initialize data member shared_ptr&lt;Query_base&gt;;
</span><span class="c1">// the call of eval and rep inside class type now uses shared_ptr&lt;Query_base&gt; data members and &#39;-&gt;&#39; operator.
</span><span class="c1">// three overload operator functions should change its paramter type from &#39;const Query &amp;&#39; to &#39;shared_ptr&lt;Query_base&gt;&#39;, and its return type from &#39;Query&#39; to &#39;shared_ptr&lt;Query_base&gt;&#39; too.
</span><span class="c1">// in a word, the interface layer of Query class is replaced by direct operation of shared_ptr&lt;Query_base&gt;.
</span><span class="c1"></span></code></pre></td></tr></table>
</div>
</div>
<h2 id="exercise-15-dot-38">Exercise 15.38</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="c1">// BinaryQuery a = Query(&#34;fiery&#34;) &amp; Query(&#34;bird&#34;)
</span><span class="c1">// false;
</span><span class="c1">// BinaryQuery is a abstract class, construct of this class type is illegal.
</span><span class="c1">// AndQuery b = Query(&#34;fiery&#34;) &amp; Query(&#34;bird&#34;)
</span><span class="c1">// false
</span><span class="c1">// operator&amp;(const Query &amp;, const Query &amp;) returns a object of Query class type, not AndQuery, and there is no available way of conversion from Query to AndQuery.
</span><span class="c1">// OrQuery b = Query(&#34;fiery&#34;) &amp; Query(&#34;bird&#34;)
</span><span class="c1">// false
</span><span class="c1">// operator&amp;(const Query &amp;, const Query &amp;) returns a object of Query class type, not OrQuery, and there is no available way of conversion from Query to OrQuery.
</span><span class="c1"></span></code></pre></td></tr></table>
</div>
</div>
<h2 id="exercise-15-dot-39">Exercise 15.39</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="c1">// See 15.35.h.
</span><span class="c1"></span><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span>
<span class="p">{</span>
  <span class="n">ifstream</span> <span class="n">ifs</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
  <span class="n">TextQuery</span> <span class="n">tq</span><span class="p">(</span><span class="n">ifs</span><span class="p">);</span>
  <span class="n">Query</span> <span class="n">q</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span><span class="s">&#34;fiery&#34;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">Query</span><span class="p">(</span><span class="s">&#34;bird&#34;</span><span class="p">)</span> <span class="o">|</span> <span class="n">Query</span><span class="p">(</span><span class="s">&#34;wind&#34;</span><span class="p">);</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">q</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="k">auto</span> <span class="n">result</span> <span class="o">=</span> <span class="n">q</span><span class="p">.</span><span class="n">eval</span><span class="p">(</span><span class="n">tq</span><span class="p">);</span>
  <span class="n">print</span><span class="p">(</span><span class="n">cout</span><span class="p">,</span> <span class="n">result</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>
<h2 id="15-dot-35-dot-h">15.35.h</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="k">class</span><span class="err"> </span><span class="nc">Query_base</span>
<span class="p">{</span>
  <span class="k">friend</span> <span class="k">class</span><span class="err"> </span><span class="nc">Query</span><span class="p">;</span>
<span class="k">protected</span><span class="o">:</span>
  <span class="k">using</span> <span class="n">line_no</span> <span class="o">=</span> <span class="n">TextQuery</span><span class="o">::</span><span class="n">line_no</span><span class="p">;</span>
  <span class="n">Query_base</span><span class="p">()</span> <span class="p">{</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Query_base::Query_base()&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;}</span>
  <span class="k">virtual</span> <span class="o">~</span><span class="n">Query_base</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>
<span class="k">private</span><span class="o">:</span>
  <span class="k">virtual</span> <span class="n">QueryResult</span> <span class="n">eval</span><span class="p">(</span><span class="k">const</span> <span class="n">TextQuery</span> <span class="o">&amp;</span><span class="p">)</span> <span class="k">const</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">virtual</span> <span class="n">string</span> <span class="nf">rep</span><span class="p">()</span> <span class="k">const</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">};</span>
<span class="k">class</span><span class="err"> </span><span class="nc">Query</span>
<span class="p">{</span>
  <span class="k">friend</span> <span class="n">Query</span> <span class="k">operator</span><span class="o">~</span><span class="p">(</span><span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="p">);</span>
  <span class="k">friend</span> <span class="n">Query</span> <span class="k">operator</span><span class="o">|</span><span class="p">(</span><span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="p">,</span> <span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="p">);</span>
  <span class="k">friend</span> <span class="n">Query</span> <span class="k">operator</span><span class="o">&amp;</span><span class="p">(</span><span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="p">,</span> <span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="p">);</span>
<span class="k">public</span><span class="o">:</span>
  <span class="n">Query</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="p">);</span>
  <span class="n">QueryResult</span> <span class="nf">eval</span><span class="p">(</span><span class="k">const</span> <span class="n">TextQuery</span> <span class="o">&amp;</span><span class="n">t</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span><span class="k">return</span> <span class="n">q</span><span class="o">-&gt;</span><span class="n">eval</span><span class="p">(</span><span class="n">t</span><span class="p">);}</span>
  <span class="n">string</span> <span class="nf">rep</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Query::rep&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span> <span class="k">return</span> <span class="n">q</span><span class="o">-&gt;</span><span class="n">rep</span><span class="p">();}</span>
<span class="k">private</span><span class="o">:</span>
 <span class="n">Query</span><span class="p">(</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Query_base</span><span class="o">&gt;</span> <span class="n">query</span><span class="p">)</span><span class="o">:</span> <span class="n">q</span><span class="p">(</span><span class="n">query</span><span class="p">)</span> <span class="p">{</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Query::Query(shared_ptr)&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;}</span>
  <span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Query_base</span><span class="o">&gt;</span> <span class="n">q</span><span class="p">;</span>
<span class="p">};</span>
<span class="k">class</span><span class="err"> </span><span class="nc">WordQuery</span><span class="o">:</span> <span class="k">public</span> <span class="n">Query_base</span>
<span class="p">{</span>
  <span class="k">friend</span> <span class="k">class</span><span class="err"> </span><span class="nc">Query</span><span class="p">;</span>
 <span class="n">WordQuery</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="n">s</span><span class="p">)</span><span class="o">:</span> <span class="n">query_word</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="p">{</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;WordQuery::WordQuery(const string &amp;)&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;}</span>
  <span class="n">QueryResult</span> <span class="n">eval</span><span class="p">(</span><span class="k">const</span> <span class="n">TextQuery</span> <span class="o">&amp;</span><span class="n">t</span><span class="p">)</span> <span class="k">const</span>
  <span class="p">{</span><span class="k">return</span> <span class="n">t</span><span class="p">.</span><span class="n">query</span><span class="p">(</span><span class="n">query_word</span><span class="p">);}</span>
  <span class="n">string</span> <span class="n">rep</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;WordQuery::rep&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span> <span class="k">return</span> <span class="n">query_word</span><span class="p">;}</span>
  <span class="n">string</span> <span class="n">query_word</span><span class="p">;</span>
<span class="p">};</span>
<span class="kr">inline</span> <span class="n">Query</span><span class="o">::</span><span class="n">Query</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="n">s</span><span class="p">)</span><span class="o">:</span> <span class="n">q</span><span class="p">(</span><span class="k">new</span> <span class="n">WordQuery</span><span class="p">(</span><span class="n">s</span><span class="p">))</span> <span class="p">{</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Query::Query(const string &amp;)&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;}</span>
<span class="k">class</span><span class="err"> </span><span class="nc">BinaryQuery</span><span class="o">:</span> <span class="k">public</span> <span class="n">Query_base</span>
<span class="p">{</span>
 <span class="k">protected</span><span class="o">:</span>
 <span class="n">BinaryQuery</span><span class="p">(</span><span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="n">l</span><span class="p">,</span> <span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="n">r</span><span class="p">,</span> <span class="n">string</span> <span class="n">s</span><span class="p">)</span><span class="o">:</span>
  <span class="n">lhs</span><span class="p">(</span><span class="n">l</span><span class="p">),</span> <span class="n">rhs</span><span class="p">(</span><span class="n">r</span><span class="p">),</span> <span class="n">opSym</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="p">{</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;BinaryQuery::BinaryQuery&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;}</span>
  <span class="n">string</span> <span class="n">rep</span><span class="p">()</span> <span class="k">const</span>
  <span class="p">{</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;BinaryQuery::rep&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="k">return</span> <span class="s">&#34;(&#34;</span> <span class="o">+</span> <span class="n">lhs</span><span class="p">.</span><span class="n">rep</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#34; &#34;</span>
      <span class="o">+</span> <span class="n">opSym</span> <span class="o">+</span> <span class="s">&#34; &#34;</span>
      <span class="o">+</span> <span class="n">rhs</span><span class="p">.</span><span class="n">rep</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#34;)&#34;</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">Query</span> <span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">;</span>
  <span class="n">string</span> <span class="n">opSym</span><span class="p">;</span>
<span class="p">};</span>
<span class="k">class</span><span class="err"> </span><span class="nc">AndQuery</span><span class="o">:</span> <span class="k">public</span> <span class="n">BinaryQuery</span>
<span class="p">{</span>
  <span class="k">friend</span> <span class="n">Query</span> <span class="k">operator</span><span class="o">&amp;</span><span class="p">(</span><span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="p">,</span> <span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="p">);</span>
 <span class="n">AndQuery</span><span class="p">(</span><span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="n">left</span><span class="p">,</span> <span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="n">right</span><span class="p">)</span><span class="o">:</span>
  <span class="n">BinaryQuery</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="s">&#34;&amp;&#34;</span><span class="p">)</span> <span class="p">{</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;AndQuery::AndQuery&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;}</span>
  <span class="n">QueryResult</span> <span class="n">eval</span><span class="p">(</span><span class="k">const</span> <span class="n">TextQuery</span> <span class="o">&amp;</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
<span class="p">};</span>
<span class="kr">inline</span> <span class="n">Query</span> <span class="k">operator</span><span class="o">&amp;</span><span class="p">(</span><span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="n">lhs</span><span class="p">,</span> <span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="n">rhs</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Query_base</span><span class="o">&gt;</span><span class="p">(</span><span class="k">new</span> <span class="n">AndQuery</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">));</span>
<span class="p">}</span>
<span class="n">QueryResult</span>
<span class="n">AndQuery</span><span class="o">::</span><span class="n">eval</span><span class="p">(</span><span class="k">const</span> <span class="n">TextQuery</span> <span class="o">&amp;</span><span class="n">text</span><span class="p">)</span> <span class="k">const</span>
<span class="p">{</span>
  <span class="k">auto</span> <span class="n">left</span> <span class="o">=</span> <span class="n">lhs</span><span class="p">.</span><span class="n">eval</span><span class="p">(</span><span class="n">text</span><span class="p">),</span> <span class="n">right</span> <span class="o">=</span> <span class="n">rhs</span><span class="p">.</span><span class="n">eval</span><span class="p">(</span><span class="n">text</span><span class="p">);</span>
  <span class="k">auto</span> <span class="n">ret_lines</span> <span class="o">=</span> <span class="n">make_shared</span><span class="o">&lt;</span><span class="n">set</span><span class="o">&lt;</span><span class="n">line_no</span><span class="o">&gt;&gt;</span><span class="p">();</span>
  <span class="n">set_intersection</span><span class="p">(</span><span class="n">left</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">left</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span>
		<span class="n">right</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">right</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span>
		<span class="n">inserter</span><span class="p">(</span><span class="o">*</span><span class="n">ret_lines</span><span class="p">,</span> <span class="n">ret_lines</span><span class="o">-&gt;</span><span class="n">begin</span><span class="p">()));</span>
  <span class="k">return</span> <span class="nf">QueryResult</span><span class="p">(</span><span class="n">rep</span><span class="p">(),</span> <span class="n">ret_lines</span><span class="p">,</span> <span class="n">left</span><span class="p">.</span><span class="n">get_file</span><span class="p">());</span>
<span class="p">}</span>
<span class="k">class</span><span class="err"> </span><span class="nc">OrQuery</span><span class="o">:</span> <span class="k">public</span> <span class="n">BinaryQuery</span>
<span class="p">{</span>
  <span class="k">friend</span> <span class="n">Query</span> <span class="k">operator</span><span class="o">|</span><span class="p">(</span><span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="p">,</span> <span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="p">);</span>
 <span class="n">OrQuery</span><span class="p">(</span><span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="n">left</span><span class="p">,</span> <span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="n">right</span><span class="p">)</span><span class="o">:</span>
  <span class="n">BinaryQuery</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="s">&#34;|&#34;</span><span class="p">)</span> <span class="p">{</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;OrQUery::OrQuery&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;}</span>
  <span class="n">QueryResult</span> <span class="n">eval</span><span class="p">(</span><span class="k">const</span> <span class="n">TextQuery</span> <span class="o">&amp;</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
<span class="p">};</span>
<span class="kr">inline</span> <span class="n">Query</span> <span class="k">operator</span><span class="o">|</span><span class="p">(</span><span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="n">lhs</span><span class="p">,</span> <span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="n">rhs</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Query_base</span><span class="o">&gt;</span><span class="p">(</span><span class="k">new</span> <span class="n">OrQuery</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">));</span>
<span class="p">}</span>
<span class="n">ostream</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="n">ostream</span> <span class="o">&amp;</span><span class="n">os</span><span class="p">,</span> <span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="n">query</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="n">os</span> <span class="o">&lt;&lt;</span> <span class="n">query</span><span class="p">.</span><span class="n">rep</span><span class="p">();</span>
<span class="p">}</span>
<span class="n">QueryResult</span> <span class="n">OrQuery</span><span class="o">::</span><span class="n">eval</span><span class="p">(</span><span class="k">const</span> <span class="n">TextQuery</span> <span class="o">&amp;</span><span class="n">text</span><span class="p">)</span> <span class="k">const</span>
<span class="p">{</span>
  <span class="k">auto</span> <span class="n">right</span> <span class="o">=</span> <span class="n">rhs</span><span class="p">.</span><span class="n">eval</span><span class="p">(</span><span class="n">text</span><span class="p">),</span> <span class="n">left</span> <span class="o">=</span> <span class="n">lhs</span><span class="p">.</span><span class="n">eval</span><span class="p">(</span><span class="n">text</span><span class="p">);</span>
  <span class="k">auto</span> <span class="n">ret_lines</span> <span class="o">=</span> <span class="n">make_shared</span><span class="o">&lt;</span><span class="n">set</span><span class="o">&lt;</span><span class="n">line_no</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="n">left</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">left</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>
  <span class="n">ret_lines</span><span class="o">-&gt;</span><span class="n">insert</span><span class="p">(</span><span class="n">right</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">right</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>
  <span class="k">return</span> <span class="nf">QueryResult</span><span class="p">(</span><span class="n">rep</span><span class="p">(),</span> <span class="n">ret_lines</span><span class="p">,</span> <span class="n">left</span><span class="p">.</span><span class="n">get_file</span><span class="p">());</span>
<span class="p">}</span>
<span class="k">class</span><span class="err"> </span><span class="nc">NotQuery</span><span class="o">:</span> <span class="k">public</span> <span class="n">Query_base</span>
<span class="p">{</span>
  <span class="k">friend</span> <span class="n">Query</span> <span class="k">operator</span><span class="o">~</span><span class="p">(</span><span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="p">);</span>
 <span class="n">NotQuery</span><span class="p">(</span><span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="n">q</span><span class="p">)</span><span class="o">:</span> <span class="n">query</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="p">{}</span>
  <span class="n">string</span> <span class="n">rep</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span><span class="k">return</span> <span class="s">&#34;~(&#34;</span> <span class="o">+</span> <span class="n">query</span><span class="p">.</span><span class="n">rep</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#34;)&#34;</span><span class="p">;}</span>
  <span class="n">QueryResult</span> <span class="n">eval</span><span class="p">(</span><span class="k">const</span> <span class="n">TextQuery</span> <span class="o">&amp;</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
  <span class="n">Query</span> <span class="n">query</span><span class="p">;</span>
<span class="p">};</span>
<span class="kr">inline</span> <span class="n">Query</span> <span class="k">operator</span><span class="o">~</span><span class="p">(</span><span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="n">operand</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Query_base</span><span class="o">&gt;</span><span class="p">(</span><span class="k">new</span> <span class="n">NotQuery</span><span class="p">(</span><span class="n">operand</span><span class="p">));</span>
<span class="p">}</span>
<span class="n">QueryResult</span>
<span class="n">NotQuery</span><span class="o">::</span><span class="n">eval</span><span class="p">(</span><span class="k">const</span> <span class="n">TextQuery</span> <span class="o">&amp;</span><span class="n">text</span><span class="p">)</span> <span class="k">const</span>
<span class="p">{</span>
  <span class="k">auto</span> <span class="n">result</span> <span class="o">=</span> <span class="n">query</span><span class="p">.</span><span class="n">eval</span><span class="p">(</span><span class="n">text</span><span class="p">);</span>
  <span class="k">auto</span> <span class="n">ret_lines</span> <span class="o">=</span> <span class="n">make_shared</span><span class="o">&lt;</span><span class="n">set</span><span class="o">&lt;</span><span class="n">line_no</span><span class="o">&gt;&gt;</span><span class="p">();</span>
  <span class="k">auto</span> <span class="n">beg</span> <span class="o">=</span> <span class="n">result</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">end</span> <span class="o">=</span> <span class="n">result</span><span class="p">.</span><span class="n">end</span><span class="p">();</span>
  <span class="k">auto</span> <span class="n">sz</span> <span class="o">=</span> <span class="n">result</span><span class="p">.</span><span class="n">get_file</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">();</span>
  <span class="k">for</span><span class="p">(</span><span class="n">size_t</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">n</span> <span class="o">!=</span> <span class="n">sz</span><span class="p">;</span> <span class="o">++</span><span class="n">n</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span><span class="n">beg</span> <span class="o">==</span> <span class="n">end</span> <span class="o">||</span> <span class="o">*</span><span class="n">beg</span> <span class="o">!=</span> <span class="n">n</span><span class="p">)</span>
      <span class="n">ret_lines</span><span class="o">-&gt;</span><span class="n">insert</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>
      <span class="k">else</span> <span class="nf">if</span><span class="p">(</span><span class="n">beg</span> <span class="o">!=</span> <span class="n">end</span><span class="p">)</span>
      <span class="o">++</span><span class="n">beg</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="k">return</span> <span class="n">QueryResult</span><span class="p">(</span><span class="n">rep</span><span class="p">(),</span> <span class="n">ret_lines</span><span class="p">,</span> <span class="n">result</span><span class="p">.</span><span class="n">get_file</span><span class="p">());</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>
<h2 id="exercise-15-dot-40">Exercise 15.40</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="c1">// Within OrQuery, if rhs.eval(text) returns a QueryResult object which points to an empty set, the return value of OrQuery::eval would be same as the result of lhs.eval(text);
</span><span class="c1">// vise versa;
</span><span class="c1">// if both results of rhs.eval and lhs.eval point to an empty set, the return QueryResult of OrQuery::eval points to an empty set, too.
</span><span class="c1"></span></code></pre></td></tr></table>
</div>
</div>
<h2 id="exercise-15-dot-41">Exercise 15.41</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span>
<span class="p">{</span>
  <span class="n">ifstream</span> <span class="n">ifs</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
  <span class="n">TextQuery</span> <span class="n">tq</span><span class="p">(</span><span class="n">ifs</span><span class="p">);</span>
  <span class="n">Query</span> <span class="n">q</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span><span class="s">&#34;fiery&#34;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">Query</span><span class="p">(</span><span class="s">&#34;bird&#34;</span><span class="p">)</span> <span class="o">|</span> <span class="n">Query</span><span class="p">(</span><span class="s">&#34;wind&#34;</span><span class="p">);</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">q</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="k">auto</span> <span class="n">result</span> <span class="o">=</span> <span class="n">q</span><span class="p">.</span><span class="n">eval</span><span class="p">(</span><span class="n">tq</span><span class="p">);</span>
  <span class="n">print</span><span class="p">(</span><span class="n">cout</span><span class="p">,</span> <span class="n">result</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>
<h2 id="15-dot-41-dot-h">15.41.h</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="k">class</span><span class="err"> </span><span class="nc">Query_base</span>
<span class="p">{</span>
  <span class="k">friend</span> <span class="k">class</span><span class="err"> </span><span class="nc">Query</span><span class="p">;</span>
<span class="k">protected</span><span class="o">:</span>
  <span class="k">using</span> <span class="n">line_no</span> <span class="o">=</span> <span class="n">TextQuery</span><span class="o">::</span><span class="n">line_no</span><span class="p">;</span>
  <span class="n">Query_base</span><span class="p">()</span> <span class="p">{}</span>
  <span class="k">virtual</span> <span class="o">~</span><span class="n">Query_base</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>
<span class="k">private</span><span class="o">:</span>
  <span class="k">virtual</span> <span class="n">QueryResult</span> <span class="n">eval</span><span class="p">(</span><span class="k">const</span> <span class="n">TextQuery</span> <span class="o">&amp;</span><span class="p">)</span> <span class="k">const</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">virtual</span> <span class="n">string</span> <span class="nf">rep</span><span class="p">()</span> <span class="k">const</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">class</span><span class="err"> </span><span class="nc">Query</span>
<span class="p">{</span>
  <span class="k">friend</span> <span class="n">Query</span> <span class="k">operator</span><span class="o">~</span><span class="p">(</span><span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="p">);</span>
  <span class="k">friend</span> <span class="n">Query</span> <span class="k">operator</span><span class="o">|</span><span class="p">(</span><span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="p">,</span> <span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="p">);</span>
  <span class="k">friend</span> <span class="n">Query</span> <span class="k">operator</span><span class="o">&amp;</span><span class="p">(</span><span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="p">,</span> <span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="p">);</span>
<span class="k">public</span><span class="o">:</span>
  <span class="n">Query</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="p">);</span>
  <span class="n">Query</span><span class="p">(</span><span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="n">p</span><span class="p">)</span><span class="o">:</span> <span class="n">q</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">q</span><span class="p">),</span> <span class="n">use</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">use</span><span class="p">)</span> <span class="p">{</span><span class="o">++*</span><span class="n">use</span><span class="p">;}</span>
  <span class="n">Query</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="n">p</span><span class="p">);</span>
  <span class="n">QueryResult</span> <span class="nf">eval</span><span class="p">(</span><span class="k">const</span> <span class="n">TextQuery</span> <span class="o">&amp;</span><span class="n">t</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span><span class="k">return</span> <span class="n">q</span><span class="o">-&gt;</span><span class="n">eval</span><span class="p">(</span><span class="n">t</span><span class="p">);}</span>
  <span class="n">string</span> <span class="nf">rep</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span><span class="k">return</span> <span class="n">q</span><span class="o">-&gt;</span><span class="n">rep</span><span class="p">();}</span>
  <span class="o">~</span><span class="n">Query</span><span class="p">()</span>
  <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="o">--*</span><span class="n">use</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
      <span class="p">{</span>
	<span class="k">delete</span> <span class="n">q</span><span class="p">;</span>
	<span class="k">delete</span> <span class="n">use</span><span class="p">;</span>
      <span class="p">}</span>
  <span class="p">}</span>
<span class="k">private</span><span class="o">:</span>
 <span class="n">Query</span><span class="p">(</span><span class="n">Query_base</span> <span class="o">*</span><span class="n">query</span><span class="p">)</span><span class="o">:</span> <span class="n">q</span><span class="p">(</span><span class="n">query</span><span class="p">),</span> <span class="n">use</span><span class="p">(</span><span class="k">new</span> <span class="kt">unsigned</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span> <span class="p">{}</span>
  <span class="n">Query_base</span> <span class="o">*</span><span class="n">q</span><span class="p">;</span>
  <span class="kt">unsigned</span> <span class="o">*</span><span class="n">use</span><span class="p">;</span>
<span class="p">};</span>

<span class="n">Query</span> <span class="o">&amp;</span><span class="n">Query</span><span class="o">::</span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="n">p</span><span class="p">)</span>
<span class="p">{</span>
  <span class="o">++*</span><span class="n">p</span><span class="p">.</span><span class="n">use</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="o">--*</span><span class="n">use</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="k">delete</span> <span class="n">use</span><span class="p">;</span>
      <span class="k">delete</span> <span class="n">q</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="n">use</span> <span class="o">=</span> <span class="n">p</span><span class="p">.</span><span class="n">use</span><span class="p">;</span>
  <span class="n">q</span> <span class="o">=</span> <span class="n">p</span><span class="p">.</span><span class="n">q</span><span class="p">;</span>
  <span class="k">return</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">class</span><span class="err"> </span><span class="nc">WordQuery</span><span class="o">:</span> <span class="k">public</span> <span class="n">Query_base</span>
<span class="p">{</span>
  <span class="k">friend</span> <span class="k">class</span><span class="err"> </span><span class="nc">Query</span><span class="p">;</span>
  <span class="n">WordQuery</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="n">s</span><span class="p">)</span><span class="o">:</span> <span class="n">query_word</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="p">{}</span>
  <span class="n">QueryResult</span> <span class="n">eval</span><span class="p">(</span><span class="k">const</span> <span class="n">TextQuery</span> <span class="o">&amp;</span><span class="n">t</span><span class="p">)</span> <span class="k">const</span>
  <span class="p">{</span><span class="k">return</span> <span class="n">t</span><span class="p">.</span><span class="n">query</span><span class="p">(</span><span class="n">query_word</span><span class="p">);}</span>
  <span class="n">string</span> <span class="n">rep</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span><span class="k">return</span> <span class="n">query_word</span><span class="p">;}</span>
  <span class="n">string</span> <span class="n">query_word</span><span class="p">;</span>
<span class="p">};</span>

<span class="kr">inline</span> <span class="n">Query</span><span class="o">::</span><span class="n">Query</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="n">s</span><span class="p">)</span><span class="o">:</span> <span class="n">q</span><span class="p">(</span><span class="k">new</span> <span class="n">WordQuery</span><span class="p">(</span><span class="n">s</span><span class="p">)),</span> <span class="n">use</span><span class="p">(</span><span class="k">new</span> <span class="kt">unsigned</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span> <span class="p">{}</span>

<span class="k">class</span><span class="err"> </span><span class="nc">BinaryQuery</span><span class="o">:</span> <span class="k">public</span> <span class="n">Query_base</span>
<span class="p">{</span>
<span class="k">protected</span><span class="o">:</span>
  <span class="n">BinaryQuery</span><span class="p">(</span><span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="n">l</span><span class="p">,</span> <span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="n">r</span><span class="p">,</span> <span class="n">string</span> <span class="n">s</span><span class="p">)</span><span class="o">:</span>
    <span class="n">lhs</span><span class="p">(</span><span class="n">l</span><span class="p">),</span> <span class="n">rhs</span><span class="p">(</span><span class="n">r</span><span class="p">),</span> <span class="n">opSym</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="p">{}</span>
  <span class="n">string</span> <span class="n">rep</span><span class="p">()</span> <span class="k">const</span>
  <span class="p">{</span>
    <span class="k">return</span> <span class="s">&#34;(&#34;</span> <span class="o">+</span> <span class="n">lhs</span><span class="p">.</span><span class="n">rep</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#34; &#34;</span>
      <span class="o">+</span> <span class="n">opSym</span> <span class="o">+</span> <span class="s">&#34; &#34;</span>
      <span class="o">+</span> <span class="n">rhs</span><span class="p">.</span><span class="n">rep</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#34;)&#34;</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">Query</span> <span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">;</span>
  <span class="n">string</span> <span class="n">opSym</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">class</span><span class="err"> </span><span class="nc">AndQuery</span><span class="o">:</span> <span class="k">public</span> <span class="n">BinaryQuery</span>
<span class="p">{</span>
  <span class="k">friend</span> <span class="n">Query</span> <span class="k">operator</span><span class="o">&amp;</span><span class="p">(</span><span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="p">,</span> <span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="p">);</span>
  <span class="n">AndQuery</span><span class="p">(</span><span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="n">left</span><span class="p">,</span> <span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="n">right</span><span class="p">)</span><span class="o">:</span>
    <span class="n">BinaryQuery</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="s">&#34;&amp;&#34;</span><span class="p">)</span> <span class="p">{}</span>
  <span class="n">QueryResult</span> <span class="n">eval</span><span class="p">(</span><span class="k">const</span> <span class="n">TextQuery</span> <span class="o">&amp;</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
<span class="p">};</span>

<span class="kr">inline</span> <span class="n">Query</span> <span class="k">operator</span><span class="o">&amp;</span><span class="p">(</span><span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="n">lhs</span><span class="p">,</span> <span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="n">rhs</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="k">new</span> <span class="n">AndQuery</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">QueryResult</span>
<span class="n">AndQuery</span><span class="o">::</span><span class="n">eval</span><span class="p">(</span><span class="k">const</span> <span class="n">TextQuery</span> <span class="o">&amp;</span><span class="n">text</span><span class="p">)</span> <span class="k">const</span>
<span class="p">{</span>
  <span class="k">auto</span> <span class="n">left</span> <span class="o">=</span> <span class="n">lhs</span><span class="p">.</span><span class="n">eval</span><span class="p">(</span><span class="n">text</span><span class="p">),</span> <span class="n">right</span> <span class="o">=</span> <span class="n">rhs</span><span class="p">.</span><span class="n">eval</span><span class="p">(</span><span class="n">text</span><span class="p">);</span>
  <span class="k">auto</span> <span class="n">ret_lines</span> <span class="o">=</span> <span class="n">make_shared</span><span class="o">&lt;</span><span class="n">set</span><span class="o">&lt;</span><span class="n">line_no</span><span class="o">&gt;&gt;</span><span class="p">();</span>
  <span class="n">set_intersection</span><span class="p">(</span><span class="n">left</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">left</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span>
		   <span class="n">right</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">right</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span>
		   <span class="n">inserter</span><span class="p">(</span><span class="o">*</span><span class="n">ret_lines</span><span class="p">,</span> <span class="n">ret_lines</span><span class="o">-&gt;</span><span class="n">begin</span><span class="p">()));</span>
  <span class="k">return</span> <span class="nf">QueryResult</span><span class="p">(</span><span class="n">rep</span><span class="p">(),</span> <span class="n">ret_lines</span><span class="p">,</span> <span class="n">left</span><span class="p">.</span><span class="n">get_file</span><span class="p">());</span>
<span class="p">}</span>

<span class="k">class</span><span class="err"> </span><span class="nc">OrQuery</span><span class="o">:</span> <span class="k">public</span> <span class="n">BinaryQuery</span>
<span class="p">{</span>
  <span class="k">friend</span> <span class="n">Query</span> <span class="k">operator</span><span class="o">|</span><span class="p">(</span><span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="p">,</span> <span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="p">);</span>
  <span class="n">OrQuery</span><span class="p">(</span><span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="n">left</span><span class="p">,</span> <span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="n">right</span><span class="p">)</span><span class="o">:</span>
    <span class="n">BinaryQuery</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="s">&#34;|&#34;</span><span class="p">)</span> <span class="p">{}</span>
  <span class="n">QueryResult</span> <span class="n">eval</span><span class="p">(</span><span class="k">const</span> <span class="n">TextQuery</span> <span class="o">&amp;</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
<span class="p">};</span>

<span class="kr">inline</span> <span class="n">Query</span> <span class="k">operator</span><span class="o">|</span><span class="p">(</span><span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="n">lhs</span><span class="p">,</span> <span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="n">rhs</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="k">new</span> <span class="n">OrQuery</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">ostream</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="n">ostream</span> <span class="o">&amp;</span><span class="n">os</span><span class="p">,</span> <span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="n">query</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="n">os</span> <span class="o">&lt;&lt;</span> <span class="n">query</span><span class="p">.</span><span class="n">rep</span><span class="p">();</span>
<span class="p">}</span>

<span class="n">QueryResult</span> <span class="n">OrQuery</span><span class="o">::</span><span class="n">eval</span><span class="p">(</span><span class="k">const</span> <span class="n">TextQuery</span> <span class="o">&amp;</span><span class="n">text</span><span class="p">)</span> <span class="k">const</span>
<span class="p">{</span>
  <span class="k">auto</span> <span class="n">right</span> <span class="o">=</span> <span class="n">rhs</span><span class="p">.</span><span class="n">eval</span><span class="p">(</span><span class="n">text</span><span class="p">),</span> <span class="n">left</span> <span class="o">=</span> <span class="n">lhs</span><span class="p">.</span><span class="n">eval</span><span class="p">(</span><span class="n">text</span><span class="p">);</span>
  <span class="k">auto</span> <span class="n">ret_lines</span> <span class="o">=</span> <span class="n">make_shared</span><span class="o">&lt;</span><span class="n">set</span><span class="o">&lt;</span><span class="n">line_no</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="n">left</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">left</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>
  <span class="n">ret_lines</span><span class="o">-&gt;</span><span class="n">insert</span><span class="p">(</span><span class="n">right</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">right</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>
  <span class="k">return</span> <span class="nf">QueryResult</span><span class="p">(</span><span class="n">rep</span><span class="p">(),</span> <span class="n">ret_lines</span><span class="p">,</span> <span class="n">left</span><span class="p">.</span><span class="n">get_file</span><span class="p">());</span>
<span class="p">}</span>

<span class="k">class</span><span class="err"> </span><span class="nc">NotQuery</span><span class="o">:</span> <span class="k">public</span> <span class="n">Query_base</span>
<span class="p">{</span>
  <span class="k">friend</span> <span class="n">Query</span> <span class="k">operator</span><span class="o">~</span><span class="p">(</span><span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="p">);</span>
  <span class="n">NotQuery</span><span class="p">(</span><span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="n">q</span><span class="p">)</span><span class="o">:</span> <span class="n">query</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="p">{}</span>
  <span class="n">string</span> <span class="n">rep</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span><span class="k">return</span> <span class="s">&#34;~(&#34;</span> <span class="o">+</span> <span class="n">query</span><span class="p">.</span><span class="n">rep</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#34;)&#34;</span><span class="p">;}</span>
  <span class="n">QueryResult</span> <span class="n">eval</span><span class="p">(</span><span class="k">const</span> <span class="n">TextQuery</span> <span class="o">&amp;</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
  <span class="n">Query</span> <span class="n">query</span><span class="p">;</span>
<span class="p">};</span>

<span class="kr">inline</span> <span class="n">Query</span> <span class="k">operator</span><span class="o">~</span><span class="p">(</span><span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="n">operand</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="k">new</span> <span class="n">NotQuery</span><span class="p">(</span><span class="n">operand</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">QueryResult</span>
<span class="n">NotQuery</span><span class="o">::</span><span class="n">eval</span><span class="p">(</span><span class="k">const</span> <span class="n">TextQuery</span> <span class="o">&amp;</span><span class="n">text</span><span class="p">)</span> <span class="k">const</span>
<span class="p">{</span>
  <span class="k">auto</span> <span class="n">result</span> <span class="o">=</span> <span class="n">query</span><span class="p">.</span><span class="n">eval</span><span class="p">(</span><span class="n">text</span><span class="p">);</span>
  <span class="k">auto</span> <span class="n">ret_lines</span> <span class="o">=</span> <span class="n">make_shared</span><span class="o">&lt;</span><span class="n">set</span><span class="o">&lt;</span><span class="n">line_no</span><span class="o">&gt;&gt;</span><span class="p">();</span>
  <span class="k">auto</span> <span class="n">beg</span> <span class="o">=</span> <span class="n">result</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">end</span> <span class="o">=</span> <span class="n">result</span><span class="p">.</span><span class="n">end</span><span class="p">();</span>
  <span class="k">auto</span> <span class="n">sz</span> <span class="o">=</span> <span class="n">result</span><span class="p">.</span><span class="n">get_file</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">();</span>
  <span class="k">for</span><span class="p">(</span><span class="n">size_t</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">n</span> <span class="o">!=</span> <span class="n">sz</span><span class="p">;</span> <span class="o">++</span><span class="n">n</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span><span class="n">beg</span> <span class="o">==</span> <span class="n">end</span> <span class="o">||</span> <span class="o">*</span><span class="n">beg</span> <span class="o">!=</span> <span class="n">n</span><span class="p">)</span>
	<span class="n">ret_lines</span><span class="o">-&gt;</span><span class="n">insert</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>
      <span class="k">else</span> <span class="nf">if</span><span class="p">(</span><span class="n">beg</span> <span class="o">!=</span> <span class="n">end</span><span class="p">)</span>
	<span class="o">++</span><span class="n">beg</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="k">return</span> <span class="n">QueryResult</span><span class="p">(</span><span class="n">rep</span><span class="p">(),</span> <span class="n">ret_lines</span><span class="p">,</span> <span class="n">result</span><span class="p">.</span><span class="n">get_file</span><span class="p">());</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>
<h2 id="exercise-15-dot-42">Exercise 15.42</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="c1">// implement (a)
</span><span class="c1">// modify TextQuery.h
</span><span class="c1">// see TextQuery-1542.h
</span><span class="c1"></span><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span>
<span class="p">{</span>
  <span class="n">ifstream</span> <span class="n">ifs</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
  <span class="n">TextQuery</span> <span class="n">tq</span><span class="p">(</span><span class="n">ifs</span><span class="p">);</span>
  <span class="n">Query</span> <span class="n">q</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span><span class="s">&#34;fiery&#34;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">Query</span><span class="p">(</span><span class="s">&#34;bird&#34;</span><span class="p">)</span> <span class="o">|</span> <span class="n">Query</span><span class="p">(</span><span class="s">&#34;wind&#34;</span><span class="p">);</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">q</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="k">auto</span> <span class="n">result</span> <span class="o">=</span> <span class="n">q</span><span class="p">.</span><span class="n">eval</span><span class="p">(</span><span class="n">tq</span><span class="p">);</span>
  <span class="n">print</span><span class="p">(</span><span class="n">cout</span><span class="p">,</span> <span class="n">result</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>
<h2 id="15-dot-42-dot-h">15.42.h</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="k">class</span><span class="err"> </span><span class="nc">Query_base</span>
<span class="p">{</span>
  <span class="k">friend</span> <span class="k">class</span><span class="err"> </span><span class="nc">Query</span><span class="p">;</span>
<span class="k">protected</span><span class="o">:</span>
  <span class="k">using</span> <span class="n">line_no</span> <span class="o">=</span> <span class="n">TextQuery</span><span class="o">::</span><span class="n">line_no</span><span class="p">;</span>
  <span class="n">Query_base</span><span class="p">()</span> <span class="p">{</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Query_base::Query_base()&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;}</span>
  <span class="k">virtual</span> <span class="o">~</span><span class="n">Query_base</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>
<span class="k">private</span><span class="o">:</span>
  <span class="k">virtual</span> <span class="n">QueryResult</span> <span class="n">eval</span><span class="p">(</span><span class="k">const</span> <span class="n">TextQuery</span> <span class="o">&amp;</span><span class="p">)</span> <span class="k">const</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">virtual</span> <span class="n">string</span> <span class="nf">rep</span><span class="p">()</span> <span class="k">const</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">class</span><span class="err"> </span><span class="nc">Query</span>
<span class="p">{</span>
  <span class="k">friend</span> <span class="n">Query</span> <span class="k">operator</span><span class="o">~</span><span class="p">(</span><span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="p">);</span>
  <span class="k">friend</span> <span class="n">Query</span> <span class="k">operator</span><span class="o">|</span><span class="p">(</span><span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="p">,</span> <span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="p">);</span>
  <span class="k">friend</span> <span class="n">Query</span> <span class="k">operator</span><span class="o">&amp;</span><span class="p">(</span><span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="p">,</span> <span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="p">);</span>
<span class="k">public</span><span class="o">:</span>
  <span class="n">Query</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="p">);</span>
  <span class="n">QueryResult</span> <span class="nf">eval</span><span class="p">(</span><span class="k">const</span> <span class="n">TextQuery</span> <span class="o">&amp;</span><span class="n">t</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span><span class="k">return</span> <span class="n">q</span><span class="o">-&gt;</span><span class="n">eval</span><span class="p">(</span><span class="n">t</span><span class="p">);}</span>
  <span class="n">string</span> <span class="nf">rep</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Query::rep&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span> <span class="k">return</span> <span class="n">q</span><span class="o">-&gt;</span><span class="n">rep</span><span class="p">();}</span>
<span class="k">private</span><span class="o">:</span>
 <span class="n">Query</span><span class="p">(</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Query_base</span><span class="o">&gt;</span> <span class="n">query</span><span class="p">)</span><span class="o">:</span> <span class="n">q</span><span class="p">(</span><span class="n">query</span><span class="p">)</span> <span class="p">{</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Query::Query(shared_ptr)&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;}</span>
  <span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Query_base</span><span class="o">&gt;</span> <span class="n">q</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">class</span><span class="err"> </span><span class="nc">WordQuery</span><span class="o">:</span> <span class="k">public</span> <span class="n">Query_base</span>
<span class="p">{</span>
  <span class="k">friend</span> <span class="k">class</span><span class="err"> </span><span class="nc">Query</span><span class="p">;</span>
 <span class="n">WordQuery</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="n">s</span><span class="p">)</span><span class="o">:</span> <span class="n">query_word</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="p">{</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;WordQuery::WordQuery(const string &amp;)&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;}</span>
  <span class="n">QueryResult</span> <span class="n">eval</span><span class="p">(</span><span class="k">const</span> <span class="n">TextQuery</span> <span class="o">&amp;</span><span class="n">t</span><span class="p">)</span> <span class="k">const</span>
  <span class="p">{</span><span class="k">return</span> <span class="n">t</span><span class="p">.</span><span class="n">query</span><span class="p">(</span><span class="n">query_word</span><span class="p">);}</span>
  <span class="n">string</span> <span class="n">rep</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;WordQuery::rep&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span> <span class="k">return</span> <span class="n">query_word</span><span class="p">;}</span>
  <span class="n">string</span> <span class="n">query_word</span><span class="p">;</span>
<span class="p">};</span>

<span class="kr">inline</span> <span class="n">Query</span><span class="o">::</span><span class="n">Query</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="n">s</span><span class="p">)</span><span class="o">:</span> <span class="n">q</span><span class="p">(</span><span class="k">new</span> <span class="n">WordQuery</span><span class="p">(</span><span class="n">s</span><span class="p">))</span> <span class="p">{</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Query::Query(const string &amp;)&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;}</span>

<span class="k">class</span><span class="err"> </span><span class="nc">BinaryQuery</span><span class="o">:</span> <span class="k">public</span> <span class="n">Query_base</span>
<span class="p">{</span>
 <span class="k">protected</span><span class="o">:</span>
 <span class="n">BinaryQuery</span><span class="p">(</span><span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="n">l</span><span class="p">,</span> <span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="n">r</span><span class="p">,</span> <span class="n">string</span> <span class="n">s</span><span class="p">)</span><span class="o">:</span>
  <span class="n">lhs</span><span class="p">(</span><span class="n">l</span><span class="p">),</span> <span class="n">rhs</span><span class="p">(</span><span class="n">r</span><span class="p">),</span> <span class="n">opSym</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="p">{</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;BinaryQuery::BinaryQuery&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;}</span>
  <span class="n">string</span> <span class="n">rep</span><span class="p">()</span> <span class="k">const</span>
  <span class="p">{</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;BinaryQuery::rep&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="k">return</span> <span class="s">&#34;(&#34;</span> <span class="o">+</span> <span class="n">lhs</span><span class="p">.</span><span class="n">rep</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#34; &#34;</span>
      <span class="o">+</span> <span class="n">opSym</span> <span class="o">+</span> <span class="s">&#34; &#34;</span>
      <span class="o">+</span> <span class="n">rhs</span><span class="p">.</span><span class="n">rep</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#34;)&#34;</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">Query</span> <span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">;</span>
  <span class="n">string</span> <span class="n">opSym</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">class</span><span class="err"> </span><span class="nc">AndQuery</span><span class="o">:</span> <span class="k">public</span> <span class="n">BinaryQuery</span>
<span class="p">{</span>
  <span class="k">friend</span> <span class="n">Query</span> <span class="k">operator</span><span class="o">&amp;</span><span class="p">(</span><span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="p">,</span> <span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="p">);</span>
 <span class="n">AndQuery</span><span class="p">(</span><span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="n">left</span><span class="p">,</span> <span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="n">right</span><span class="p">)</span><span class="o">:</span>
  <span class="n">BinaryQuery</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="s">&#34;&amp;&#34;</span><span class="p">)</span> <span class="p">{</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;AndQuery::AndQuery&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;}</span>
  <span class="n">QueryResult</span> <span class="n">eval</span><span class="p">(</span><span class="k">const</span> <span class="n">TextQuery</span> <span class="o">&amp;</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
<span class="p">};</span>

<span class="kr">inline</span> <span class="n">Query</span> <span class="k">operator</span><span class="o">&amp;</span><span class="p">(</span><span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="n">lhs</span><span class="p">,</span> <span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="n">rhs</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Query_base</span><span class="o">&gt;</span><span class="p">(</span><span class="k">new</span> <span class="n">AndQuery</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">));</span>
<span class="p">}</span>

<span class="n">QueryResult</span>
<span class="n">AndQuery</span><span class="o">::</span><span class="n">eval</span><span class="p">(</span><span class="k">const</span> <span class="n">TextQuery</span> <span class="o">&amp;</span><span class="n">text</span><span class="p">)</span> <span class="k">const</span>
<span class="p">{</span>
  <span class="k">auto</span> <span class="n">left</span> <span class="o">=</span> <span class="n">lhs</span><span class="p">.</span><span class="n">eval</span><span class="p">(</span><span class="n">text</span><span class="p">),</span> <span class="n">right</span> <span class="o">=</span> <span class="n">rhs</span><span class="p">.</span><span class="n">eval</span><span class="p">(</span><span class="n">text</span><span class="p">);</span>
  <span class="k">auto</span> <span class="n">ret_lines</span> <span class="o">=</span> <span class="n">make_shared</span><span class="o">&lt;</span><span class="n">set</span><span class="o">&lt;</span><span class="n">line_no</span><span class="o">&gt;&gt;</span><span class="p">();</span>
  <span class="n">set_intersection</span><span class="p">(</span><span class="n">left</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">left</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span>
		  <span class="n">right</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">right</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span>
		  <span class="n">inserter</span><span class="p">(</span><span class="o">*</span><span class="n">ret_lines</span><span class="p">,</span> <span class="n">ret_lines</span><span class="o">-&gt;</span><span class="n">begin</span><span class="p">()));</span>
  <span class="k">return</span> <span class="nf">QueryResult</span><span class="p">(</span><span class="n">rep</span><span class="p">(),</span> <span class="n">ret_lines</span><span class="p">,</span> <span class="n">left</span><span class="p">.</span><span class="n">get_file</span><span class="p">());</span>
<span class="p">}</span>

<span class="k">class</span><span class="err"> </span><span class="nc">OrQuery</span><span class="o">:</span> <span class="k">public</span> <span class="n">BinaryQuery</span>
<span class="p">{</span>
  <span class="k">friend</span> <span class="n">Query</span> <span class="k">operator</span><span class="o">|</span><span class="p">(</span><span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="p">,</span> <span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="p">);</span>
 <span class="n">OrQuery</span><span class="p">(</span><span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="n">left</span><span class="p">,</span> <span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="n">right</span><span class="p">)</span><span class="o">:</span>
  <span class="n">BinaryQuery</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="s">&#34;|&#34;</span><span class="p">)</span> <span class="p">{</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;OrQUery::OrQuery&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;}</span>
  <span class="n">QueryResult</span> <span class="n">eval</span><span class="p">(</span><span class="k">const</span> <span class="n">TextQuery</span> <span class="o">&amp;</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
<span class="p">};</span>

<span class="kr">inline</span> <span class="n">Query</span> <span class="k">operator</span><span class="o">|</span><span class="p">(</span><span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="n">lhs</span><span class="p">,</span> <span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="n">rhs</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Query_base</span><span class="o">&gt;</span><span class="p">(</span><span class="k">new</span> <span class="n">OrQuery</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">));</span>
<span class="p">}</span>

<span class="n">ostream</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="n">ostream</span> <span class="o">&amp;</span><span class="n">os</span><span class="p">,</span> <span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="n">query</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="n">os</span> <span class="o">&lt;&lt;</span> <span class="n">query</span><span class="p">.</span><span class="n">rep</span><span class="p">();</span>
<span class="p">}</span>

<span class="n">QueryResult</span> <span class="n">OrQuery</span><span class="o">::</span><span class="n">eval</span><span class="p">(</span><span class="k">const</span> <span class="n">TextQuery</span> <span class="o">&amp;</span><span class="n">text</span><span class="p">)</span> <span class="k">const</span>
<span class="p">{</span>
  <span class="k">auto</span> <span class="n">right</span> <span class="o">=</span> <span class="n">rhs</span><span class="p">.</span><span class="n">eval</span><span class="p">(</span><span class="n">text</span><span class="p">),</span> <span class="n">left</span> <span class="o">=</span> <span class="n">lhs</span><span class="p">.</span><span class="n">eval</span><span class="p">(</span><span class="n">text</span><span class="p">);</span>
  <span class="k">auto</span> <span class="n">ret_lines</span> <span class="o">=</span> <span class="n">make_shared</span><span class="o">&lt;</span><span class="n">set</span><span class="o">&lt;</span><span class="n">line_no</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="n">left</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">left</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>
  <span class="n">ret_lines</span><span class="o">-&gt;</span><span class="n">insert</span><span class="p">(</span><span class="n">right</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">right</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>
  <span class="k">return</span> <span class="nf">QueryResult</span><span class="p">(</span><span class="n">rep</span><span class="p">(),</span> <span class="n">ret_lines</span><span class="p">,</span> <span class="n">left</span><span class="p">.</span><span class="n">get_file</span><span class="p">());</span>
<span class="p">}</span>

<span class="k">class</span><span class="err"> </span><span class="nc">NotQuery</span><span class="o">:</span> <span class="k">public</span> <span class="n">Query_base</span>
<span class="p">{</span>
  <span class="k">friend</span> <span class="n">Query</span> <span class="k">operator</span><span class="o">~</span><span class="p">(</span><span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="p">);</span>
 <span class="n">NotQuery</span><span class="p">(</span><span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="n">q</span><span class="p">)</span><span class="o">:</span> <span class="n">query</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="p">{}</span>
  <span class="n">string</span> <span class="n">rep</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span><span class="k">return</span> <span class="s">&#34;~(&#34;</span> <span class="o">+</span> <span class="n">query</span><span class="p">.</span><span class="n">rep</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#34;)&#34;</span><span class="p">;}</span>
  <span class="n">QueryResult</span> <span class="n">eval</span><span class="p">(</span><span class="k">const</span> <span class="n">TextQuery</span> <span class="o">&amp;</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
  <span class="n">Query</span> <span class="n">query</span><span class="p">;</span>
<span class="p">};</span>

<span class="kr">inline</span> <span class="n">Query</span> <span class="k">operator</span><span class="o">~</span><span class="p">(</span><span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="n">operand</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Query_base</span><span class="o">&gt;</span><span class="p">(</span><span class="k">new</span> <span class="n">NotQuery</span><span class="p">(</span><span class="n">operand</span><span class="p">));</span>
<span class="p">}</span>

<span class="n">QueryResult</span>
<span class="n">NotQuery</span><span class="o">::</span><span class="n">eval</span><span class="p">(</span><span class="k">const</span> <span class="n">TextQuery</span> <span class="o">&amp;</span><span class="n">text</span><span class="p">)</span> <span class="k">const</span>
<span class="p">{</span>
  <span class="k">auto</span> <span class="n">result</span> <span class="o">=</span> <span class="n">query</span><span class="p">.</span><span class="n">eval</span><span class="p">(</span><span class="n">text</span><span class="p">);</span>
  <span class="k">auto</span> <span class="n">ret_lines</span> <span class="o">=</span> <span class="n">make_shared</span><span class="o">&lt;</span><span class="n">set</span><span class="o">&lt;</span><span class="n">line_no</span><span class="o">&gt;&gt;</span><span class="p">();</span>
  <span class="k">auto</span> <span class="n">beg</span> <span class="o">=</span> <span class="n">result</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">end</span> <span class="o">=</span> <span class="n">result</span><span class="p">.</span><span class="n">end</span><span class="p">();</span>
  <span class="k">auto</span> <span class="n">sz</span> <span class="o">=</span> <span class="n">result</span><span class="p">.</span><span class="n">get_file</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">();</span>
  <span class="k">for</span><span class="p">(</span><span class="n">size_t</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">n</span> <span class="o">!=</span> <span class="n">sz</span><span class="p">;</span> <span class="o">++</span><span class="n">n</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span><span class="n">beg</span> <span class="o">==</span> <span class="n">end</span> <span class="o">||</span> <span class="o">*</span><span class="n">beg</span> <span class="o">!=</span> <span class="n">n</span><span class="p">)</span>
	<span class="n">ret_lines</span><span class="o">-&gt;</span><span class="n">insert</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>
      <span class="k">else</span> <span class="nf">if</span><span class="p">(</span><span class="n">beg</span> <span class="o">!=</span> <span class="n">end</span><span class="p">)</span>
	<span class="o">++</span><span class="n">beg</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="k">return</span> <span class="n">QueryResult</span><span class="p">(</span><span class="n">rep</span><span class="p">(),</span> <span class="n">ret_lines</span><span class="p">,</span> <span class="n">result</span><span class="p">.</span><span class="n">get_file</span><span class="p">());</span>
<span class="p">}</span>
<span class="cp">#endif
</span><span class="cp"></span></code></pre></td></tr></table>
</div>
</div>
<h2 id="textquery-1542-dot-h">TextQuery-1542.h</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="cp">#ifndef TEXTQUERY1542_H
</span><span class="cp">#define TEXTQUERY1542_H
</span><span class="cp"></span><span class="k">class</span><span class="err"> </span><span class="nc">QueryResult</span><span class="p">;</span>
<span class="k">class</span><span class="err"> </span><span class="nc">TextQuery</span>
<span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="k">using</span> <span class="n">line_no</span> <span class="o">=</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;::</span><span class="n">size_type</span><span class="p">;</span>
  <span class="n">TextQuery</span><span class="p">(</span><span class="n">ifstream</span> <span class="o">&amp;</span><span class="n">infile</span><span class="p">);</span>
  <span class="n">TextQuery</span><span class="p">(</span><span class="k">const</span> <span class="n">TextQuery</span> <span class="o">&amp;</span><span class="p">);</span>
  <span class="n">TextQuery</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">TextQuery</span> <span class="o">&amp;</span><span class="p">);</span>
  <span class="n">QueryResult</span> <span class="nf">query</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="n">s</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
 <span class="k">private</span><span class="o">:</span>
  <span class="k">friend</span> <span class="n">QueryResult</span><span class="p">;</span>
  <span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;&gt;</span> <span class="n">sp1</span><span class="p">;</span>
  <span class="n">map</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span> <span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">set</span><span class="o">&lt;</span><span class="n">line_no</span><span class="o">&gt;&gt;&gt;</span> <span class="n">mp</span><span class="p">;</span>
<span class="p">};</span>
<span class="n">istream</span> <span class="o">&amp;</span><span class="n">get_sentence</span><span class="p">(</span><span class="n">istream</span> <span class="o">&amp;</span><span class="n">is</span><span class="p">,</span> <span class="n">string</span> <span class="o">&amp;</span><span class="n">s</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">s</span> <span class="o">=</span> <span class="s">&#34;&#34;</span><span class="p">;</span>
  <span class="n">string</span> <span class="n">word</span><span class="p">;</span>
  <span class="k">while</span><span class="p">(</span><span class="n">is</span> <span class="o">&gt;&gt;</span> <span class="n">word</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="kt">char</span> <span class="n">symbol</span> <span class="o">=</span> <span class="n">word</span><span class="p">[</span><span class="n">word</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">];</span>
      <span class="k">if</span><span class="p">(</span><span class="n">ispunct</span><span class="p">(</span><span class="n">symbol</span><span class="p">))</span>
      <span class="p">{</span>
	<span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="n">word</span><span class="p">;</span>
	<span class="k">break</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">else</span>
      <span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="n">word</span> <span class="o">+</span> <span class="s">&#34; &#34;</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="k">return</span> <span class="n">is</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">TextQuery</span><span class="o">::</span><span class="n">TextQuery</span><span class="p">(</span><span class="n">ifstream</span> <span class="o">&amp;</span><span class="n">infile</span><span class="p">)</span><span class="o">:</span>
<span class="n">sp1</span><span class="p">(</span><span class="k">new</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">line_no</span> <span class="n">line_number</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">string</span> <span class="n">sentence</span><span class="p">;</span>
  <span class="k">while</span><span class="p">(</span><span class="n">get_sentence</span><span class="p">(</span><span class="n">infile</span><span class="p">,</span> <span class="n">sentence</span><span class="p">))</span>
    <span class="p">{</span>
      <span class="c1">// store sentence in vector&lt;string&gt;
</span><span class="c1"></span>      <span class="n">sp1</span><span class="o">-&gt;</span><span class="n">push_back</span><span class="p">(</span><span class="n">sentence</span><span class="p">);</span>
      <span class="c1">// scan through the sentence
</span><span class="c1"></span>      <span class="n">istringstream</span> <span class="nf">ist</span><span class="p">(</span><span class="n">sentence</span><span class="p">);</span>
      <span class="n">string</span> <span class="n">word</span><span class="p">;</span>
      <span class="k">while</span><span class="p">(</span><span class="n">ist</span> <span class="o">&gt;&gt;</span> <span class="n">word</span><span class="p">)</span>
      <span class="p">{</span>
	<span class="k">if</span><span class="p">(</span><span class="n">ispunct</span><span class="p">(</span><span class="n">word</span><span class="p">[</span><span class="n">word</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]))</span>
	  <span class="n">word</span><span class="p">.</span><span class="n">erase</span><span class="p">(</span><span class="n">word</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">auto</span> <span class="o">&amp;</span><span class="n">lines</span> <span class="o">=</span> <span class="n">mp</span><span class="p">[</span><span class="n">word</span><span class="p">];</span>
	<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">lines</span><span class="p">)</span> <span class="n">lines</span><span class="p">.</span><span class="n">reset</span><span class="p">(</span><span class="k">new</span> <span class="n">set</span><span class="o">&lt;</span><span class="n">line_no</span><span class="o">&gt;</span><span class="p">);</span>
	<span class="n">lines</span><span class="o">-&gt;</span><span class="n">insert</span><span class="p">(</span><span class="n">line_number</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="c1">// increase the line_number
</span><span class="c1"></span>      <span class="o">++</span><span class="n">line_number</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="n">TextQuery</span><span class="o">::</span><span class="n">TextQuery</span><span class="p">(</span><span class="k">const</span> <span class="n">TextQuery</span> <span class="o">&amp;</span><span class="n">t</span><span class="p">)</span><span class="o">:</span> <span class="n">sp1</span><span class="p">(</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="o">*</span><span class="n">t</span><span class="p">.</span><span class="n">sp1</span><span class="p">)),</span> <span class="n">mp</span><span class="p">(</span><span class="n">t</span><span class="p">.</span><span class="n">mp</span><span class="p">)</span> <span class="p">{}</span>
<span class="n">TextQuery</span> <span class="o">&amp;</span><span class="n">TextQuery</span><span class="o">::</span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">TextQuery</span> <span class="o">&amp;</span><span class="n">t</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">sp1</span> <span class="o">=</span> <span class="n">make_shared</span><span class="o">&lt;</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="o">*</span><span class="n">t</span><span class="p">.</span><span class="n">sp1</span><span class="p">);</span>
  <span class="n">mp</span> <span class="o">=</span> <span class="n">t</span><span class="p">.</span><span class="n">mp</span><span class="p">;</span>
  <span class="k">return</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span>
<span class="p">}</span>
  <span class="k">class</span><span class="err"> </span><span class="nc">QueryResult</span>
  <span class="p">{</span>
    <span class="k">friend</span> <span class="n">ostream</span> <span class="o">&amp;</span><span class="n">print</span><span class="p">(</span><span class="n">ostream</span> <span class="o">&amp;</span><span class="p">,</span> <span class="k">const</span> <span class="n">QueryResult</span> <span class="o">&amp;</span><span class="p">);</span>
    <span class="n">string</span> <span class="n">search_word</span><span class="p">;</span>
    <span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;&gt;</span> <span class="n">sp1</span><span class="p">;</span>
    <span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">set</span><span class="o">&lt;</span><span class="n">TextQuery</span><span class="o">::</span><span class="n">line_no</span><span class="o">&gt;&gt;</span> <span class="n">sp2</span><span class="p">;</span>
  <span class="k">public</span><span class="o">:</span>
  <span class="n">QueryResult</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="n">s</span><span class="p">,</span>
	    <span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">set</span><span class="o">&lt;</span><span class="n">TextQuery</span><span class="o">::</span><span class="n">line_no</span><span class="o">&gt;&gt;</span> <span class="n">p</span><span class="p">,</span>
	    <span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;&gt;</span> <span class="n">file</span><span class="p">)</span><span class="o">:</span> <span class="n">search_word</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="n">sp1</span><span class="p">(</span><span class="n">file</span><span class="p">),</span> <span class="n">sp2</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="p">{}</span>
    <span class="n">QueryResult</span><span class="p">(</span><span class="k">const</span> <span class="n">QueryResult</span> <span class="o">&amp;</span><span class="p">);</span>
    <span class="n">QueryResult</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">QueryResult</span> <span class="o">&amp;</span><span class="p">);</span>
    <span class="n">set</span><span class="o">&lt;</span><span class="n">TextQuery</span><span class="o">::</span><span class="n">line_no</span><span class="o">&gt;::</span><span class="n">iterator</span> <span class="n">begin</span><span class="p">()</span> <span class="p">{</span><span class="k">return</span> <span class="n">sp2</span><span class="o">-&gt;</span><span class="n">begin</span><span class="p">();}</span>
    <span class="n">set</span><span class="o">&lt;</span><span class="n">TextQuery</span><span class="o">::</span><span class="n">line_no</span><span class="o">&gt;::</span><span class="n">iterator</span> <span class="n">end</span><span class="p">()</span> <span class="p">{</span><span class="k">return</span> <span class="n">sp2</span><span class="o">-&gt;</span><span class="n">end</span><span class="p">();}</span>
    <span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;&gt;</span> <span class="n">get_file</span><span class="p">()</span> <span class="p">{</span><span class="k">return</span> <span class="n">sp1</span><span class="p">;}</span>
  <span class="p">};</span>
<span class="n">QueryResult</span><span class="o">::</span><span class="n">QueryResult</span><span class="p">(</span><span class="k">const</span> <span class="n">QueryResult</span> <span class="o">&amp;</span><span class="n">q</span><span class="p">)</span><span class="o">:</span> <span class="n">sp1</span><span class="p">(</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="o">*</span><span class="n">q</span><span class="p">.</span><span class="n">sp1</span><span class="p">)),</span> <span class="n">sp2</span><span class="p">(</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">set</span><span class="o">&lt;</span><span class="n">TextQuery</span><span class="o">::</span><span class="n">line_no</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="o">*</span><span class="n">q</span><span class="p">.</span><span class="n">sp2</span><span class="p">)),</span> <span class="n">search_word</span><span class="p">(</span><span class="n">q</span><span class="p">.</span><span class="n">search_word</span><span class="p">)</span> <span class="p">{}</span>
<span class="n">QueryResult</span> <span class="o">&amp;</span><span class="n">QueryResult</span><span class="o">::</span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">QueryResult</span> <span class="o">&amp;</span><span class="n">q</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">sp1</span> <span class="o">=</span> <span class="n">make_shared</span><span class="o">&lt;</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="o">*</span><span class="n">q</span><span class="p">.</span><span class="n">sp1</span><span class="p">);</span>
  <span class="n">sp2</span> <span class="o">=</span> <span class="n">make_shared</span><span class="o">&lt;</span><span class="n">set</span><span class="o">&lt;</span><span class="n">TextQuery</span><span class="o">::</span><span class="n">line_no</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="o">*</span><span class="n">q</span><span class="p">.</span><span class="n">sp2</span><span class="p">);</span>
  <span class="n">search_word</span> <span class="o">=</span> <span class="n">q</span><span class="p">.</span><span class="n">search_word</span><span class="p">;</span>
  <span class="k">return</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span>
<span class="p">}</span>
  <span class="n">ostream</span> <span class="o">&amp;</span><span class="n">print</span><span class="p">(</span><span class="n">ostream</span> <span class="o">&amp;</span><span class="n">o</span><span class="p">,</span> <span class="k">const</span> <span class="n">QueryResult</span> <span class="o">&amp;</span><span class="n">q</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="k">auto</span> <span class="n">n</span> <span class="o">=</span> <span class="n">q</span><span class="p">.</span><span class="n">sp2</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">();</span>
    <span class="n">o</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;element occurs &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">n</span> <span class="o">&lt;&lt;</span> <span class="s">&#34; times&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="k">auto</span> <span class="n">result</span> <span class="o">=</span> <span class="o">*</span><span class="n">q</span><span class="p">.</span><span class="n">sp2</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="k">const</span> <span class="k">auto</span> <span class="o">&amp;</span><span class="nl">l</span> <span class="p">:</span> <span class="n">result</span><span class="p">)</span>
      <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;</span><span class="se">\t</span><span class="s">(sentence &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">l</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;) &#34;</span>
	 <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="o">*</span><span class="n">q</span><span class="p">.</span><span class="n">sp1</span><span class="p">)[</span><span class="n">l</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">o</span><span class="p">;</span>
  <span class="p">}</span>
<span class="n">QueryResult</span> <span class="n">TextQuery</span><span class="o">::</span><span class="n">query</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="n">s</span><span class="p">)</span> <span class="k">const</span>
<span class="p">{</span>
  <span class="k">static</span> <span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">set</span><span class="o">&lt;</span><span class="n">line_no</span><span class="o">&gt;&gt;</span> <span class="n">nodata</span><span class="p">(</span><span class="k">new</span> <span class="n">set</span><span class="o">&lt;</span><span class="n">line_no</span><span class="o">&gt;</span><span class="p">);</span>
  <span class="k">auto</span> <span class="n">iter</span> <span class="o">=</span> <span class="n">mp</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">s</span><span class="p">);</span>
  <span class="k">auto</span> <span class="n">last</span> <span class="o">=</span> <span class="n">mp</span><span class="p">.</span><span class="n">end</span><span class="p">();</span>
  <span class="k">if</span><span class="p">(</span><span class="n">iter</span> <span class="o">!=</span> <span class="n">last</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">QueryResult</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">iter</span><span class="o">-&gt;</span><span class="n">second</span><span class="p">,</span> <span class="n">sp1</span><span class="p">);</span>
  <span class="k">else</span>
    <span class="k">return</span> <span class="nf">QueryResult</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">nodata</span><span class="p">,</span> <span class="n">sp1</span><span class="p">);</span>
<span class="p">}</span>
<span class="cp">#endif
</span><span class="cp"></span></code></pre></td></tr></table>
</div>
</div>
    </div>

    
    
<div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">文章作者</span>
    <span class="item-content">zero4drift</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">上次更新</span>
    <span class="item-content">2019-01-14</span>
  </p>
  
  <p class="copyright-item">
    <span class="item-title">许可协议</span>
    <span class="item-content"><a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank">CC BY-NC-ND 4.0</a></span>
  </p>
</div>


    
    

    <footer class="post-footer">
      <div class="post-tags">
          <a href="https://zero4drift.github.io/tags/c&#43;&#43;/">C&#43;&#43;</a>
          <a href="https://zero4drift.github.io/tags/cpp-primer/">cpp-primer</a>
          
        </div>

      
      <nav class="post-nav">
        
          <a class="prev" href="/post/cpp-primer-5th-exercises-chapter-16/">
            
            <i class="iconfont">
              <svg  class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M691.908486 949.511495l75.369571-89.491197c10.963703-12.998035 10.285251-32.864502-1.499144-44.378743L479.499795 515.267417 757.434875 204.940602c11.338233-12.190647 11.035334-32.285311-0.638543-44.850487l-80.46666-86.564541c-11.680017-12.583596-30.356378-12.893658-41.662889-0.716314L257.233596 494.235404c-11.332093 12.183484-11.041474 32.266891 0.657986 44.844348l80.46666 86.564541c1.772366 1.910513 3.706415 3.533476 5.750981 4.877077l306.620399 321.703933C662.505829 963.726242 680.945807 962.528973 691.908486 949.511495z"></path>
</svg>

            </i>
            <span class="prev-text nav-default">Cpp-Primer-5th-Exercises-Chapter-16</span>
            <span class="prev-text nav-mobile">上一篇</span>
          </a>
        
          <a class="next" href="/post/cpp-primer-5th-exercises-chapter-14/">
            <span class="next-text nav-default">Cpp-Primer-5th-Exercises-Chapter-14</span>
            <span class="prev-text nav-mobile">下一篇</span>
            
            <i class="iconfont">
              <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M332.091514 74.487481l-75.369571 89.491197c-10.963703 12.998035-10.285251 32.864502 1.499144 44.378743l286.278095 300.375162L266.565125 819.058374c-11.338233 12.190647-11.035334 32.285311 0.638543 44.850487l80.46666 86.564541c11.680017 12.583596 30.356378 12.893658 41.662889 0.716314l377.434212-421.426145c11.332093-12.183484 11.041474-32.266891-0.657986-44.844348l-80.46666-86.564541c-1.772366-1.910513-3.706415-3.533476-5.750981-4.877077L373.270379 71.774697C361.493148 60.273758 343.054193 61.470003 332.091514 74.487481z"></path>
</svg>

            </i>
          </a>
      </nav>
    </footer>
  </article>

  
  

  
  

  
  
    <div class="post bg-white">
      <script src="https://utteranc.es/client.js"
            repo= "zero4drift/comments-for-my-blog"
            issue-term="pathname"
            crossorigin="anonymous"
            async>
      </script>
    </div>
  

  

  

  
  
    



        </div>
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  
  
    <a href="fang0052@e.ntu.edu.sg" rel="me noopener" class="iconfont"
      title="email"  target="_blank"
      >
      <svg class="icon" viewBox="0 0 1451 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M664.781909 681.472759 0 97.881301C0 3.997201 71.046997 0 71.046997 0L474.477909 0 961.649408 0 1361.641813 0C1361.641813 0 1432.688811 3.997201 1432.688811 97.881301L771.345323 681.472759C771.345323 681.472759 764.482731 685.154773 753.594283 688.65053L753.594283 688.664858C741.602731 693.493018 729.424896 695.068979 718.077952 694.839748 706.731093 695.068979 694.553173 693.493018 682.561621 688.664858L682.561621 688.65053C671.644501 685.140446 664.781909 681.472759 664.781909 681.472759L664.781909 681.472759ZM718.063616 811.603883C693.779541 811.016482 658.879232 802.205449 619.10784 767.734955 542.989056 701.759633 0 212.052267 0 212.052267L0 942.809523C0 942.809523 0 1024 83.726336 1024L682.532949 1024 753.579947 1024 1348.948139 1024C1432.688811 1024 1432.688811 942.809523 1432.688811 942.809523L1432.688811 212.052267C1432.688811 212.052267 893.138176 701.759633 817.019477 767.734955 777.248 802.205449 742.347691 811.03081 718.063616 811.603883L718.063616 811.603883Z"></path>
</svg>

    </a>
  
    <a href="https://github.com/zero4drift" rel="me noopener" class="iconfont"
      title="github"  target="_blank"
      >
      <svg class="icon" style="" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M512 12.672c-282.88 0-512 229.248-512 512 0 226.261333 146.688 418.133333 350.08 485.76 25.6 4.821333 34.986667-11.008 34.986667-24.618667 0-12.16-0.426667-44.373333-0.64-87.04-142.421333 30.890667-172.458667-68.693333-172.458667-68.693333C188.672 770.986667 155.008 755.2 155.008 755.2c-46.378667-31.744 3.584-31.104 3.584-31.104 51.413333 3.584 78.421333 52.736 78.421333 52.736 45.653333 78.293333 119.850667 55.68 149.12 42.581333 4.608-33.109333 17.792-55.68 32.426667-68.48-113.706667-12.8-233.216-56.832-233.216-253.013333 0-55.893333 19.84-101.546667 52.693333-137.386667-5.76-12.928-23.04-64.981333 4.48-135.509333 0 0 42.88-13.738667 140.8 52.48 40.96-11.392 84.48-17.024 128-17.28 43.52 0.256 87.04 5.888 128 17.28 97.28-66.218667 140.16-52.48 140.16-52.48 27.52 70.528 10.24 122.581333 5.12 135.509333 32.64 35.84 52.48 81.493333 52.48 137.386667 0 196.693333-119.68 240-233.6 252.586667 17.92 15.36 34.56 46.762667 34.56 94.72 0 68.522667-0.64 123.562667-0.64 140.202666 0 13.44 8.96 29.44 35.2 24.32C877.44 942.592 1024 750.592 1024 524.672c0-282.752-229.248-512-512-512"></path>
</svg>

    </a>


<a href="https://zero4drift.github.io/index.xml" rel="noopener alternate" type="application/rss&#43;xml"
    class="iconfont" title="rss" target="_blank">
    <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="30" height="30">
  <path d="M819.157333 1024C819.157333 574.592 449.408 204.8 0 204.8V0c561.706667 0 1024 462.293333 1024 1024h-204.842667zM140.416 743.04a140.8 140.8 0 0 1 140.501333 140.586667A140.928 140.928 0 0 1 140.074667 1024C62.72 1024 0 961.109333 0 883.626667s62.933333-140.544 140.416-140.586667zM678.784 1024h-199.04c0-263.210667-216.533333-479.786667-479.744-479.786667V345.173333c372.352 0 678.784 306.517333 678.784 678.826667z"></path>
</svg>

  </a>
  
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - <a class="theme-link" href="https://github.com/xianmin/hugo-theme-jane">Jane</a>
  </span>

  <span class="copyright-year">
    &copy;
    
      2018 -
    2019
    <span class="heart">
      
      <i class="iconfont">
        <svg class="icon" viewBox="0 0 1025 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="14" height="14">
  <path d="M1000.1 247.9c-15.5-37.3-37.6-70.6-65.7-98.9-54.4-54.8-125.8-85-201-85-85.7 0-166 39-221.4 107.4C456.6 103 376.3 64 290.6 64c-75.1 0-146.5 30.4-201.1 85.6-28.2 28.5-50.4 61.9-65.8 99.3-16 38.8-24 79.9-23.6 122.2 0.7 91.7 40.1 177.2 108.1 234.8 3.1 2.6 6 5.1 8.9 7.8 14.9 13.4 58 52.8 112.6 102.7 93.5 85.5 209.9 191.9 257.5 234.2 7 6.1 15.8 9.5 24.9 9.5 9.2 0 18.1-3.4 24.9-9.5 34.5-30.7 105.8-95.9 181.4-165 74.2-67.8 150.9-138 195.8-178.2 69.5-57.9 109.6-144.4 109.9-237.3 0.1-42.5-8-83.6-24-122.2z"
   fill="#8a8a8a"></path>
</svg>

      </i>
    </span><span class="author">
        zero4drift
        
      </span></span>

  
  
    <span id="busuanzi_container">
      访客数/访问量：<span id="busuanzi_value_site_uv"></span>/<span id="busuanzi_value_site_pv"></span>
    </span>
  

  
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont">
        
        <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="35" height="35">
  <path d="M510.866688 227.694839 95.449397 629.218702l235.761562 0-2.057869 328.796468 362.40389 0L691.55698 628.188232l241.942331-3.089361L510.866688 227.694839zM63.840492 63.962777l894.052392 0 0 131.813095L63.840492 195.775872 63.840492 63.962777 63.840492 63.962777zM63.840492 63.962777"></path>
</svg>

      </i>
    </div>
  </div>
  
<script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>




<script type="text/javascript" src="/js/main.638251f4230630f0335d8c6748e53a96f94b72670920b60c09a56fdc8bece214.js" integrity="sha256-Y4JR9CMGMPAzXYxnSOU6lvlLcmcJILYMCaVv3Ivs4hQ=" crossorigin="anonymous"></script>

  <script type="text/javascript">
    window.MathJax = {
      showProcessingMessages: false,
      messageStyle: 'none'
    };
  </script>
  <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML' async></script>





  
    <script type="text/javascript" src="/js/load-photoswipe.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe.min.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe-ui-default.min.js"></script>
  




  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>










</body>
</html>
