<!DOCTYPE html>
<html lang="zh-cn" itemscope itemtype="http://schema.org/WebPage">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Cpp-Primer-5th-Exercises-Chapter-13 - 找一个吃麦旋风的理由</title>
  

<meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta name="MobileOptimized" content="width"/>
<meta name="HandheldFriendly" content="true"/>


<meta name="applicable-device" content="pc,mobile">

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">

<meta name="mobile-web-app-capable" content="yes">

<meta name="author" content="zero4drift" />
  <meta name="description" content="Exercise 13.1 1 2 3 4 5 6 7 8  // Within a class type, if the first parameter of one constructor is the reference of the class type itself, and left parameters all have default values, then this constrcutor is copy constructor. // copy constructor is utilized in copy initialization: // 1. Define variable using an =; // 2. Pass an object as an argument to a parameter of noreference type; // 3." />

  <meta name="keywords" content="代码, 算法, 工具" />






<meta name="generator" content="Hugo 0.48" />


<link rel="canonical" href="https://zero4drift.github.io/post/cpp-primer-5th-exercises-chapter-13/" />



<link rel="icon" href="/favicon.ico" />











<link rel="stylesheet" href="/sass/jane.min.28854364c052ec02eba4ee5867bc889d3a567cdf337ba3a355c33511d20bee1e.css" integrity="sha256-KIVDZMBS7ALrpO5YZ7yInTpWfN8ze6OjVcM1EdIL7h4=" media="screen" crossorigin="anonymous">





<meta property="og:title" content="Cpp-Primer-5th-Exercises-Chapter-13" />
<meta property="og:description" content="Exercise 13.1 1 2 3 4 5 6 7 8  // Within a class type, if the first parameter of one constructor is the reference of the class type itself, and left parameters all have default values, then this constrcutor is copy constructor. // copy constructor is utilized in copy initialization: // 1. Define variable using an =; // 2. Pass an object as an argument to a parameter of noreference type; // 3." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://zero4drift.github.io/post/cpp-primer-5th-exercises-chapter-13/" /><meta property="article:published_time" content="2018-06-29T19:39:00&#43;08:00"/>
<meta property="article:modified_time" content="2019-01-14T22:23:57&#43;08:00"/>
<meta itemprop="name" content="Cpp-Primer-5th-Exercises-Chapter-13">
<meta itemprop="description" content="Exercise 13.1 1 2 3 4 5 6 7 8  // Within a class type, if the first parameter of one constructor is the reference of the class type itself, and left parameters all have default values, then this constrcutor is copy constructor. // copy constructor is utilized in copy initialization: // 1. Define variable using an =; // 2. Pass an object as an argument to a parameter of noreference type; // 3.">


<meta itemprop="datePublished" content="2018-06-29T19:39:00&#43;08:00" />
<meta itemprop="dateModified" content="2018-06-29T19:39:00&#43;08:00" />
<meta itemprop="wordCount" content="5331">



<meta itemprop="keywords" content="C&#43;&#43;,cpp-primer," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Cpp-Primer-5th-Exercises-Chapter-13"/>
<meta name="twitter:description" content="Exercise 13.1 1 2 3 4 5 6 7 8  // Within a class type, if the first parameter of one constructor is the reference of the class type itself, and left parameters all have default values, then this constrcutor is copy constructor. // copy constructor is utilized in copy initialization: // 1. Define variable using an =; // 2. Pass an object as an argument to a parameter of noreference type; // 3."/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->




</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">找一个吃麦旋风的理由</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://zero4drift.github.io/">主页</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://zero4drift.github.io/post/">存档</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://zero4drift.github.io/tags/">标签</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://zero4drift.github.io/categories/">分类</a>
          
        
      </li>
    
  </ul>
</nav>


  
    






  <link rel="stylesheet" href="/lib/photoswipe/photoswipe.min.css" />
  <link rel="stylesheet" href="/lib/photoswipe/default-skin/default-skin.min.css" />




<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>

  

  

  <header id="header" class="header container">
    <div class="logo-wrapper">
  <a href="/" class="logo">
    
      找一个吃麦旋风的理由
    
  </a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://zero4drift.github.io/">主页</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://zero4drift.github.io/post/">存档</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://zero4drift.github.io/tags/">标签</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://zero4drift.github.io/categories/">分类</a>
          

        

      </li>
    
    
  </ul>
</nav>

  </header>

  <div id="mobile-panel">
    <main id="main" class="main bg-llight">
      <div class="content-wrapper">
        <div id="content" class="content container">
          <article class="post bg-white">
    
    <header class="post-header">
      <h1 class="post-title">Cpp-Primer-5th-Exercises-Chapter-13</h1>
      
      <div class="post-meta">
        <time datetime="2018-06-29" class="post-time">
          2018-06-29
        </time>
        <div class="post-category">
            <a href="https://zero4drift.github.io/categories/c&#43;&#43;/"> C&#43;&#43; </a>
            
          </div>
        

        
        

        
        
      </div>
    </header>

    
    
<div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">文章目录</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#exercise-13-dot-1">Exercise 13.1</a></li>
<li><a href="#exercise-13-dot-2">Exercise 13.2</a></li>
<li><a href="#exercise-13-dot-3">Exercise 13.3</a></li>
<li><a href="#exercise-13-dot-4">Exercise 13.4</a></li>
<li><a href="#exercise-13-dot-5">Exercise 13.5</a></li>
<li><a href="#exercise-13-dot-6">Exercise 13.6</a></li>
<li><a href="#exercise-13-dot-7">Exercise 13.7</a></li>
<li><a href="#exercise-13-dot-8">Exercise 13.8</a></li>
<li><a href="#exercise-13-dot-9">Exercise 13.9</a></li>
<li><a href="#exercise-13-dot-10">Exercise 13.10</a></li>
<li><a href="#exercise-13-dot-11">Exercise 13.11</a></li>
<li><a href="#exercise-13-dot-12">Exercise 13.12</a></li>
<li><a href="#exercise-13-dot-13">Exercise 13.13</a></li>
<li><a href="#exercise-13-dot-14">Exercise 13.14</a></li>
<li><a href="#exercise-13-dot-15">Exercise 13.15</a></li>
<li><a href="#exercise-13-dot-16">Exercise 13.16</a></li>
<li><a href="#exercise-13-dot-17">Exercise 13.17</a></li>
<li><a href="#exercise-13-dot-18">Exercise 13.18</a></li>
<li><a href="#employee-dot-h">Employee.h</a></li>
<li><a href="#exercise-13-dot-19">Exercise 13.19</a></li>
<li><a href="#exercise-13-dot-20">Exercise 13.20</a></li>
<li><a href="#exercise-13-dot-21">Exercise 13.21</a></li>
<li><a href="#textquery-dot-h">TextQuery.h</a></li>
<li><a href="#exercise-13-dot-22">Exercise 13.22</a></li>
<li><a href="#exercise-13-dot-23">Exercise 13.23</a></li>
<li><a href="#13-dot-22-dot-cpp">13.22.cpp</a></li>
<li><a href="#exercise-13-dot-24">Exercise 13.24</a></li>
<li><a href="#exercise-13-dot-25">Exercise 13.25</a></li>
<li><a href="#strblob-dot-h">StrBlob.h</a></li>
<li><a href="#exercise-13-dot-26">Exercise 13.26</a></li>
<li><a href="#exercise-13-dot-27">Exercise 13.27</a></li>
<li><a href="#exercise-13-dot-28">Exercise 13.28</a></li>
<li><a href="#exercise-13-dot-29">Exercise 13.29</a></li>
<li><a href="#exercise-13-dot-30">Exercise 13.30</a></li>
<li><a href="#hasptr-dot-h">HasPtr.h</a></li>
<li><a href="#exercise-13-dot-31">Exercise 13.31</a></li>
<li><a href="#exercise-13-dot-32">Exercise 13.32</a></li>
<li><a href="#exercise-13-dot-33">Exercise 13.33</a></li>
<li><a href="#exercise-13-dot-34">Exercise 13.34</a></li>
<li><a href="#message-dot-h">Message.h</a></li>
<li><a href="#exercise-13-dot-35">Exercise 13.35</a></li>
<li><a href="#exercise-13-dot-36">Exercise 13.36</a></li>
<li><a href="#exercise-13-dot-37">Exercise 13.37</a></li>
<li><a href="#exercise-13-dot-38">Exercise 13.38</a></li>
<li><a href="#exercise-13-dot-39">Exercise 13.39</a></li>
<li><a href="#strvec-dot-h">StrVec.h</a></li>
<li><a href="#exercise-13-dot-40">Exercise 13.40</a></li>
<li><a href="#exercise-13-dot-41">Exercise 13.41</a></li>
<li><a href="#exercise-13-dot-42">Exercise 13.42</a></li>
<li><a href="#exercise-13-dot-43">Exercise 13.43</a></li>
<li><a href="#exercise-13-dot-44">Exercise 13.44</a></li>
<li><a href="#string-dot-h">String.h</a></li>
<li><a href="#exercise-13-dot-45">Exercise 13.45</a></li>
<li><a href="#exercise-13-dot-46">Exercise 13.46</a></li>
<li><a href="#exercise-13-dot-47">Exercise 13.47</a></li>
<li><a href="#exercise-13-dot-48">Exercise 13.48</a></li>
<li><a href="#exercise-13-dot-49">Exercise 13.49</a></li>
<li><a href="#exercise-13-dot-50">Exercise 13.50</a></li>
<li><a href="#exercise-13-dot-51">Exercise 13.51</a></li>
<li><a href="#exercise-13-dot-52">Exercise 13.52</a></li>
<li><a href="#exercise-13-dot-53">Exercise 13.53</a></li>
<li><a href="#exercise-13-dot-54">Exercise 13.54</a></li>
<li><a href="#exercise-13-dot-55">Exercise 13.55</a></li>
<li><a href="#exercise-13-dot-56">Exercise 13.56</a></li>
<li><a href="#exercise-13-dot-57">Exercise 13.57</a></li>
<li><a href="#exercise-13-dot-58">Exercise 13.58</a></li>
</ul></li>
</ul>
</nav>
  </div>
</div>

    
    <div class="post-content">
      

<h2 id="exercise-13-dot-1">Exercise 13.1</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="c1">// Within a class type, if the first parameter of one constructor is the reference of the class type itself, and left parameters all have default values, then this constrcutor is copy constructor.
</span><span class="c1">// copy constructor is utilized in copy initialization:
</span><span class="c1">// 1. Define variable using an =;
</span><span class="c1">// 2. Pass an object as an argument to a parameter of noreference type;
</span><span class="c1">// 3. Return an object from a function that has a nonreference return type;
</span><span class="c1">// 4. Brace initialize the elements in an array or the members of an aggregate class;
</span><span class="c1">// 5. Some class types also use copy initializetion for the objects they allocate.
</span><span class="c1"></span></code></pre></td></tr></table>
</div>
</div>
<h2 id="exercise-13-dot-2">Exercise 13.2</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="c1">// Sales_data::Sales_data(Sales_data rhs)
</span><span class="c1">// try to define a copy constructor of class type Sales_data;
</span><span class="c1">// and the first parameter&#39;s type is Sales_data, it is illegal;
</span><span class="c1">// when copy constructor is used in copy initialization, Sales_data object as argument is pass in to copy initialize the paramenter rhs;
</span><span class="c1">// while this copy initialize will call the copy constructor itself;
</span><span class="c1">// a infinite loop in the end;
</span><span class="c1">// so the type of first parameter should be Sales_data&amp;.
</span><span class="c1"></span></code></pre></td></tr></table>
</div>
</div>
<h2 id="exercise-13-dot-3">Exercise 13.3</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="c1">// copy a StrBlob object would copy every non-static member of it, and StrBlob class type has a shared_ptr member, copy it will increase the reference count of the object which is pointed by shared_ptr.
</span><span class="c1">// copy a StrBlob object would copy every non-static member of it, StrBlobPtr class type has a weak_ptr member, copy it will not influence the reference count of the object which is pointed by weak_ptr.
</span><span class="c1"></span></code></pre></td></tr></table>
</div>
</div>
<h2 id="exercise-13-dot-4">Exercise 13.4</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="n">Point</span> <span class="n">global</span><span class="p">;</span>
<span class="n">Point</span> <span class="nf">foo_var</span><span class="p">(</span><span class="n">Point</span> <span class="n">arg</span><span class="p">)</span>	<span class="c1">// argument passed in would call copy constructor
</span><span class="c1"></span><span class="p">{</span>
  <span class="n">Point</span> <span class="n">local</span> <span class="o">=</span> <span class="n">arg</span><span class="p">,</span> <span class="o">*</span><span class="n">heap</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Point</span><span class="p">(</span><span class="n">global</span><span class="p">);</span> <span class="c1">// call copy constructor twice.
</span><span class="c1"></span>  <span class="o">*</span><span class="n">heap</span> <span class="o">=</span> <span class="n">local</span><span class="p">;</span>				<span class="c1">// copy-assignment operator
</span><span class="c1"></span>  <span class="n">Point</span> <span class="n">pa</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">local</span><span class="p">,</span> <span class="o">*</span><span class="n">heap</span><span class="p">};</span>			<span class="c1">// use curly braced list to initialize array would call copy constructor
</span><span class="c1"></span>  <span class="k">return</span> <span class="o">*</span><span class="n">heap</span><span class="p">;</span>					<span class="c1">// return an object, and the return type of this function is not reference, then it calls copy constructor
</span><span class="c1"></span><span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>
<h2 id="exercise-13-dot-5">Exercise 13.5</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="k">class</span><span class="err"> </span><span class="nc">HasPtr</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
  <span class="n">HasPtr</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="n">s</span> <span class="o">=</span> <span class="n">string</span><span class="p">())</span><span class="o">:</span>
    <span class="n">ps</span><span class="p">(</span><span class="k">new</span> <span class="n">string</span><span class="p">(</span><span class="n">s</span><span class="p">)),</span> <span class="n">i</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">{}</span>
  <span class="n">HasPtr</span><span class="p">(</span><span class="k">const</span> <span class="n">HasPtr</span> <span class="o">&amp;</span><span class="n">h</span><span class="p">)</span><span class="o">:</span> <span class="n">ps</span><span class="p">(</span><span class="k">new</span> <span class="n">string</span><span class="p">(</span><span class="o">*</span><span class="n">h</span><span class="p">.</span><span class="n">ps</span><span class="p">)),</span> <span class="n">i</span><span class="p">(</span><span class="n">h</span><span class="p">.</span><span class="n">i</span><span class="p">)</span> <span class="p">{}</span>
<span class="k">private</span><span class="o">:</span>
  <span class="n">string</span> <span class="o">*</span><span class="n">ps</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></td></tr></table>
</div>
</div>
<h2 id="exercise-13-dot-6">Exercise 13.6</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="c1">// copy-assignment operator defines what happened when assign an object to another object with same type.
</span><span class="c1">// when assign an object to another object with same type, copy-assignment operator would be called.
</span><span class="c1">// for sone class type, copy-assignment operator prevents the assignment of objects of this calss type, but mainly copy-assignment operator would assign every non-static member of right operand to the corresponding member of left operand using the copy-assignment operator for the type of the member.
</span><span class="c1">// if there is no copy-assignment operator defined within a class type, compiler would generate a synthesized copy-assignment oeperator for it.
</span><span class="c1"></span></code></pre></td></tr></table>
</div>
</div>
<h2 id="exercise-13-dot-7">Exercise 13.7</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="c1">// assign a StrBlob object to another StrBlob object would assign every non-static member of it, and StrBlob class type has a shared_ptr member, assign it will increase the reference count of the object which is pointed by right operand&#39;s shared_ptr, and decrease the reference count of the object which is pointed by the left operand&#39;s shared_ptr .
</span><span class="c1">// assign a StrBlobPtr object to another StrBlobPtr object would assign every non-static member of it, StrBlobPtr class type has a weak_ptr member, assignment of it will not influence the reference count of the object which is pointed by weak_ptr.
</span><span class="c1"></span></code></pre></td></tr></table>
</div>
</div>
<h2 id="exercise-13-dot-8">Exercise 13.8</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="k">class</span><span class="err"> </span><span class="nc">HasPtr</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
  <span class="n">HasPtr</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="n">s</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">())</span><span class="o">:</span>
    <span class="n">ps</span><span class="p">(</span><span class="k">new</span> <span class="n">string</span><span class="p">(</span><span class="n">s</span><span class="p">)),</span> <span class="n">i</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">{}</span>
  <span class="n">HasPtr</span><span class="p">(</span><span class="k">const</span> <span class="n">HasPtr</span> <span class="o">&amp;</span><span class="n">h</span><span class="p">)</span><span class="o">:</span> <span class="n">ps</span><span class="p">(</span><span class="k">new</span> <span class="n">string</span><span class="p">),</span> <span class="n">i</span><span class="p">(</span><span class="n">h</span><span class="p">.</span><span class="n">i</span><span class="p">)</span> <span class="p">{}</span>
  <span class="n">HasPtr</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">HasPtr</span> <span class="o">&amp;</span><span class="p">);</span>
<span class="k">private</span><span class="o">:</span>
  <span class="n">string</span> <span class="o">*</span><span class="n">ps</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
<span class="p">};</span>
<span class="n">HasPtr</span><span class="o">&amp;</span> <span class="n">HasPtr</span><span class="o">::</span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">HasPtr</span> <span class="o">&amp;</span><span class="n">h</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">auto</span> <span class="n">newptr</span> <span class="o">=</span> <span class="k">new</span> <span class="n">string</span><span class="p">(</span><span class="o">*</span><span class="n">h</span><span class="p">.</span><span class="n">ps</span><span class="p">);</span>
  <span class="k">delete</span> <span class="n">ps</span><span class="p">;</span>
  <span class="n">ps</span> <span class="o">=</span> <span class="n">newptr</span><span class="p">;</span>
  <span class="n">i</span> <span class="o">=</span> <span class="n">h</span><span class="p">.</span><span class="n">i</span><span class="p">;</span>
  <span class="k">return</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>
<h2 id="exercise-13-dot-9">Exercise 13.9</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="c1">// A destructor is a member function of class type, its name is combined of ~ and class name, and no return value, no parameter.
</span><span class="c1">// destructor releases the resource used by object, destruct every non-static member of object.
</span><span class="c1">// compiler would generate a synthesized destructor for a class if it has not defined a destructor.
</span><span class="c1"></span></code></pre></td></tr></table>
</div>
</div>
<h2 id="exercise-13-dot-10">Exercise 13.10</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="c1">// When a StrBlob object is destructed, every non-static member of it would be destructed, and descrease the reference count of the object which is pointed by object&#39;s share_ptr, if count comes to zero, that object be pointed is destructed, too.
</span><span class="c1">// When StrBlobPtr object is destructed, every non-static member of it would be destructed, since it has a weak_ptr member, this ptr&#39;s destruction has no influence on the reference count of the object which is pointed by weak_ptr.
</span><span class="c1"></span></code></pre></td></tr></table>
</div>
</div>
<h2 id="exercise-13-dot-11">Exercise 13.11</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="k">class</span><span class="err"> </span><span class="nc">HasPtr</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
  <span class="n">HasPtr</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="n">s</span> <span class="o">=</span> <span class="n">string</span><span class="p">())</span><span class="o">:</span>
    <span class="n">ps</span><span class="p">(</span><span class="k">new</span> <span class="n">string</span><span class="p">(</span><span class="n">s</span><span class="p">)),</span> <span class="n">i</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">{}</span>
  <span class="n">HasPtr</span><span class="p">(</span><span class="k">const</span> <span class="n">HasPtr</span> <span class="o">&amp;</span><span class="n">h</span><span class="p">)</span><span class="o">:</span> <span class="n">ps</span><span class="p">(</span><span class="k">new</span> <span class="n">string</span><span class="p">(</span><span class="o">*</span><span class="n">h</span><span class="p">.</span><span class="n">ps</span><span class="p">)),</span> <span class="n">i</span><span class="p">(</span><span class="n">h</span><span class="p">.</span><span class="n">i</span><span class="p">)</span> <span class="p">{}</span>
  <span class="n">HasPtr</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">HasPtr</span> <span class="o">&amp;</span><span class="p">);</span>
  <span class="o">~</span><span class="n">HasPtr</span><span class="p">()</span> <span class="p">{</span><span class="k">delete</span> <span class="n">ps</span><span class="p">;};</span>
<span class="k">private</span><span class="o">:</span>
  <span class="n">string</span> <span class="o">*</span><span class="n">ps</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
<span class="p">};</span>
<span class="n">HasPtr</span><span class="o">&amp;</span> <span class="n">HasPtr</span><span class="o">::</span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">HasPtr</span> <span class="o">&amp;</span><span class="n">h</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">auto</span> <span class="n">newptr</span> <span class="o">=</span> <span class="k">new</span> <span class="n">string</span><span class="p">(</span><span class="o">*</span><span class="n">h</span><span class="p">.</span><span class="n">ps</span><span class="p">);</span>
  <span class="k">delete</span> <span class="n">ps</span><span class="p">;</span>
  <span class="n">ps</span> <span class="o">=</span> <span class="n">newptr</span><span class="p">;</span>
  <span class="n">i</span> <span class="o">=</span> <span class="n">h</span><span class="p">.</span><span class="n">i</span><span class="p">;</span>
  <span class="k">return</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>
<h2 id="exercise-13-dot-12">Exercise 13.12</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="kt">bool</span> <span class="nf">fcn</span><span class="p">(</span><span class="k">const</span> <span class="n">Sales_data</span> <span class="o">*</span><span class="n">trans</span><span class="p">,</span> <span class="n">Sales_data</span> <span class="n">accum</span><span class="p">)</span> <span class="c1">// accum is copy initialized within this function body, it would be destructed when this function call ends.
</span><span class="c1"></span><span class="p">{</span>
  <span class="n">Sales_data</span> <span class="n">item1</span><span class="p">(</span><span class="o">*</span><span class="n">trans</span><span class="p">),</span> <span class="n">item2</span><span class="p">(</span><span class="n">accum</span><span class="p">);</span> <span class="c1">// both would be destructed when this function body ends
</span><span class="c1"></span>  <span class="k">return</span> <span class="n">item1</span><span class="p">.</span><span class="n">isbn</span><span class="p">()</span> <span class="o">!=</span> <span class="n">item2</span><span class="p">.</span><span class="n">isbn</span><span class="p">();</span> <span class="c1">// the two string temp object would be destructed when the expression ends
</span><span class="c1"></span>  <span class="c1">// and the temp bool object as result of this expression would be destructed after copy initialization of the return value.
</span><span class="c1"></span><span class="p">}</span>
<span class="c1">// since destruction of Sales_data object would lead to the destruction of the string type member, and destruct string object would call its destructor.
</span><span class="c1">// so there would be 2 + 2 + 2 + 1 + 1 = 8 times of calling of destructor.
</span><span class="c1"></span></code></pre></td></tr></table>
</div>
</div>
<h2 id="exercise-13-dot-13">Exercise 13.13</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="k">struct</span> <span class="n">X</span>
<span class="p">{</span>
  <span class="n">X</span><span class="p">()</span> <span class="p">{</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;X()&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;}</span>
  <span class="n">X</span><span class="p">(</span><span class="k">const</span> <span class="n">X</span> <span class="o">&amp;</span><span class="p">)</span> <span class="p">{</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;X(const X &amp;)&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;}</span>
  <span class="n">X</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">X</span> <span class="o">&amp;</span><span class="p">)</span> <span class="p">{</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;X &amp;operator=(const X &amp;x)&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;}</span>
  <span class="o">~</span><span class="n">X</span><span class="p">()</span> <span class="p">{</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;~X()&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;}</span>
<span class="p">};</span>
<span class="kt">void</span> <span class="nf">test1</span><span class="p">(</span><span class="n">X</span> <span class="o">&amp;</span><span class="p">)</span> <span class="p">{}</span>
<span class="kt">void</span> <span class="nf">test2</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="p">{}</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">X</span> <span class="n">x1</span><span class="p">;</span>
  <span class="n">X</span> <span class="n">x2</span> <span class="o">=</span> <span class="n">x1</span><span class="p">;</span>
  <span class="n">X</span> <span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="k">new</span> <span class="n">X</span><span class="p">;</span>
  <span class="n">test1</span><span class="p">(</span><span class="n">x1</span><span class="p">);</span>
  <span class="n">test2</span><span class="p">(</span><span class="n">x1</span><span class="p">);</span>
  <span class="n">X</span> <span class="n">ax</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="o">*</span><span class="n">p</span><span class="p">};</span>
  <span class="k">delete</span> <span class="n">p</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>
<h2 id="exercise-13-dot-14">Exercise 13.14</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="c1">// Using synthesized copy constructor
</span><span class="c1">// the outputs are all the same.
</span><span class="c1"></span></code></pre></td></tr></table>
</div>
</div>
<h2 id="exercise-13-dot-15">Exercise 13.15</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="c1">// if a copy constructor is defined within class type numbered,
</span><span class="c1">// outputs would be changed, for that copy constructor would generage a new number for the object,
</span><span class="c1">// what&#39;s more, function accepts a &#39;numbered s&#39; type parameter, this would call copy instructor when called, and &#39;s.mysn&#39; is different from the argument passed in,
</span><span class="c1">// different outputs, and not expected, do not match the real mysn member of original objects.
</span><span class="c1"></span></code></pre></td></tr></table>
</div>
</div>
<h2 id="exercise-13-dot-16">Exercise 13.16</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="c1">// That would give the expected result.
</span><span class="c1">// outputs would have three different serial numbers,
</span><span class="c1">// and every one represents the real mysn member of the passed in numbered type object.
</span><span class="c1"></span></code></pre></td></tr></table>
</div>
</div>
<h2 id="exercise-13-dot-17">Exercise 13.17</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="k">struct</span> <span class="n">numbered1</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">mysn</span><span class="p">;</span>
<span class="p">};</span>
<span class="k">struct</span> <span class="n">numbered2</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">mysn</span><span class="p">;</span>
  <span class="n">numbered2</span><span class="p">(</span><span class="k">const</span> <span class="n">numbered2</span> <span class="o">&amp;</span><span class="n">n</span><span class="p">)</span><span class="o">:</span> <span class="n">mysn</span><span class="p">(</span><span class="n">n</span><span class="p">.</span><span class="n">mysn</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{}</span>
  <span class="n">numbered2</span><span class="p">()</span><span class="o">:</span> <span class="n">mysn</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">{}</span>
<span class="p">};</span>
<span class="kt">void</span> <span class="nf">f1</span><span class="p">(</span><span class="n">numbered1</span> <span class="n">s</span><span class="p">)</span> <span class="p">{</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">s</span><span class="p">.</span><span class="n">mysn</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;}</span>
<span class="kt">void</span> <span class="nf">f2</span><span class="p">(</span><span class="n">numbered2</span> <span class="n">s</span><span class="p">)</span> <span class="p">{</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">s</span><span class="p">.</span><span class="n">mysn</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;}</span>
<span class="kt">void</span> <span class="nf">f3</span><span class="p">(</span><span class="k">const</span> <span class="n">numbered2</span> <span class="o">&amp;</span><span class="n">s</span><span class="p">)</span> <span class="p">{</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">s</span><span class="p">.</span><span class="n">mysn</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;}</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
  <span class="c1">// first
</span><span class="c1"></span>  <span class="n">numbered1</span> <span class="n">a1</span><span class="p">,</span> <span class="n">b1</span> <span class="o">=</span> <span class="n">a1</span><span class="p">,</span> <span class="n">c1</span> <span class="o">=</span> <span class="n">b1</span><span class="p">;</span>
  <span class="n">f1</span><span class="p">(</span><span class="n">a1</span><span class="p">);</span>
  <span class="n">f1</span><span class="p">(</span><span class="n">b1</span><span class="p">);</span>
  <span class="n">f1</span><span class="p">(</span><span class="n">c1</span><span class="p">);</span>
  <span class="c1">// second
</span><span class="c1"></span>  <span class="n">numbered2</span> <span class="n">a2</span><span class="p">,</span> <span class="n">b2</span> <span class="o">=</span> <span class="n">a2</span><span class="p">,</span> <span class="n">c2</span> <span class="o">=</span> <span class="n">b2</span><span class="p">;</span>
  <span class="n">f2</span><span class="p">(</span><span class="n">a2</span><span class="p">);</span>
  <span class="n">f2</span><span class="p">(</span><span class="n">b2</span><span class="p">);</span>
  <span class="n">f2</span><span class="p">(</span><span class="n">c2</span><span class="p">);</span>
  <span class="c1">// third
</span><span class="c1"></span>  <span class="n">f3</span><span class="p">(</span><span class="n">a2</span><span class="p">);</span>
  <span class="n">f3</span><span class="p">(</span><span class="n">b2</span><span class="p">);</span>
  <span class="n">f3</span><span class="p">(</span><span class="n">c2</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>
<h2 id="exercise-13-dot-18">Exercise 13.18</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="c1">// See Employee.h
</span><span class="c1"></span></code></pre></td></tr></table>
</div>
</div>
<h2 id="employee-dot-h">Employee.h</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="k">class</span><span class="err"> </span><span class="nc">Employee</span>
<span class="p">{</span>
  <span class="k">static</span> <span class="kt">unsigned</span> <span class="n">seed</span><span class="p">;</span>
  <span class="n">string</span> <span class="n">name</span><span class="p">;</span>
  <span class="kt">unsigned</span> <span class="n">id</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
 <span class="k">public</span><span class="o">:</span>
 <span class="n">Employee</span><span class="p">()</span><span class="o">:</span> <span class="n">id</span><span class="p">(</span><span class="o">++</span><span class="n">seed</span><span class="p">)</span> <span class="p">{}</span>
 <span class="n">Employee</span><span class="p">(</span><span class="n">string</span> <span class="n">n</span><span class="p">)</span><span class="o">:</span> <span class="n">name</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">id</span><span class="p">(</span><span class="o">++</span><span class="n">seed</span><span class="p">)</span> <span class="p">{}</span>
 <span class="n">Employee</span><span class="p">(</span><span class="k">const</span> <span class="n">Employee</span> <span class="o">&amp;</span><span class="n">e</span><span class="p">)</span><span class="o">:</span> <span class="n">name</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">name</span><span class="p">),</span> <span class="n">id</span><span class="p">(</span><span class="o">++</span><span class="n">seed</span><span class="p">)</span> <span class="p">{}</span>
  <span class="n">Employee</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">Employee</span> <span class="o">&amp;</span><span class="n">e</span><span class="p">);</span>
<span class="p">};</span>
<span class="kt">unsigned</span> <span class="n">Employee</span><span class="o">::</span><span class="n">seed</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="n">Employee</span><span class="o">&amp;</span> <span class="n">Employee</span><span class="o">::</span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">Employee</span> <span class="o">&amp;</span><span class="n">e</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">name</span> <span class="o">=</span> <span class="n">e</span><span class="p">.</span><span class="n">name</span><span class="p">;</span>
  <span class="n">id</span> <span class="o">=</span> <span class="o">++</span><span class="n">seed</span><span class="p">;</span>
  <span class="k">return</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>
<h2 id="exercise-13-dot-19">Exercise 13.19</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="c1">// Should define copy constructor and copy assignment operator itself.
</span><span class="c1">// For the name may be the same, but id of every employee object should be unique(id should be handled automatically)
</span><span class="c1">// See Employee.h
</span><span class="c1"></span></code></pre></td></tr></table>
</div>
</div>
<p><a href="#employee-dot-h">Employee.h</a></p>

<h2 id="exercise-13-dot-20">Exercise 13.20</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="c1">// copy: copy TextQuery or QueryResult object would copy every mamber of it, and would increase the reference count of the object which is pointed by the shared_ptr member;
</span><span class="c1">// assignment: assign TextQuery or QueryResult object would assign every mamber of it, and would increase the reference count of the object which is pointed by the shared_ptr member, decrease the reference count of the object which is pointed by the original shared_ptr;
</span><span class="c1">// destruct: destruct TextQuery or QueryResult object would destruct every mamber of it, and would decrease the reference count of the object which is pointed by the shared_ptr member;
</span><span class="c1"></span></code></pre></td></tr></table>
</div>
</div>
<h2 id="exercise-13-dot-21">Exercise 13.21</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="c1">// Should define the copy constructor and copy assignment operator;
</span><span class="c1">// copy objects of both types should just copy the content pointed by the share_ptr to another memory space pointed by the new shared_ptr, not directly copy the share_ptr object.
</span><span class="c1">// See TextQuery.h
</span><span class="c1"></span></code></pre></td></tr></table>
</div>
</div>
<h2 id="textquery-dot-h">TextQuery.h</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span><span class="lnt">90
</span><span class="lnt">91
</span><span class="lnt">92
</span><span class="lnt">93
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="cp">#ifndef TEXTQUERY_H
</span><span class="cp">#define TEXTQUERY_H
</span><span class="cp"></span><span class="k">class</span><span class="err"> </span><span class="nc">QueryResult</span><span class="p">;</span>
<span class="k">class</span><span class="err"> </span><span class="nc">TextQuery</span>
<span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="k">using</span> <span class="n">line_no</span> <span class="o">=</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;::</span><span class="n">size_type</span><span class="p">;</span>
  <span class="n">TextQuery</span><span class="p">(</span><span class="n">ifstream</span> <span class="o">&amp;</span><span class="n">infile</span><span class="p">);</span>
  <span class="n">TextQuery</span><span class="p">(</span><span class="k">const</span> <span class="n">TextQuery</span> <span class="o">&amp;</span><span class="p">);</span>
  <span class="n">TextQuery</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">TextQuery</span> <span class="o">&amp;</span><span class="p">);</span>
  <span class="n">QueryResult</span> <span class="nf">query</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="n">s</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
 <span class="k">private</span><span class="o">:</span>
  <span class="k">friend</span> <span class="n">QueryResult</span><span class="p">;</span>
  <span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;&gt;</span> <span class="n">sp1</span><span class="p">;</span>
  <span class="n">map</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span> <span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">set</span><span class="o">&lt;</span><span class="n">line_no</span><span class="o">&gt;&gt;&gt;</span> <span class="n">mp</span><span class="p">;</span>
<span class="p">};</span>
<span class="n">TextQuery</span><span class="o">::</span><span class="n">TextQuery</span><span class="p">(</span><span class="n">ifstream</span> <span class="o">&amp;</span><span class="n">infile</span><span class="p">)</span><span class="o">:</span>
<span class="n">sp1</span><span class="p">(</span><span class="k">new</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">line_no</span> <span class="n">line_number</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">string</span> <span class="n">line</span><span class="p">;</span>
  <span class="k">while</span><span class="p">(</span><span class="n">getline</span><span class="p">(</span><span class="n">infile</span><span class="p">,</span> <span class="n">line</span><span class="p">))</span>
    <span class="p">{</span>
      <span class="c1">// store line in vector&lt;string&gt;
</span><span class="c1"></span>      <span class="n">sp1</span><span class="o">-&gt;</span><span class="n">push_back</span><span class="p">(</span><span class="n">line</span><span class="p">);</span>
      <span class="c1">// scan through the line
</span><span class="c1"></span>      <span class="n">istringstream</span> <span class="nf">ist</span><span class="p">(</span><span class="n">line</span><span class="p">);</span>
      <span class="n">string</span> <span class="n">word</span><span class="p">;</span>
      <span class="k">while</span><span class="p">(</span><span class="n">ist</span> <span class="o">&gt;&gt;</span> <span class="n">word</span><span class="p">)</span>
      <span class="p">{</span>
	<span class="k">if</span><span class="p">(</span><span class="n">ispunct</span><span class="p">(</span><span class="n">word</span><span class="p">[</span><span class="n">word</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]))</span>
	  <span class="n">word</span><span class="p">.</span><span class="n">erase</span><span class="p">(</span><span class="n">word</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">auto</span> <span class="o">&amp;</span><span class="n">lines</span> <span class="o">=</span> <span class="n">mp</span><span class="p">[</span><span class="n">word</span><span class="p">];</span>
	<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">lines</span><span class="p">)</span> <span class="n">lines</span><span class="p">.</span><span class="n">reset</span><span class="p">(</span><span class="k">new</span> <span class="n">set</span><span class="o">&lt;</span><span class="n">line_no</span><span class="o">&gt;</span><span class="p">);</span>
	<span class="n">lines</span><span class="o">-&gt;</span><span class="n">insert</span><span class="p">(</span><span class="n">line_number</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="c1">// increase the line_number
</span><span class="c1"></span>      <span class="o">++</span><span class="n">line_number</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="n">TextQuery</span><span class="o">::</span><span class="n">TextQuery</span><span class="p">(</span><span class="k">const</span> <span class="n">TextQuery</span> <span class="o">&amp;</span><span class="n">t</span><span class="p">)</span><span class="o">:</span> <span class="n">sp1</span><span class="p">(</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="o">*</span><span class="n">t</span><span class="p">.</span><span class="n">sp1</span><span class="p">)),</span> <span class="n">mp</span><span class="p">(</span><span class="n">t</span><span class="p">.</span><span class="n">mp</span><span class="p">)</span> <span class="p">{}</span>
<span class="n">TextQuery</span> <span class="o">&amp;</span><span class="n">TextQuery</span><span class="o">::</span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">TextQuery</span> <span class="o">&amp;</span><span class="n">t</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">sp1</span> <span class="o">=</span> <span class="n">make_shared</span><span class="o">&lt;</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="o">*</span><span class="n">t</span><span class="p">.</span><span class="n">sp1</span><span class="p">);</span>
  <span class="n">mp</span> <span class="o">=</span> <span class="n">t</span><span class="p">.</span><span class="n">mp</span><span class="p">;</span>
  <span class="k">return</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span>
<span class="p">}</span>
  <span class="k">class</span><span class="err"> </span><span class="nc">QueryResult</span>
  <span class="p">{</span>
    <span class="k">friend</span> <span class="n">ostream</span> <span class="o">&amp;</span><span class="n">print</span><span class="p">(</span><span class="n">ostream</span> <span class="o">&amp;</span><span class="p">,</span> <span class="k">const</span> <span class="n">QueryResult</span> <span class="o">&amp;</span><span class="p">);</span>
    <span class="n">string</span> <span class="n">search_word</span><span class="p">;</span>
    <span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;&gt;</span> <span class="n">sp1</span><span class="p">;</span>
    <span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">set</span><span class="o">&lt;</span><span class="n">TextQuery</span><span class="o">::</span><span class="n">line_no</span><span class="o">&gt;&gt;</span> <span class="n">sp2</span><span class="p">;</span>
  <span class="k">public</span><span class="o">:</span>
  <span class="n">QueryResult</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="n">s</span><span class="p">,</span>
	    <span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">set</span><span class="o">&lt;</span><span class="n">TextQuery</span><span class="o">::</span><span class="n">line_no</span><span class="o">&gt;&gt;</span> <span class="n">p</span><span class="p">,</span>
	    <span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;&gt;</span> <span class="n">file</span><span class="p">)</span><span class="o">:</span> <span class="n">search_word</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="n">sp1</span><span class="p">(</span><span class="n">file</span><span class="p">),</span> <span class="n">sp2</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="p">{}</span>
    <span class="n">QueryResult</span><span class="p">(</span><span class="k">const</span> <span class="n">QueryResult</span> <span class="o">&amp;</span><span class="p">);</span>
    <span class="n">QueryResult</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">QueryResult</span> <span class="o">&amp;</span><span class="p">);</span>
    <span class="n">set</span><span class="o">&lt;</span><span class="n">TextQuery</span><span class="o">::</span><span class="n">line_no</span><span class="o">&gt;::</span><span class="n">iterator</span> <span class="n">begin</span><span class="p">()</span> <span class="p">{</span><span class="k">return</span> <span class="n">sp2</span><span class="o">-&gt;</span><span class="n">begin</span><span class="p">();}</span>
    <span class="n">set</span><span class="o">&lt;</span><span class="n">TextQuery</span><span class="o">::</span><span class="n">line_no</span><span class="o">&gt;::</span><span class="n">iterator</span> <span class="n">end</span><span class="p">()</span> <span class="p">{</span><span class="k">return</span> <span class="n">sp2</span><span class="o">-&gt;</span><span class="n">end</span><span class="p">();}</span>
    <span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;&gt;</span> <span class="n">get_file</span><span class="p">()</span> <span class="p">{</span><span class="k">return</span> <span class="n">sp1</span><span class="p">;}</span>
  <span class="p">};</span>
<span class="n">QueryResult</span><span class="o">::</span><span class="n">QueryResult</span><span class="p">(</span><span class="k">const</span> <span class="n">QueryResult</span> <span class="o">&amp;</span><span class="n">q</span><span class="p">)</span><span class="o">:</span> <span class="n">sp1</span><span class="p">(</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="o">*</span><span class="n">q</span><span class="p">.</span><span class="n">sp1</span><span class="p">)),</span> <span class="n">sp2</span><span class="p">(</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">set</span><span class="o">&lt;</span><span class="n">TextQuery</span><span class="o">::</span><span class="n">line_no</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="o">*</span><span class="n">q</span><span class="p">.</span><span class="n">sp2</span><span class="p">)),</span> <span class="n">search_word</span><span class="p">(</span><span class="n">q</span><span class="p">.</span><span class="n">search_word</span><span class="p">)</span> <span class="p">{}</span>
<span class="n">QueryResult</span> <span class="o">&amp;</span><span class="n">QueryResult</span><span class="o">::</span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">QueryResult</span> <span class="o">&amp;</span><span class="n">q</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">sp1</span> <span class="o">=</span> <span class="n">make_shared</span><span class="o">&lt;</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="o">*</span><span class="n">q</span><span class="p">.</span><span class="n">sp1</span><span class="p">);</span>
  <span class="n">sp2</span> <span class="o">=</span> <span class="n">make_shared</span><span class="o">&lt;</span><span class="n">set</span><span class="o">&lt;</span><span class="n">TextQuery</span><span class="o">::</span><span class="n">line_no</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="o">*</span><span class="n">q</span><span class="p">.</span><span class="n">sp2</span><span class="p">);</span>
  <span class="n">search_word</span> <span class="o">=</span> <span class="n">q</span><span class="p">.</span><span class="n">search_word</span><span class="p">;</span>
  <span class="k">return</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span>
<span class="p">}</span>
  <span class="n">ostream</span> <span class="o">&amp;</span><span class="n">print</span><span class="p">(</span><span class="n">ostream</span> <span class="o">&amp;</span><span class="n">o</span><span class="p">,</span> <span class="k">const</span> <span class="n">QueryResult</span> <span class="o">&amp;</span><span class="n">q</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="k">auto</span> <span class="n">n</span> <span class="o">=</span> <span class="n">q</span><span class="p">.</span><span class="n">sp2</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">();</span>
    <span class="n">o</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;element occurs &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">n</span> <span class="o">&lt;&lt;</span> <span class="s">&#34; times&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="k">auto</span> <span class="n">result</span> <span class="o">=</span> <span class="o">*</span><span class="n">q</span><span class="p">.</span><span class="n">sp2</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="k">const</span> <span class="k">auto</span> <span class="o">&amp;</span><span class="nl">l</span> <span class="p">:</span> <span class="n">result</span><span class="p">)</span>
      <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;</span><span class="se">\t</span><span class="s">(line &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">l</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;) &#34;</span>
	 <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="o">*</span><span class="n">q</span><span class="p">.</span><span class="n">sp1</span><span class="p">)[</span><span class="n">l</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">o</span><span class="p">;</span>
  <span class="p">}</span>
<span class="n">QueryResult</span> <span class="n">TextQuery</span><span class="o">::</span><span class="n">query</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="n">s</span><span class="p">)</span> <span class="k">const</span>
<span class="p">{</span>
  <span class="k">static</span> <span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">set</span><span class="o">&lt;</span><span class="n">line_no</span><span class="o">&gt;&gt;</span> <span class="n">nodata</span><span class="p">(</span><span class="k">new</span> <span class="n">set</span><span class="o">&lt;</span><span class="n">line_no</span><span class="o">&gt;</span><span class="p">);</span>
  <span class="k">auto</span> <span class="n">iter</span> <span class="o">=</span> <span class="n">mp</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">s</span><span class="p">);</span>
  <span class="k">auto</span> <span class="n">last</span> <span class="o">=</span> <span class="n">mp</span><span class="p">.</span><span class="n">end</span><span class="p">();</span>
  <span class="k">if</span><span class="p">(</span><span class="n">iter</span> <span class="o">!=</span> <span class="n">last</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">QueryResult</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">iter</span><span class="o">-&gt;</span><span class="n">second</span><span class="p">,</span> <span class="n">sp1</span><span class="p">);</span>
  <span class="k">else</span>
    <span class="k">return</span> <span class="nf">QueryResult</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">nodata</span><span class="p">,</span> <span class="n">sp1</span><span class="p">);</span>
<span class="p">}</span>
<span class="cp">#endif
</span><span class="cp"></span></code></pre></td></tr></table>
</div>
</div>
<h2 id="exercise-13-dot-22">Exercise 13.22</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="k">class</span><span class="err"> </span><span class="nc">HasPtr</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
  <span class="n">HasPtr</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="n">s</span> <span class="o">=</span> <span class="n">string</span><span class="p">())</span><span class="o">:</span>
    <span class="n">ps</span><span class="p">(</span><span class="k">new</span> <span class="n">string</span><span class="p">(</span><span class="n">s</span><span class="p">)),</span> <span class="n">i</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">{}</span>
  <span class="n">HasPtr</span><span class="p">(</span><span class="k">const</span> <span class="n">HasPtr</span> <span class="o">&amp;</span><span class="n">h</span><span class="p">)</span><span class="o">:</span> <span class="n">ps</span><span class="p">(</span><span class="k">new</span> <span class="n">string</span><span class="p">(</span><span class="o">*</span><span class="n">h</span><span class="p">.</span><span class="n">ps</span><span class="p">)),</span> <span class="n">i</span><span class="p">(</span><span class="n">h</span><span class="p">.</span><span class="n">i</span><span class="p">)</span> <span class="p">{}</span>
  <span class="n">HasPtr</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">HasPtr</span> <span class="o">&amp;</span><span class="p">);</span>
  <span class="o">~</span><span class="n">HasPtr</span><span class="p">()</span> <span class="p">{</span><span class="k">delete</span> <span class="n">ps</span><span class="p">;};</span>
<span class="k">private</span><span class="o">:</span>
  <span class="n">string</span> <span class="o">*</span><span class="n">ps</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
<span class="p">};</span>
<span class="n">HasPtr</span><span class="o">&amp;</span> <span class="n">HasPtr</span><span class="o">::</span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">HasPtr</span> <span class="o">&amp;</span><span class="n">h</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">auto</span> <span class="n">newptr</span> <span class="o">=</span> <span class="k">new</span> <span class="n">string</span><span class="p">(</span><span class="o">*</span><span class="n">h</span><span class="p">.</span><span class="n">ps</span><span class="p">);</span>
  <span class="k">delete</span> <span class="n">ps</span><span class="p">;</span>
  <span class="n">ps</span> <span class="o">=</span> <span class="n">newptr</span><span class="p">;</span>
  <span class="n">i</span> <span class="o">=</span> <span class="n">h</span><span class="p">.</span><span class="n">i</span><span class="p">;</span>
  <span class="k">return</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>
<h2 id="exercise-13-dot-23">Exercise 13.23</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="c1">// See exercise 13.22.cpp, I made a lot of mistakes before.
</span><span class="c1"></span></code></pre></td></tr></table>
</div>
</div>
<h2 id="13-dot-22-dot-cpp">13.22.cpp</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="k">class</span><span class="err"> </span><span class="nc">HasPtr</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
  <span class="n">HasPtr</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="n">s</span> <span class="o">=</span> <span class="n">string</span><span class="p">())</span><span class="o">:</span>
    <span class="n">ps</span><span class="p">(</span><span class="k">new</span> <span class="n">string</span><span class="p">(</span><span class="n">s</span><span class="p">)),</span> <span class="n">i</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">{}</span>
  <span class="n">HasPtr</span><span class="p">(</span><span class="k">const</span> <span class="n">HasPtr</span> <span class="o">&amp;</span><span class="n">h</span><span class="p">)</span><span class="o">:</span> <span class="n">ps</span><span class="p">(</span><span class="k">new</span> <span class="n">string</span><span class="p">(</span><span class="o">*</span><span class="n">h</span><span class="p">.</span><span class="n">ps</span><span class="p">)),</span> <span class="n">i</span><span class="p">(</span><span class="n">h</span><span class="p">.</span><span class="n">i</span><span class="p">)</span> <span class="p">{}</span>
  <span class="n">HasPtr</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">HasPtr</span> <span class="o">&amp;</span><span class="p">);</span>
  <span class="o">~</span><span class="n">HasPtr</span><span class="p">()</span> <span class="p">{</span><span class="k">delete</span> <span class="n">ps</span><span class="p">;};</span>
<span class="k">private</span><span class="o">:</span>
  <span class="n">string</span> <span class="o">*</span><span class="n">ps</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
<span class="p">};</span>
<span class="n">HasPtr</span><span class="o">&amp;</span> <span class="n">HasPtr</span><span class="o">::</span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">HasPtr</span> <span class="o">&amp;</span><span class="n">h</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">auto</span> <span class="n">newptr</span> <span class="o">=</span> <span class="k">new</span> <span class="n">string</span><span class="p">(</span><span class="o">*</span><span class="n">h</span><span class="p">.</span><span class="n">ps</span><span class="p">);</span>
  <span class="k">delete</span> <span class="n">ps</span><span class="p">;</span>
  <span class="n">ps</span> <span class="o">=</span> <span class="n">newptr</span><span class="p">;</span>
  <span class="n">i</span> <span class="o">=</span> <span class="n">h</span><span class="p">.</span><span class="n">i</span><span class="p">;</span>
  <span class="k">return</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>
<h2 id="exercise-13-dot-24">Exercise 13.24</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="c1">// if not define a destructor in HasPtr class type, the dynamic memory space pointed by member ps would not be released after destruction of HasPtr object, then causes memory leak.
</span><span class="c1">// if not define a copy constructor illustrated in section 12.2.1, copy initialization of HasPtr object would directly copy the value of member ps, thus at last two objects&#39; ps member both point to the same dynamic memory space.
</span><span class="c1"></span></code></pre></td></tr></table>
</div>
</div>
<h2 id="exercise-13-dot-25">Exercise 13.25</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="c1">// See StrBlob.h
</span><span class="c1">// copy onstructor must allocate a new dynamic memory space for the content copied from the place pointed by original StrBlob object&#39;s shared_ptr, use the new shared_ptr object to initialize self&#39;s data member.
</span><span class="c1">// copy assignment operator behaves almost like copy constructor, but it does not initialize data member, instead it assigns the new shared_ptr value to it.
</span><span class="c1">// what&#39;s more, operator does not need to explicitly free the dynamic memory originally pointed by the old value of data member, for data&#39;s type is shared_ptr, the dynamic space arranged by shared_ptr would be automatically released when its reference count decreases to zero.
</span><span class="c1">// StrBlob could rely its own synthesized destructor, for there is only one data member, and class type of member itself owns destrucor.
</span><span class="c1"></span></code></pre></td></tr></table>
</div>
</div>
<h2 id="strblob-dot-h">StrBlob.h</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="cp">#ifndef STRBLOB_H
</span><span class="cp">#define STRBLOB_H
</span><span class="cp"></span><span class="k">class</span><span class="err"> </span><span class="nc">StrBlobPtr</span><span class="p">;</span>
<span class="k">class</span><span class="err"> </span><span class="nc">StrBlob</span>
<span class="p">{</span>
  <span class="k">friend</span> <span class="k">class</span><span class="err"> </span><span class="nc">StrBlobPtr</span><span class="p">;</span>
  <span class="k">friend</span> <span class="k">class</span><span class="err"> </span><span class="nc">ConstStrBlobPtr</span><span class="p">;</span>
  <span class="k">friend</span> <span class="kt">bool</span> <span class="k">operator</span><span class="o">==</span><span class="p">(</span><span class="k">const</span> <span class="n">StrBlob</span> <span class="o">&amp;</span><span class="p">,</span> <span class="k">const</span> <span class="n">StrBlob</span> <span class="o">&amp;</span><span class="p">);</span>
  <span class="k">friend</span> <span class="kt">bool</span> <span class="k">operator</span><span class="o">!=</span><span class="p">(</span><span class="k">const</span> <span class="n">StrBlob</span> <span class="o">&amp;</span><span class="p">,</span> <span class="k">const</span> <span class="n">StrBlob</span> <span class="o">&amp;</span><span class="p">);</span>
  <span class="k">friend</span> <span class="kt">bool</span> <span class="k">operator</span><span class="o">&lt;</span><span class="p">(</span><span class="k">const</span> <span class="n">StrBlob</span> <span class="o">&amp;</span><span class="p">,</span> <span class="k">const</span> <span class="n">StrBlob</span> <span class="o">&amp;</span><span class="p">);</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="k">typedef</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;::</span><span class="n">size_type</span> <span class="n">size_type</span><span class="p">;</span>
  <span class="n">StrBlob</span><span class="p">();</span>
  <span class="n">StrBlob</span><span class="p">(</span><span class="n">initializer_list</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">il</span><span class="p">);</span>
  <span class="n">StrBlob</span><span class="p">(</span><span class="k">const</span> <span class="n">StrBlob</span> <span class="o">&amp;</span><span class="p">);</span>
  <span class="n">StrBlob</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">StrBlob</span> <span class="o">&amp;</span><span class="p">);</span>
  <span class="n">string</span> <span class="o">&amp;</span><span class="k">operator</span><span class="p">[](</span><span class="n">size_t</span> <span class="n">n</span><span class="p">);</span>
  <span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="k">operator</span><span class="p">[](</span><span class="n">size_t</span> <span class="n">n</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
  <span class="n">size_type</span> <span class="nf">size</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span><span class="k">return</span> <span class="n">data</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">();}</span>
  <span class="kt">bool</span> <span class="nf">empty</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span><span class="k">return</span> <span class="n">data</span><span class="o">-&gt;</span><span class="n">empty</span><span class="p">();}</span>
  <span class="kt">void</span> <span class="nf">push_back</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="n">t</span><span class="p">)</span> <span class="p">{</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">push_back</span><span class="p">(</span><span class="n">t</span><span class="p">);}</span>
  <span class="kt">void</span> <span class="nf">push_back</span><span class="p">(</span><span class="n">string</span> <span class="o">&amp;&amp;</span><span class="n">t</span><span class="p">)</span> <span class="p">{</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">push_back</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">t</span><span class="p">));}</span>
  <span class="kt">void</span> <span class="nf">pop_back</span><span class="p">();</span>
  <span class="n">string</span> <span class="o">&amp;</span><span class="n">front</span><span class="p">();</span>
  <span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="n">front</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
  <span class="n">string</span> <span class="o">&amp;</span><span class="n">back</span><span class="p">();</span>
  <span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="n">back</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
  <span class="n">StrBlobPtr</span> <span class="nf">begin</span><span class="p">();</span>
    <span class="n">StrBlobPtr</span> <span class="nf">end</span><span class="p">();</span>
 <span class="k">private</span><span class="o">:</span>
  <span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;&gt;</span> <span class="n">data</span><span class="p">;</span>
  <span class="kt">void</span> <span class="nf">check</span><span class="p">(</span><span class="n">size_type</span> <span class="n">i</span><span class="p">,</span> <span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="n">msg</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
<span class="p">};</span>
<span class="k">class</span><span class="err"> </span><span class="nc">StrBlobPtr</span>
<span class="p">{</span>
  <span class="k">friend</span> <span class="kt">bool</span> <span class="k">operator</span><span class="o">==</span><span class="p">(</span><span class="k">const</span> <span class="n">StrBlobPtr</span> <span class="o">&amp;</span><span class="p">,</span> <span class="k">const</span> <span class="n">StrBlobPtr</span> <span class="o">&amp;</span><span class="p">);</span>
  <span class="k">friend</span> <span class="kt">bool</span> <span class="k">operator</span><span class="o">!=</span><span class="p">(</span><span class="k">const</span> <span class="n">StrBlobPtr</span> <span class="o">&amp;</span><span class="p">,</span> <span class="k">const</span> <span class="n">StrBlobPtr</span> <span class="o">&amp;</span><span class="p">);</span>
  <span class="k">friend</span> <span class="kt">bool</span> <span class="k">operator</span><span class="o">&lt;</span><span class="p">(</span><span class="k">const</span> <span class="n">StrBlobPtr</span> <span class="o">&amp;</span><span class="p">,</span> <span class="k">const</span> <span class="n">StrBlobPtr</span> <span class="o">&amp;</span><span class="p">);</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="n">string</span> <span class="o">&amp;</span><span class="k">operator</span><span class="p">[](</span><span class="n">size_t</span> <span class="n">n</span><span class="p">);</span>
  <span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="k">operator</span><span class="p">[](</span><span class="n">size_t</span> <span class="n">n</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
 <span class="n">StrBlobPtr</span><span class="p">()</span><span class="o">:</span> <span class="n">curr</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">{}</span>
 <span class="n">StrBlobPtr</span><span class="p">(</span><span class="n">StrBlob</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">,</span> <span class="n">size_t</span> <span class="n">sz</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span><span class="o">:</span>
  <span class="n">wptr</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">data</span><span class="p">),</span> <span class="n">curr</span><span class="p">(</span><span class="n">sz</span><span class="p">)</span> <span class="p">{}</span>
  <span class="n">string</span> <span class="o">&amp;</span><span class="n">deref</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
  <span class="n">StrBlobPtr</span> <span class="o">&amp;</span><span class="n">incr</span><span class="p">();</span>
 <span class="k">private</span><span class="o">:</span>
  <span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;&gt;</span> <span class="n">check</span><span class="p">(</span><span class="n">size_t</span><span class="p">,</span><span class="k">const</span> <span class="n">string</span><span class="o">&amp;</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
  <span class="n">weak_ptr</span><span class="o">&lt;</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;&gt;</span> <span class="n">wptr</span><span class="p">;</span>
  <span class="n">size_t</span> <span class="n">curr</span><span class="p">;</span>
<span class="p">};</span>
<span class="k">class</span><span class="err"> </span><span class="nc">ConstStrBlobPtr</span>
<span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
 <span class="n">ConstStrBlobPtr</span><span class="p">()</span><span class="o">:</span> <span class="n">curr</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">{}</span>
 <span class="n">ConstStrBlobPtr</span><span class="p">(</span><span class="k">const</span> <span class="n">StrBlob</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">,</span> <span class="n">size_t</span> <span class="n">sz</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span><span class="o">:</span>
  <span class="n">wptr</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">data</span><span class="p">),</span> <span class="n">curr</span><span class="p">(</span><span class="n">sz</span><span class="p">)</span> <span class="p">{}</span>
  <span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="n">deref</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
  <span class="n">ConstStrBlobPtr</span> <span class="o">&amp;</span><span class="n">incr</span><span class="p">();</span>
 <span class="k">private</span><span class="o">:</span>
  <span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;&gt;</span> <span class="n">check</span><span class="p">(</span><span class="n">size_t</span><span class="p">,</span><span class="k">const</span> <span class="n">string</span><span class="o">&amp;</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
  <span class="n">weak_ptr</span><span class="o">&lt;</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;&gt;</span> <span class="n">wptr</span><span class="p">;</span>
  <span class="n">size_t</span> <span class="n">curr</span><span class="p">;</span>
<span class="p">};</span>
<span class="cp">#endif
</span><span class="cp"></span></code></pre></td></tr></table>
</div>
</div>
<h2 id="exercise-13-dot-26">Exercise 13.26</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="c1">// See StrBlob.h
</span><span class="c1"></span></code></pre></td></tr></table>
</div>
</div>
<p><a href="#strblob-dot-h">StrBlob.h</a></p>

<h2 id="exercise-13-dot-27">Exercise 13.27</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="k">class</span><span class="err"> </span><span class="nc">HasPtr</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
  <span class="n">HasPtr</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="n">s</span> <span class="o">=</span> <span class="n">string</span><span class="p">())</span><span class="o">:</span>
    <span class="n">ps</span><span class="p">(</span><span class="k">new</span> <span class="n">string</span><span class="p">(</span><span class="n">s</span><span class="p">)),</span> <span class="n">use</span><span class="p">(</span><span class="k">new</span> <span class="n">size_t</span><span class="p">(</span><span class="mi">1</span><span class="p">)),</span> <span class="n">i</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">{}</span>
  <span class="n">HasPtr</span><span class="p">(</span><span class="k">const</span> <span class="n">HasPtr</span> <span class="o">&amp;</span><span class="n">h</span><span class="p">)</span><span class="o">:</span> <span class="n">ps</span><span class="p">(</span><span class="k">new</span> <span class="n">string</span><span class="p">(</span><span class="o">*</span><span class="n">h</span><span class="p">.</span><span class="n">ps</span><span class="p">)),</span> <span class="n">use</span><span class="p">(</span><span class="n">h</span><span class="p">.</span><span class="n">use</span><span class="p">),</span><span class="n">i</span><span class="p">(</span><span class="n">h</span><span class="p">.</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span><span class="o">++*</span><span class="n">use</span><span class="p">;}</span>
  <span class="n">HasPtr</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">HasPtr</span> <span class="o">&amp;</span><span class="p">);</span>
  <span class="o">~</span><span class="n">HasPtr</span><span class="p">();</span>
<span class="k">private</span><span class="o">:</span>
  <span class="n">string</span> <span class="o">*</span><span class="n">ps</span><span class="p">;</span>
  <span class="n">size_t</span> <span class="o">*</span><span class="n">use</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
<span class="p">};</span>
<span class="n">HasPtr</span><span class="o">::~</span><span class="n">HasPtr</span><span class="p">()</span>
<span class="p">{</span>
  <span class="k">if</span><span class="p">(</span><span class="o">--*</span><span class="n">use</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="k">delete</span> <span class="n">ps</span><span class="p">;</span>
      <span class="k">delete</span> <span class="n">use</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="n">HasPtr</span><span class="o">&amp;</span> <span class="n">HasPtr</span><span class="o">::</span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">HasPtr</span> <span class="o">&amp;</span><span class="n">h</span><span class="p">)</span>
<span class="p">{</span>
  <span class="o">++*</span><span class="n">h</span><span class="p">.</span><span class="n">use</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="o">--*</span><span class="n">use</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="k">delete</span> <span class="n">ps</span><span class="p">;</span>
      <span class="k">delete</span> <span class="n">use</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="n">ps</span> <span class="o">=</span> <span class="n">h</span><span class="p">.</span><span class="n">ps</span><span class="p">;</span>
  <span class="n">i</span> <span class="o">=</span> <span class="n">h</span><span class="p">.</span><span class="n">i</span><span class="p">;</span>
  <span class="n">use</span> <span class="o">=</span> <span class="n">h</span><span class="p">.</span><span class="n">use</span><span class="p">;</span>
  <span class="k">return</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>
<h2 id="exercise-13-dot-28">Exercise 13.28</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="c1">// recursive widely used here.
</span><span class="c1"></span><span class="k">class</span><span class="err"> </span><span class="nc">BinStrTree</span><span class="p">;</span>
<span class="k">class</span><span class="err"> </span><span class="nc">TreeNode</span>
<span class="p">{</span>
<span class="k">private</span><span class="o">:</span>
  <span class="n">string</span> <span class="n">value</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">count</span><span class="p">;</span>
  <span class="n">TreeNode</span> <span class="o">*</span><span class="n">left</span><span class="p">;</span>
  <span class="n">TreeNode</span> <span class="o">*</span><span class="n">right</span><span class="p">;</span>
<span class="k">public</span><span class="o">:</span>
  <span class="n">TreeNode</span><span class="p">()</span><span class="o">:</span> <span class="n">count</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">left</span><span class="p">(</span><span class="k">nullptr</span><span class="p">),</span> <span class="n">right</span><span class="p">(</span><span class="k">nullptr</span><span class="p">)</span> <span class="p">{}</span>
  <span class="n">TreeNode</span><span class="p">(</span><span class="k">const</span> <span class="n">TreeNode</span> <span class="o">&amp;</span><span class="n">t</span><span class="p">);</span>
  <span class="n">TreeNode</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">TreeNode</span> <span class="o">&amp;</span><span class="n">t</span><span class="p">);</span>
  <span class="o">~</span><span class="n">TreeNode</span><span class="p">();</span>
<span class="p">};</span>
<span class="n">TreeNode</span><span class="o">::</span><span class="n">TreeNode</span><span class="p">(</span><span class="k">const</span> <span class="n">TreeNode</span> <span class="o">&amp;</span><span class="n">t</span><span class="p">)</span><span class="o">:</span> <span class="n">value</span><span class="p">(</span><span class="n">t</span><span class="p">.</span><span class="n">value</span><span class="p">),</span> <span class="n">count</span><span class="p">(</span><span class="n">t</span><span class="p">.</span><span class="n">count</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span><span class="p">(</span><span class="n">t</span><span class="p">.</span><span class="n">left</span><span class="p">)</span>
    <span class="n">left</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TreeNode</span><span class="p">(</span><span class="o">*</span><span class="n">t</span><span class="p">.</span><span class="n">left</span><span class="p">);</span>
  <span class="k">if</span><span class="p">(</span><span class="n">t</span><span class="p">.</span><span class="n">right</span><span class="p">)</span>
    <span class="n">right</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TreeNode</span><span class="p">(</span><span class="o">*</span><span class="n">t</span><span class="p">.</span><span class="n">right</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">TreeNode</span> <span class="o">&amp;</span><span class="n">TreeNode</span><span class="o">::</span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">TreeNode</span> <span class="o">&amp;</span><span class="n">t</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">auto</span> <span class="n">new_left</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TreeNode</span><span class="p">(</span><span class="o">*</span><span class="n">t</span><span class="p">.</span><span class="n">left</span><span class="p">);</span>
  <span class="k">auto</span> <span class="n">new_right</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TreeNode</span><span class="p">(</span><span class="o">*</span><span class="n">t</span><span class="p">.</span><span class="n">right</span><span class="p">);</span>
  <span class="k">delete</span> <span class="n">left</span><span class="p">;</span>
  <span class="k">delete</span> <span class="n">right</span><span class="p">;</span>
  <span class="n">left</span> <span class="o">=</span> <span class="n">new_left</span><span class="p">;</span>
  <span class="n">right</span> <span class="o">=</span> <span class="n">new_right</span><span class="p">;</span>
  <span class="n">value</span> <span class="o">=</span> <span class="n">t</span><span class="p">.</span><span class="n">value</span><span class="p">;</span>
  <span class="n">count</span> <span class="o">=</span> <span class="n">t</span><span class="p">.</span><span class="n">count</span><span class="p">;</span>
  <span class="k">return</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">TreeNode</span><span class="o">::~</span><span class="n">TreeNode</span><span class="p">()</span>
<span class="p">{</span>
  <span class="k">delete</span> <span class="n">left</span><span class="p">;</span>
  <span class="k">delete</span> <span class="n">right</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">class</span><span class="err"> </span><span class="nc">BinStrTree</span>
<span class="p">{</span>
<span class="k">private</span><span class="o">:</span>
  <span class="n">TreeNode</span> <span class="o">*</span><span class="n">root</span><span class="p">;</span>
<span class="k">public</span><span class="o">:</span>
  <span class="n">BinStrTree</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>
  <span class="n">BinStrTree</span><span class="p">(</span><span class="k">const</span> <span class="n">BinStrTree</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span><span class="o">:</span> <span class="n">root</span><span class="p">(</span><span class="k">new</span> <span class="n">TreeNode</span><span class="p">(</span><span class="o">*</span><span class="n">b</span><span class="p">.</span><span class="n">root</span><span class="p">))</span> <span class="p">{}</span>
  <span class="n">BinStrTree</span><span class="p">(</span><span class="k">const</span> <span class="n">TreeNode</span> <span class="o">&amp;</span><span class="n">t</span><span class="p">)</span><span class="o">:</span> <span class="n">root</span><span class="p">(</span><span class="k">new</span> <span class="n">TreeNode</span><span class="p">(</span><span class="n">t</span><span class="p">))</span> <span class="p">{}</span>
  <span class="n">BinStrTree</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">BinStrTree</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">);</span>
  <span class="o">~</span><span class="n">BinStrTree</span><span class="p">();</span>
<span class="p">};</span>
<span class="n">BinStrTree</span> <span class="o">&amp;</span><span class="n">BinStrTree</span><span class="o">::</span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">BinStrTree</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">auto</span> <span class="n">new_root</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TreeNode</span><span class="p">(</span><span class="o">*</span><span class="n">b</span><span class="p">.</span><span class="n">root</span><span class="p">);</span>
  <span class="k">delete</span> <span class="n">root</span><span class="p">;</span>
  <span class="n">root</span> <span class="o">=</span> <span class="n">new_root</span><span class="p">;</span>
  <span class="k">return</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">BinStrTree</span><span class="o">::~</span><span class="n">BinStrTree</span><span class="p">()</span>
<span class="p">{</span>
  <span class="k">delete</span> <span class="n">root</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>
<h2 id="exercise-13-dot-29">Exercise 13.29</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="c1">// Because the swap version called in &#39;HasPtr &amp;HasPtr::operator=(HasPtr rhs)&#39; is the type specified version, not std::swap.
</span><span class="c1"></span></code></pre></td></tr></table>
</div>
</div>
<h2 id="exercise-13-dot-30">Exercise 13.30</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="c1">// See HasPtr.h.
</span><span class="c1"></span></code></pre></td></tr></table>
</div>
</div>
<h2 id="hasptr-dot-h">HasPtr.h</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="k">class</span><span class="err"> </span><span class="nc">HasPtr</span>
<span class="p">{</span>
  <span class="k">friend</span> <span class="kt">void</span> <span class="n">swap</span><span class="p">(</span><span class="n">HasPtr</span> <span class="o">&amp;</span><span class="p">,</span> <span class="n">HasPtr</span> <span class="o">&amp;</span><span class="p">);</span>
 <span class="k">public</span><span class="o">:</span>
 <span class="n">HasPtr</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="n">s</span> <span class="o">=</span> <span class="n">string</span><span class="p">())</span><span class="o">:</span> <span class="n">ps</span><span class="p">(</span><span class="k">new</span> <span class="n">string</span><span class="p">(</span><span class="n">s</span><span class="p">)),</span> <span class="n">i</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">{}</span>
  <span class="n">HasPtr</span><span class="p">(</span><span class="n">HasPtr</span> <span class="o">&amp;&amp;</span><span class="n">h</span><span class="p">)</span> <span class="k">noexcept</span><span class="o">:</span> <span class="n">ps</span><span class="p">(</span><span class="n">h</span><span class="p">.</span><span class="n">ps</span><span class="p">),</span> <span class="n">i</span><span class="p">(</span><span class="n">h</span><span class="p">.</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span><span class="n">h</span><span class="p">.</span><span class="n">ps</span> <span class="o">=</span> <span class="k">nullptr</span><span class="p">;}</span>
 <span class="n">HasPtr</span><span class="p">(</span><span class="k">const</span> <span class="n">HasPtr</span> <span class="o">&amp;</span><span class="n">h</span><span class="p">)</span><span class="o">:</span> <span class="n">ps</span><span class="p">(</span><span class="k">new</span> <span class="n">string</span><span class="p">(</span><span class="o">*</span><span class="n">h</span><span class="p">.</span><span class="n">ps</span><span class="p">)),</span> <span class="n">i</span><span class="p">(</span><span class="n">h</span><span class="p">.</span><span class="n">i</span><span class="p">)</span> <span class="p">{}</span>
  <span class="n">HasPtr</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">HasPtr</span> <span class="o">&amp;</span><span class="p">);</span>
  <span class="n">HasPtr</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="n">HasPtr</span> <span class="o">&amp;&amp;</span><span class="p">)</span> <span class="k">noexcept</span><span class="p">;</span>
  <span class="o">~</span><span class="n">HasPtr</span><span class="p">()</span> <span class="p">{</span><span class="k">delete</span> <span class="n">ps</span><span class="p">;};</span>
 <span class="k">private</span><span class="o">:</span>
  <span class="n">string</span> <span class="o">*</span><span class="n">ps</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
<span class="p">};</span>
<span class="n">HasPtr</span><span class="o">&amp;</span> <span class="n">HasPtr</span><span class="o">::</span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="n">HasPtr</span> <span class="o">&amp;&amp;</span><span class="n">h</span><span class="p">)</span> <span class="k">noexcept</span>
<span class="p">{</span>
  <span class="k">if</span><span class="p">(</span><span class="k">this</span> <span class="o">!=</span> <span class="o">&amp;</span><span class="n">h</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="k">delete</span> <span class="n">ps</span><span class="p">;</span>
      <span class="n">ps</span> <span class="o">=</span> <span class="n">h</span><span class="p">.</span><span class="n">ps</span><span class="p">;</span>
      <span class="n">i</span> <span class="o">=</span> <span class="n">h</span><span class="p">.</span><span class="n">i</span><span class="p">;</span>
      <span class="n">h</span><span class="p">.</span><span class="n">ps</span> <span class="o">=</span> <span class="k">nullptr</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="k">return</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="n">swap</span><span class="p">(</span><span class="n">string</span> <span class="o">*</span><span class="n">p1</span><span class="p">,</span> <span class="n">string</span> <span class="o">*</span><span class="n">p2</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">string</span> <span class="o">*</span><span class="n">temp</span> <span class="o">=</span> <span class="n">p1</span><span class="p">;</span>
  <span class="n">p1</span> <span class="o">=</span> <span class="n">p2</span><span class="p">;</span>
  <span class="n">p2</span> <span class="o">=</span> <span class="n">temp</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="n">swap</span><span class="p">(</span><span class="n">HasPtr</span> <span class="o">&amp;</span><span class="n">h1</span><span class="p">,</span> <span class="n">HasPtr</span> <span class="o">&amp;</span><span class="n">h2</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;swap(HasPtr &amp;h1, HasPtr &amp;h2)&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">swap</span><span class="p">(</span><span class="n">h1</span><span class="p">.</span><span class="n">ps</span><span class="p">,</span> <span class="n">h2</span><span class="p">.</span><span class="n">ps</span><span class="p">);</span>
  <span class="n">swap</span><span class="p">(</span><span class="n">h1</span><span class="p">.</span><span class="n">i</span><span class="p">,</span> <span class="n">h2</span><span class="p">.</span><span class="n">i</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">HasPtr</span><span class="o">&amp;</span> <span class="n">HasPtr</span><span class="o">::</span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">HasPtr</span><span class="o">&amp;</span> <span class="n">h</span><span class="p">)</span>
<span class="p">{</span>
  <span class="c1">// swap(*this, h);
</span><span class="c1"></span>  <span class="n">ps</span> <span class="o">=</span> <span class="k">new</span> <span class="n">string</span><span class="p">(</span><span class="o">*</span><span class="n">h</span><span class="p">.</span><span class="n">ps</span><span class="p">);</span>
  <span class="n">i</span> <span class="o">=</span> <span class="n">h</span><span class="p">.</span><span class="n">i</span><span class="p">;</span>
  <span class="k">return</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>
<h2 id="exercise-13-dot-31">Exercise 13.31</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="k">class</span><span class="err"> </span><span class="nc">HasPtr</span>
<span class="p">{</span>
  <span class="k">friend</span> <span class="kt">void</span> <span class="n">swap</span><span class="p">(</span><span class="n">HasPtr</span> <span class="o">&amp;</span><span class="p">,</span> <span class="n">HasPtr</span> <span class="o">&amp;</span><span class="p">);</span>
<span class="k">public</span><span class="o">:</span>
  <span class="n">HasPtr</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="n">s</span> <span class="o">=</span> <span class="n">string</span><span class="p">())</span><span class="o">:</span>
    <span class="n">ps</span><span class="p">(</span><span class="k">new</span> <span class="n">string</span><span class="p">(</span><span class="n">s</span><span class="p">)),</span> <span class="n">i</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">{}</span>
  <span class="n">HasPtr</span><span class="p">(</span><span class="k">const</span> <span class="n">HasPtr</span> <span class="o">&amp;</span><span class="n">h</span><span class="p">)</span><span class="o">:</span> <span class="n">ps</span><span class="p">(</span><span class="k">new</span> <span class="n">string</span><span class="p">(</span><span class="o">*</span><span class="n">h</span><span class="p">.</span><span class="n">ps</span><span class="p">)),</span> <span class="n">i</span><span class="p">(</span><span class="n">h</span><span class="p">.</span><span class="n">i</span><span class="p">)</span> <span class="p">{}</span>
  <span class="n">HasPtr</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="n">HasPtr</span><span class="p">);</span>
  <span class="kt">bool</span> <span class="k">operator</span><span class="o">&lt;</span><span class="p">(</span><span class="n">HasPtr</span> <span class="o">&amp;</span><span class="p">);</span>
  <span class="o">~</span><span class="n">HasPtr</span><span class="p">()</span> <span class="p">{</span><span class="k">delete</span> <span class="n">ps</span><span class="p">;};</span>
<span class="k">private</span><span class="o">:</span>
  <span class="n">string</span> <span class="o">*</span><span class="n">ps</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
<span class="p">};</span>
<span class="kt">bool</span> <span class="n">HasPtr</span><span class="o">::</span><span class="k">operator</span><span class="o">&lt;</span><span class="p">(</span><span class="n">HasPtr</span> <span class="o">&amp;</span><span class="n">h</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="o">*</span><span class="n">ps</span> <span class="o">&lt;</span> <span class="o">*</span><span class="p">(</span><span class="n">h</span><span class="p">.</span><span class="n">ps</span><span class="p">);</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="n">swap</span><span class="p">(</span><span class="n">string</span> <span class="o">*</span><span class="n">p1</span><span class="p">,</span> <span class="n">string</span> <span class="o">*</span><span class="n">p2</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">string</span> <span class="o">*</span><span class="n">temp</span> <span class="o">=</span> <span class="n">p1</span><span class="p">;</span>
  <span class="n">p1</span> <span class="o">=</span> <span class="n">p2</span><span class="p">;</span>
  <span class="n">p2</span> <span class="o">=</span> <span class="n">temp</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="n">swap</span><span class="p">(</span><span class="n">HasPtr</span> <span class="o">&amp;</span><span class="n">h1</span><span class="p">,</span> <span class="n">HasPtr</span> <span class="o">&amp;</span><span class="n">h2</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;swap(HasPtr &amp;h1, HasPtr &amp;h2)&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">swap</span><span class="p">(</span><span class="n">h1</span><span class="p">.</span><span class="n">ps</span><span class="p">,</span> <span class="n">h2</span><span class="p">.</span><span class="n">ps</span><span class="p">);</span>
  <span class="n">swap</span><span class="p">(</span><span class="n">h1</span><span class="p">.</span><span class="n">i</span><span class="p">,</span> <span class="n">h2</span><span class="p">.</span><span class="n">i</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">HasPtr</span><span class="o">&amp;</span> <span class="n">HasPtr</span><span class="o">::</span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="n">HasPtr</span> <span class="n">h</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">swap</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">,</span> <span class="n">h</span><span class="p">);</span>
  <span class="k">return</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">vector</span><span class="o">&lt;</span><span class="n">HasPtr</span><span class="o">&gt;</span> <span class="n">vh</span><span class="p">;</span>
  <span class="n">vh</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">HasPtr</span><span class="p">(</span><span class="s">&#34;hello&#34;</span><span class="p">));</span>
  <span class="n">vh</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">HasPtr</span><span class="p">(</span><span class="s">&#34;you&#34;</span><span class="p">));</span>
  <span class="n">vh</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">HasPtr</span><span class="p">(</span><span class="s">&#34;me&#34;</span><span class="p">));</span>
  <span class="n">sort</span><span class="p">(</span><span class="n">vh</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">vh</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>
<h2 id="exercise-13-dot-32">Exercise 13.32</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="c1">// Gets fewer benefits than the value-like class;
</span><span class="c1">// only saves the work of copy initialization of the HasPtr temp object, and the increase &amp; decrease of reference counts.
</span><span class="c1"></span></code></pre></td></tr></table>
</div>
</div>
<h2 id="exercise-13-dot-33">Exercise 13.33</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="c1">// Both functions aim to modify the exact Folder object passed in.
</span><span class="c1">// if the type of parameter of save and remove is &#39;Folder&#39;: that would use the argument to copy initialize the paremeter, both functions aim to modify the Folder object passed in, not the copy of it.
</span><span class="c1">// if it is &#39;const Folder &amp;&#39;, it is impossibile to modify a const Folder object, the expressions within function body are illegal.
</span><span class="c1"></span></code></pre></td></tr></table>
</div>
</div>
<h2 id="exercise-13-dot-34">Exercise 13.34</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="c1">// See Message.h.
</span><span class="c1"></span></code></pre></td></tr></table>
</div>
</div>
<h2 id="message-dot-h">Message.h</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="k">class</span><span class="err"> </span><span class="nc">Message</span><span class="p">;</span>
<span class="k">class</span><span class="err"> </span><span class="nc">Folder</span>
<span class="p">{</span>
  <span class="n">set</span><span class="o">&lt;</span><span class="n">Message</span><span class="o">*&gt;</span> <span class="n">messages</span><span class="p">;</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="n">Folder</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>
  <span class="n">Folder</span><span class="p">(</span><span class="k">const</span> <span class="n">Folder</span> <span class="o">&amp;</span><span class="p">);</span>
  <span class="o">~</span><span class="n">Folder</span><span class="p">();</span>
  <span class="kt">void</span> <span class="nf">addMsg</span><span class="p">(</span><span class="n">Message</span> <span class="o">*</span><span class="n">m</span><span class="p">)</span> <span class="p">{</span><span class="n">messages</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">m</span><span class="p">);}</span>
  <span class="kt">void</span> <span class="nf">remMsg</span><span class="p">(</span><span class="n">Message</span> <span class="o">*</span><span class="n">m</span><span class="p">)</span> <span class="p">{</span><span class="n">messages</span><span class="p">.</span><span class="n">erase</span><span class="p">(</span><span class="n">m</span><span class="p">);}</span>
<span class="p">};</span>
<span class="k">class</span><span class="err"> </span><span class="nc">Message</span>
<span class="p">{</span>
  <span class="k">friend</span> <span class="k">class</span><span class="err"> </span><span class="nc">Folder</span><span class="p">;</span>
  <span class="k">friend</span> <span class="kt">void</span> <span class="nf">swap</span><span class="p">(</span><span class="n">Message</span> <span class="o">&amp;</span><span class="p">,</span> <span class="n">Message</span> <span class="o">&amp;</span><span class="p">);</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="k">explicit</span> <span class="n">Message</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="n">str</span> <span class="o">=</span> <span class="s">&#34;&#34;</span><span class="p">)</span><span class="o">:</span> <span class="n">contents</span><span class="p">(</span><span class="n">str</span><span class="p">)</span> <span class="p">{}</span>
  <span class="n">Message</span><span class="p">(</span><span class="k">const</span> <span class="n">Message</span> <span class="o">&amp;</span><span class="p">);</span>
  <span class="n">Message</span><span class="p">(</span><span class="n">Message</span> <span class="o">&amp;&amp;</span><span class="p">)</span> <span class="k">noexcept</span><span class="p">;</span>
  <span class="n">Message</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">Message</span> <span class="o">&amp;</span><span class="p">);</span>
  <span class="n">Message</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="n">Message</span> <span class="o">&amp;&amp;</span><span class="p">)</span> <span class="k">noexcept</span><span class="p">;</span>
  <span class="o">~</span><span class="n">Message</span><span class="p">();</span>
  <span class="kt">void</span> <span class="nf">save</span><span class="p">(</span><span class="n">Folder</span> <span class="o">&amp;</span><span class="p">);</span>
  <span class="kt">void</span> <span class="nf">remove</span><span class="p">(</span><span class="n">Folder</span> <span class="o">&amp;</span><span class="p">);</span>
  <span class="kt">void</span> <span class="nf">addFod</span><span class="p">(</span><span class="n">Folder</span> <span class="o">*</span><span class="n">f</span><span class="p">)</span> <span class="p">{</span><span class="n">folders</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">f</span><span class="p">);}</span>
  <span class="kt">void</span> <span class="nf">remFod</span><span class="p">(</span><span class="n">Folder</span> <span class="o">*</span><span class="n">f</span><span class="p">)</span> <span class="p">{</span><span class="n">folders</span><span class="p">.</span><span class="n">erase</span><span class="p">(</span><span class="n">f</span><span class="p">);}</span>
 <span class="k">private</span><span class="o">:</span>
  <span class="n">string</span> <span class="n">contents</span><span class="p">;</span>
  <span class="n">set</span><span class="o">&lt;</span><span class="n">Folder</span><span class="o">*&gt;</span> <span class="n">folders</span><span class="p">;</span>
  <span class="kt">void</span> <span class="nf">add_to_Folders</span><span class="p">(</span><span class="k">const</span> <span class="n">Message</span> <span class="o">&amp;</span><span class="p">);</span>
  <span class="kt">void</span> <span class="nf">remove_from_Folders</span><span class="p">();</span>
  <span class="kt">void</span> <span class="nf">move_Folders</span><span class="p">(</span><span class="n">Message</span> <span class="o">*</span><span class="p">);</span>
<span class="p">};</span>
<span class="kt">void</span> <span class="n">Message</span><span class="o">::</span><span class="n">save</span><span class="p">(</span><span class="n">Folder</span> <span class="o">&amp;</span><span class="n">f</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">folders</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="o">&amp;</span><span class="n">f</span><span class="p">);</span>
  <span class="n">f</span><span class="p">.</span><span class="n">addMsg</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="n">Message</span><span class="o">::</span><span class="n">remove</span><span class="p">(</span><span class="n">Folder</span> <span class="o">&amp;</span><span class="n">f</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">folders</span><span class="p">.</span><span class="n">erase</span><span class="p">(</span><span class="o">&amp;</span><span class="n">f</span><span class="p">);</span>
  <span class="n">f</span><span class="p">.</span><span class="n">remMsg</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="n">Message</span><span class="o">::</span><span class="n">add_to_Folders</span><span class="p">(</span><span class="k">const</span> <span class="n">Message</span> <span class="o">&amp;</span><span class="n">m</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">for</span><span class="p">(</span><span class="k">auto</span> <span class="nl">f</span> <span class="p">:</span> <span class="n">m</span><span class="p">.</span><span class="n">folders</span><span class="p">)</span>
    <span class="n">f</span><span class="o">-&gt;</span><span class="n">addMsg</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">Message</span><span class="o">::</span><span class="n">Message</span><span class="p">(</span><span class="k">const</span> <span class="n">Message</span> <span class="o">&amp;</span><span class="n">m</span><span class="p">)</span><span class="o">:</span>
<span class="n">contents</span><span class="p">(</span><span class="n">m</span><span class="p">.</span><span class="n">contents</span><span class="p">),</span> <span class="n">folders</span><span class="p">(</span><span class="n">m</span><span class="p">.</span><span class="n">folders</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">add_to_Folders</span><span class="p">(</span><span class="n">m</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">Message</span><span class="o">::</span><span class="n">Message</span><span class="p">(</span><span class="n">Message</span> <span class="o">&amp;&amp;</span><span class="n">m</span><span class="p">)</span> <span class="k">noexcept</span><span class="o">:</span> <span class="n">contents</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">m</span><span class="p">.</span><span class="n">contents</span><span class="p">))</span>
<span class="p">{</span>
  <span class="n">move_Folders</span><span class="p">(</span><span class="o">&amp;</span><span class="n">m</span><span class="p">);</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="n">Message</span><span class="o">::</span><span class="n">remove_from_Folders</span><span class="p">()</span>
<span class="p">{</span>
  <span class="k">for</span><span class="p">(</span><span class="k">auto</span> <span class="nl">f</span> <span class="p">:</span> <span class="n">folders</span><span class="p">)</span>
    <span class="n">f</span><span class="o">-&gt;</span><span class="n">remMsg</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">Message</span><span class="o">::~</span><span class="n">Message</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">remove_from_Folders</span><span class="p">();</span>
<span class="p">}</span>
<span class="n">Message</span><span class="o">&amp;</span> <span class="n">Message</span><span class="o">::</span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">Message</span> <span class="o">&amp;</span><span class="n">rhs</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">remove_from_Folders</span><span class="p">();</span>
  <span class="n">contents</span> <span class="o">=</span> <span class="n">rhs</span><span class="p">.</span><span class="n">contents</span><span class="p">;</span>
  <span class="n">folders</span> <span class="o">=</span> <span class="n">rhs</span><span class="p">.</span><span class="n">folders</span><span class="p">;</span>
  <span class="n">add_to_Folders</span><span class="p">(</span><span class="n">rhs</span><span class="p">);</span>
  <span class="k">return</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span>
<span class="p">}</span>
  <span class="n">Message</span><span class="o">&amp;</span> <span class="n">Message</span><span class="o">::</span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="n">Message</span> <span class="o">&amp;&amp;</span><span class="n">m</span><span class="p">)</span> <span class="k">noexcept</span>
  <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="k">this</span> <span class="o">!=</span> <span class="o">&amp;</span><span class="n">m</span><span class="p">)</span>
      <span class="p">{</span>
      <span class="n">remove_from_Folders</span><span class="p">();</span>
      <span class="n">contents</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">m</span><span class="p">.</span><span class="n">contents</span><span class="p">);</span>
      <span class="n">move_Folders</span><span class="p">(</span><span class="o">&amp;</span><span class="n">m</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="k">return</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span>
  <span class="p">}</span>
    <span class="kt">void</span> <span class="n">swap</span><span class="p">(</span><span class="n">Message</span> <span class="o">&amp;</span><span class="n">lhs</span><span class="p">,</span> <span class="n">Message</span> <span class="o">&amp;</span><span class="n">rhs</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="k">for</span><span class="p">(</span><span class="k">auto</span> <span class="nl">f</span> <span class="p">:</span> <span class="n">lhs</span><span class="p">.</span><span class="n">folders</span><span class="p">)</span>
      <span class="n">f</span><span class="o">-&gt;</span><span class="n">remMsg</span><span class="p">(</span><span class="o">&amp;</span><span class="n">lhs</span><span class="p">);</span>
      <span class="k">for</span><span class="p">(</span><span class="k">auto</span> <span class="nl">f</span> <span class="p">:</span> <span class="n">rhs</span><span class="p">.</span><span class="n">folders</span><span class="p">)</span>
      <span class="n">f</span><span class="o">-&gt;</span><span class="n">remMsg</span><span class="p">(</span><span class="o">&amp;</span><span class="n">rhs</span><span class="p">);</span>
      <span class="n">swap</span><span class="p">(</span><span class="n">lhs</span><span class="p">.</span><span class="n">folders</span><span class="p">,</span> <span class="n">rhs</span><span class="p">.</span><span class="n">folders</span><span class="p">);</span>
      <span class="n">swap</span><span class="p">(</span><span class="n">lhs</span><span class="p">.</span><span class="n">contents</span><span class="p">,</span> <span class="n">rhs</span><span class="p">.</span><span class="n">contents</span><span class="p">);</span>
      <span class="k">for</span><span class="p">(</span><span class="k">auto</span> <span class="nl">f</span> <span class="p">:</span> <span class="n">lhs</span><span class="p">.</span><span class="n">folders</span><span class="p">)</span>
      <span class="n">f</span><span class="o">-&gt;</span><span class="n">addMsg</span><span class="p">(</span><span class="o">&amp;</span><span class="n">lhs</span><span class="p">);</span>
      <span class="k">for</span><span class="p">(</span><span class="k">auto</span> <span class="nl">f</span> <span class="p">:</span> <span class="n">rhs</span><span class="p">.</span><span class="n">folders</span><span class="p">)</span>
      <span class="n">f</span><span class="o">-&gt;</span><span class="n">addMsg</span><span class="p">(</span><span class="o">&amp;</span><span class="n">rhs</span><span class="p">);</span>
    <span class="p">}</span>
<span class="n">Folder</span><span class="o">::~</span><span class="n">Folder</span><span class="p">()</span>
<span class="p">{</span>
  <span class="k">for</span><span class="p">(</span><span class="k">auto</span> <span class="o">&amp;</span><span class="nl">m</span> <span class="p">:</span> <span class="n">messages</span><span class="p">)</span>
    <span class="n">m</span><span class="o">-&gt;</span><span class="n">remove</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">Folder</span><span class="o">::</span><span class="n">Folder</span><span class="p">(</span><span class="k">const</span> <span class="n">Folder</span> <span class="o">&amp;</span><span class="n">f</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">messages</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
  <span class="k">for</span><span class="p">(</span><span class="k">auto</span> <span class="o">&amp;</span><span class="nl">m</span> <span class="p">:</span> <span class="n">messages</span><span class="p">)</span>
    <span class="n">m</span><span class="o">-&gt;</span><span class="n">remove</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">);</span>
  <span class="k">for</span><span class="p">(</span><span class="k">auto</span> <span class="o">&amp;</span><span class="nl">m</span> <span class="p">:</span> <span class="n">f</span><span class="p">.</span><span class="n">messages</span><span class="p">)</span>
    <span class="n">m</span><span class="o">-&gt;</span><span class="n">save</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">);</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="n">Message</span><span class="o">::</span><span class="n">move_Folders</span><span class="p">(</span><span class="n">Message</span> <span class="o">*</span><span class="n">m</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">folders</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">m</span><span class="o">-&gt;</span><span class="n">folders</span><span class="p">);</span>
  <span class="k">for</span><span class="p">(</span><span class="k">auto</span> <span class="nl">f</span> <span class="p">:</span> <span class="n">folders</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="n">f</span><span class="o">-&gt;</span><span class="n">remMsg</span><span class="p">(</span><span class="n">m</span><span class="p">);</span>
      <span class="n">f</span><span class="o">-&gt;</span><span class="n">addMsg</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="n">m</span><span class="o">-&gt;</span><span class="n">folders</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>
<h2 id="exercise-13-dot-35">Exercise 13.35</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="c1">// is using synthesized version of copy control members:
</span><span class="c1">// for copy constructor: no folder contains the pointer which points to this newly constructed Message object;
</span><span class="c1">// for destructor: even destructed, folders still contains the pointer which points to the invalid memory space which once stored this destructed object.
</span><span class="c1">// for copy assignment constructor: this case is a combination of copy constructor and destructor illustrated above, the folders-message relationship stays the same but it should have been updated.
</span><span class="c1"></span></code></pre></td></tr></table>
</div>
</div>
<h2 id="exercise-13-dot-36">Exercise 13.36</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="c1">// See Message.h.
</span><span class="c1"></span></code></pre></td></tr></table>
</div>
</div>
<p><a href="#message-dot-h">Message.h</a></p>

<h2 id="exercise-13-dot-37">Exercise 13.37</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="c1">// see Message.h.
</span><span class="c1"></span></code></pre></td></tr></table>
</div>
</div>
<p><a href="#message-dot-h">Message.h</a></p>

<h2 id="exercise-13-dot-38">Exercise 13.38</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="c1">// void swap(message &amp;lhs, Message &amp;rhs)
</span><span class="c1">// its implementation really swaps the contents of the two passed in arguments,
</span><span class="c1">// and Message &amp;Message::operator=(const Message &amp;rhs) has a const reference type parameter, if this copy assignment operator calls swap(message &amp;lhs,, Messag &amp;rhs),
</span><span class="c1">// the operations within swap is illegal;
</span><span class="c1">// even though there is a way of copy initializing a non-const temp object from rhs, and pass it to swap as second argument, which would make it reasonable;
</span><span class="c1">// but there is a lot of unnecessary work defined in swap for copy assignment operator; for example, destruction and rebuild of the message-folders relationship of the second parameter is a waste of time and space.
</span><span class="c1"></span></code></pre></td></tr></table>
</div>
</div>
<h2 id="exercise-13-dot-39">Exercise 13.39</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="c1">// see StrVec.h.
</span><span class="c1"></span></code></pre></td></tr></table>
</div>
</div>
<h2 id="strvec-dot-h">StrVec.h</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="cp">#ifndef STRVEC_H
</span><span class="cp">#define STRVEC_H
</span><span class="cp"></span><span class="k">class</span><span class="err"> </span><span class="nc">StrVec</span>
<span class="p">{</span>
  <span class="k">friend</span> <span class="kt">bool</span> <span class="k">operator</span><span class="o">==</span><span class="p">(</span><span class="k">const</span> <span class="n">StrVec</span> <span class="o">&amp;</span><span class="p">,</span> <span class="k">const</span> <span class="n">StrVec</span> <span class="o">&amp;</span><span class="p">);</span>
  <span class="k">friend</span> <span class="kt">bool</span> <span class="k">operator</span><span class="o">!=</span><span class="p">(</span><span class="k">const</span> <span class="n">StrVec</span> <span class="o">&amp;</span><span class="p">,</span> <span class="k">const</span> <span class="n">StrVec</span> <span class="o">&amp;</span><span class="p">);</span>
  <span class="k">friend</span> <span class="kt">bool</span> <span class="k">operator</span><span class="o">&lt;</span><span class="p">(</span><span class="k">const</span> <span class="n">StrVec</span> <span class="o">&amp;</span><span class="p">,</span> <span class="k">const</span> <span class="n">StrVec</span> <span class="o">&amp;</span><span class="p">);</span>
 <span class="k">public</span><span class="o">:</span>
 <span class="n">StrVec</span><span class="p">()</span><span class="o">:</span> <span class="n">elements</span><span class="p">(</span><span class="k">nullptr</span><span class="p">),</span> <span class="n">first_free</span><span class="p">(</span><span class="k">nullptr</span><span class="p">),</span> <span class="n">cap</span><span class="p">(</span><span class="k">nullptr</span><span class="p">)</span> <span class="p">{}</span>
  <span class="n">StrVec</span><span class="p">(</span><span class="k">const</span> <span class="n">StrVec</span> <span class="o">&amp;</span><span class="p">);</span>
  <span class="n">StrVec</span><span class="p">(</span><span class="n">StrVec</span> <span class="o">&amp;&amp;</span><span class="p">)</span> <span class="k">noexcept</span><span class="p">;</span>
  <span class="n">StrVec</span><span class="p">(</span><span class="k">const</span> <span class="n">initializer_list</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">is</span><span class="p">);</span>
  <span class="n">StrVec</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">StrVec</span> <span class="o">&amp;</span><span class="p">);</span>
  <span class="n">StrVec</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="n">StrVec</span> <span class="o">&amp;&amp;</span><span class="p">)</span> <span class="k">noexcept</span><span class="p">;</span>
  <span class="n">StrVec</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">initializer_list</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="p">);</span>
  <span class="n">string</span> <span class="o">&amp;</span><span class="k">operator</span><span class="p">[](</span><span class="n">size_t</span> <span class="n">n</span><span class="p">);</span>
  <span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="k">operator</span><span class="p">[](</span><span class="n">size_t</span> <span class="n">n</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
  <span class="o">~</span><span class="n">StrVec</span><span class="p">();</span>
  <span class="kt">void</span> <span class="nf">push_back</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="p">);</span>
  <span class="n">size_t</span> <span class="nf">size</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span><span class="k">return</span> <span class="n">first_free</span> <span class="o">-</span> <span class="n">elements</span><span class="p">;}</span>
  <span class="n">size_t</span> <span class="nf">capacity</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span><span class="k">return</span> <span class="n">cap</span> <span class="o">-</span> <span class="n">elements</span><span class="p">;}</span>
  <span class="kt">void</span> <span class="nf">reserve</span><span class="p">(</span><span class="n">size_t</span><span class="p">);</span>
  <span class="kt">void</span> <span class="nf">resize</span><span class="p">(</span><span class="n">size_t</span> <span class="n">n</span><span class="p">,</span> <span class="n">string</span> <span class="n">s</span> <span class="o">=</span> <span class="s">&#34;&#34;</span><span class="p">);</span>
  <span class="n">string</span> <span class="o">*</span><span class="nf">begin</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span><span class="k">return</span> <span class="n">elements</span><span class="p">;}</span>
  <span class="n">string</span> <span class="o">*</span><span class="nf">end</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span><span class="k">return</span> <span class="n">first_free</span><span class="p">;}</span>
 <span class="k">private</span><span class="o">:</span>
  <span class="n">allocator</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">alloc</span><span class="p">;</span> <span class="cm">/* it using static, &#39;undefined reference&#39; reported when compile */</span>
  <span class="kt">void</span> <span class="nf">chk_n_alloc</span><span class="p">()</span>
  <span class="p">{</span><span class="k">if</span><span class="p">(</span><span class="n">size</span><span class="p">()</span> <span class="o">==</span> <span class="n">capacity</span><span class="p">())</span> <span class="n">reallocate</span><span class="p">();}</span>
  <span class="n">pair</span><span class="o">&lt;</span><span class="n">string</span> <span class="o">*</span><span class="p">,</span> <span class="n">string</span> <span class="o">*&gt;</span> <span class="n">alloc_n_copy</span>
    <span class="p">(</span><span class="k">const</span> <span class="n">string</span> <span class="o">*</span><span class="p">,</span> <span class="k">const</span> <span class="n">string</span> <span class="o">*</span><span class="p">);</span>
  <span class="kt">void</span> <span class="nf">free</span><span class="p">();</span>
  <span class="kt">void</span> <span class="nf">reallocate</span><span class="p">(</span><span class="n">size_t</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span><span class="p">);</span>
  <span class="n">string</span> <span class="o">*</span><span class="n">elements</span><span class="p">;</span>
  <span class="n">string</span> <span class="o">*</span><span class="n">first_free</span><span class="p">;</span>
  <span class="n">string</span> <span class="o">*</span><span class="n">cap</span><span class="p">;</span>
<span class="p">};</span>
<span class="cp">#endif
</span><span class="cp"></span></code></pre></td></tr></table>
</div>
</div>
<h2 id="exercise-13-dot-40">Exercise 13.40</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="c1">// See StrVec.h
</span><span class="c1"></span></code></pre></td></tr></table>
</div>
</div>
<p><a href="#strvec-dot-h">StrVec.h</a></p>

<h2 id="exercise-13-dot-41">Exercise 13.41</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="c1">// &#39;first_free++&#39; keeps the original value of i as temp, increase first_free itself, and return the temp;
</span><span class="c1">// if use &#39;++first_free&#39;, increase first_free, and return it; that is not right, if use that version, it would not construct the specified string object at right place but the place next to it, which means, this operation would skip the right place.
</span><span class="c1"></span></code></pre></td></tr></table>
</div>
</div>
<h2 id="exercise-13-dot-42">Exercise 13.42</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="c1">// See TextQuery.h.
</span><span class="c1"></span><span class="kt">void</span> <span class="nf">runQueries</span><span class="p">(</span><span class="n">ifstream</span> <span class="o">&amp;</span><span class="n">infile</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">TextQuery</span> <span class="n">tq</span><span class="p">(</span><span class="n">infile</span><span class="p">);</span>
  <span class="k">while</span><span class="p">(</span><span class="nb">true</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Enter word to look for, or q to quit: &#34;</span><span class="p">;</span>
      <span class="n">string</span> <span class="n">s</span><span class="p">;</span>
      <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">s</span><span class="p">)</span> <span class="o">||</span> <span class="n">s</span> <span class="o">==</span> <span class="s">&#34;q&#34;</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
      <span class="n">print</span><span class="p">(</span><span class="n">cout</span><span class="p">,</span> <span class="n">tq</span><span class="p">.</span><span class="n">query</span><span class="p">(</span><span class="n">s</span><span class="p">))</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span>
<span class="p">{</span>
  <span class="n">ifstream</span> <span class="n">ifs</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
  <span class="n">runQueries</span><span class="p">(</span><span class="n">ifs</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>
<p><a href="#textquery-dot-h">TextQuery.h</a></p>

<h2 id="exercise-13-dot-43">Exercise 13.43</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="c1">// see StrVec.h.
</span><span class="c1">// the original one is better, use for loop, it could destroy elememts in a reverse order as required, that form is more flexible.
</span><span class="c1">// thr for_each one could not destroy elements in a reverse order, for the string poniter could not behave like a reverse iterator, the form of this for_each syntax has its advantages of simple and easy to use, but has more restrictions than for type syntax.
</span><span class="c1"></span></code></pre></td></tr></table>
</div>
</div>
<p><a href="#strvec-dot-h">StrVec.h</a></p>

<h2 id="exercise-13-dot-44">Exercise 13.44</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="c1">// See String.h.
</span><span class="c1"></span><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">String</span> <span class="n">s1</span><span class="p">;</span>
  <span class="n">String</span> <span class="n">s2</span><span class="p">(</span><span class="s">&#34;Sing for me!&#34;</span><span class="p">);</span>
  <span class="n">s1</span><span class="p">.</span><span class="n">print</span><span class="p">();</span>
  <span class="n">s2</span><span class="p">.</span><span class="n">print</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>
<h2 id="string-dot-h">String.h</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="cp">#ifndef STRING_H_EX
</span><span class="cp">#define STRING_H_EX
</span><span class="cp"></span><span class="k">class</span><span class="err"> </span><span class="nc">String</span>
<span class="p">{</span>
  <span class="k">friend</span> <span class="kt">bool</span> <span class="k">operator</span><span class="o">==</span><span class="p">(</span><span class="k">const</span> <span class="n">String</span> <span class="o">&amp;</span><span class="p">,</span> <span class="k">const</span> <span class="n">String</span> <span class="o">&amp;</span><span class="p">);</span>
  <span class="k">friend</span> <span class="kt">bool</span> <span class="k">operator</span><span class="o">!=</span><span class="p">(</span><span class="k">const</span> <span class="n">String</span> <span class="o">&amp;</span><span class="p">,</span> <span class="k">const</span> <span class="n">String</span> <span class="o">&amp;</span><span class="p">);</span>
  <span class="k">friend</span> <span class="kt">bool</span> <span class="k">operator</span><span class="o">&lt;</span><span class="p">(</span><span class="k">const</span> <span class="n">String</span> <span class="o">&amp;</span><span class="p">,</span> <span class="k">const</span> <span class="n">String</span> <span class="o">&amp;</span><span class="p">);</span>
 <span class="k">public</span><span class="o">:</span>
 <span class="n">String</span><span class="p">()</span><span class="o">:</span> <span class="n">elements</span><span class="p">(</span><span class="k">nullptr</span><span class="p">),</span> <span class="n">first_free</span><span class="p">(</span><span class="k">nullptr</span><span class="p">),</span> <span class="n">cap</span><span class="p">(</span><span class="k">nullptr</span><span class="p">)</span> <span class="p">{}</span>
  <span class="n">String</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="p">);</span>
  <span class="n">String</span><span class="p">(</span><span class="k">const</span> <span class="n">String</span> <span class="o">&amp;</span><span class="p">);</span>
  <span class="n">String</span><span class="p">(</span><span class="n">String</span> <span class="o">&amp;&amp;</span><span class="p">)</span> <span class="k">noexcept</span><span class="p">;</span>
  <span class="n">String</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">String</span> <span class="o">&amp;</span><span class="p">);</span>
  <span class="n">String</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="n">String</span> <span class="o">&amp;&amp;</span><span class="p">)</span> <span class="k">noexcept</span><span class="p">;</span>
  <span class="kt">char</span> <span class="o">&amp;</span><span class="k">operator</span><span class="p">[](</span><span class="n">size_t</span> <span class="n">n</span><span class="p">);</span>
  <span class="k">const</span> <span class="kt">char</span> <span class="o">&amp;</span><span class="k">operator</span><span class="p">[](</span><span class="n">size_t</span> <span class="n">n</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
  <span class="o">~</span><span class="n">String</span><span class="p">();</span>
  <span class="kt">void</span> <span class="nf">push_back</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">&amp;</span><span class="p">);</span>
  <span class="n">size_t</span> <span class="nf">size</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span><span class="k">return</span> <span class="n">first_free</span> <span class="o">-</span> <span class="n">elements</span><span class="p">;}</span>
  <span class="n">size_t</span> <span class="nf">capacity</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span><span class="k">return</span> <span class="n">cap</span> <span class="o">-</span> <span class="n">elements</span><span class="p">;}</span>
  <span class="kt">char</span> <span class="o">*</span><span class="nf">begin</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span><span class="k">return</span> <span class="n">elements</span><span class="p">;}</span>
  <span class="kt">char</span> <span class="o">*</span><span class="nf">end</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span><span class="k">return</span> <span class="n">first_free</span><span class="p">;}</span>
  <span class="n">ostream</span> <span class="o">&amp;</span><span class="n">print</span><span class="p">();</span>
 <span class="k">private</span><span class="o">:</span>
  <span class="n">allocator</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span> <span class="n">alloc</span><span class="p">;</span> <span class="cm">/* it using static, &#39;undefined reference&#39; reported when compile */</span>
  <span class="kt">void</span> <span class="nf">chk_n_alloc</span><span class="p">()</span>
  <span class="p">{</span><span class="k">if</span><span class="p">(</span><span class="n">size</span><span class="p">()</span> <span class="o">==</span> <span class="n">capacity</span><span class="p">())</span> <span class="n">reallocate</span><span class="p">();}</span>
  <span class="n">pair</span><span class="o">&lt;</span><span class="kt">char</span> <span class="o">*</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*&gt;</span> <span class="n">alloc_n_copy</span>
    <span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="p">);</span>
  <span class="kt">void</span> <span class="nf">free</span><span class="p">();</span>
  <span class="kt">void</span> <span class="nf">reallocate</span><span class="p">(</span><span class="n">size_t</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span><span class="p">);</span>
  <span class="kt">char</span> <span class="o">*</span><span class="n">elements</span><span class="p">;</span>
  <span class="kt">char</span> <span class="o">*</span><span class="n">first_free</span><span class="p">;</span>
  <span class="kt">char</span> <span class="o">*</span><span class="n">cap</span><span class="p">;</span>
<span class="p">};</span>
<span class="cp">#endif
</span><span class="cp"></span></code></pre></td></tr></table>
</div>
</div>
<h2 id="exercise-13-dot-45">Exercise 13.45</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="c1">// Difference between lvalue reference and rvalue reference:
</span><span class="c1">// lvalue reference: could not bind to expressions which require convertion, literal constants or erpressions which return rvalue; could bind to expressions which returns lvalue.
</span><span class="c1">// rvalue reference; just the opposite to the lvalue reference.
</span><span class="c1"></span></code></pre></td></tr></table>
</div>
</div>
<h2 id="exercise-13-dot-46">Exercise 13.46</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="c1">// int f();
</span><span class="c1">// vector&lt;int&gt; vi(100);
</span><span class="c1">// int &amp;&amp;r1 = f();
</span><span class="c1">// int &amp;r2 = vi[0];
</span><span class="c1">// int &amp;r3 = r1;
</span><span class="c1">// int &amp;&amp;r4 = vi[0] * f();
</span><span class="c1"></span></code></pre></td></tr></table>
</div>
</div>
<h2 id="exercise-13-dot-47">Exercise 13.47</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="c1">// see String.h.
</span><span class="c1"></span></code></pre></td></tr></table>
</div>
</div>
<p><a href="#string-dot-h">String.h</a></p>

<h2 id="exercise-13-dot-48">Exercise 13.48</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">vs</span><span class="p">;</span>
  <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Initialize vector&lt;String&gt; object&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
  <span class="n">String</span> <span class="n">s</span><span class="p">(</span><span class="s">&#34;hello&#34;</span><span class="p">);</span>
  <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Initialize String object&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
  <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Push first&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
  <span class="n">vs</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">s</span><span class="p">);</span>
  <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Push second&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
  <span class="n">vs</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">s</span><span class="p">);</span>
  <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Push third&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
  <span class="c1">// vs.push_back(String(&#34;word&#34;));
</span><span class="c1"></span>  <span class="n">vs</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">s</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">// echo &#34;String::String(const String &amp;s) six times
</span><span class="c1">// for there is a memory reallocation processing during push_back.
</span><span class="c1"></span></code></pre></td></tr></table>
</div>
</div>
<h2 id="exercise-13-dot-49">Exercise 13.49</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="c1">// See StrVec.h, String.h, Message.h.
</span><span class="c1"></span></code></pre></td></tr></table>
</div>
</div>
<p><a href="#message-dot-h">Message.h</a></p>

<p><a href="#strvec-dot-h">StrVec.h</a></p>

<p><a href="#string-dot-h">String.h</a></p>

<h2 id="exercise-13-dot-50">Exercise 13.50</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="c1">// When the vector&lt;String&gt; object does not have enough space and then processes memory reallocation, it would use move constructor instead of copy constructor of String type during the reallocation of original elements.
</span><span class="c1"></span></code></pre></td></tr></table>
</div>
</div>
<h2 id="exercise-13-dot-51">Exercise 13.51</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="c1">// unique_ptr supports move constructor and move-assignment operator;
</span><span class="c1">// the source objects are to be destroyed.
</span><span class="c1"></span></code></pre></td></tr></table>
</div>
</div>
<h2 id="exercise-13-dot-52">Exercise 13.52</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="c1">// HasPtr hp = hp2;
</span><span class="c1">// hp2 is lvaule, using copy constructor to initialize hp, hp2 stays unchanged, hp is the copy of hp2;
</span><span class="c1">// HasPtr hp = std::move(hp2);
</span><span class="c1">// std::move(hp2) returns a rvalue reference binded to lvalue hp2;
</span><span class="c1">// so using move constructor to initialize hp, hp gets the control of the resouces owned by hp2;
</span><span class="c1">// while hp2 is valid, in a destruction-safe state, but there is no gurantee of the hp2&#39;s contents.
</span><span class="c1">// as illustreted in text, both expressions use constructors, not assignment operators, so parameter rhs is not involved in this context.
</span><span class="c1"></span></code></pre></td></tr></table>
</div>
</div>
<h2 id="exercise-13-dot-53">Exercise 13.53</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="c1">// See HasPtr.h.
</span><span class="c1">// The efficiency of copy-assgnment operator of HasPtr class type is not good enough, for that there is a copy constructor called when argument passed in, and the exchanging of value within function body may be unnecessary.
</span><span class="c1">// The new move-assignment operator takes control of the resources owned by another source object, and makes sure that object in a valid and destruction-safe state.
</span><span class="c1">// The copy-swap operator implements assignment by value exchanging, finally the data member ps points to a new allocated string, which is a copy of string object pointed by right operand&#39;s data member ps, the right operand stays unchanged.
</span><span class="c1"></span></code></pre></td></tr></table>
</div>
</div>
<p><a href="#hasptr-dot-h">HasPtr.h</a></p>

<h2 id="exercise-13-dot-54">Exercise 13.54</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">HasPtr</span> <span class="n">h</span><span class="p">(</span><span class="s">&#34;helloworld&#34;</span><span class="p">);</span>
  <span class="n">HasPtr</span> <span class="n">h2</span> <span class="o">=</span> <span class="n">h</span><span class="p">;</span>
  <span class="n">HasPtr</span> <span class="n">h3</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">h2</span><span class="p">);</span>
  <span class="n">h2</span> <span class="o">=</span> <span class="n">h</span><span class="p">;</span>
  <span class="n">h2</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">h3</span><span class="p">);</span>
  <span class="c1">// if the original copy-assignment operator stay unchanged
</span><span class="c1"></span>  <span class="c1">// compiler warns:
</span><span class="c1"></span>  <span class="c1">// ambiguous overload for &#39;operator=&#39; (operand types are &#39;HasPtr&#39;
</span><span class="c1"></span>  <span class="c1">// and &#39;std::remove_reference&lt;HasPtr&amp;&gt;::type {aka HasPtr}&#39;)
</span><span class="c1"></span><span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>
<h2 id="exercise-13-dot-55">Exercise 13.55</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="c1">// See StrBlob.h.
</span><span class="c1"></span></code></pre></td></tr></table>
</div>
</div>
<p><a href="#strblob-dot-h">StrBlob.h</a></p>

<h2 id="exercise-13-dot-56">Exercise 13.56</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="c1">///////////////////////////////
</span><span class="c1">// Foo Foo::sorted() const &amp; //
</span><span class="c1">// {			     //
</span><span class="c1">//   Foo ret(*this);	     //
</span><span class="c1">//   return ret.sorted();    //
</span><span class="c1">// }			     //
</span><span class="c1">///////////////////////////////
</span><span class="c1">// The return statement causes infinite recursively calling, exceeds the max stack depth.
</span><span class="c1"></span></code></pre></td></tr></table>
</div>
</div>
<h2 id="exercise-13-dot-57">Exercise 13.57</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="c1">// Passed, got the desired result.
</span><span class="c1"></span></code></pre></td></tr></table>
</div>
</div>
<h2 id="exercise-13-dot-58">Exercise 13.58</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-c++" data-lang="c++"><span class="k">class</span><span class="err"> </span><span class="nc">Foo</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
  <span class="n">Foo</span> <span class="n">sorted</span><span class="p">()</span> <span class="o">&amp;&amp;</span><span class="p">;</span>
  <span class="n">Foo</span> <span class="nf">sorted</span><span class="p">()</span> <span class="k">const</span> <span class="o">&amp;</span><span class="p">;</span>
<span class="k">private</span><span class="o">:</span>
  <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">data</span><span class="p">;</span>
<span class="p">};</span>
<span class="c1">// Foo Foo::sorted() const &amp;
</span><span class="c1">// {
</span><span class="c1">//   cout &lt;&lt; &#34;Foo Foo::sorted() const &amp;&#34; &lt;&lt; endl;
</span><span class="c1">//   Foo ret(*this);
</span><span class="c1">//   return ret.sorted();		// segment fault
</span><span class="c1">// }
</span><span class="c1"></span><span class="n">Foo</span> <span class="n">Foo</span><span class="o">::</span><span class="n">sorted</span><span class="p">()</span> <span class="k">const</span> <span class="o">&amp;</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="n">Foo</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">).</span><span class="n">sorted</span><span class="p">();</span>	<span class="c1">// passed
</span><span class="c1"></span><span class="p">}</span>
<span class="n">Foo</span> <span class="n">Foo</span><span class="o">::</span><span class="n">sorted</span><span class="p">()</span> <span class="o">&amp;&amp;</span>
<span class="p">{</span>
  <span class="n">sort</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">data</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>
  <span class="k">return</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">Foo</span> <span class="n">f</span><span class="p">;</span>
  <span class="n">f</span><span class="p">.</span><span class="n">sorted</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div>
    </div>

    
    
<div class="post-copyright">
  <p class="copyright-item">
    <span class="item-title">文章作者</span>
    <span class="item-content">zero4drift</span>
  </p>
  <p class="copyright-item">
    <span class="item-title">上次更新</span>
    <span class="item-content">2019-01-14</span>
  </p>
  
  <p class="copyright-item">
    <span class="item-title">许可协议</span>
    <span class="item-content"><a rel="license noopener" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank">CC BY-NC-ND 4.0</a></span>
  </p>
</div>


    
    

    <footer class="post-footer">
      <div class="post-tags">
          <a href="https://zero4drift.github.io/tags/c&#43;&#43;/">C&#43;&#43;</a>
          <a href="https://zero4drift.github.io/tags/cpp-primer/">cpp-primer</a>
          
        </div>

      
      <nav class="post-nav">
        
          <a class="prev" href="/post/cpp-primer-5th-exercises-chapter-14/">
            
            <i class="iconfont">
              <svg  class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M691.908486 949.511495l75.369571-89.491197c10.963703-12.998035 10.285251-32.864502-1.499144-44.378743L479.499795 515.267417 757.434875 204.940602c11.338233-12.190647 11.035334-32.285311-0.638543-44.850487l-80.46666-86.564541c-11.680017-12.583596-30.356378-12.893658-41.662889-0.716314L257.233596 494.235404c-11.332093 12.183484-11.041474 32.266891 0.657986 44.844348l80.46666 86.564541c1.772366 1.910513 3.706415 3.533476 5.750981 4.877077l306.620399 321.703933C662.505829 963.726242 680.945807 962.528973 691.908486 949.511495z"></path>
</svg>

            </i>
            <span class="prev-text nav-default">Cpp-Primer-5th-Exercises-Chapter-14</span>
            <span class="prev-text nav-mobile">上一篇</span>
          </a>
        
          <a class="next" href="/post/cpp-primer-5th-exercises-chapter-12/">
            <span class="next-text nav-default">Cpp-Primer-5th-Exercises-Chapter-12</span>
            <span class="prev-text nav-mobile">下一篇</span>
            
            <i class="iconfont">
              <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M332.091514 74.487481l-75.369571 89.491197c-10.963703 12.998035-10.285251 32.864502 1.499144 44.378743l286.278095 300.375162L266.565125 819.058374c-11.338233 12.190647-11.035334 32.285311 0.638543 44.850487l80.46666 86.564541c11.680017 12.583596 30.356378 12.893658 41.662889 0.716314l377.434212-421.426145c11.332093-12.183484 11.041474-32.266891-0.657986-44.844348l-80.46666-86.564541c-1.772366-1.910513-3.706415-3.533476-5.750981-4.877077L373.270379 71.774697C361.493148 60.273758 343.054193 61.470003 332.091514 74.487481z"></path>
</svg>

            </i>
          </a>
      </nav>
    </footer>
  </article>

  
  

  
  

  
  
    <div class="post bg-white">
      <script src="https://utteranc.es/client.js"
            repo= "zero4drift/comments-for-my-blog"
            issue-term="pathname"
            crossorigin="anonymous"
            async>
      </script>
    </div>
  

  

  

  
  
    



        </div>
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="social-links">
  
  
    <a href="fang0052@e.ntu.edu.sg" rel="me noopener" class="iconfont"
      title="email"  target="_blank"
      >
      <svg class="icon" viewBox="0 0 1451 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M664.781909 681.472759 0 97.881301C0 3.997201 71.046997 0 71.046997 0L474.477909 0 961.649408 0 1361.641813 0C1361.641813 0 1432.688811 3.997201 1432.688811 97.881301L771.345323 681.472759C771.345323 681.472759 764.482731 685.154773 753.594283 688.65053L753.594283 688.664858C741.602731 693.493018 729.424896 695.068979 718.077952 694.839748 706.731093 695.068979 694.553173 693.493018 682.561621 688.664858L682.561621 688.65053C671.644501 685.140446 664.781909 681.472759 664.781909 681.472759L664.781909 681.472759ZM718.063616 811.603883C693.779541 811.016482 658.879232 802.205449 619.10784 767.734955 542.989056 701.759633 0 212.052267 0 212.052267L0 942.809523C0 942.809523 0 1024 83.726336 1024L682.532949 1024 753.579947 1024 1348.948139 1024C1432.688811 1024 1432.688811 942.809523 1432.688811 942.809523L1432.688811 212.052267C1432.688811 212.052267 893.138176 701.759633 817.019477 767.734955 777.248 802.205449 742.347691 811.03081 718.063616 811.603883L718.063616 811.603883Z"></path>
</svg>

    </a>
  
    <a href="https://github.com/zero4drift" rel="me noopener" class="iconfont"
      title="github"  target="_blank"
      >
      <svg class="icon" style="" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M512 12.672c-282.88 0-512 229.248-512 512 0 226.261333 146.688 418.133333 350.08 485.76 25.6 4.821333 34.986667-11.008 34.986667-24.618667 0-12.16-0.426667-44.373333-0.64-87.04-142.421333 30.890667-172.458667-68.693333-172.458667-68.693333C188.672 770.986667 155.008 755.2 155.008 755.2c-46.378667-31.744 3.584-31.104 3.584-31.104 51.413333 3.584 78.421333 52.736 78.421333 52.736 45.653333 78.293333 119.850667 55.68 149.12 42.581333 4.608-33.109333 17.792-55.68 32.426667-68.48-113.706667-12.8-233.216-56.832-233.216-253.013333 0-55.893333 19.84-101.546667 52.693333-137.386667-5.76-12.928-23.04-64.981333 4.48-135.509333 0 0 42.88-13.738667 140.8 52.48 40.96-11.392 84.48-17.024 128-17.28 43.52 0.256 87.04 5.888 128 17.28 97.28-66.218667 140.16-52.48 140.16-52.48 27.52 70.528 10.24 122.581333 5.12 135.509333 32.64 35.84 52.48 81.493333 52.48 137.386667 0 196.693333-119.68 240-233.6 252.586667 17.92 15.36 34.56 46.762667 34.56 94.72 0 68.522667-0.64 123.562667-0.64 140.202666 0 13.44 8.96 29.44 35.2 24.32C877.44 942.592 1024 750.592 1024 524.672c0-282.752-229.248-512-512-512"></path>
</svg>

    </a>


<a href="https://zero4drift.github.io/index.xml" rel="noopener alternate" type="application/rss&#43;xml"
    class="iconfont" title="rss" target="_blank">
    <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="30" height="30">
  <path d="M819.157333 1024C819.157333 574.592 449.408 204.8 0 204.8V0c561.706667 0 1024 462.293333 1024 1024h-204.842667zM140.416 743.04a140.8 140.8 0 0 1 140.501333 140.586667A140.928 140.928 0 0 1 140.074667 1024C62.72 1024 0 961.109333 0 883.626667s62.933333-140.544 140.416-140.586667zM678.784 1024h-199.04c0-263.210667-216.533333-479.786667-479.744-479.786667V345.173333c372.352 0 678.784 306.517333 678.784 678.826667z"></path>
</svg>

  </a>
  
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - <a class="theme-link" href="https://github.com/xianmin/hugo-theme-jane">Jane</a>
  </span>

  <span class="copyright-year">
    &copy;
    
      2018 -
    2019
    <span class="heart">
      
      <i class="iconfont">
        <svg class="icon" viewBox="0 0 1025 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="14" height="14">
  <path d="M1000.1 247.9c-15.5-37.3-37.6-70.6-65.7-98.9-54.4-54.8-125.8-85-201-85-85.7 0-166 39-221.4 107.4C456.6 103 376.3 64 290.6 64c-75.1 0-146.5 30.4-201.1 85.6-28.2 28.5-50.4 61.9-65.8 99.3-16 38.8-24 79.9-23.6 122.2 0.7 91.7 40.1 177.2 108.1 234.8 3.1 2.6 6 5.1 8.9 7.8 14.9 13.4 58 52.8 112.6 102.7 93.5 85.5 209.9 191.9 257.5 234.2 7 6.1 15.8 9.5 24.9 9.5 9.2 0 18.1-3.4 24.9-9.5 34.5-30.7 105.8-95.9 181.4-165 74.2-67.8 150.9-138 195.8-178.2 69.5-57.9 109.6-144.4 109.9-237.3 0.1-42.5-8-83.6-24-122.2z"
   fill="#8a8a8a"></path>
</svg>

      </i>
    </span><span class="author">
        zero4drift
        
      </span></span>

  
  

  
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont">
        
        <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="35" height="35">
  <path d="M510.866688 227.694839 95.449397 629.218702l235.761562 0-2.057869 328.796468 362.40389 0L691.55698 628.188232l241.942331-3.089361L510.866688 227.694839zM63.840492 63.962777l894.052392 0 0 131.813095L63.840492 195.775872 63.840492 63.962777 63.840492 63.962777zM63.840492 63.962777"></path>
</svg>

      </i>
    </div>
  </div>
  
<script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>




<script type="text/javascript" src="/js/main.638251f4230630f0335d8c6748e53a96f94b72670920b60c09a56fdc8bece214.js" integrity="sha256-Y4JR9CMGMPAzXYxnSOU6lvlLcmcJILYMCaVv3Ivs4hQ=" crossorigin="anonymous"></script>






  
    <script type="text/javascript" src="/js/load-photoswipe.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe.min.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe-ui-default.min.js"></script>
  













</body>
</html>
