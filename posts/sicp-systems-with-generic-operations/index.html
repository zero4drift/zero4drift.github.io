<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " vocab="http://ogp.me/ns" lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="Refresher of SICP chapter 2.5 abstraction data systems-with-generic-operations 构造数据抽象 带有通用型操作的计算系统">
<meta name="viewport" content="width=device-width">
<title>SICP-Systems-with-Generic-Operations | 钉钉是世界上最傻逼的app</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link rel="alternate" type="application/rss+xml" title="RSS" href="../../rss.xml">
<link rel="canonical" href="https://zero4drift.github.io/posts/sicp-systems-with-generic-operations/">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="zero4drift">
<meta property="og:site_name" content="钉钉是世界上最傻逼的app">
<meta property="og:title" content="SICP-Systems-with-Generic-Operations">
<meta property="og:url" content="https://zero4drift.github.io/posts/sicp-systems-with-generic-operations/">
<meta property="og:description" content="Refresher of SICP chapter 2.5 abstraction data systems-with-generic-operations 构造数据抽象 带有通用型操作的计算系统">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2018-12-28T11:30:42+08:00">
<meta property="article:tag" content="Scheme">
<meta property="article:tag" content="SICP">
</head>
<body>
    

    <header id="header" class="navbar"><div class="container">
            
    <div class="brand">

        <div class="brand-text">
            <a href="https://zero4drift.github.io/" title="钉钉是世界上最傻逼的app" rel="home">
                钉钉是世界上最傻逼的app
            </a>
        </div>

        <a id="btn-toggle-nav" class="navbar-toggle">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </a>
    </div>

            
    <nav class="navbar-collapse collapse"><ul class="nav">
<li><a href="../../archive.html">Archive</a></li>
                <li><a href="https://github.com/zero4drift">Github</a></li>
                <li><a href="../../categories/">Tags</a></li>
                <li><a href="../../rss.xml">RSS feed</a></li>
    
    
    </ul></nav>
</div>
    </header><div class="header-padding"> </div>

    
    <div class="post-header">
        <div class="container">
            <div class="title">
                SICP-Systems-with-Generic-Operations
            </div>
        </div>
    </div>

    <div class="post-meta">
      <div class="container">
	<div class="meta clearfix">
	  <div class="authordate">
	    <time class="timeago" datetime="2018-12-28T11:30:42+08:00">2018/12/28</time>
</div>
	  <div class="post-tags">
	    <div class="tag">
	      <a href="../../categories/scheme/" rel="tag">Scheme</a>
	    </div>
	    <div class="tag">
	      <a href="../../categories/sicp/" rel="tag">SICP</a>
	    </div>
	  </div>
	</div>
      </div>
    </div>
    
    
    <div id="post-main" class="main">
        <div class="container">
        <div id="outline-container-org8e51cf7" class="outline-2">
<h2 id="org8e51cf7">带有通用型操作的系统</h2>
<div class="outline-text-2" id="text-org8e51cf7">
<blockquote>
<p>
在设计大型系统时，处理好一大批相互有关的类型而同时又能保持模块性，是一个非常苦
难的问题。
</p>
</blockquote>

<p>
本文中的代码是完全体，可运行，书本上的操作全部验证通过；
</p>

<p>
包括 <i>SICP</i> 第二章第五节文本部分介绍的特性，及习题部分要求加入的新特性（除了
2.92）；
</p>

<p>
版本记录中包含此代码的文件是按照习题顺序逐次加入特性并提交的，需要按习题对照代
码及功能查看个人 github 页面的提交记录并检出：<a href="https://github.com/zero4drift/SICP/blob/master/chapter2/systems-with-generic-operations.scm">systems-with-generic-operations</a>
</p>

<p>
运行程序的还需要 <i>SICP</i> 第三章 3.24 的习题代码，没有的请去上面的链接里往上翻。
</p>

<div class="highlight"><pre><span></span>  <span class="p">(</span><span class="nb">load </span><span class="s">"../chapter3/3.24.scm"</span><span class="p">)</span>

  <span class="c1">;; make a type-operation table</span>
  <span class="p">(</span><span class="k">define </span><span class="nv">tb</span> <span class="p">(</span><span class="nf">make-table</span> <span class="nv">equal?</span><span class="p">))</span>
  <span class="p">(</span><span class="k">define </span><span class="nv">get</span> <span class="p">(</span><span class="nf">tb</span> <span class="ss">'lookup-proc</span><span class="p">))</span>
  <span class="p">(</span><span class="k">define </span><span class="nv">put</span> <span class="p">(</span><span class="nf">tb</span> <span class="ss">'insert-proc!</span><span class="p">))</span>
  <span class="c1">;; table done</span>

  <span class="c1">;; overall general procedures</span>

  <span class="c1">;; follow ex 2.78</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">attach-tag</span> <span class="nv">type-tag</span> <span class="nv">contents</span><span class="p">)</span>
    <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">number? </span><span class="nv">contents</span><span class="p">)</span>
	<span class="nv">contents</span>
	<span class="p">(</span><span class="nb">cons </span><span class="nv">type-tag</span> <span class="nv">contents</span><span class="p">)))</span>

  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">type-tag</span> <span class="nv">datum</span><span class="p">)</span>
    <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nb">number? </span><span class="nv">datum</span><span class="p">)</span> <span class="ss">'scheme-number</span><span class="p">)</span>
	  <span class="p">((</span><span class="nb">pair? </span><span class="nv">datum</span><span class="p">)</span> <span class="p">(</span><span class="nb">car </span><span class="nv">datum</span><span class="p">))</span>
	  <span class="p">(</span><span class="nf">else</span>
	   <span class="p">(</span><span class="nf">error</span> <span class="s">"Bad tagged datum -- CONTENTS"</span> <span class="nv">datum</span><span class="p">))))</span>

  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">contents</span> <span class="nv">datum</span><span class="p">)</span>
    <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nb">number? </span><span class="nv">datum</span><span class="p">)</span> <span class="nv">datum</span><span class="p">)</span>
	  <span class="p">((</span><span class="nb">pair? </span><span class="nv">datum</span><span class="p">)</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">datum</span><span class="p">))</span>
	  <span class="p">(</span><span class="nf">else</span>
	   <span class="p">(</span><span class="nf">error</span> <span class="s">"Bad tagged datum -- CONTENTS"</span> <span class="nv">datum</span><span class="p">))))</span>
  <span class="c1">;; 2.78</span>

  <span class="c1">;; follow 2.81</span>
  <span class="c1">;; (define (apply-generic op . args)</span>
  <span class="c1">;;   (let ((type-tags (map type-tag args)))</span>
  <span class="c1">;;     (let ((proc (get op type-tags)))</span>
  <span class="c1">;;       (if proc</span>
  <span class="c1">;; 	  (apply proc (map contents args))</span>
  <span class="c1">;; 	  (if (= (length args) 2)</span>
  <span class="c1">;; 	      (let ((type1 (car type-tags))</span>
  <span class="c1">;; 		    (type2 (cadr type-tags))</span>
  <span class="c1">;; 		    (a1 (car args))</span>
  <span class="c1">;; 		    (a2 (cadr args)))</span>
  <span class="c1">;; 		(if(equal? type1 type2)</span>
  <span class="c1">;; 		   (error "No method for these types"</span>
  <span class="c1">;; 			  (list op type-tags))</span>
  <span class="c1">;; 		   (let ((t1-&gt;t2 (get-coercion type1 type2))</span>
  <span class="c1">;; 			 (t2-&gt;t1 (get-coercion type2 type1)))</span>
  <span class="c1">;; 		     (cond (t1-&gt;t2</span>
  <span class="c1">;; 			    (apply-generic op (t1-&gt;t2 a1) a2))</span>
  <span class="c1">;; 			   (t2-&gt;t1</span>
  <span class="c1">;; 			    (apply-generic op a1 (t2-&gt;t1 a2)))</span>
  <span class="c1">;; 			   (else</span>
  <span class="c1">;; 			    (error "No method for these types"</span>
  <span class="c1">;; 				   (list op type-tags))))))</span>
  <span class="c1">;; 		(error "No method for these types"</span>
  <span class="c1">;; 		       (list op type-tags))))))))</span>
  <span class="c1">;; 2.81</span>


  <span class="c1">;; follow ex 2.84</span>
  <span class="c1">;; types-tower</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">install-types-tower</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">put</span> <span class="ss">'level</span> <span class="ss">'scheme-number</span> <span class="mi">1</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">put</span> <span class="ss">'level</span> <span class="ss">'rational</span> <span class="mi">2</span><span class="p">)</span>
    <span class="c1">;; real package is not implemented</span>
    <span class="p">(</span><span class="nf">put</span> <span class="ss">'level</span> <span class="ss">'real</span> <span class="mi">3</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">put</span> <span class="ss">'level</span> <span class="ss">'complex</span> <span class="mi">4</span><span class="p">)</span>
    <span class="ss">'done</span><span class="p">)</span>

  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">apply-generic</span> <span class="nv">op</span> <span class="o">.</span> <span class="nv">args</span><span class="p">)</span>
    <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">type-tags</span> <span class="p">(</span><span class="nb">map </span><span class="nv">type-tag</span> <span class="nv">args</span><span class="p">)))</span>
      <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">proc</span> <span class="p">(</span><span class="nf">get</span> <span class="nv">op</span> <span class="nv">type-tags</span><span class="p">)))</span>
	<span class="p">(</span><span class="k">if </span><span class="nv">proc</span>
	    <span class="c1">;; follow 2.85</span>
	    <span class="c1">;; (let ((res (apply proc (map contents args))))</span>
	    <span class="c1">;;   (if (or (eq? op 'raise) (eq? op 'equ?) (eq? op '=zero?))</span>
	    <span class="c1">;; 	res</span>
	    <span class="c1">;; 	(drop res)))</span>
	    <span class="c1">;; 2.85</span>
	    <span class="p">(</span><span class="nb">apply </span><span class="nv">proc</span> <span class="p">(</span><span class="nb">map </span><span class="nv">contents</span> <span class="nv">args</span><span class="p">))</span>
	    <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">= </span><span class="p">(</span><span class="nb">length </span><span class="nv">args</span><span class="p">)</span> <span class="mi">2</span><span class="p">)</span>
		<span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">type1</span> <span class="p">(</span><span class="nb">car </span><span class="nv">type-tags</span><span class="p">))</span>
		      <span class="p">(</span><span class="nf">type2</span> <span class="p">(</span><span class="nb">cadr </span><span class="nv">type-tags</span><span class="p">))</span>
		      <span class="p">(</span><span class="nf">a1</span> <span class="p">(</span><span class="nb">car </span><span class="nv">args</span><span class="p">))</span>
		      <span class="p">(</span><span class="nf">a2</span> <span class="p">(</span><span class="nb">cadr </span><span class="nv">args</span><span class="p">)))</span>
		  <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nb">equal? </span><span class="nv">type1</span> <span class="nv">type2</span><span class="p">)</span>
			 <span class="p">(</span><span class="nf">error</span> <span class="s">"No method for these types"</span>
				<span class="p">(</span><span class="nb">list </span><span class="nv">op</span> <span class="nv">type-tags</span><span class="p">)))</span>
			<span class="p">((</span><span class="nb">&lt; </span><span class="p">(</span><span class="nf">level</span> <span class="nv">a1</span><span class="p">)</span> <span class="p">(</span><span class="nf">level</span> <span class="nv">a2</span><span class="p">))</span>
			 <span class="p">(</span><span class="nf">apply-generic</span> <span class="nv">op</span> <span class="p">(</span><span class="nf">raise</span> <span class="nv">a1</span><span class="p">)</span> <span class="nv">a2</span><span class="p">))</span>
			<span class="p">(</span><span class="k">else </span><span class="p">(</span><span class="nf">apply-generic</span> <span class="nv">op</span> <span class="nv">a1</span> <span class="p">(</span><span class="nf">raise</span> <span class="nv">a2</span><span class="p">)))))</span>
		<span class="p">(</span><span class="nf">error</span> <span class="s">"No method for these types"</span>
		       <span class="p">(</span><span class="nb">list </span><span class="nv">op</span> <span class="nv">type-tags</span><span class="p">)))))))</span>
  <span class="c1">;; 2.84</span>

  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">add</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">)</span> <span class="p">(</span><span class="nf">apply-generic</span> <span class="ss">'add</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">))</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">sub</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">)</span> <span class="p">(</span><span class="nf">apply-generic</span> <span class="ss">'sub</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">))</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">mul</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">)</span> <span class="p">(</span><span class="nf">apply-generic</span> <span class="ss">'mul</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">))</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">div</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">)</span> <span class="p">(</span><span class="nf">apply-generic</span> <span class="ss">'div</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">))</span>
  <span class="c1">;; follow ex 2.79</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">equ?</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">)(</span><span class="nf">apply-generic</span> <span class="ss">'equ?</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">))</span>
  <span class="c1">;; 2.79</span>
  <span class="c1">;; follow ex 2.80</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">=zero?</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">apply-generic</span> <span class="ss">'=zero?</span> <span class="nv">x</span><span class="p">))</span>
  <span class="c1">;; 2.80</span>
  <span class="c1">;; follow 2.83</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">raise</span> <span class="nv">number</span><span class="p">)</span> <span class="p">(</span><span class="nf">apply-generic</span> <span class="ss">'raise</span> <span class="nv">number</span><span class="p">))</span>
  <span class="c1">;; 2.83</span>
  <span class="c1">;; follow 2.84</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">level</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">get</span> <span class="ss">'level</span> <span class="p">(</span><span class="nf">type-tag</span> <span class="nv">x</span><span class="p">)))</span>
  <span class="c1">;; 2.84</span>
  <span class="c1">;; follow ex 2.85</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">project</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">apply-generic</span> <span class="ss">'project</span> <span class="nv">x</span><span class="p">))</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">drop</span> <span class="nv">x</span><span class="p">)</span>
    <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">number? </span><span class="nv">x</span><span class="p">)</span>
	<span class="nv">x</span>
	<span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">a</span> <span class="p">(</span><span class="nf">project</span> <span class="nv">x</span><span class="p">)))</span>
	  <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">equ?</span> <span class="p">(</span><span class="nf">raise</span> <span class="nv">a</span><span class="p">)</span> <span class="nv">x</span><span class="p">)</span>
	      <span class="p">(</span><span class="nf">drop</span> <span class="nv">a</span><span class="p">)</span>
	      <span class="nv">x</span><span class="p">))))</span>
  <span class="c1">;; 2.85</span>
  <span class="c1">;; follow ex 2.86</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">sine</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">apply-generic</span> <span class="ss">'sine</span> <span class="nv">x</span><span class="p">))</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">cosine</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">apply-generic</span> <span class="ss">'cosine</span> <span class="nv">x</span><span class="p">))</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">arctan</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">apply-generic</span> <span class="ss">'arctan</span> <span class="nv">x</span><span class="p">))</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nb">exp </span><span class="nv">x</span> <span class="nv">y</span><span class="p">)</span> <span class="p">(</span><span class="nf">apply-generic</span> <span class="ss">'exp</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">))</span>
  <span class="c1">;; 2.86</span>
  <span class="c1">;; follow ex 2.87</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">negative</span> <span class="nv">n</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">apply-generic</span> <span class="ss">'negative</span> <span class="nv">n</span><span class="p">))</span>
  <span class="c1">;; 2.87</span>
  <span class="c1">;; follow ex 2.93 &amp; 2.94</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">greatest-common-divisor</span> <span class="nv">a</span> <span class="nv">b</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">apply-generic</span> <span class="ss">'gcd</span> <span class="nv">a</span> <span class="nv">b</span><span class="p">))</span>
  <span class="c1">;; 2.93 &amp; 2.94</span>
  <span class="c1">;; follow ex 2.97</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">reduce</span> <span class="nv">n</span> <span class="nv">d</span><span class="p">)</span> <span class="p">(</span><span class="nf">apply-generic</span> <span class="ss">'reduce</span> <span class="nv">n</span> <span class="nv">d</span><span class="p">))</span>
  <span class="c1">;; 2.97</span>


  <span class="c1">;; helper functions</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">square</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">mul</span> <span class="nv">x</span> <span class="nv">x</span><span class="p">))</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">sqr</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">exp </span><span class="nv">x</span> <span class="mf">0.5</span><span class="p">))</span>
  <span class="c1">;; built-in gcd</span>


  <span class="c1">;; scheme-number package</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">install-scheme-number-package</span><span class="p">)</span>
    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">tag</span> <span class="nv">x</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">attach-tag</span> <span class="ss">'scheme-number</span> <span class="nv">x</span><span class="p">))</span>

    <span class="c1">;; follow ex 2.79</span>
    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">equ-number?</span> <span class="nv">n1</span> <span class="nv">n2</span><span class="p">)</span>
      <span class="p">(</span><span class="nb">= </span><span class="nv">n1</span> <span class="nv">n2</span><span class="p">))</span>
    <span class="p">(</span><span class="nf">put</span> <span class="ss">'equ?</span> <span class="o">'</span><span class="p">(</span><span class="nv">scheme-number</span> <span class="nv">scheme-number</span><span class="p">)</span> <span class="nv">equ-number?</span><span class="p">)</span>
    <span class="c1">;; 2,79</span>
    <span class="c1">;; follow ex 2.80</span>
    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">=zero-number?</span> <span class="nv">n</span><span class="p">)</span> <span class="p">(</span><span class="nb">= </span><span class="nv">n</span> <span class="mi">0</span><span class="p">))</span>
    <span class="p">(</span><span class="nf">put</span> <span class="ss">'=zero?</span> <span class="o">'</span><span class="p">(</span><span class="nv">scheme-number</span><span class="p">)</span> <span class="nv">=zero-number?</span><span class="p">)</span>
    <span class="c1">;; 2.80</span>
    <span class="c1">;; follow 2.83</span>
    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">scheme-number-&gt;rational</span> <span class="nv">number</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">make-rational</span> <span class="nv">number</span> <span class="mi">1</span><span class="p">))</span>
    <span class="p">(</span><span class="nf">put</span> <span class="ss">'raise</span> <span class="o">'</span><span class="p">(</span><span class="nv">scheme-number</span><span class="p">)</span> <span class="nv">scheme-number-&gt;rational</span><span class="p">)</span>
    <span class="c1">;; 2.83</span>
    <span class="c1">;; follow 2.85</span>
    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">drop-scheme-number</span> <span class="nv">x</span><span class="p">)</span> <span class="nv">x</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">put</span> <span class="ss">'drop</span> <span class="o">'</span><span class="p">(</span><span class="nv">scheme-number</span><span class="p">)</span> <span class="nv">drop-scheme-number</span><span class="p">)</span>
    <span class="c1">;; 2.85</span>
    <span class="c1">;; follow ex 2.93 &amp; 2.94</span>
    <span class="p">(</span><span class="k">define </span><span class="nv">gcd-scheme-number</span> <span class="nv">gcd</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">put</span> <span class="ss">'gcd</span> <span class="o">'</span><span class="p">(</span><span class="nv">scheme-number</span> <span class="nv">scheme-number</span><span class="p">)</span>
	 <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">s1</span> <span class="nv">s2</span><span class="p">)</span> <span class="p">(</span><span class="nf">tag</span> <span class="p">(</span><span class="nf">gcd-scheme-number</span> <span class="nv">s1</span> <span class="nv">s2</span><span class="p">))))</span>
    <span class="c1">;; 2.93 &amp; 2.94</span>
    <span class="c1">;; follow ex 2.97</span>
    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">reduce-integers</span> <span class="nv">n</span> <span class="nv">d</span><span class="p">)</span>
      <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">g</span> <span class="p">(</span><span class="nf">greatest-common-divisor</span> <span class="nv">n</span> <span class="nv">d</span><span class="p">)))</span>
	<span class="p">(</span><span class="nb">list </span><span class="p">(</span><span class="nf">div</span> <span class="nv">n</span> <span class="nv">g</span><span class="p">)</span> <span class="p">(</span><span class="nf">div</span> <span class="nv">d</span> <span class="nv">g</span><span class="p">))))</span>
    <span class="c1">;; 2.97</span>
    <span class="p">(</span><span class="nf">put</span> <span class="ss">'reduce</span> <span class="o">'</span><span class="p">(</span><span class="nv">scheme-number</span> <span class="nv">scheme-number</span><span class="p">)</span>
	 <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">n</span> <span class="nv">d</span><span class="p">)</span> <span class="p">(</span><span class="nb">map </span><span class="nv">tag</span> <span class="p">(</span><span class="nf">reduce-integers</span> <span class="nv">n</span> <span class="nv">d</span><span class="p">))))</span>
    <span class="p">(</span><span class="nf">put</span> <span class="ss">'add</span> <span class="o">'</span><span class="p">(</span><span class="nv">scheme-number</span> <span class="nv">scheme-number</span><span class="p">)</span>
	 <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span> <span class="nv">y</span><span class="p">)</span> <span class="p">(</span><span class="nf">tag</span> <span class="p">(</span><span class="nb">+ </span><span class="nv">x</span> <span class="nv">y</span><span class="p">))))</span>
    <span class="p">(</span><span class="nf">put</span> <span class="ss">'sub</span> <span class="o">'</span><span class="p">(</span><span class="nv">scheme-number</span> <span class="nv">scheme-number</span><span class="p">)</span>
	 <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span> <span class="nv">y</span><span class="p">)</span> <span class="p">(</span><span class="nf">tag</span> <span class="p">(</span><span class="nb">- </span><span class="nv">x</span> <span class="nv">y</span><span class="p">))))</span>
    <span class="p">(</span><span class="nf">put</span> <span class="ss">'mul</span> <span class="o">'</span><span class="p">(</span><span class="nv">scheme-number</span> <span class="nv">scheme-number</span><span class="p">)</span>
	 <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span> <span class="nv">y</span><span class="p">)</span> <span class="p">(</span><span class="nf">tag</span> <span class="p">(</span><span class="nb">* </span><span class="nv">x</span> <span class="nv">y</span><span class="p">))))</span>
    <span class="p">(</span><span class="nf">put</span> <span class="ss">'div</span> <span class="o">'</span><span class="p">(</span><span class="nv">scheme-number</span> <span class="nv">scheme-number</span><span class="p">)</span>
	 <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span> <span class="nv">y</span><span class="p">)</span> <span class="p">(</span><span class="nf">tag</span> <span class="p">(</span><span class="nb">/ </span><span class="nv">x</span> <span class="nv">y</span><span class="p">))))</span>
    <span class="p">(</span><span class="nf">put</span> <span class="ss">'make</span> <span class="ss">'scheme-number</span>
	 <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">tag</span> <span class="nv">x</span><span class="p">)))</span>
    <span class="c1">;; follow ex 2.86</span>
    <span class="p">(</span><span class="nf">put</span> <span class="ss">'sine</span> <span class="o">'</span><span class="p">(</span><span class="nv">scheme-number</span><span class="p">)</span> <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">tag</span> <span class="p">(</span><span class="nb">sin </span><span class="nv">x</span><span class="p">))))</span>
    <span class="p">(</span><span class="nf">put</span> <span class="ss">'cosine</span> <span class="o">'</span><span class="p">(</span><span class="nv">scheme-number</span><span class="p">)</span> <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">tag</span> <span class="p">(</span><span class="nb">cos </span><span class="nv">x</span><span class="p">))))</span>
    <span class="p">(</span><span class="nf">put</span> <span class="ss">'arctan</span> <span class="o">'</span><span class="p">(</span><span class="nv">scheme-number</span> <span class="nv">scheme-number</span><span class="p">)</span> <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">y</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">tag</span> <span class="p">(</span><span class="nb">atan </span><span class="nv">y</span> <span class="nv">x</span><span class="p">))))</span>
    <span class="p">(</span><span class="nf">put</span> <span class="ss">'exp</span> <span class="o">'</span><span class="p">(</span><span class="nv">scheme-number</span> <span class="nv">scheme-number</span><span class="p">)</span> <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span> <span class="nv">y</span><span class="p">)</span> <span class="p">(</span><span class="nf">tag</span> <span class="p">(</span><span class="nb">expt </span><span class="nv">x</span> <span class="nv">y</span><span class="p">))))</span>
    <span class="c1">;; 2.86</span>
    <span class="c1">;; follow 2.88</span>
    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">negative-scheme-number</span> <span class="nv">n</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">make-scheme-number</span> <span class="p">(</span><span class="nb">- </span><span class="nv">n</span><span class="p">)))</span>
    <span class="p">(</span><span class="nf">put</span> <span class="ss">'negative</span> <span class="o">'</span><span class="p">(</span><span class="nv">scheme-number</span><span class="p">)</span> <span class="nv">negative-scheme-number</span><span class="p">)</span>
    <span class="c1">;; 2.88</span>

    <span class="ss">'done</span><span class="p">)</span>

  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-scheme-number</span> <span class="nv">n</span><span class="p">)</span>
    <span class="p">((</span><span class="nf">get</span> <span class="ss">'make</span> <span class="ss">'scheme-number</span><span class="p">)</span> <span class="nv">n</span><span class="p">))</span>

  <span class="c1">;; rational package</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">install-rational-package</span><span class="p">)</span>
    <span class="c1">;; internal procedures</span>
    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">numer</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">car </span><span class="nv">x</span><span class="p">))</span>
    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">denom</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">x</span><span class="p">))</span>
    <span class="c1">;; (define (make-rat n d)</span>
    <span class="c1">;;   ;; follow ex 2.93 &amp; 2.94</span>
    <span class="c1">;;   (let ((g (greatest-common-divisor n d)))</span>
    <span class="c1">;;     (cons (div n g) (div d g))))</span>
    <span class="c1">;; follow ex 2.97</span>
    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-rat</span> <span class="nv">n</span> <span class="nv">d</span><span class="p">)</span>
      <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">simple</span> <span class="p">(</span><span class="nf">reduce</span> <span class="nv">n</span> <span class="nv">d</span><span class="p">)))</span>
	<span class="p">(</span><span class="nb">cons </span><span class="p">(</span><span class="nb">car </span><span class="nv">simple</span><span class="p">)</span> <span class="p">(</span><span class="nb">cadr </span><span class="nv">simple</span><span class="p">))))</span>
    <span class="c1">;; 2.97</span>
    <span class="c1">;; 2.93 &amp; 2.94</span>
    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">add-rat</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">make-rat</span> <span class="p">(</span><span class="nf">add</span> <span class="p">(</span><span class="nf">mul</span> <span class="p">(</span><span class="nf">numer</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">denom</span> <span class="nv">y</span><span class="p">))</span>
		     <span class="p">(</span><span class="nf">mul</span> <span class="p">(</span><span class="nf">numer</span> <span class="nv">y</span><span class="p">)</span> <span class="p">(</span><span class="nf">denom</span> <span class="nv">x</span><span class="p">)))</span>
		<span class="p">(</span><span class="nf">mul</span> <span class="p">(</span><span class="nf">denom</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">denom</span> <span class="nv">y</span><span class="p">))))</span>
    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">sub-rat</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">make-rat</span> <span class="p">(</span><span class="nf">sub</span> <span class="p">(</span><span class="nf">mul</span> <span class="p">(</span><span class="nf">numer</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">denom</span> <span class="nv">y</span><span class="p">))</span>
		     <span class="p">(</span><span class="nf">mul</span> <span class="p">(</span><span class="nf">numer</span> <span class="nv">y</span><span class="p">)</span> <span class="p">(</span><span class="nf">denom</span> <span class="nv">x</span><span class="p">)))</span>
		<span class="p">(</span><span class="nf">mul</span> <span class="p">(</span><span class="nf">denom</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">denom</span> <span class="nv">y</span><span class="p">))))</span>
    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">mul-rat</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">make-rat</span> <span class="p">(</span><span class="nf">mul</span> <span class="p">(</span><span class="nf">numer</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">numer</span> <span class="nv">y</span><span class="p">))</span>
		<span class="p">(</span><span class="nf">mul</span> <span class="p">(</span><span class="nf">denom</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">denom</span> <span class="nv">y</span><span class="p">))))</span>
    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">div-rat</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">make-rat</span> <span class="p">(</span><span class="nf">mul</span> <span class="p">(</span><span class="nf">numer</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">denom</span> <span class="nv">y</span><span class="p">))</span>
		<span class="p">(</span><span class="nf">mul</span> <span class="p">(</span><span class="nf">denom</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">numer</span> <span class="nv">y</span><span class="p">))))</span>
    <span class="c1">;; follow ex 2.79</span>
    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">equ-rational?</span> <span class="nv">r1</span> <span class="nv">r2</span><span class="p">)</span>
      <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">product1</span> <span class="p">(</span><span class="nb">* </span><span class="p">(</span><span class="nf">numer</span> <span class="nv">r1</span><span class="p">)</span> <span class="p">(</span><span class="nf">denom</span> <span class="nv">r2</span><span class="p">)))</span>
	    <span class="p">(</span><span class="nf">product2</span> <span class="p">(</span><span class="nb">* </span><span class="p">(</span><span class="nf">denom</span> <span class="nv">r1</span><span class="p">)</span> <span class="p">(</span><span class="nf">numer</span> <span class="nv">r2</span><span class="p">))))</span>
	<span class="p">(</span><span class="nb">= </span><span class="nv">product1</span> <span class="nv">product2</span><span class="p">)))</span>
    <span class="p">(</span><span class="nf">put</span> <span class="ss">'equ?</span> <span class="o">'</span><span class="p">(</span><span class="nv">rational</span> <span class="nv">rational</span><span class="p">)</span> <span class="nv">equ-rational?</span><span class="p">)</span>
    <span class="c1">;; 2.79</span>
    <span class="c1">;; follow ex 2.80</span>
    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">=zero-rational?</span> <span class="nv">r</span><span class="p">)</span>
      <span class="p">(</span><span class="nb">= </span><span class="p">(</span><span class="nf">numer</span> <span class="nv">r</span><span class="p">)</span> <span class="mi">0</span><span class="p">))</span>
    <span class="p">(</span><span class="nf">put</span> <span class="ss">'=zero?</span> <span class="o">'</span><span class="p">(</span><span class="nv">rational</span><span class="p">)</span> <span class="nv">=zero-rational?</span><span class="p">)</span>
    <span class="c1">;; 2.80</span>
    <span class="c1">;; follow 2.83</span>
    <span class="c1">;; note that we do not implement a real package</span>
    <span class="c1">;; (define (rational-&gt;real number)</span>
    <span class="c1">;;   (make-real (/ (numer number) (denom number))))</span>
    <span class="c1">;; (put 'raise '(rational) rational-&gt;real)</span>
    <span class="c1">;; 2.83</span>
    <span class="c1">;; follow 2.85</span>
    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">project-rational</span> <span class="nv">x</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">make-scheme-number</span> <span class="p">(</span><span class="nb">round </span><span class="p">(</span><span class="nb">/ </span><span class="p">(</span><span class="nf">numer</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">denom</span> <span class="nv">x</span><span class="p">)))))</span>
    <span class="p">(</span><span class="nf">put</span> <span class="ss">'project</span> <span class="o">'</span><span class="p">(</span><span class="nv">rational</span><span class="p">)</span> <span class="nv">project-rational</span><span class="p">)</span>
    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">drop-rational</span> <span class="nv">x</span><span class="p">)</span>
      <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">a</span> <span class="p">(</span><span class="nf">project</span> <span class="nv">x</span><span class="p">)))</span>
	<span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">equ?</span> <span class="p">(</span><span class="nf">raise</span> <span class="nv">a</span><span class="p">)</span> <span class="nv">x</span><span class="p">)</span>
	    <span class="nv">a</span>
	    <span class="nv">x</span><span class="p">)))</span>
    <span class="p">(</span><span class="nf">put</span> <span class="ss">'drop</span> <span class="o">'</span><span class="p">(</span><span class="nv">rational</span><span class="p">)</span> <span class="nv">drop-rational</span><span class="p">)</span>
    <span class="c1">;; 2.85</span>
    <span class="c1">;; follow 2.88</span>
    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">negative-rational</span> <span class="nv">n</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">make-rational</span> <span class="p">(</span><span class="nf">negative</span> <span class="p">(</span><span class="nf">numer</span> <span class="nv">n</span><span class="p">))</span> <span class="p">(</span><span class="nf">denom</span> <span class="nv">n</span><span class="p">)))</span>
    <span class="p">(</span><span class="nf">put</span> <span class="ss">'negative</span> <span class="o">'</span><span class="p">(</span><span class="nv">rational</span><span class="p">)</span> <span class="nv">negative-rational</span><span class="p">)</span>
    <span class="c1">;; 2.88</span>

    <span class="c1">;; interface to rest of the system</span>
    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">tag</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">attach-tag</span> <span class="ss">'rational</span> <span class="nv">x</span><span class="p">))</span>
    <span class="p">(</span><span class="nf">put</span> <span class="ss">'add</span> <span class="o">'</span><span class="p">(</span><span class="nv">rational</span> <span class="nv">rational</span><span class="p">)</span>
	 <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span> <span class="nv">y</span><span class="p">)</span> <span class="p">(</span><span class="nf">tag</span> <span class="p">(</span><span class="nf">add-rat</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">))))</span>
    <span class="p">(</span><span class="nf">put</span> <span class="ss">'sub</span> <span class="o">'</span><span class="p">(</span><span class="nv">rational</span> <span class="nv">rational</span><span class="p">)</span>
	 <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span> <span class="nv">y</span><span class="p">)</span> <span class="p">(</span><span class="nf">tag</span> <span class="p">(</span><span class="nf">sub-rat</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">))))</span>
    <span class="p">(</span><span class="nf">put</span> <span class="ss">'mul</span> <span class="o">'</span><span class="p">(</span><span class="nv">rational</span> <span class="nv">rational</span><span class="p">)</span>
	 <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span> <span class="nv">y</span><span class="p">)</span> <span class="p">(</span><span class="nf">tag</span> <span class="p">(</span><span class="nf">mul-rat</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">))))</span>
    <span class="p">(</span><span class="nf">put</span> <span class="ss">'div</span> <span class="o">'</span><span class="p">(</span><span class="nv">rational</span> <span class="nv">rational</span><span class="p">)</span>
	 <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span> <span class="nv">y</span><span class="p">)</span> <span class="p">(</span><span class="nf">tag</span> <span class="p">(</span><span class="nf">div-rat</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">))))</span>
    <span class="p">(</span><span class="nf">put</span> <span class="ss">'make</span> <span class="ss">'rational</span>
	 <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">n</span> <span class="nv">d</span><span class="p">)</span> <span class="p">(</span><span class="nf">tag</span> <span class="p">(</span><span class="nf">make-rat</span> <span class="nv">n</span> <span class="nv">d</span><span class="p">))))</span>
    <span class="c1">;; follow ex 2.86</span>
    <span class="c1">;; assume that there is a way of computing numer and denom from real number(*.*)</span>
    <span class="c1">;; calls get_numer_denom, which returns a numer-denom pair</span>
    <span class="c1">;; Alternative:</span>
    <span class="c1">;; if not strictly stricted, sine/cosine/arctan/exp of rational could return scheme number;</span>
    <span class="c1">;; just replace (tag (get_numer_denom)) with (make-scheme-number)</span>
    <span class="c1">;; (put 'sine '(rational) (lambda (x) (tag (get_numer_denom (sine (/ (numer x) (denom x)))))))</span>
    <span class="c1">;; (put 'cosine '(rational) (lambda (x) (tag (get_numer_denom (cosine (/  (numer x) (denom x)))))))</span>
    <span class="c1">;; (put 'arctan '(rational rational)</span>
    <span class="c1">;;      (lambda (y x) (tag (get_numer_denom</span>
    <span class="c1">;; 		      (arctan (/ (numer y) (denom x)) (/ (numer x) (denom x)))))))</span>
    <span class="c1">;; (put 'exp '(rational rational)</span>
    <span class="c1">;;      (lambda (x y) (tag (get_numer_denom</span>
    <span class="c1">;; 		      (exp (/ (numer x) (denom x)) (/ (numer y) (denom y)))))))</span>
    <span class="c1">;; 2.86</span>
    <span class="ss">'done</span><span class="p">)</span>

  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-rational</span> <span class="nv">n</span> <span class="nv">d</span><span class="p">)</span>
    <span class="p">((</span><span class="nf">get</span> <span class="ss">'make</span> <span class="ss">'rational</span><span class="p">)</span> <span class="nv">n</span> <span class="nv">d</span><span class="p">))</span>

  <span class="c1">;; complex package</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">install-complex-package</span><span class="p">)</span>
    <span class="c1">;; imported procedures from rectangular and polar packages</span>
    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-from-real-imag</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">)</span>
      <span class="p">((</span><span class="nf">get</span> <span class="ss">'make-from-real-imag</span> <span class="ss">'rectangular</span><span class="p">)</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">))</span>
    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-from-mag-ang</span> <span class="nv">r</span> <span class="nv">a</span><span class="p">)</span>
      <span class="p">((</span><span class="nf">get</span> <span class="ss">'make-from-mag-ang</span> <span class="ss">'polar</span><span class="p">)</span> <span class="nv">r</span> <span class="nv">a</span><span class="p">))</span>

    <span class="c1">;; internal procedures</span>
    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">add-complex</span> <span class="nv">z1</span> <span class="nv">z2</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">make-from-real-imag</span> <span class="p">(</span><span class="nf">add</span> <span class="p">(</span><span class="nb">real-part </span><span class="nv">z1</span><span class="p">)</span> <span class="p">(</span><span class="nb">real-part </span><span class="nv">z2</span><span class="p">))</span>
			   <span class="p">(</span><span class="nf">add</span> <span class="p">(</span><span class="nb">imag-part </span><span class="nv">z1</span><span class="p">)</span> <span class="p">(</span><span class="nb">imag-part </span><span class="nv">z2</span><span class="p">))))</span>
    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">sub-complex</span> <span class="nv">z1</span> <span class="nv">z2</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">make-from-real-imag</span> <span class="p">(</span><span class="nf">sub</span> <span class="p">(</span><span class="nb">real-part </span><span class="nv">z1</span><span class="p">)</span> <span class="p">(</span><span class="nb">real-part </span><span class="nv">z2</span><span class="p">))</span>
			   <span class="p">(</span><span class="nf">sub</span> <span class="p">(</span><span class="nb">imag-part </span><span class="nv">z1</span><span class="p">)</span> <span class="p">(</span><span class="nb">imag-part </span><span class="nv">z2</span><span class="p">))))</span>
    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">mul-complex</span> <span class="nv">z1</span> <span class="nv">z2</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">make-from-mag-ang</span> <span class="p">(</span><span class="nf">mul</span> <span class="p">(</span><span class="nb">magnitude </span><span class="nv">z1</span><span class="p">)</span> <span class="p">(</span><span class="nb">magnitude </span><span class="nv">z2</span><span class="p">))</span>
			 <span class="p">(</span><span class="nf">add</span> <span class="p">(</span><span class="nb">angle </span><span class="nv">z1</span><span class="p">)</span> <span class="p">(</span><span class="nb">angle </span><span class="nv">z2</span><span class="p">))))</span>
    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">div-complex</span> <span class="nv">z1</span> <span class="nv">z2</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">make-from-mag-ang</span> <span class="p">(</span><span class="nf">div</span> <span class="p">(</span><span class="nb">magnitude </span><span class="nv">z1</span><span class="p">)</span> <span class="p">(</span><span class="nb">magnitude </span><span class="nv">z2</span><span class="p">))</span>
			 <span class="p">(</span><span class="nf">sub</span> <span class="p">(</span><span class="nb">angle </span><span class="nv">z1</span><span class="p">)</span> <span class="p">(</span><span class="nb">angle </span><span class="nv">z2</span><span class="p">))))</span>
    <span class="c1">;; follow ex 2.79</span>
    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">equ-complex?</span> <span class="nv">c1</span> <span class="nv">c2</span><span class="p">)</span>
      <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">real1</span> <span class="p">(</span><span class="nb">real-part </span><span class="nv">c1</span><span class="p">))</span>
	    <span class="p">(</span><span class="nf">imag1</span> <span class="p">(</span><span class="nb">imag-part </span><span class="nv">c1</span><span class="p">))</span>
	    <span class="p">(</span><span class="nf">real2</span> <span class="p">(</span><span class="nb">real-part </span><span class="nv">c2</span><span class="p">))</span>
	    <span class="p">(</span><span class="nf">imag2</span> <span class="p">(</span><span class="nb">imag-part </span><span class="nv">c2</span><span class="p">)))</span>
	<span class="p">(</span><span class="k">and </span><span class="p">(</span><span class="nb">= </span><span class="nv">real1</span> <span class="nv">real2</span><span class="p">)</span> <span class="p">(</span><span class="nb">= </span><span class="nv">imag1</span> <span class="nv">imag2</span><span class="p">))))</span>
    <span class="p">(</span><span class="nf">put</span> <span class="ss">'equ?</span> <span class="o">'</span><span class="p">(</span><span class="nv">complex</span> <span class="nv">complex</span><span class="p">)</span> <span class="nv">equ-complex?</span><span class="p">)</span>
    <span class="c1">;; 2.79</span>
    <span class="c1">;; follow ex 2.80</span>
    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">=zero-complex?</span> <span class="nv">c</span><span class="p">)</span>
      <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">real</span> <span class="p">(</span><span class="nb">real-part </span><span class="nv">c</span><span class="p">))</span>
	    <span class="p">(</span><span class="nf">imag</span> <span class="p">(</span><span class="nb">imag-part </span><span class="nv">c</span><span class="p">)))</span>
	<span class="p">(</span><span class="k">and </span><span class="p">(</span><span class="nb">= </span><span class="nv">real</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nb">= </span><span class="nv">imag</span> <span class="mi">0</span><span class="p">))))</span>
    <span class="p">(</span><span class="nf">put</span> <span class="ss">'=zero?</span> <span class="o">'</span><span class="p">(</span><span class="nv">complex</span><span class="p">)</span> <span class="nv">=zero-complex?</span><span class="p">)</span>
    <span class="c1">;; 2.80</span>
    <span class="c1">;; follow ex 2.85</span>
    <span class="c1">;; need real package</span>
    <span class="c1">;; (define (project-complex x) (make-real (real-part x)))</span>
    <span class="c1">;; (put 'project '(complex) project-complex)</span>
    <span class="c1">;; (define (drop-complex x)</span>
    <span class="c1">;;   (let ((a (project x)))</span>
    <span class="c1">;;     (if (equ? (raise a) x)</span>
    <span class="c1">;; 	  (drop a)</span>
    <span class="c1">;; 	  x)))	</span>
    <span class="c1">;; (put 'drop '(complex) drop-complex)</span>
    <span class="c1">;; 2.85</span>
    <span class="c1">;; follow ex 2.88</span>
    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">negative-complex</span> <span class="nv">n</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">make-complex-from-real-imag</span> <span class="p">(</span><span class="nf">negative</span> <span class="p">(</span><span class="nb">real-part </span><span class="nv">n</span><span class="p">))</span> <span class="p">(</span><span class="nf">negative</span> <span class="p">(</span><span class="nb">imag-part </span><span class="nv">n</span><span class="p">))))</span>
    <span class="p">(</span><span class="nf">put</span> <span class="ss">'negative</span> <span class="o">'</span><span class="p">(</span><span class="nv">complex</span><span class="p">)</span> <span class="nv">negative-complex</span><span class="p">)</span>
    <span class="c1">;; 2.88</span>

    <span class="c1">;; interface to rest of the system</span>
    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">tag</span> <span class="nv">z</span><span class="p">)</span> <span class="p">(</span><span class="nf">attach-tag</span> <span class="ss">'complex</span> <span class="nv">z</span><span class="p">))</span>
    <span class="p">(</span><span class="nf">put</span> <span class="ss">'add</span> <span class="o">'</span><span class="p">(</span><span class="nv">complex</span> <span class="nv">complex</span><span class="p">)</span>
	 <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">z1</span> <span class="nv">z2</span><span class="p">)</span> <span class="p">(</span><span class="nf">tag</span> <span class="p">(</span><span class="nf">add-complex</span> <span class="nv">z1</span> <span class="nv">z2</span><span class="p">))))</span>
    <span class="p">(</span><span class="nf">put</span> <span class="ss">'sub</span> <span class="o">'</span><span class="p">(</span><span class="nv">complex</span> <span class="nv">complex</span><span class="p">)</span>
	 <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">z1</span> <span class="nv">z2</span><span class="p">)</span> <span class="p">(</span><span class="nf">tag</span> <span class="p">(</span><span class="nf">sub-complex</span> <span class="nv">z1</span> <span class="nv">z2</span><span class="p">))))</span>
    <span class="p">(</span><span class="nf">put</span> <span class="ss">'mul</span> <span class="o">'</span><span class="p">(</span><span class="nv">complex</span> <span class="nv">complex</span><span class="p">)</span>
	 <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">z1</span> <span class="nv">z2</span><span class="p">)</span> <span class="p">(</span><span class="nf">tag</span> <span class="p">(</span><span class="nf">mul-complex</span> <span class="nv">z1</span> <span class="nv">z2</span><span class="p">))))</span>
    <span class="p">(</span><span class="nf">put</span> <span class="ss">'div</span> <span class="o">'</span><span class="p">(</span><span class="nv">complex</span> <span class="nv">complex</span><span class="p">)</span>
	 <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">z1</span> <span class="nv">z2</span><span class="p">)</span> <span class="p">(</span><span class="nf">tag</span> <span class="p">(</span><span class="nf">div-complex</span> <span class="nv">z1</span> <span class="nv">z2</span><span class="p">))))</span>
    <span class="p">(</span><span class="nf">put</span> <span class="ss">'make-from-real-imag</span> <span class="ss">'complex</span>
	 <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span> <span class="nv">y</span><span class="p">)</span> <span class="p">(</span><span class="nf">tag</span> <span class="p">(</span><span class="nf">make-from-real-imag</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">))))</span>
    <span class="p">(</span><span class="nf">put</span> <span class="ss">'make-from-mag-ang</span> <span class="ss">'complex</span>
	 <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">r</span> <span class="nv">a</span><span class="p">)</span> <span class="p">(</span><span class="nf">tag</span> <span class="p">(</span><span class="nf">make-from-mag-ang</span> <span class="nv">r</span> <span class="nv">a</span><span class="p">))))</span>  
    <span class="ss">'done</span><span class="p">)</span>

  <span class="c1">;; rectangular-package for complex package</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">install-rectangular-package</span><span class="p">)</span>
    <span class="c1">;; internal procedures</span>
    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nb">real-part </span><span class="nv">z</span><span class="p">)</span> <span class="p">(</span><span class="nb">car </span><span class="nv">z</span><span class="p">))</span>
    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nb">imag-part </span><span class="nv">z</span><span class="p">)</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">z</span><span class="p">))</span>
    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-from-real-imag</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">)</span> <span class="p">(</span><span class="nb">cons </span><span class="nv">x</span> <span class="nv">y</span><span class="p">))</span>
    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nb">magnitude </span><span class="nv">z</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">sqr</span> <span class="p">(</span><span class="nf">add</span> <span class="p">(</span><span class="nf">square</span> <span class="p">(</span><span class="nb">real-part </span><span class="nv">z</span><span class="p">))</span>
		<span class="p">(</span><span class="nf">square</span> <span class="p">(</span><span class="nb">imag-part </span><span class="nv">z</span><span class="p">)))))</span>
    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nb">angle </span><span class="nv">z</span><span class="p">)</span>
      <span class="p">(</span><span class="nb">atan </span><span class="p">(</span><span class="nb">imag-part </span><span class="nv">z</span><span class="p">)</span> <span class="p">(</span><span class="nb">real-part </span><span class="nv">z</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-from-mag-ang</span> <span class="nv">r</span> <span class="nv">a</span><span class="p">)</span>
      <span class="p">(</span><span class="nb">cons </span><span class="p">(</span><span class="nf">mul</span> <span class="nv">r</span> <span class="p">(</span><span class="nf">cosine</span> <span class="nv">a</span><span class="p">))</span> <span class="p">(</span><span class="nf">mul</span> <span class="nv">r</span> <span class="p">(</span><span class="nf">sine</span> <span class="nv">a</span><span class="p">))))</span>

    <span class="c1">;; interface to the rest of the system</span>
    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">tag</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">attach-tag</span> <span class="ss">'rectangular</span> <span class="nv">x</span><span class="p">))</span>
    <span class="p">(</span><span class="nf">put</span> <span class="ss">'real-part</span> <span class="o">'</span><span class="p">(</span><span class="nv">rectangular</span><span class="p">)</span> <span class="nv">real-part</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">put</span> <span class="ss">'imag-part</span> <span class="o">'</span><span class="p">(</span><span class="nv">rectangular</span><span class="p">)</span> <span class="nv">imag-part</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">put</span> <span class="ss">'magnitude</span> <span class="o">'</span><span class="p">(</span><span class="nv">rectangular</span><span class="p">)</span> <span class="nv">magnitude</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">put</span> <span class="ss">'angle</span> <span class="o">'</span><span class="p">(</span><span class="nv">rectangular</span><span class="p">)</span> <span class="nv">angle</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">put</span> <span class="ss">'make-from-real-imag</span> <span class="ss">'rectangular</span>
	 <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span> <span class="nv">y</span><span class="p">)</span> <span class="p">(</span><span class="nf">tag</span> <span class="p">(</span><span class="nf">make-from-real-imag</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">))))</span>
    <span class="p">(</span><span class="nf">put</span> <span class="ss">'make-from-mag-ang</span> <span class="ss">'rectangular</span>
	 <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">r</span> <span class="nv">a</span><span class="p">)</span> <span class="p">(</span><span class="nf">tag</span> <span class="p">(</span><span class="nf">make-from-mag-ang</span> <span class="nv">r</span> <span class="nv">a</span><span class="p">))))</span>
    <span class="ss">'done</span><span class="p">)</span>

  <span class="c1">;; polar-package for complex package</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">install-polar-package</span><span class="p">)</span>
    <span class="c1">;; internal procedures</span>
    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nb">magnitude </span><span class="nv">z</span><span class="p">)</span> <span class="p">(</span><span class="nb">car </span><span class="nv">z</span><span class="p">))</span> 
    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nb">angle </span><span class="nv">z</span><span class="p">)</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">z</span><span class="p">))</span>
    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-from-mag-ang</span> <span class="nv">r</span> <span class="nv">a</span><span class="p">)</span> <span class="p">(</span><span class="nb">cons </span><span class="nv">r</span> <span class="nv">a</span><span class="p">))</span>
    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nb">real-part </span><span class="nv">z</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">mul</span> <span class="p">(</span><span class="nb">magnitude </span><span class="nv">z</span><span class="p">)</span> <span class="p">(</span><span class="nf">cosine</span> <span class="p">(</span><span class="nb">angle </span><span class="nv">z</span><span class="p">))))</span>
    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nb">imag-part </span><span class="nv">z</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">mul</span> <span class="p">(</span><span class="nb">magnitude </span><span class="nv">z</span><span class="p">)</span> <span class="p">(</span><span class="nf">sine</span> <span class="p">(</span><span class="nb">angle </span><span class="nv">z</span><span class="p">))))</span>
    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-from-real-imag</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">)</span>
      <span class="p">(</span><span class="nb">cons </span><span class="p">(</span><span class="nf">sqr</span> <span class="p">(</span><span class="nf">add</span> <span class="p">(</span><span class="nf">square</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">square</span> <span class="nv">y</span><span class="p">)))</span>
	    <span class="p">(</span><span class="nf">arctan</span> <span class="nv">y</span> <span class="nv">x</span><span class="p">)))</span>
    <span class="c1">;; interface to the rest of the system</span>
    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">tag</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">attach-tag</span> <span class="ss">'polar</span> <span class="nv">x</span><span class="p">))</span>
    <span class="p">(</span><span class="nf">put</span> <span class="ss">'real-part</span> <span class="o">'</span><span class="p">(</span><span class="nv">polar</span><span class="p">)</span> <span class="nv">real-part</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">put</span> <span class="ss">'imag-part</span> <span class="o">'</span><span class="p">(</span><span class="nv">polar</span><span class="p">)</span> <span class="nv">imag-part</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">put</span> <span class="ss">'magnitude</span> <span class="o">'</span><span class="p">(</span><span class="nv">polar</span><span class="p">)</span> <span class="nv">magnitude</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">put</span> <span class="ss">'angle</span> <span class="o">'</span><span class="p">(</span><span class="nv">polar</span><span class="p">)</span> <span class="nv">angle</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">put</span> <span class="ss">'make-from-real-imag</span> <span class="ss">'polar</span>
	 <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span> <span class="nv">y</span><span class="p">)</span> <span class="p">(</span><span class="nf">tag</span> <span class="p">(</span><span class="nf">make-from-real-imag</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">))))</span>
    <span class="p">(</span><span class="nf">put</span> <span class="ss">'make-from-mag-ang</span> <span class="ss">'polar</span>
	 <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">r</span> <span class="nv">a</span><span class="p">)</span> <span class="p">(</span><span class="nf">tag</span> <span class="p">(</span><span class="nf">make-from-mag-ang</span> <span class="nv">r</span> <span class="nv">a</span><span class="p">))))</span>
    <span class="ss">'done</span><span class="p">)</span>

  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nb">real-part </span><span class="nv">z</span><span class="p">)</span> <span class="p">(</span><span class="nf">apply-generic</span> <span class="ss">'real-part</span> <span class="nv">z</span><span class="p">))</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nb">imag-part </span><span class="nv">z</span><span class="p">)</span> <span class="p">(</span><span class="nf">apply-generic</span> <span class="ss">'imag-part</span> <span class="nv">z</span><span class="p">))</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nb">magnitude </span><span class="nv">z</span><span class="p">)</span> <span class="p">(</span><span class="nf">apply-generic</span> <span class="ss">'magnitude</span> <span class="nv">z</span><span class="p">))</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nb">angle </span><span class="nv">z</span><span class="p">)</span> <span class="p">(</span><span class="nf">apply-generic</span> <span class="ss">'angle</span> <span class="nv">z</span><span class="p">))</span>

  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-complex-from-real-imag</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">)</span>
    <span class="p">((</span><span class="nf">get</span> <span class="ss">'make-from-real-imag</span> <span class="ss">'complex</span><span class="p">)</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">))</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-complex-from-mag-ang</span> <span class="nv">r</span> <span class="nv">a</span><span class="p">)</span>
    <span class="p">((</span><span class="nf">get</span> <span class="ss">'make-from-mag-ang</span> <span class="ss">'complex</span><span class="p">)</span> <span class="nv">r</span> <span class="nv">a</span><span class="p">))</span>

  <span class="c1">;; follow ex 2.89 &amp; 2.90</span>
  <span class="c1">;; install common polynomial term package</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">install-poly-term-package</span><span class="p">)</span>
    <span class="c1">;; procedures kept same</span>
    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-term</span> <span class="nv">order</span> <span class="nv">coeff</span><span class="p">)</span> <span class="p">(</span><span class="nb">list </span><span class="nv">order</span> <span class="nv">coeff</span><span class="p">))</span>
    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">order</span> <span class="nv">term</span><span class="p">)</span> <span class="p">(</span><span class="nb">car </span><span class="nv">term</span><span class="p">))</span>
    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">coeff</span> <span class="nv">term</span><span class="p">)</span> <span class="p">(</span><span class="nb">cadr </span><span class="nv">term</span><span class="p">))</span>
    <span class="c1">;; tag</span>
    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">tag</span> <span class="nv">term</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">attach-tag</span> <span class="ss">'polynomial-term</span> <span class="nv">term</span><span class="p">))</span>
    <span class="c1">;; put</span>
    <span class="p">(</span><span class="nf">put</span> <span class="ss">'make</span> <span class="ss">'polynomial-term</span>
	 <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span> <span class="nv">y</span><span class="p">)</span> <span class="p">(</span><span class="nf">tag</span> <span class="p">(</span><span class="nf">make-term</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">))))</span>
    <span class="p">(</span><span class="nf">put</span> <span class="ss">'order</span> <span class="o">'</span><span class="p">(</span><span class="nv">polynomial-term</span><span class="p">)</span> <span class="nv">order</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">put</span> <span class="ss">'coeff</span> <span class="o">'</span><span class="p">(</span><span class="nv">polynomial-term</span><span class="p">)</span> <span class="nv">coeff</span><span class="p">)</span>
    <span class="ss">'done</span><span class="p">)</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-term</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">)</span>
    <span class="p">((</span><span class="nf">get</span> <span class="ss">'make</span> <span class="ss">'polynomial-term</span><span class="p">)</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">))</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">order</span> <span class="nv">x</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">apply-generic</span> <span class="ss">'order</span> <span class="nv">x</span><span class="p">))</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">coeff</span> <span class="nv">x</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">apply-generic</span> <span class="ss">'coeff</span> <span class="nv">x</span><span class="p">))</span>

  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">install-dense-terms-package</span><span class="p">)</span>
    <span class="c1">;; procedures about dense terms...</span>
    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">tag</span> <span class="nv">terms</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">attach-tag</span> <span class="ss">'polynomial-dense</span> <span class="nv">terms</span><span class="p">))</span>
    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">first-term-d</span> <span class="nv">term-list</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">make-term</span> <span class="p">(</span><span class="nb">- </span><span class="p">(</span><span class="nb">length </span><span class="nv">term-list</span><span class="p">)</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="nb">car </span><span class="nv">term-list</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">rest-terms-d</span> <span class="nv">term-list</span><span class="p">)</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">term-list</span><span class="p">))</span>
    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">empty-termlist-d?</span> <span class="nv">term-list</span><span class="p">)</span> <span class="p">(</span><span class="nb">null? </span><span class="nv">term-list</span><span class="p">))</span>
    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">adjoin-term-d</span> <span class="nv">term</span> <span class="nv">term-list</span><span class="p">)</span>
      <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nf">=zero?</span> <span class="p">(</span><span class="nf">coeff</span> <span class="nv">term</span><span class="p">))</span> <span class="nv">term-list</span><span class="p">)</span>
	    <span class="p">((</span><span class="nf">equ?</span> <span class="p">(</span><span class="nf">order</span> <span class="nv">term</span><span class="p">)</span> <span class="p">(</span><span class="nb">length </span><span class="nv">term-list</span><span class="p">))</span>
	     <span class="p">(</span><span class="nb">cons </span><span class="p">(</span><span class="nf">coeff</span> <span class="nv">term</span><span class="p">)</span> <span class="nv">term-list</span><span class="p">))</span>
	    <span class="p">((</span><span class="nb">&gt; </span><span class="p">(</span><span class="nf">order</span> <span class="nv">term</span><span class="p">)</span> <span class="p">(</span><span class="nb">length </span><span class="nv">term-list</span><span class="p">))</span>
	     <span class="p">(</span><span class="nf">adjoin-term-d</span> <span class="nv">term</span> <span class="p">(</span><span class="nb">cons </span><span class="mi">0</span> <span class="nv">term-list</span><span class="p">)))))</span> <span class="c1">;</span>
    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">negative-d</span> <span class="nv">terms</span><span class="p">)</span>
      <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">empty-termlist-d?</span> <span class="nv">terms</span><span class="p">)</span>
	  <span class="nv">terms</span>
	  <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">first</span> <span class="p">(</span><span class="nb">car </span><span class="nv">terms</span><span class="p">)))</span>
	    <span class="p">(</span><span class="nb">cons </span><span class="p">(</span><span class="nf">negative</span> <span class="nv">first</span><span class="p">)</span>
		  <span class="p">(</span><span class="nf">negative-d</span> <span class="p">(</span><span class="nf">rest-terms-d</span> <span class="nv">terms</span><span class="p">))))))</span>
    <span class="c1">;; follow ex 2.96</span>
    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">coeffs-d</span> <span class="nv">terms</span><span class="p">)</span>
      <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nf">empty-termlist-d?</span> <span class="nv">terms</span><span class="p">)</span> <span class="o">'</span><span class="p">())</span>
	    <span class="p">((</span><span class="nf">equ?</span> <span class="p">(</span><span class="nb">car </span><span class="nv">terms</span><span class="p">)</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nf">coeffs-d</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">terms</span><span class="p">)))</span>
	    <span class="p">(</span><span class="k">else </span><span class="p">(</span><span class="nb">cons </span><span class="p">(</span><span class="nb">car </span><span class="nv">terms</span><span class="p">)</span> <span class="p">(</span><span class="nf">coeffs-d</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">terms</span><span class="p">))))))</span>
    <span class="p">(</span><span class="nf">put</span> <span class="ss">'coeffs</span> <span class="o">'</span><span class="p">(</span><span class="nv">polynomial-dense</span><span class="p">)</span> <span class="nv">coeffs-d</span><span class="p">)</span>
    <span class="c1">;; 2.96</span>
    <span class="p">(</span><span class="nf">put</span> <span class="ss">'negative</span> <span class="o">'</span><span class="p">(</span><span class="nv">polynomial-dense</span><span class="p">)</span>
	 <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">tag</span> <span class="p">(</span><span class="nf">negative-d</span> <span class="nv">x</span><span class="p">))))</span>
    <span class="p">(</span><span class="nf">put</span> <span class="ss">'first-term</span> <span class="o">'</span><span class="p">(</span><span class="nv">polynomial-dense</span><span class="p">)</span>
	 <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">first-term-d</span> <span class="nv">x</span><span class="p">)))</span>
    <span class="p">(</span><span class="nf">put</span> <span class="ss">'empty-termlist?</span> <span class="o">'</span><span class="p">(</span><span class="nv">polynomial-dense</span><span class="p">)</span> <span class="nv">empty-termlist-d?</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">put</span> <span class="ss">'rest-terms</span> <span class="o">'</span><span class="p">(</span><span class="nv">polynomial-dense</span><span class="p">)</span>
	 <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">tag</span> <span class="p">(</span><span class="nf">rest-terms-d</span> <span class="nv">x</span><span class="p">))))</span>
    <span class="p">(</span><span class="nf">put</span> <span class="ss">'adjoin-term</span> <span class="ss">'polynomial-dense</span>
	 <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span> <span class="nv">y</span><span class="p">)</span> <span class="p">(</span><span class="nf">tag</span> <span class="p">(</span><span class="nf">adjoin-term-d</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">))))</span>
    <span class="p">(</span><span class="nf">put</span> <span class="ss">'make</span> <span class="ss">'polynomial-dense</span> <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">t</span><span class="p">)</span> <span class="p">(</span><span class="nf">tag</span> <span class="nv">t</span><span class="p">)))</span>
    <span class="ss">'done</span><span class="p">)</span>

  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-dense-terms</span> <span class="nv">terms</span><span class="p">)</span>
    <span class="p">((</span><span class="nf">get</span> <span class="ss">'make</span> <span class="ss">'polynomial-dense</span><span class="p">)</span> <span class="nv">terms</span><span class="p">))</span>

  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">install-sparse-terms-package</span><span class="p">)</span>
    <span class="c1">;; procedures about sparse terms...</span>
    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">tag</span> <span class="nv">terms</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">attach-tag</span> <span class="ss">'polynomial-sparse</span> <span class="nv">terms</span><span class="p">))</span>
    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">first-term-s</span> <span class="nv">term-list</span><span class="p">)</span> <span class="p">(</span><span class="nb">car </span><span class="nv">term-list</span><span class="p">))</span>
    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">adjoin-term-s</span> <span class="nv">term</span> <span class="nv">term-list</span><span class="p">)</span>
      <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">=zero?</span> <span class="p">(</span><span class="nf">coeff</span> <span class="nv">term</span><span class="p">))</span>
	  <span class="nv">term-list</span>
	  <span class="p">(</span><span class="nb">cons </span><span class="nv">term</span> <span class="nv">term-list</span><span class="p">)))</span>
    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">rest-terms-s</span> <span class="nv">term-list</span><span class="p">)</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">term-list</span><span class="p">))</span>
    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">empty-termlist-s?</span> <span class="nv">term-list</span><span class="p">)</span> <span class="p">(</span><span class="nb">null? </span><span class="nv">term-list</span><span class="p">))</span>
    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">negative-s</span> <span class="nv">terms</span><span class="p">)</span>
      <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">empty-termlist-s?</span> <span class="nv">terms</span><span class="p">)</span>
	  <span class="nv">terms</span>
	  <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">first</span> <span class="p">(</span><span class="nf">first-term-s</span> <span class="nv">terms</span><span class="p">)))</span>
	    <span class="p">(</span><span class="nf">adjoin-term-s</span> <span class="p">(</span><span class="nf">make-term</span>
			    <span class="p">(</span><span class="nf">order</span> <span class="nv">first</span><span class="p">)</span>
			    <span class="p">(</span><span class="nf">negative</span> <span class="p">(</span><span class="nf">coeff</span> <span class="nv">first</span><span class="p">)))</span>
			   <span class="p">(</span><span class="nf">negative-s</span> <span class="p">(</span><span class="nf">rest-terms-s</span> <span class="nv">terms</span><span class="p">))))))</span>
    <span class="c1">;; follow ex 2.96</span>
    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">coeffs-s</span> <span class="nv">terms</span><span class="p">)</span>
      <span class="p">(</span><span class="nb">map </span><span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">t</span><span class="p">)</span> <span class="p">(</span><span class="nf">coeff</span> <span class="nv">t</span><span class="p">))</span> <span class="nv">terms</span><span class="p">))</span>
    <span class="p">(</span><span class="nf">put</span> <span class="ss">'coeffs</span> <span class="o">'</span><span class="p">(</span><span class="nv">polynomial-sparse</span><span class="p">)</span> <span class="nv">coeffs-s</span><span class="p">)</span>
    <span class="c1">;; 2.96</span>
    <span class="p">(</span><span class="nf">put</span> <span class="ss">'negative</span> <span class="o">'</span><span class="p">(</span><span class="nv">polynomial-sparse</span><span class="p">)</span>
	 <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">tag</span> <span class="p">(</span><span class="nf">negative-s</span> <span class="nv">x</span><span class="p">))))</span>
    <span class="p">(</span><span class="nf">put</span> <span class="ss">'first-term</span> <span class="o">'</span><span class="p">(</span><span class="nv">polynomial-sparse</span><span class="p">)</span>
	 <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">first-term-s</span> <span class="nv">x</span><span class="p">)))</span>
    <span class="p">(</span><span class="nf">put</span> <span class="ss">'empty-termlist?</span> <span class="o">'</span><span class="p">(</span><span class="nv">polynomial-sparse</span><span class="p">)</span> <span class="nv">empty-termlist-s?</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">put</span> <span class="ss">'rest-terms</span> <span class="o">'</span><span class="p">(</span><span class="nv">polynomial-sparse</span><span class="p">)</span>
	 <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">tag</span> <span class="p">(</span><span class="nf">rest-terms-s</span> <span class="nv">x</span><span class="p">))))</span>
    <span class="p">(</span><span class="nf">put</span> <span class="ss">'adjoin-term</span> <span class="ss">'polynomial-sparse</span>
	 <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span> <span class="nv">y</span><span class="p">)</span> <span class="p">(</span><span class="nf">tag</span> <span class="p">(</span><span class="nf">adjoin-term-s</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">))))</span>
    <span class="p">(</span><span class="nf">put</span> <span class="ss">'make</span> <span class="ss">'polynomial-sparse</span> <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">t</span><span class="p">)</span> <span class="p">(</span><span class="nf">tag</span> <span class="nv">t</span><span class="p">)))</span>
    <span class="ss">'done</span><span class="p">)</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-sparse-terms</span> <span class="nv">terms</span><span class="p">)</span>
    <span class="p">((</span><span class="nf">get</span> <span class="ss">'make</span> <span class="ss">'polynomial-sparse</span><span class="p">)</span> <span class="nv">terms</span><span class="p">))</span>

  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">first-term</span> <span class="nv">x</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">apply-generic</span> <span class="ss">'first-term</span> <span class="nv">x</span><span class="p">))</span>

  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">adjoin-term</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">)</span>
    <span class="p">((</span><span class="nf">get</span> <span class="ss">'adjoin-term</span> <span class="p">(</span><span class="nf">type-tag</span> <span class="nv">y</span><span class="p">))</span> <span class="nv">x</span> <span class="p">(</span><span class="nf">contents</span> <span class="nv">y</span><span class="p">)))</span>

  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">negative</span> <span class="nv">x</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">apply-generic</span> <span class="ss">'negative</span> <span class="nv">x</span><span class="p">))</span>

  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">empty-termlist?</span> <span class="nv">x</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">apply-generic</span> <span class="ss">'empty-termlist?</span> <span class="nv">x</span><span class="p">))</span>

  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">rest-terms</span> <span class="nv">x</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">apply-generic</span> <span class="ss">'rest-terms</span> <span class="nv">x</span><span class="p">))</span>

  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-terms</span> <span class="nv">t</span> <span class="nv">terms</span><span class="p">)</span>
    <span class="p">((</span><span class="nf">get</span> <span class="ss">'make</span> <span class="nv">t</span><span class="p">)</span>
     <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">equal? </span><span class="nv">t</span> <span class="ss">'polynomial-sparse</span><span class="p">)</span>
	 <span class="nv">terms</span>
	 <span class="p">(</span><span class="nb">map </span><span class="nv">coeff</span> <span class="nv">terms</span><span class="p">))))</span>
  <span class="c1">;; 2.89 &amp; 2.90</span>
  <span class="c1">;; follow 2.96</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">coeffs</span> <span class="nv">t</span><span class="p">)</span>
    <span class="p">(</span><span class="nf">apply-generic</span> <span class="ss">'coeffs</span> <span class="nv">t</span><span class="p">))</span>
  <span class="c1">;; 2.96</span>

  <span class="c1">;; polynomial-package</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">install-polynomial-package</span><span class="p">)</span>
    <span class="c1">;; internal procedures</span>
    <span class="c1">;; representation of poly</span>
    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-poly</span> <span class="nv">variable</span> <span class="nv">term-list</span><span class="p">)</span>
      <span class="p">(</span><span class="nb">cons </span><span class="nv">variable</span> <span class="nv">term-list</span><span class="p">))</span>
    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">variable</span> <span class="nv">p</span><span class="p">)</span> <span class="p">(</span><span class="nb">car </span><span class="nv">p</span><span class="p">))</span>
    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">term-list</span> <span class="nv">p</span><span class="p">)</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">p</span><span class="p">))</span>
    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">variable?</span> <span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">symbol? </span><span class="nv">x</span><span class="p">))</span>
    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">same-variable?</span> <span class="nv">v1</span> <span class="nv">v2</span><span class="p">)</span>
      <span class="p">(</span><span class="k">and </span><span class="p">(</span><span class="nf">variable?</span> <span class="nv">v1</span><span class="p">)</span> <span class="p">(</span><span class="nf">variable?</span> <span class="nv">v2</span><span class="p">)</span> <span class="p">(</span><span class="nb">eq? </span><span class="nv">v1</span> <span class="nv">v2</span><span class="p">)))</span>

    <span class="c1">;; terms</span>
    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">add-terms</span> <span class="nv">L1</span> <span class="nv">L2</span><span class="p">)</span>
      <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nf">empty-termlist?</span> <span class="nv">L1</span><span class="p">)</span> <span class="nv">L2</span><span class="p">)</span>
	    <span class="p">((</span><span class="nf">empty-termlist?</span> <span class="nv">L2</span><span class="p">)</span> <span class="nv">L1</span><span class="p">)</span>
	    <span class="p">(</span><span class="nf">else</span>
	     <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">t1</span> <span class="p">(</span><span class="nf">first-term</span> <span class="nv">L1</span><span class="p">))</span> <span class="p">(</span><span class="nf">t2</span> <span class="p">(</span><span class="nf">first-term</span> <span class="nv">L2</span><span class="p">)))</span>
	       <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nb">&gt; </span><span class="p">(</span><span class="nf">order</span> <span class="nv">t1</span><span class="p">)</span> <span class="p">(</span><span class="nf">order</span> <span class="nv">t2</span><span class="p">))</span>
		      <span class="p">(</span><span class="nf">adjoin-term</span>
		       <span class="nv">t1</span> <span class="p">(</span><span class="nf">add-terms</span> <span class="p">(</span><span class="nf">rest-terms</span> <span class="nv">L1</span><span class="p">)</span> <span class="nv">L2</span><span class="p">)))</span>
		     <span class="p">((</span><span class="nb">&lt; </span><span class="p">(</span><span class="nf">order</span> <span class="nv">t1</span><span class="p">)</span> <span class="p">(</span><span class="nf">order</span> <span class="nv">t2</span><span class="p">))</span>
		      <span class="p">(</span><span class="nf">adjoin-term</span> <span class="nv">t2</span> <span class="p">(</span><span class="nf">add-terms</span> <span class="nv">L1</span> <span class="p">(</span><span class="nf">rest-terms</span> <span class="nv">L2</span><span class="p">))))</span>
		     <span class="p">(</span><span class="nf">else</span>
		      <span class="p">(</span><span class="nf">adjoin-term</span>
		       <span class="p">(</span><span class="nf">make-term</span> <span class="p">(</span><span class="nf">order</span> <span class="nv">t1</span><span class="p">)</span>
				  <span class="p">(</span><span class="nf">add</span> <span class="p">(</span><span class="nf">coeff</span> <span class="nv">t1</span><span class="p">)</span> <span class="p">(</span><span class="nf">coeff</span> <span class="nv">t2</span><span class="p">)))</span>
		       <span class="p">(</span><span class="nf">add-terms</span> <span class="p">(</span><span class="nf">rest-terms</span> <span class="nv">L1</span><span class="p">)</span>
				  <span class="p">(</span><span class="nf">rest-terms</span> <span class="nv">L2</span><span class="p">)))))))))</span>
    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">mul-terms</span> <span class="nv">L1</span> <span class="nv">L2</span><span class="p">)</span>
      <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">empty-termlist?</span> <span class="nv">L1</span><span class="p">)</span>
	  <span class="nv">L1</span>
	  <span class="p">(</span><span class="nf">add-terms</span> <span class="p">(</span><span class="nf">mul-term-by-all-terms</span> <span class="p">(</span><span class="nf">first-term</span> <span class="nv">L1</span><span class="p">)</span> <span class="nv">L2</span><span class="p">)</span>
		     <span class="p">(</span><span class="nf">mul-terms</span> <span class="p">(</span><span class="nf">rest-terms</span> <span class="nv">L1</span><span class="p">)</span> <span class="nv">L2</span><span class="p">))))</span>
    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">mul-term-by-all-terms</span> <span class="nv">t1</span> <span class="nv">L</span><span class="p">)</span>
      <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">empty-termlist?</span> <span class="nv">L</span><span class="p">)</span>
	  <span class="nv">L</span>
	  <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">t2</span> <span class="p">(</span><span class="nf">first-term</span> <span class="nv">L</span><span class="p">)))</span>
	    <span class="p">(</span><span class="nf">adjoin-term</span>
	     <span class="p">(</span><span class="nf">make-term</span> <span class="p">(</span><span class="nf">add</span> <span class="p">(</span><span class="nf">order</span> <span class="nv">t1</span><span class="p">)</span> <span class="p">(</span><span class="nf">order</span> <span class="nv">t2</span><span class="p">))</span>
			<span class="p">(</span><span class="nf">mul</span> <span class="p">(</span><span class="nf">coeff</span> <span class="nv">t1</span><span class="p">)</span> <span class="p">(</span><span class="nf">coeff</span> <span class="nv">t2</span><span class="p">)))</span>
	     <span class="p">(</span><span class="nf">mul-term-by-all-terms</span> <span class="nv">t1</span> <span class="p">(</span><span class="nf">rest-terms</span> <span class="nv">L</span><span class="p">))))))</span>
    <span class="c1">;; follow ex 2.91</span>
    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">div-terms</span> <span class="nv">L1</span> <span class="nv">L2</span><span class="p">)</span>
      <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">empty-termlist?</span> <span class="nv">L1</span><span class="p">)</span>
	  <span class="p">(</span><span class="nb">list </span><span class="nv">L1</span> <span class="nv">L1</span><span class="p">)</span>
	  <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">t1</span> <span class="p">(</span><span class="nf">first-term</span> <span class="nv">L1</span><span class="p">))</span>
		<span class="p">(</span><span class="nf">t2</span> <span class="p">(</span><span class="nf">first-term</span> <span class="nv">L2</span><span class="p">)))</span>
	    <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">&gt; </span><span class="p">(</span><span class="nf">order</span> <span class="nv">t2</span><span class="p">)</span> <span class="p">(</span><span class="nf">order</span> <span class="nv">t1</span><span class="p">))</span>
		<span class="p">(</span><span class="nb">list </span><span class="p">(</span><span class="nf">make-terms</span> <span class="p">(</span><span class="nf">type-tag</span> <span class="nv">L1</span><span class="p">)</span> <span class="o">'</span><span class="p">())</span> <span class="nv">L1</span><span class="p">)</span>
		<span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">new-c</span> <span class="p">(</span><span class="nf">div</span> <span class="p">(</span><span class="nf">coeff</span> <span class="nv">t1</span><span class="p">)</span> <span class="p">(</span><span class="nf">coeff</span> <span class="nv">t2</span><span class="p">)))</span>
		      <span class="p">(</span><span class="nf">new-o</span> <span class="p">(</span><span class="nf">sub</span> <span class="p">(</span><span class="nf">order</span> <span class="nv">t1</span><span class="p">)</span> <span class="p">(</span><span class="nf">order</span> <span class="nv">t2</span><span class="p">))))</span>
		  <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">rest-of-result</span>
			 <span class="p">(</span><span class="nf">div-terms</span>
			  <span class="p">(</span><span class="nf">add-terms</span> <span class="nv">L1</span>
				     <span class="p">(</span><span class="nf">negative</span> <span class="p">(</span><span class="nf">mul-term-by-all-terms</span>
						<span class="p">(</span><span class="nf">make-term</span> <span class="nv">new-o</span> <span class="nv">new-c</span><span class="p">)</span>
						<span class="nv">L2</span><span class="p">)))</span>
			  <span class="nv">L2</span><span class="p">)))</span>
		    <span class="p">(</span><span class="nb">list </span><span class="p">(</span><span class="nf">adjoin-term</span> <span class="p">(</span><span class="nf">make-term</span> <span class="nv">new-o</span> <span class="nv">new-c</span><span class="p">)</span>
				       <span class="p">(</span><span class="nb">car </span><span class="nv">rest-of-result</span><span class="p">))</span>
			  <span class="p">(</span><span class="nb">cadr </span><span class="nv">rest-of-result</span><span class="p">))))))))</span>
    <span class="c1">;; follow ex 2.96</span>
    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">pseudoremainder-terms</span> <span class="nv">a</span> <span class="nv">b</span><span class="p">)</span>
      <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">f1</span> <span class="p">(</span><span class="nf">first-term</span> <span class="nv">a</span><span class="p">))</span>
	    <span class="p">(</span><span class="nf">f2</span> <span class="p">(</span><span class="nf">first-term</span> <span class="nv">b</span><span class="p">)))</span>
	<span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">o1</span> <span class="p">(</span><span class="nf">order</span> <span class="nv">f1</span><span class="p">))</span>
	      <span class="p">(</span><span class="nf">o2</span> <span class="p">(</span><span class="nf">order</span> <span class="nv">f2</span><span class="p">))</span>
	      <span class="p">(</span><span class="nf">c</span> <span class="p">(</span><span class="nf">coeff</span> <span class="nv">f2</span><span class="p">)))</span>
	  <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">constant</span> <span class="p">(</span><span class="nb">exp </span><span class="nv">c</span> <span class="p">(</span><span class="nb">+ </span><span class="mi">1</span> <span class="nv">o1</span> <span class="p">(</span><span class="nb">- </span><span class="nv">o2</span><span class="p">)))))</span>
	    <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">term</span> <span class="p">(</span><span class="nf">make-term</span> <span class="mi">0</span>
				   <span class="nv">constant</span><span class="p">)))</span>
	      <span class="p">(</span><span class="nb">cadr </span><span class="p">(</span><span class="nf">div-terms</span>
		     <span class="p">(</span><span class="nf">mul-term-by-all-terms</span> <span class="nv">term</span> <span class="nv">a</span><span class="p">)</span>
		     <span class="nv">b</span><span class="p">)))))))</span>
    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">gcd-terms-coeff</span> <span class="nv">l</span><span class="p">)</span>
      <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">recursive</span> <span class="nv">l</span><span class="p">)</span>
	<span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nb">= </span><span class="mi">2</span> <span class="p">(</span><span class="nb">length </span><span class="nv">l</span><span class="p">))</span>
	       <span class="p">(</span><span class="nf">greatest-common-divisor</span> <span class="p">(</span><span class="nb">car </span><span class="nv">l</span><span class="p">)</span> <span class="p">(</span><span class="nb">cadr </span><span class="nv">l</span><span class="p">)))</span>
	      <span class="p">((</span><span class="nb">= </span><span class="mi">1</span> <span class="p">(</span><span class="nb">length </span><span class="nv">l</span><span class="p">))</span> <span class="p">(</span><span class="nb">car </span><span class="nv">l</span><span class="p">))</span>
	      <span class="p">((</span><span class="nb">null? </span><span class="nv">l</span><span class="p">)</span> <span class="mi">0</span><span class="p">)</span>
	      <span class="p">(</span><span class="k">else </span><span class="p">(</span><span class="nf">greatest-common-divisor</span>
		     <span class="p">(</span><span class="nb">car </span><span class="nv">l</span><span class="p">)</span>
		     <span class="p">(</span><span class="nf">recursive</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">l</span><span class="p">))))))</span>
      <span class="p">(</span><span class="nf">recursive</span> <span class="nv">l</span><span class="p">))</span>
    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">gcd-terms</span> <span class="nv">a</span> <span class="nv">b</span><span class="p">)</span>
      <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">empty-termlist?</span> <span class="nv">b</span><span class="p">)</span>
	  <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">coeffs-gcd</span> <span class="p">(</span><span class="nf">gcd-terms-coeff</span> <span class="p">(</span><span class="nf">coeffs</span> <span class="nv">a</span><span class="p">))))</span>
	    <span class="p">(</span><span class="nb">car </span><span class="p">(</span><span class="nf">div-terms</span>
		  <span class="nv">a</span>
		  <span class="p">(</span><span class="nf">make-terms</span> <span class="p">(</span><span class="nf">type-tag</span> <span class="nv">a</span><span class="p">)</span>
			      <span class="p">(</span><span class="nb">list </span><span class="p">(</span><span class="nf">make-term</span> <span class="mi">0</span> <span class="nv">coeffs-gcd</span><span class="p">))))))</span>
	  <span class="p">(</span><span class="nf">gcd-terms</span> <span class="nv">b</span> <span class="p">(</span><span class="nf">pseudoremainder-terms</span> <span class="nv">a</span> <span class="nv">b</span><span class="p">))))</span>
    <span class="c1">;; 2.96</span>

    <span class="c1">;; follow 2.97</span>
    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">reduce-terms</span> <span class="nv">n</span> <span class="nv">d</span><span class="p">)</span>
      <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">compute-constant</span> <span class="nv">a</span> <span class="nv">b</span> <span class="nv">c</span><span class="p">)</span>
	<span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">af</span> <span class="p">(</span><span class="nf">first-term</span> <span class="nv">a</span><span class="p">))</span>
	      <span class="p">(</span><span class="nf">bf</span> <span class="p">(</span><span class="nf">first-term</span> <span class="nv">b</span><span class="p">))</span>
	      <span class="p">(</span><span class="nf">cf</span> <span class="p">(</span><span class="nf">first-term</span> <span class="nv">c</span><span class="p">)))</span>
	  <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">c</span> <span class="p">(</span><span class="nf">coeff</span> <span class="nv">af</span><span class="p">))</span>
		<span class="p">(</span><span class="nf">o1</span> <span class="p">(</span><span class="nb">max </span><span class="p">(</span><span class="nf">order</span> <span class="nv">bf</span><span class="p">)</span> <span class="p">(</span><span class="nf">order</span> <span class="nv">cf</span><span class="p">)))</span>
		<span class="p">(</span><span class="nf">o2</span> <span class="p">(</span><span class="nf">order</span> <span class="nv">af</span><span class="p">)))</span>
	    <span class="p">(</span><span class="nb">exp </span><span class="nv">c</span> <span class="p">(</span><span class="nb">+ </span><span class="mi">1</span> <span class="nv">o1</span> <span class="p">(</span><span class="nb">- </span><span class="nv">o2</span><span class="p">))))))</span>
      <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">simplify</span> <span class="nv">a</span> <span class="nv">b</span><span class="p">)</span>
	<span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">g</span> <span class="p">(</span><span class="nf">gcd-terms-coeff</span> <span class="p">(</span><span class="nb">append </span><span class="p">(</span><span class="nf">coeffs</span> <span class="nv">a</span><span class="p">)</span> <span class="p">(</span><span class="nf">coeffs</span> <span class="nv">b</span><span class="p">)))))</span>
	  <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">divider</span> <span class="p">(</span><span class="nf">make-terms</span> <span class="p">(</span><span class="nf">type-tag</span> <span class="nv">a</span><span class="p">)</span> <span class="p">(</span><span class="nb">list </span><span class="p">(</span><span class="nf">make-term</span> <span class="mi">0</span> <span class="nv">g</span><span class="p">)))))</span>
	    <span class="p">(</span><span class="nb">list </span><span class="p">(</span><span class="nb">car </span><span class="p">(</span><span class="nf">div-terms</span> <span class="nv">a</span> <span class="nv">divider</span><span class="p">))</span> <span class="p">(</span><span class="nb">car </span><span class="p">(</span><span class="nf">div-terms</span> <span class="nv">b</span> <span class="nv">divider</span><span class="p">))))))</span>
      <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">g</span> <span class="p">(</span><span class="nf">gcd-terms</span> <span class="nv">n</span> <span class="nv">d</span><span class="p">)))</span>
	<span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">constant</span> <span class="p">(</span><span class="nf">compute-constant</span> <span class="nv">g</span> <span class="nv">n</span> <span class="nv">d</span><span class="p">)))</span>
	  <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">mn</span> <span class="p">(</span><span class="nf">mul-term-by-all-terms</span> <span class="p">(</span><span class="nf">make-term</span> <span class="mi">0</span> <span class="nv">constant</span><span class="p">)</span> <span class="nv">n</span><span class="p">))</span>
		<span class="p">(</span><span class="nf">md</span> <span class="p">(</span><span class="nf">mul-term-by-all-terms</span> <span class="p">(</span><span class="nf">make-term</span> <span class="mi">0</span> <span class="nv">constant</span><span class="p">)</span> <span class="nv">d</span><span class="p">)))</span>
	    <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">gn</span> <span class="p">(</span><span class="nb">car </span><span class="p">(</span><span class="nf">div-terms</span> <span class="nv">mn</span> <span class="nv">g</span><span class="p">)))</span>
		  <span class="p">(</span><span class="nf">gd</span> <span class="p">(</span><span class="nb">car </span><span class="p">(</span><span class="nf">div-terms</span> <span class="nv">md</span> <span class="nv">g</span><span class="p">))))</span>
	      <span class="p">(</span><span class="nf">simplify</span> <span class="nv">gn</span> <span class="nv">gd</span><span class="p">))))))</span>	
    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">reduce-poly</span> <span class="nv">p1</span> <span class="nv">p2</span><span class="p">)</span>
      <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">same-variable?</span> <span class="p">(</span><span class="nf">variable</span> <span class="nv">p1</span><span class="p">)</span> <span class="p">(</span><span class="nf">variable</span> <span class="nv">p2</span><span class="p">))</span>
	  <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">t1</span> <span class="p">(</span><span class="nf">term-list</span> <span class="nv">p1</span><span class="p">))</span>
		<span class="p">(</span><span class="nf">t2</span> <span class="p">(</span><span class="nf">term-list</span> <span class="nv">p2</span><span class="p">)))</span>
	    <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">result</span> <span class="p">(</span><span class="nf">reduce-terms</span> <span class="nv">t1</span> <span class="nv">t2</span><span class="p">)))</span>
	      <span class="p">(</span><span class="nb">list </span><span class="p">(</span><span class="nf">make-poly</span> <span class="p">(</span><span class="nf">variable</span> <span class="nv">p1</span><span class="p">)</span> <span class="p">(</span><span class="nb">car </span><span class="nv">result</span><span class="p">))</span>
		    <span class="p">(</span><span class="nf">make-poly</span> <span class="p">(</span><span class="nf">variable</span> <span class="nv">p1</span><span class="p">)</span> <span class="p">(</span><span class="nb">cadr </span><span class="nv">result</span><span class="p">)))))</span>
	  <span class="p">(</span><span class="nf">error</span> <span class="s">"Polys not in same variable -- REDUCE-POLY"</span>
		 <span class="p">(</span><span class="nb">list </span><span class="nv">p1</span> <span class="nv">p2</span><span class="p">))))</span>
    <span class="p">(</span><span class="nf">put</span> <span class="ss">'reduce</span> <span class="o">'</span><span class="p">(</span><span class="nv">polynomial</span> <span class="nv">polynomial</span><span class="p">)</span>
	 <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">n</span> <span class="nv">d</span><span class="p">)</span> <span class="p">(</span><span class="nb">map </span><span class="nv">tag</span> <span class="p">(</span><span class="nf">reduce-poly</span> <span class="nv">n</span> <span class="nv">d</span><span class="p">))))</span>
    <span class="c1">;; 2.97</span>

    <span class="c1">;; 2.91</span>
    <span class="c1">;; follow ex 2.87</span>
    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">=zero?-p</span> <span class="nv">p</span><span class="p">)</span>
      <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">recursive</span> <span class="nv">terms</span><span class="p">)</span>
	<span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">empty-termlist?</span> <span class="nv">terms</span><span class="p">)</span>
	    <span class="no">#t</span>
	    <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">first</span> <span class="p">(</span><span class="nf">first-term</span> <span class="nv">terms</span><span class="p">))</span>
		  <span class="p">(</span><span class="nf">rest</span> <span class="p">(</span><span class="nf">rest-terms</span> <span class="nv">terms</span><span class="p">)))</span>
	      <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">=zero?</span> <span class="p">(</span><span class="nf">coeff</span> <span class="nv">first</span><span class="p">))</span>
		  <span class="p">(</span><span class="nf">recursive</span> <span class="nv">rest</span><span class="p">)</span>
		  <span class="no">#f</span><span class="p">))))</span>
      <span class="p">(</span><span class="nf">recursive</span> <span class="p">(</span><span class="nf">term-list</span> <span class="nv">p</span><span class="p">)))</span>
    <span class="p">(</span><span class="nf">put</span> <span class="ss">'=zero?</span> <span class="o">'</span><span class="p">(</span><span class="nv">polynomial</span><span class="p">)</span> <span class="nv">=zero?-p</span><span class="p">)</span>
    <span class="c1">;; 2.87</span>

    <span class="c1">;; poly</span>
    <span class="c1">;; follow 2.88</span>
    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">negative-poly</span> <span class="nv">n</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">make-poly</span> <span class="p">(</span><span class="nf">variable</span> <span class="nv">n</span><span class="p">)</span> <span class="p">(</span><span class="nf">negative</span> <span class="p">(</span><span class="nf">term-list</span> <span class="nv">n</span><span class="p">))))</span>
    <span class="p">(</span><span class="nf">put</span> <span class="ss">'negative</span> <span class="o">'</span><span class="p">(</span><span class="nv">polynomial</span><span class="p">)</span>
	 <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">tag</span> <span class="p">(</span><span class="nf">negative-poly</span> <span class="nv">x</span><span class="p">))))</span>
    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">sub-poly</span> <span class="nv">p1</span> <span class="nv">p2</span><span class="p">)</span>
      <span class="p">(</span><span class="nf">add-poly</span> <span class="nv">p1</span> <span class="p">(</span><span class="nf">negative-poly</span> <span class="nv">p2</span><span class="p">)))</span>
    <span class="p">(</span><span class="nf">put</span> <span class="ss">'sub</span> <span class="o">'</span><span class="p">(</span><span class="nv">polynomial</span> <span class="nv">polynomial</span><span class="p">)</span>
	 <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span> <span class="nv">y</span><span class="p">)</span> <span class="p">(</span><span class="nf">tag</span> <span class="p">(</span><span class="nf">sub-poly</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">))))</span>
    <span class="c1">;; 2.88</span>
    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">add-poly</span> <span class="nv">p1</span> <span class="nv">p2</span><span class="p">)</span>
      <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">same-variable?</span> <span class="p">(</span><span class="nf">variable</span> <span class="nv">p1</span><span class="p">)</span> <span class="p">(</span><span class="nf">variable</span> <span class="nv">p2</span><span class="p">))</span>
	  <span class="p">(</span><span class="nf">make-poly</span> <span class="p">(</span><span class="nf">variable</span> <span class="nv">p1</span><span class="p">)</span>
		     <span class="p">(</span><span class="nf">add-terms</span> <span class="p">(</span><span class="nf">term-list</span> <span class="nv">p1</span><span class="p">)</span>
				<span class="p">(</span><span class="nf">term-list</span> <span class="nv">p2</span><span class="p">)))</span>
	  <span class="p">(</span><span class="nf">error</span> <span class="s">"Polys not in same var -- ADD-POLY"</span>
		 <span class="p">(</span><span class="nb">list </span><span class="nv">p1</span> <span class="nv">p2</span><span class="p">))))</span>
    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">mul-poly</span> <span class="nv">p1</span> <span class="nv">p2</span><span class="p">)</span>
      <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">same-variable?</span> <span class="p">(</span><span class="nf">variable</span> <span class="nv">p1</span><span class="p">)</span> <span class="p">(</span><span class="nf">variable</span> <span class="nv">p2</span><span class="p">))</span>
	  <span class="p">(</span><span class="nf">make-poly</span> <span class="p">(</span><span class="nf">variable</span> <span class="nv">p1</span><span class="p">)</span>
		     <span class="p">(</span><span class="nf">mul-terms</span> <span class="p">(</span><span class="nf">term-list</span> <span class="nv">p1</span><span class="p">)</span>
				<span class="p">(</span><span class="nf">term-list</span> <span class="nv">p2</span><span class="p">)))</span>
	  <span class="p">(</span><span class="nf">error</span> <span class="s">"Polys not in same var -- MUL-POLY"</span>
		 <span class="p">(</span><span class="nb">list </span><span class="nv">p1</span> <span class="nv">p2</span><span class="p">))))</span>
    <span class="c1">;; follow 2.91</span>
    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">div-poly</span> <span class="nv">p1</span> <span class="nv">p2</span><span class="p">)</span>
      <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">same-variable?</span> <span class="p">(</span><span class="nf">variable</span> <span class="nv">p1</span><span class="p">)</span> <span class="p">(</span><span class="nf">variable</span> <span class="nv">p2</span><span class="p">))</span>
	  <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">t1</span> <span class="p">(</span><span class="nf">term-list</span> <span class="nv">p1</span><span class="p">))</span>
		<span class="p">(</span><span class="nf">t2</span> <span class="p">(</span><span class="nf">term-list</span> <span class="nv">p2</span><span class="p">)))</span>
	    <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">result</span> <span class="p">(</span><span class="nf">div-terms</span> <span class="nv">t1</span> <span class="nv">t2</span><span class="p">)))</span>
	      <span class="p">(</span><span class="nf">make-poly</span> <span class="p">(</span><span class="nf">variable</span> <span class="nv">p1</span><span class="p">)</span>
			 <span class="p">(</span><span class="nb">car </span><span class="nv">result</span><span class="p">))))</span>
	  <span class="p">(</span><span class="nf">error</span> <span class="s">"Polys not in same var -- DIV-POLY"</span>
		 <span class="p">(</span><span class="nb">list </span><span class="nv">p1</span> <span class="nv">p2</span><span class="p">))))</span>
    <span class="p">(</span><span class="nf">put</span> <span class="ss">'div</span> <span class="o">'</span><span class="p">(</span><span class="nv">polynomial</span> <span class="nv">polynomial</span><span class="p">)</span>
	 <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">p1</span> <span class="nv">p2</span><span class="p">)</span> <span class="p">(</span><span class="nf">tag</span> <span class="p">(</span><span class="nf">div-poly</span> <span class="nv">p1</span> <span class="nv">p2</span><span class="p">))))</span>
    <span class="c1">;; 2.91</span>
    <span class="c1">;; follow 2.93 &amp; 2.94</span>
    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">gcd-poly</span> <span class="nv">a</span> <span class="nv">b</span><span class="p">)</span>

      <span class="c1">;; (define (remainder-terms t1 t2)</span>
      <span class="c1">;;   (cadr (div-terms t1 t2)))</span>
      <span class="c1">;; (define (gcd-terms t1 t2)</span>
      <span class="c1">;;   (if (empty-termlist? t2)</span>
      <span class="c1">;; 	  t1</span>
      <span class="c1">;; 	  (gcd-terms t2 (remainder-terms t1 t2))))</span>

      <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">same-variable?</span> <span class="p">(</span><span class="nf">variable</span> <span class="nv">a</span><span class="p">)</span> <span class="p">(</span><span class="nf">variable</span> <span class="nv">b</span><span class="p">))</span>
	  <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">t1</span> <span class="p">(</span><span class="nf">term-list</span> <span class="nv">a</span><span class="p">))</span>
		<span class="p">(</span><span class="nf">t2</span> <span class="p">(</span><span class="nf">term-list</span> <span class="nv">b</span><span class="p">)))</span>
	    <span class="p">(</span><span class="nf">make-poly</span> <span class="p">(</span><span class="nf">variable</span> <span class="nv">a</span><span class="p">)</span> <span class="p">(</span><span class="nf">gcd-terms</span> <span class="nv">t1</span> <span class="nv">t2</span><span class="p">)))</span>
	  <span class="p">(</span><span class="nf">error</span> <span class="s">"Polys not in same var -- GCD-POLY"</span>
		 <span class="p">(</span><span class="nb">list </span><span class="nv">a</span> <span class="nv">b</span><span class="p">))))</span>
    <span class="p">(</span><span class="nf">put</span> <span class="ss">'gcd</span> <span class="o">'</span><span class="p">(</span><span class="nv">polynomial</span> <span class="nv">polynomial</span><span class="p">)</span>
	 <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">p1</span> <span class="nv">p2</span><span class="p">)</span> <span class="p">(</span><span class="nf">tag</span> <span class="p">(</span><span class="nf">gcd-poly</span> <span class="nv">p1</span> <span class="nv">p2</span><span class="p">))))</span>
    <span class="c1">;; 2.93 &amp; 2.94</span>

    <span class="c1">;; interface to rest of the system</span>
    <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">tag</span> <span class="nv">p</span><span class="p">)</span> <span class="p">(</span><span class="nf">attach-tag</span> <span class="ss">'polynomial</span> <span class="nv">p</span><span class="p">))</span>
    <span class="p">(</span><span class="nf">put</span> <span class="ss">'add</span> <span class="o">'</span><span class="p">(</span><span class="nv">polynomial</span> <span class="nv">polynomial</span><span class="p">)</span>
	 <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">p1</span> <span class="nv">p2</span><span class="p">)</span> <span class="p">(</span><span class="nf">tag</span> <span class="p">(</span><span class="nf">add-poly</span> <span class="nv">p1</span> <span class="nv">p2</span><span class="p">))))</span>
    <span class="p">(</span><span class="nf">put</span> <span class="ss">'mul</span> <span class="o">'</span><span class="p">(</span><span class="nv">polynomial</span> <span class="nv">polynomial</span><span class="p">)</span>
	 <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">p1</span> <span class="nv">p2</span><span class="p">)</span> <span class="p">(</span><span class="nf">tag</span> <span class="p">(</span><span class="nf">mul-poly</span> <span class="nv">p1</span> <span class="nv">p2</span><span class="p">))))</span>
    <span class="p">(</span><span class="nf">put</span> <span class="ss">'make</span> <span class="ss">'polynomial</span>
	 <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">var</span> <span class="nv">terms</span><span class="p">)</span> <span class="p">(</span><span class="nf">tag</span> <span class="p">(</span><span class="nf">make-poly</span> <span class="nv">var</span> <span class="nv">terms</span><span class="p">))))</span>
    <span class="ss">'done</span><span class="p">)</span>
  <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-polynomial</span> <span class="nv">var</span> <span class="nv">terms</span><span class="p">)</span>
    <span class="p">((</span><span class="nf">get</span> <span class="ss">'make</span> <span class="ss">'polynomial</span><span class="p">)</span> <span class="nv">var</span> <span class="nv">terms</span><span class="p">))</span>


  <span class="c1">;; install</span>
  <span class="p">(</span><span class="nf">install-types-tower</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">install-scheme-number-package</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">install-rational-package</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">install-rectangular-package</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">install-polar-package</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">install-complex-package</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">install-poly-term-package</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">install-dense-terms-package</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">install-sparse-terms-package</span><span class="p">)</span>
  <span class="p">(</span><span class="nf">install-polynomial-package</span><span class="p">)</span>
</pre></div>
</div>
</div>
            
        
        <div id="disqus_thread"></div>
        <script>
        var disqus_shortname ="https-zero4drift-github-io",
            disqus_url="https://zero4drift.github.io/posts/sicp-systems-with-generic-operations/",
        disqus_title="SICP-Systems-with-Generic-Operations",
        disqus_identifier="cache/posts/systems-with-generic-operations.html",
        disqus_config = function () {
            this.language = "en";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.async = true;
            dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
    <a href="https://disqus.com" class="dsq-brlink" rel="nofollow">Comments powered by <span class="logo-disqus">Disqus</span></a>


        
    


        </div>
    </div>

    
    <footer><div class="container">
            <div class="social">



                <div class="social-entry">
                    <a href="../../rss.xml" target="_blank">
                        <i class="fa fa-rss"></i> 
                    </a>
                </div>
            </div>
                <div class="copyright">
                    Contents © 2018         <a href="mailto:fang0052@e.ntu.edu.sg">zero4drift</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         
                    
                </div>
           
        </div>
    </footer><script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?06e0ade16d98033ac1aad78106d873c8";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script src="../../assets/js/all-nocdn.js" type="text/javascript"></script>
</body>
</html>
