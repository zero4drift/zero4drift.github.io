<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " vocab="http://ogp.me/ns" lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="Cpp Primer 5th answers chapter-15 Exercises">
<meta name="viewport" content="width=device-width">
<title>Cpp-Primer-5th-Exercises-Chapter-15 | Procrastination Prescription</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link rel="alternate" type="application/rss+xml" title="RSS" href="../../rss.xml">
<link rel="canonical" href="https://zero4drift.github.io/posts/Cpp-Primer-5th-Exercises-Chapter-15/">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="zero4drift">
<meta property="og:site_name" content="Procrastination Prescription">
<meta property="og:title" content="Cpp-Primer-5th-Exercises-Chapter-15">
<meta property="og:url" content="https://zero4drift.github.io/posts/Cpp-Primer-5th-Exercises-Chapter-15/">
<meta property="og:description" content="Cpp Primer 5th answers chapter-15 Exercises">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2018-07-11T19:54:08+08:00">
<meta property="article:tag" content="C++">
<meta property="article:tag" content="cpp-primer">
</head>
<body>
    

    <header id="header" class="navbar"><div class="container">
            
    <div class="brand">

        <div class="brand-text">
            <a href="https://zero4drift.github.io/" title="Procrastination Prescription" rel="home">
                Procrastination Prescription
            </a>
        </div>

        <a id="btn-toggle-nav" class="navbar-toggle">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </a>
    </div>

            
    <nav class="navbar-collapse collapse"><ul class="nav">
<li><a href="../../archive.html">Archive</a></li>
                <li><a href="https://github.com/zero4drift">Github</a></li>
                <li><a href="../../categories/">Tags</a></li>
                <li><a href="../../rss.xml">RSS feed</a></li>
    
    
    </ul></nav>
</div>
    </header><div class="header-padding"> </div>

    
    <div class="post-header">
        <div class="container">
            <div class="title">
                Cpp-Primer-5th-Exercises-Chapter-15
            </div>
        </div>
    </div>

    <div class="post-meta">
      <div class="container">
	<div class="meta clearfix">
	  <div class="authordate">
	    <time class="timeago" datetime="2018-07-11T19:54:08+08:00">2018/07/11</time>
</div>
	  <div class="post-tags">
	    <div class="tag">
	      <a href="../../categories/c%2B%2B/" rel="tag">C++</a>
	    </div>
	    <div class="tag">
	      <a href="../../categories/cpp-primer/" rel="tag">cpp-primer</a>
	    </div>
	  </div>
	</div>
      </div>
    </div>
    
    
    <div id="post-main" class="main">
        <div class="container">
        <div id="outline-container-org28f1d70" class="outline-2">
<h2 id="org28f1d70">Exercise 15.1</h2>
<div class="outline-text-2" id="text-org28f1d70">
<div class="highlight"><pre><span></span><span class="c1">// What is a virtual member?</span>
<span class="c1">// For some member functions, base class demands its derived class defines its own version, then base class defines them as virtual functions.</span>
</pre></div>
</div>
</div>

<div id="outline-container-orge2c54af" class="outline-2">
<h2 id="orge2c54af">Exercise 15.2</h2>
<div class="outline-text-2" id="text-orge2c54af">
<div class="highlight"><pre><span></span><span class="c1">// members marked as protected could be visted by derived class, while still could not be visited by other user code;</span>
<span class="c1">// members marked as private could not be visited by derived class and other user code.</span>
</pre></div>
</div>
</div>

<div id="outline-container-org56fb148" class="outline-2">
<h2 id="org56fb148">Exercise 15.3</h2>
<div class="outline-text-2" id="text-org56fb148">
<div class="highlight"><pre><span></span><span class="c1">// See Quote.h.</span>
</pre></div>
</div>
</div>

<div id="outline-container-org9f28c2c" class="outline-2">
<h2 id="org9f28c2c">Quote.h</h2>
<div class="outline-text-2" id="text-org9f28c2c">
<div class="highlight"><pre><span></span><span class="cp">#ifndef QUOTE_H</span>
<span class="cp">#define QUOTE_H</span>
<span class="k">class</span> <span class="nc">Quote</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
  <span class="n">Quote</span><span class="p">()</span> <span class="p">{</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Quote()"</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;}</span>
  <span class="n">Quote</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="n">book</span><span class="p">,</span> <span class="kt">double</span> <span class="n">sales_price</span><span class="p">)</span><span class="o">:</span>
  <span class="n">bookNo</span><span class="p">(</span><span class="n">book</span><span class="p">),</span> <span class="n">price</span><span class="p">(</span><span class="n">sales_price</span><span class="p">)</span>
  <span class="p">{</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Quote(cosnt string &amp;, double)"</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;}</span>
  <span class="n">string</span> <span class="n">isbn</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span><span class="k">return</span> <span class="n">bookNo</span><span class="p">;}</span>
  <span class="n">Quote</span><span class="p">(</span><span class="k">const</span> <span class="n">Quote</span> <span class="o">&amp;</span><span class="n">q</span><span class="p">)</span>
    <span class="p">{</span><span class="n">bookNo</span> <span class="o">=</span> <span class="n">q</span><span class="p">.</span><span class="n">bookNo</span><span class="p">;</span> <span class="n">price</span> <span class="o">=</span> <span class="n">q</span><span class="p">.</span><span class="n">price</span><span class="p">;</span> <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Quote(const Quote &amp;)"</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;}</span>
  <span class="n">Quote</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">Quote</span> <span class="o">&amp;</span><span class="n">q</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="n">bookNo</span> <span class="o">=</span> <span class="n">q</span><span class="p">.</span><span class="n">bookNo</span><span class="p">;</span>
      <span class="n">price</span> <span class="o">=</span> <span class="n">q</span><span class="p">.</span><span class="n">price</span><span class="p">;</span>
      <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Quote &amp;operator=(const Quote &amp;)"</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
      <span class="k">return</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="n">Quote</span><span class="p">(</span><span class="n">Quote</span> <span class="o">&amp;&amp;</span><span class="n">q</span><span class="p">)</span>
    <span class="p">{</span><span class="n">bookNo</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">q</span><span class="p">.</span><span class="n">bookNo</span><span class="p">);</span> <span class="n">price</span> <span class="o">=</span> <span class="n">q</span><span class="p">.</span><span class="n">price</span><span class="p">;</span> <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Quote(Quote &amp;&amp;)"</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;}</span>
  <span class="n">Quote</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="n">Quote</span> <span class="o">&amp;&amp;</span><span class="n">q</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="n">bookNo</span> <span class="o">=</span> <span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">q</span><span class="p">.</span><span class="n">bookNo</span><span class="p">);</span>
      <span class="n">price</span> <span class="o">=</span> <span class="n">q</span><span class="p">.</span><span class="n">price</span><span class="p">;</span>
      <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Quote &amp;operator=(Quote &amp;&amp;)"</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
      <span class="k">return</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="k">virtual</span> <span class="kt">double</span> <span class="n">net_price</span><span class="p">(</span><span class="kt">size_t</span> <span class="n">n</span><span class="p">)</span> <span class="k">const</span>
  <span class="p">{</span><span class="k">return</span> <span class="n">n</span> <span class="o">*</span> <span class="n">price</span><span class="p">;}</span>
  <span class="k">virtual</span> <span class="n">ostream</span> <span class="o">&amp;</span><span class="n">debug</span><span class="p">()</span> <span class="k">const</span>
  <span class="p">{</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"bookNo "</span> <span class="o">&lt;&lt;</span> <span class="n">bookNo</span> <span class="o">&lt;&lt;</span> <span class="s">" price "</span> <span class="o">&lt;&lt;</span> <span class="n">price</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">cout</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">virtual</span> <span class="n">Quote</span><span class="o">*</span> <span class="n">clone</span><span class="p">()</span> <span class="k">const</span> <span class="o">&amp;</span> <span class="p">{</span><span class="k">return</span> <span class="k">new</span> <span class="n">Quote</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">);}</span>
  <span class="k">virtual</span> <span class="n">Quote</span><span class="o">*</span> <span class="n">clone</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="p">{</span><span class="k">return</span> <span class="k">new</span> <span class="n">Quote</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">));}</span>
  <span class="k">virtual</span> <span class="o">~</span><span class="n">Quote</span><span class="p">()</span> <span class="p">{</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"~Quote()"</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;};</span>
<span class="k">private</span><span class="o">:</span>
  <span class="n">string</span> <span class="n">bookNo</span><span class="p">;</span>
<span class="k">protected</span><span class="o">:</span>
  <span class="kt">double</span> <span class="n">price</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
<span class="p">};</span>
<span class="kt">double</span> <span class="nf">print_total</span><span class="p">(</span><span class="n">ostream</span> <span class="o">&amp;</span><span class="n">os</span><span class="p">,</span> <span class="k">const</span> <span class="n">Quote</span> <span class="o">&amp;</span><span class="n">item</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">n</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">double</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">item</span><span class="p">.</span><span class="n">net_price</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>
  <span class="n">os</span> <span class="o">&lt;&lt;</span> <span class="s">"ISBN: "</span> <span class="o">&lt;&lt;</span> <span class="n">item</span><span class="p">.</span><span class="n">isbn</span><span class="p">()</span>
     <span class="o">&lt;&lt;</span> <span class="s">" # sold: "</span> <span class="o">&lt;&lt;</span> <span class="n">n</span> <span class="o">&lt;&lt;</span> <span class="s">" total due: "</span> <span class="o">&lt;&lt;</span> <span class="n">ret</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">#endif</span>
</pre></div>
</div>
</div>

<div id="outline-container-org59e1b96" class="outline-2">
<h2 id="org59e1b96">Exercise 15.4</h2>
<div class="outline-text-2" id="text-org59e1b96">
<div class="highlight"><pre><span></span><span class="c1">// class Base { ... };</span>
<span class="c1">// a. class Derived : public Derived { ... }</span>
<span class="c1">// illegal, one class could not derive from itself.</span>
<span class="c1">// b. class Derived : private Base { ... }</span>
<span class="c1">// illegal, this one as definition considered legal.</span>
<span class="c1">// c. class Derived : public Base;</span>
<span class="c1">// illegal, declaration of a class should not include its class derivation list.</span>
</pre></div>
</div>
</div>

<div id="outline-container-org08e8faa" class="outline-2">
<h2 id="org08e8faa">Exercise 15.5</h2>
<div class="outline-text-2" id="text-org08e8faa">
<div class="highlight"><pre><span></span><span class="c1">// See Bulk_quote.h.</span>
</pre></div>
</div>
</div>

<div id="outline-container-orgecc71b4" class="outline-2">
<h2 id="orgecc71b4">Bulk_quote.h</h2>
<div class="outline-text-2" id="text-orgecc71b4">
<div class="highlight"><pre><span></span><span class="cp">#ifndef BULK_QUOTE_H</span>
<span class="cp">#define BULK_QUOTE_H</span>
<span class="k">class</span> <span class="nc">Bulk_quote</span><span class="o">:</span> <span class="k">public</span> <span class="n">Quote</span>
<span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="k">using</span> <span class="n">Quote</span><span class="o">::</span><span class="n">Quote</span><span class="p">;</span>
 <span class="n">Bulk_quote</span><span class="p">()</span><span class="o">:</span> <span class="n">Quote</span><span class="p">()</span> <span class="p">{</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Bulk_quote()"</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;};</span>
 <span class="n">Bulk_quote</span><span class="p">(</span><span class="k">const</span> <span class="n">Bulk_quote</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span><span class="o">:</span> <span class="n">Quote</span><span class="p">(</span><span class="n">b</span><span class="p">),</span> <span class="n">min_qty</span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="n">min_qty</span><span class="p">),</span> <span class="n">discount</span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="n">discount</span><span class="p">)</span>
    <span class="p">{</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Bulk_Quote(const Bulk_quote &amp;)"</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;}</span>
 <span class="n">Bulk_quote</span><span class="p">(</span><span class="n">Bulk_quote</span> <span class="o">&amp;&amp;</span><span class="n">b</span><span class="p">)</span><span class="o">:</span> <span class="n">Quote</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">b</span><span class="p">)),</span> <span class="n">min_qty</span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="n">min_qty</span><span class="p">),</span> <span class="n">discount</span><span class="p">(</span><span class="n">b</span><span class="p">.</span><span class="n">discount</span><span class="p">)</span>
    <span class="p">{</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Bulk_quote(Bulk_quote &amp;&amp;b)"</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;}</span>
  <span class="n">Bulk_quote</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">Bulk_quote</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="n">Quote</span><span class="o">::</span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="n">b</span><span class="p">);</span>
      <span class="n">min_qty</span> <span class="o">=</span> <span class="n">b</span><span class="p">.</span><span class="n">min_qty</span><span class="p">;</span>
      <span class="n">discount</span> <span class="o">=</span> <span class="n">b</span><span class="p">.</span><span class="n">discount</span><span class="p">;</span>
      <span class="p">{</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"operator=(const Bulk_quote &amp;)"</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;}</span> 
      <span class="k">return</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="n">Bulk_quote</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="n">Bulk_quote</span> <span class="o">&amp;&amp;</span><span class="n">b</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="n">Quote</span><span class="o">::</span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">b</span><span class="p">));</span>
      <span class="n">min_qty</span> <span class="o">=</span> <span class="n">b</span><span class="p">.</span><span class="n">min_qty</span><span class="p">;</span>
      <span class="n">discount</span> <span class="o">=</span> <span class="n">b</span><span class="p">.</span><span class="n">discount</span><span class="p">;</span>
      <span class="p">{</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"operator=(Bulk_quote &amp;&amp;)"</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;}</span> 
      <span class="k">return</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span>
    <span class="p">}</span>
 <span class="n">Bulk_quote</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span> <span class="n">book</span><span class="p">,</span> <span class="kt">double</span> <span class="n">p</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">qty</span><span class="p">,</span> <span class="kt">double</span> <span class="n">disc</span><span class="p">)</span><span class="o">:</span>
  <span class="n">Quote</span><span class="p">(</span><span class="n">book</span><span class="p">,</span> <span class="n">p</span><span class="p">),</span> <span class="n">min_qty</span><span class="p">(</span><span class="n">qty</span><span class="p">),</span> <span class="n">discount</span><span class="p">(</span><span class="n">disc</span><span class="p">)</span> <span class="p">{}</span>
  <span class="kt">double</span> <span class="n">net_price</span><span class="p">(</span><span class="kt">size_t</span><span class="p">)</span> <span class="k">const</span> <span class="k">override</span><span class="p">;</span>
  <span class="n">ostream</span> <span class="o">&amp;</span><span class="n">debug</span><span class="p">()</span> <span class="k">const</span> <span class="k">override</span><span class="p">;</span>
  <span class="n">Bulk_quote</span> <span class="o">*</span><span class="nf">clone</span><span class="p">()</span> <span class="k">const</span> <span class="o">&amp;</span> <span class="k">override</span> <span class="p">{</span><span class="k">return</span> <span class="k">new</span> <span class="n">Bulk_quote</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">);}</span>
  <span class="n">Bulk_quote</span> <span class="o">*</span><span class="nf">clone</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="k">override</span> <span class="p">{</span><span class="k">return</span> <span class="k">new</span> <span class="n">Bulk_quote</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">));}</span>
  <span class="o">~</span><span class="n">Bulk_quote</span><span class="p">()</span> <span class="k">override</span> <span class="p">{</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"~Bulk_quote()"</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;}</span>
 <span class="k">private</span><span class="o">:</span>
  <span class="kt">size_t</span> <span class="n">min_qty</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="kt">double</span> <span class="n">discount</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
<span class="p">};</span>
<span class="kt">double</span> <span class="n">Bulk_quote</span><span class="o">::</span><span class="n">net_price</span><span class="p">(</span><span class="kt">size_t</span> <span class="n">cnt</span><span class="p">)</span> <span class="k">const</span>
<span class="p">{</span>
  <span class="k">if</span><span class="p">(</span><span class="n">cnt</span> <span class="o">&gt;=</span> <span class="n">min_qty</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">cnt</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">discount</span><span class="p">)</span> <span class="o">*</span> <span class="n">price</span><span class="p">;</span>
  <span class="k">else</span>
    <span class="k">return</span> <span class="n">cnt</span> <span class="o">*</span> <span class="n">price</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">ostream</span> <span class="o">&amp;</span><span class="n">Bulk_quote</span><span class="o">::</span><span class="n">debug</span><span class="p">()</span> <span class="k">const</span>
<span class="p">{</span>
  <span class="n">Quote</span><span class="o">::</span><span class="n">debug</span><span class="p">();</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">" min_qty "</span> <span class="o">&lt;&lt;</span> <span class="n">min_qty</span> <span class="o">&lt;&lt;</span> <span class="s">" discount "</span> <span class="o">&lt;&lt;</span> <span class="n">discount</span><span class="p">;</span>
  <span class="k">return</span> <span class="n">cout</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">#endif</span>
</pre></div>
</div>
</div>

<div id="outline-container-orgb4f6b6e" class="outline-2">
<h2 id="orgb4f6b6e">Exercise 15.6</h2>
<div class="outline-text-2" id="text-orgb4f6b6e">
<div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">Quote</span> <span class="n">a</span><span class="p">(</span><span class="s">"123"</span><span class="p">,</span> <span class="mf">21.1</span><span class="p">);</span>
  <span class="n">Bulk_quote</span> <span class="n">b</span><span class="p">(</span><span class="s">"123"</span><span class="p">,</span> <span class="mf">21.1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">);</span>
  <span class="n">Limit_Bulk_quote</span> <span class="n">c</span><span class="p">(</span><span class="s">"123"</span><span class="p">,</span> <span class="mf">21.1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">);</span>
  <span class="n">print_total</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
  <span class="n">a</span><span class="p">.</span><span class="n">debug</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">print_total</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>
  <span class="n">b</span><span class="p">.</span><span class="n">debug</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">print_total</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="mi">6</span><span class="p">);</span>
  <span class="n">c</span><span class="p">.</span><span class="n">debug</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>

<div id="outline-container-org947990c" class="outline-2">
<h2 id="org947990c">Exercise 15.7</h2>
<div class="outline-text-2" id="text-org947990c">
<div class="highlight"><pre><span></span><span class="c1">// See Limit_Bulk_quote.h.</span>
</pre></div>
</div>
</div>

<div id="outline-container-org0992700" class="outline-2">
<h2 id="org0992700">Limit_Bulk_quote.h</h2>
<div class="outline-text-2" id="text-org0992700">
<div class="highlight"><pre><span></span><span class="cp">#ifndef LIMIT_BULK_QUOTE_H</span>
<span class="cp">#define LIMIT_BULK_QUOTE_H</span>
<span class="k">class</span> <span class="nc">Limit_Bulk_quote</span><span class="o">:</span> <span class="k">public</span> <span class="n">Quote</span>
<span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="n">Limit_Bulk_quote</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>
 <span class="n">Limit_Bulk_quote</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span> <span class="n">book</span><span class="p">,</span> <span class="kt">double</span> <span class="n">p</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">qty</span><span class="p">,</span> <span class="kt">double</span> <span class="n">disc</span><span class="p">)</span><span class="o">:</span>
  <span class="n">Quote</span><span class="p">(</span><span class="n">book</span><span class="p">,</span> <span class="n">p</span><span class="p">),</span> <span class="n">max_qty</span><span class="p">(</span><span class="n">qty</span><span class="p">),</span> <span class="n">discount</span><span class="p">(</span><span class="n">disc</span><span class="p">)</span> <span class="p">{}</span>
  <span class="kt">double</span> <span class="n">net_price</span><span class="p">(</span><span class="kt">size_t</span><span class="p">)</span> <span class="k">const</span> <span class="k">override</span><span class="p">;</span>
  <span class="n">ostream</span> <span class="o">&amp;</span><span class="n">debug</span><span class="p">()</span> <span class="k">const</span> <span class="k">override</span><span class="p">;</span>
 <span class="k">private</span><span class="o">:</span>
  <span class="kt">size_t</span> <span class="n">max_qty</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="kt">double</span> <span class="n">discount</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
<span class="p">};</span>
<span class="kt">double</span> <span class="n">Limit_Bulk_quote</span><span class="o">::</span><span class="n">net_price</span><span class="p">(</span><span class="kt">size_t</span> <span class="n">cnt</span><span class="p">)</span> <span class="k">const</span>
<span class="p">{</span>
  <span class="k">if</span><span class="p">(</span><span class="n">cnt</span> <span class="o">&lt;=</span> <span class="n">max_qty</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">cnt</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">discount</span><span class="p">)</span> <span class="o">*</span> <span class="n">price</span><span class="p">;</span>
  <span class="k">else</span>
    <span class="k">return</span> <span class="n">max_qty</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">discount</span><span class="p">)</span> <span class="o">*</span> <span class="n">price</span> <span class="o">+</span> <span class="p">(</span><span class="n">cnt</span> <span class="o">-</span> <span class="n">max_qty</span><span class="p">)</span> <span class="o">*</span> <span class="n">price</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">ostream</span> <span class="o">&amp;</span><span class="n">Limit_Bulk_quote</span><span class="o">::</span><span class="n">debug</span><span class="p">()</span> <span class="k">const</span>
<span class="p">{</span>
  <span class="n">Quote</span><span class="o">::</span><span class="n">debug</span><span class="p">();</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">" max_qty "</span> <span class="o">&lt;&lt;</span> <span class="n">max_qty</span> <span class="o">&lt;&lt;</span> <span class="s">" discount "</span> <span class="o">&lt;&lt;</span> <span class="n">discount</span><span class="p">;</span>
  <span class="k">return</span> <span class="n">cout</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">#endif</span>
</pre></div>
</div>
</div>

<div id="outline-container-org8b164b5" class="outline-2">
<h2 id="org8b164b5">Exercise 15.8</h2>
<div class="outline-text-2" id="text-org8b164b5">
<div class="highlight"><pre><span></span><span class="c1">// static type</span>
<span class="c1">// which is used in declaration of variable, or evaluated from expression;</span>
<span class="c1">// known in compile process.</span>
<span class="c1">// dynamic type</span>
<span class="c1">// which is the type of object allocated in memory and represented by variable or expression;</span>
<span class="c1">// known until run-time.</span>
</pre></div>
</div>
</div>

<div id="outline-container-orge46ba79" class="outline-2">
<h2 id="orge46ba79">Exercise 15.9</h2>
<div class="outline-text-2" id="text-orge46ba79">
<div class="highlight"><pre><span></span><span class="c1">// When bind a pointer of a reference of base class type to a object of derived class type, the static type is different from the dynamic type.</span>
<span class="c1">// class Base { ... };</span>
<span class="c1">// class Derived: public Base { ... };</span>
<span class="c1">// int f(const Base &amp;b) { ... }</span>
<span class="c1">// Derived d;</span>
<span class="c1">// Base &amp;b = d;</span>
<span class="c1">// Base *p = &amp;d;</span>
<span class="c1">// f(d);</span>
</pre></div>
</div>
</div>

<div id="outline-container-org93c3bd1" class="outline-2">
<h2 id="org93c3bd1">Exercise 15.10</h2>
<div class="outline-text-2" id="text-org93c3bd1">
<div class="highlight"><pre><span></span><span class="c1">// ifstream object if passed in as argument to read function of Sales_data object;</span>
<span class="c1">// read function's first parameter's type is 'istream &amp;';</span>
<span class="c1">// while ifstream class type is derived from istream class type;</span>
<span class="c1">// then this parameter could be initialized by ifstream object, binded to the istream sub-object of ifstream object;</span>
</pre></div>
</div>
</div>

<div id="outline-container-orgd6814e8" class="outline-2">
<h2 id="orgd6814e8">Exercise 15.11</h2>
<div class="outline-text-2" id="text-orgd6814e8">
<div class="highlight"><pre><span></span><span class="c1">// See Quote.h, Bulk_quote.h and Limit_quote.h.</span>
</pre></div>

<p>
<a href="#orgecc71b4">Bulk_quote.h</a>
</p>

<p>
<a href="#org9f28c2c">Quote.h</a>
</p>
</div>
</div>

<div id="outline-container-org746ad0a" class="outline-2">
<h2 id="org746ad0a">Limit_quote.h</h2>
<div class="outline-text-2" id="text-org746ad0a">
<div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>

<div id="outline-container-org595c162" class="outline-2">
<h2 id="org595c162">Exercise 15.12</h2>
<div class="outline-text-2" id="text-org595c162">
<div class="highlight"><pre><span></span><span class="c1">// Unnecessary;</span>
<span class="c1">// 'final' implicitly means that this function is a override virtual function of the virtual function within base class.</span>
<span class="c1">// Am I right?</span>
<span class="c1">// Emacs &amp; cquery &amp; flycheck do not warn me when I replace override with final.</span>
</pre></div>
</div>
</div>

<div id="outline-container-org9bde432" class="outline-2">
<h2 id="org9bde432">Exercise 15.13</h2>
<div class="outline-text-2" id="text-org9bde432">
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">base</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
  <span class="n">string</span> <span class="n">name</span><span class="p">()</span> <span class="p">{</span><span class="k">return</span> <span class="n">basename</span><span class="p">;}</span>
  <span class="k">virtual</span> <span class="kt">void</span> <span class="n">print</span><span class="p">(</span><span class="n">ostream</span> <span class="o">&amp;</span><span class="n">os</span><span class="p">)</span> <span class="p">{</span><span class="n">os</span> <span class="o">&lt;&lt;</span> <span class="n">basename</span><span class="p">;};</span>
<span class="k">private</span><span class="o">:</span>
  <span class="n">string</span> <span class="n">basename</span><span class="p">;</span>
<span class="p">};</span>
<span class="k">class</span> <span class="nc">derived</span><span class="o">:</span> <span class="k">public</span> <span class="n">base</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
  <span class="c1">// void print(ostream &amp;os) {print(os); os &lt;&lt; " " &lt;&lt; i;} // call itself within function body causes infinite recursion.</span>
  <span class="kt">void</span> <span class="n">print</span><span class="p">(</span><span class="n">ostream</span> <span class="o">&amp;</span><span class="n">os</span><span class="p">)</span> <span class="k">override</span> <span class="p">{</span><span class="n">base</span><span class="o">::</span><span class="n">print</span><span class="p">(</span><span class="n">os</span><span class="p">);</span> <span class="n">os</span> <span class="o">&lt;&lt;</span> <span class="s">" "</span> <span class="o">&lt;&lt;</span> <span class="n">i</span><span class="p">;}</span>
<span class="k">private</span><span class="o">:</span>
  <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
</div>

<div id="outline-container-org7e149ed" class="outline-2">
<h2 id="org7e149ed">Exercise 15.14</h2>
<div class="outline-text-2" id="text-org7e149ed">
<div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">base</span> <span class="n">bobj</span><span class="p">;</span>
  <span class="n">derived</span> <span class="n">dobj</span><span class="p">;</span>
  <span class="n">base</span> <span class="o">*</span><span class="n">bp1</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">bobj</span><span class="p">;</span>
  <span class="n">base</span> <span class="o">*</span><span class="n">bp2</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">dobj</span><span class="p">;</span>
  <span class="n">base</span> <span class="o">&amp;</span><span class="n">br1</span> <span class="o">=</span> <span class="n">bobj</span><span class="p">;</span>
  <span class="n">base</span> <span class="o">&amp;</span><span class="n">br2</span> <span class="o">=</span> <span class="n">dobj</span><span class="p">;</span>
  <span class="n">bobj</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">cout</span><span class="p">);</span>		<span class="c1">// base::print</span>
  <span class="n">dobj</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">cout</span><span class="p">);</span>		<span class="c1">// derived::print</span>
  <span class="n">bp1</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">();</span>			<span class="c1">// base::name</span>
  <span class="n">bp2</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">();</span>			<span class="c1">// base::name</span>
  <span class="n">br1</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">cout</span><span class="p">);</span> 		<span class="c1">// base::print</span>
  <span class="n">br2</span><span class="p">.</span><span class="n">print</span><span class="p">(</span><span class="n">cout</span><span class="p">);</span>		<span class="c1">// derived::print</span>
<span class="p">}</span>
</pre></div>
</div>
</div>

<div id="outline-container-org6987315" class="outline-2">
<h2 id="org6987315">Exercise 15.15</h2>
<div class="outline-text-2" id="text-org6987315">
<div class="highlight"><pre><span></span><span class="c1">// See Disc_quote.h and Bulk_quote-1515.h.</span>
</pre></div>
</div>
</div>

<div id="outline-container-org4f6477f" class="outline-2">
<h2 id="org4f6477f">Bulk_quote-1515.h</h2>
<div class="outline-text-2" id="text-org4f6477f">
<div class="highlight"><pre><span></span><span class="cp">#ifndef BULK_QUOTE_H</span>
<span class="cp">#define BULK_QUOTE_H</span>
<span class="k">class</span> <span class="nc">Bulk_quote</span><span class="o">:</span> <span class="k">public</span> <span class="n">Disc_quote</span>
<span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="n">Bulk_quote</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>
 <span class="n">Bulk_quote</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span> <span class="n">book</span><span class="p">,</span> <span class="kt">double</span> <span class="n">p</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">qty</span><span class="p">,</span> <span class="kt">double</span> <span class="n">disc</span><span class="p">)</span><span class="o">:</span>
  <span class="n">Disc_quote</span><span class="p">(</span><span class="n">book</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">qty</span><span class="p">,</span> <span class="n">disc</span><span class="p">)</span> <span class="p">{}</span>
  <span class="kt">double</span> <span class="n">net_price</span><span class="p">(</span><span class="kt">size_t</span><span class="p">)</span> <span class="k">const</span> <span class="k">override</span><span class="p">;</span>
  <span class="n">ostream</span> <span class="o">&amp;</span><span class="n">debug</span><span class="p">()</span> <span class="k">const</span> <span class="k">override</span><span class="p">;</span>
<span class="p">};</span>
<span class="kt">double</span> <span class="n">Bulk_quote</span><span class="o">::</span><span class="n">net_price</span><span class="p">(</span><span class="kt">size_t</span> <span class="n">cnt</span><span class="p">)</span> <span class="k">const</span>
<span class="p">{</span>
  <span class="k">if</span><span class="p">(</span><span class="n">cnt</span> <span class="o">&gt;=</span> <span class="n">quantity</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">cnt</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">discount</span><span class="p">)</span> <span class="o">*</span> <span class="n">price</span><span class="p">;</span>
  <span class="k">else</span>
    <span class="k">return</span> <span class="n">cnt</span> <span class="o">*</span> <span class="n">price</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">ostream</span> <span class="o">&amp;</span><span class="n">Bulk_quote</span><span class="o">::</span><span class="n">debug</span><span class="p">()</span> <span class="k">const</span>
<span class="p">{</span>
  <span class="n">Quote</span><span class="o">::</span><span class="n">debug</span><span class="p">();</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">" min_qty "</span> <span class="o">&lt;&lt;</span> <span class="n">quantity</span> <span class="o">&lt;&lt;</span> <span class="s">" discount "</span> <span class="o">&lt;&lt;</span> <span class="n">discount</span><span class="p">;</span>
  <span class="k">return</span> <span class="n">cout</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">#endif</span>
</pre></div>
</div>
</div>

<div id="outline-container-org6eefa0e" class="outline-2">
<h2 id="org6eefa0e">Disc_quote.h</h2>
<div class="outline-text-2" id="text-org6eefa0e">
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Disc_quote</span><span class="o">:</span> <span class="k">public</span> <span class="n">Quote</span>
<span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="n">Disc_quote</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>
  <span class="n">Disc_quote</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="n">book</span><span class="p">,</span> <span class="kt">double</span> <span class="n">price</span><span class="p">,</span>
	   <span class="kt">size_t</span> <span class="n">qty</span><span class="p">,</span> <span class="kt">double</span> <span class="n">disc</span><span class="p">)</span><span class="o">:</span>
  <span class="n">Quote</span><span class="p">(</span><span class="n">book</span><span class="p">,</span> <span class="n">price</span><span class="p">),</span> <span class="n">quantity</span><span class="p">(</span><span class="n">qty</span><span class="p">),</span> <span class="n">discount</span><span class="p">(</span><span class="n">disc</span><span class="p">)</span> <span class="p">{}</span>
  <span class="kt">double</span> <span class="n">net_price</span><span class="p">(</span><span class="kt">size_t</span><span class="p">)</span> <span class="k">const</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
 <span class="k">protected</span><span class="o">:</span>
  <span class="kt">size_t</span> <span class="n">quantity</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="kt">double</span> <span class="n">discount</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
</div>

<div id="outline-container-orgb69d8b2" class="outline-2">
<h2 id="orgb69d8b2">Exercise 15.16</h2>
<div class="outline-text-2" id="text-orgb69d8b2">
<div class="highlight"><pre><span></span><span class="c1">// See Limit_Bulk_quote-1516.h.</span>
</pre></div>
</div>
</div>

<div id="outline-container-org9228adb" class="outline-2">
<h2 id="org9228adb">Limit_Bulk_quote-1516.h</h2>
<div class="outline-text-2" id="text-org9228adb">
<div class="highlight"><pre><span></span><span class="cp">#ifndef LIMIT_BULK_QUOTE_H</span>
<span class="cp">#define LIMIT_BULK_QUOTE_H</span>
<span class="k">class</span> <span class="nc">Limit_Bulk_quote</span><span class="o">:</span> <span class="k">public</span> <span class="n">Disc_quote</span>
<span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="n">Limit_Bulk_quote</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>
 <span class="n">Limit_Bulk_quote</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span> <span class="n">book</span><span class="p">,</span> <span class="kt">double</span> <span class="n">p</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">qty</span><span class="p">,</span> <span class="kt">double</span> <span class="n">disc</span><span class="p">)</span><span class="o">:</span>
  <span class="n">Disc_quote</span><span class="p">(</span><span class="n">book</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">qty</span><span class="p">,</span> <span class="n">disc</span><span class="p">)</span> <span class="p">{}</span>
  <span class="kt">double</span> <span class="n">net_price</span><span class="p">(</span><span class="kt">size_t</span><span class="p">)</span> <span class="k">const</span> <span class="k">override</span><span class="p">;</span>
  <span class="n">ostream</span> <span class="o">&amp;</span><span class="n">debug</span><span class="p">()</span> <span class="k">const</span> <span class="k">override</span><span class="p">;</span>
<span class="p">};</span>
<span class="kt">double</span> <span class="n">Limit_Bulk_quote</span><span class="o">::</span><span class="n">net_price</span><span class="p">(</span><span class="kt">size_t</span> <span class="n">cnt</span><span class="p">)</span> <span class="k">const</span>
<span class="p">{</span>
  <span class="k">if</span><span class="p">(</span><span class="n">cnt</span> <span class="o">&lt;=</span> <span class="n">quantity</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">cnt</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">discount</span><span class="p">)</span> <span class="o">*</span> <span class="n">price</span><span class="p">;</span>
  <span class="k">else</span>
    <span class="k">return</span> <span class="n">quantity</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">discount</span><span class="p">)</span> <span class="o">*</span> <span class="n">price</span> <span class="o">+</span> <span class="p">(</span><span class="n">cnt</span> <span class="o">-</span> <span class="n">quantity</span><span class="p">)</span> <span class="o">*</span> <span class="n">price</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">ostream</span> <span class="o">&amp;</span><span class="n">Limit_Bulk_quote</span><span class="o">::</span><span class="n">debug</span><span class="p">()</span> <span class="k">const</span>
<span class="p">{</span>
  <span class="n">Quote</span><span class="o">::</span><span class="n">debug</span><span class="p">();</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">" max_qty "</span> <span class="o">&lt;&lt;</span> <span class="n">quantity</span> <span class="o">&lt;&lt;</span> <span class="s">" discount "</span> <span class="o">&lt;&lt;</span> <span class="n">discount</span><span class="p">;</span>
  <span class="k">return</span> <span class="n">cout</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">#endif</span>
</pre></div>
</div>
</div>

<div id="outline-container-orgd55ebbf" class="outline-2">
<h2 id="orgd55ebbf">Exercise 15.17</h2>
<div class="outline-text-2" id="text-orgd55ebbf">
<div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">Disc_quote</span> <span class="n">d</span><span class="p">;</span>
  <span class="c1">// variable type 'Disc_quote' is an abstract class</span>
<span class="p">}</span>
</pre></div>
</div>
</div>

<div id="outline-container-org71253cf" class="outline-2">
<h2 id="org71253cf">Exercise 15.18</h2>
<div class="outline-text-2" id="text-org71253cf">
<div class="highlight"><pre><span></span><span class="c1">// Base *p = &amp;dl;</span>
<span class="c1">// d1: Pub_Derv</span>
<span class="c1">// legal</span>
<span class="c1">// p = &amp;d2;</span>
<span class="c1">// d2: Priv_Derv</span>
<span class="c1">// illegal, for the derivation access specifier of Priv_Derv is private, conversion from Priv_Derv to its base class Base is forbidden;</span>
<span class="c1">// p = &amp;d3;</span>
<span class="c1">// d3: Prot_Derv</span>
<span class="c1">// illegal, for the derivation access spedifier of Prot_Derv is protected, conversion from Priv_Derv to its base class Base is forbidden;</span>
<span class="c1">// p = &amp;dd1;</span>
<span class="c1">// dd1: Derived_from_Public</span>
<span class="c1">// legal</span>
<span class="c1">// p = &amp;dd2;</span>
<span class="c1">// dd2: Derived_from_Private</span>
<span class="c1">// illegal, same reason as the second one;</span>
<span class="c1">// p = &amp;dd3;</span>
<span class="c1">// dd3: Derived_from_Protected</span>
<span class="c1">// illegal, same reason as the third one.</span>
</pre></div>
</div>
</div>

<div id="outline-container-org901f605" class="outline-2">
<h2 id="org901f605">Exercise 15.19</h2>
<div class="outline-text-2" id="text-org901f605">
<div class="highlight"><pre><span></span><span class="c1">// void memfcn(Base &amp;b) { b = &amp;this; }</span>
<span class="c1">// as member function</span>
<span class="c1">// for Base:</span>
<span class="c1">// legal;</span>
<span class="c1">// for Pub_Derv:</span>
<span class="c1">// legal;</span>
<span class="c1">// for Pro_Derv;</span>
<span class="c1">// legal;</span>
<span class="c1">// for Priv_Derv:</span>
<span class="c1">// legal;</span>
<span class="c1">// for Derived_from_Public:</span>
<span class="c1">// legal;</span>
<span class="c1">// for Derived_from_Private:</span>
<span class="c1">// illegal;</span>
<span class="c1">// for the derivation access specifier of Priv_Derv is private, member or friend of derivaed class of Priv_Derv would nerver call the conversion from Derived_from_private to Base class.</span>
<span class="c1">// for Derived_from_Protected:</span>
<span class="c1">// legal;</span>
</pre></div>
</div>
</div>

<div id="outline-container-org6068ff6" class="outline-2">
<h2 id="org6068ff6">Exercise 15.20</h2>
<div class="outline-text-2" id="text-org6068ff6">
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Base</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
  <span class="kt">void</span> <span class="n">memfcn</span><span class="p">(</span><span class="n">Base</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span> <span class="p">{</span><span class="n">b</span> <span class="o">=</span> <span class="o">*</span><span class="k">this</span><span class="p">;}</span>
  <span class="kt">void</span> <span class="n">pub_mem</span><span class="p">();</span>
<span class="k">protected</span><span class="o">:</span>
  <span class="kt">int</span> <span class="n">prot_mem</span><span class="p">;</span>
<span class="k">private</span><span class="o">:</span>
  <span class="kt">char</span> <span class="n">priv_mem</span><span class="p">;</span>
<span class="p">};</span>
<span class="k">struct</span> <span class="nl">Pub_Derv</span><span class="p">:</span> <span class="k">public</span> <span class="n">Base</span>
<span class="p">{</span>
  <span class="kt">void</span> <span class="n">memfcn</span><span class="p">(</span><span class="n">Base</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span> <span class="p">{</span><span class="n">b</span> <span class="o">=</span> <span class="o">*</span><span class="k">this</span><span class="p">;}</span>
  <span class="kt">int</span> <span class="n">f</span><span class="p">()</span> <span class="p">{</span><span class="k">return</span> <span class="n">prot_mem</span><span class="p">;}</span>
<span class="p">};</span>
<span class="k">struct</span> <span class="nl">Priv_Derv</span><span class="p">:</span> <span class="k">private</span> <span class="n">Base</span>
<span class="p">{</span>
  <span class="kt">void</span> <span class="n">memfcn</span><span class="p">(</span><span class="n">Base</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span> <span class="p">{</span><span class="n">b</span> <span class="o">=</span> <span class="o">*</span><span class="k">this</span><span class="p">;}</span>
  <span class="kt">int</span> <span class="n">f1</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span><span class="k">return</span> <span class="n">prot_mem</span><span class="p">;}</span>
<span class="p">};</span>
<span class="k">struct</span> <span class="nl">Prot_Derv</span><span class="p">:</span> <span class="k">protected</span> <span class="n">Base</span>
<span class="p">{</span>
  <span class="kt">void</span> <span class="n">memfcn</span><span class="p">(</span><span class="n">Base</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span> <span class="p">{</span><span class="n">b</span> <span class="o">=</span> <span class="o">*</span><span class="k">this</span><span class="p">;}</span>
  <span class="kt">int</span> <span class="n">f2</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span><span class="k">return</span> <span class="n">prot_mem</span><span class="p">;}</span>
<span class="p">};</span>
<span class="k">struct</span> <span class="nl">Derived_from_Public</span><span class="p">:</span> <span class="k">public</span> <span class="n">Pub_Derv</span>
<span class="p">{</span>
  <span class="kt">void</span> <span class="n">memfcn</span><span class="p">(</span><span class="n">Base</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span> <span class="p">{</span><span class="n">b</span> <span class="o">=</span> <span class="o">*</span><span class="k">this</span><span class="p">;}</span>
  <span class="kt">int</span> <span class="n">use_base</span><span class="p">()</span> <span class="p">{</span><span class="k">return</span> <span class="n">prot_mem</span><span class="p">;};</span>
<span class="p">};</span>
<span class="k">struct</span> <span class="nl">Derived_from_Private</span><span class="p">:</span> <span class="k">public</span> <span class="n">Priv_Derv</span>
<span class="p">{</span>
  <span class="kt">void</span> <span class="n">memfcn</span><span class="p">(</span><span class="n">Base</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span> <span class="p">{</span><span class="n">b</span> <span class="o">=</span> <span class="o">*</span><span class="k">this</span><span class="p">;}</span> <span class="c1">// illegal </span>
  <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
<span class="p">};</span>
<span class="k">struct</span> <span class="nl">Derived_from_Protected</span><span class="p">:</span> <span class="k">public</span> <span class="n">Prot_Derv</span>
<span class="p">{</span>
  <span class="kt">void</span> <span class="n">memfcn</span><span class="p">(</span><span class="n">Base</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span> <span class="p">{</span><span class="n">b</span> <span class="o">=</span> <span class="o">*</span><span class="k">this</span><span class="p">;}</span>
  <span class="kt">int</span> <span class="n">use_base</span><span class="p">()</span> <span class="p">{</span><span class="k">return</span> <span class="n">prot_mem</span><span class="p">;}</span>
<span class="p">};</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">Pub_Derv</span> <span class="n">d1</span><span class="p">;</span>
  <span class="n">Priv_Derv</span> <span class="n">d2</span><span class="p">;</span>
  <span class="n">Prot_Derv</span> <span class="n">d3</span><span class="p">;</span>
  <span class="n">Derived_from_Public</span> <span class="n">dd1</span><span class="p">;</span>
  <span class="n">Derived_from_Private</span> <span class="n">dd2</span><span class="p">;</span>
  <span class="n">Derived_from_Protected</span> <span class="n">dd3</span><span class="p">;</span>

  <span class="n">Base</span> <span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">d1</span><span class="p">;</span>		<span class="c1">// legal;</span>
  <span class="n">p</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">d2</span><span class="p">;</span>			<span class="c1">// illegal;</span>
  <span class="n">p</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">d3</span><span class="p">;</span>			<span class="c1">// illegal;</span>
  <span class="n">p</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">dd1</span><span class="p">;</span>			<span class="c1">// legal;</span>
  <span class="n">p</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">dd2</span><span class="p">;</span>			<span class="c1">// illegal;</span>
  <span class="n">p</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">dd3</span><span class="p">;</span>			<span class="c1">// illegal;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>

<div id="outline-container-org22abbc8" class="outline-2">
<h2 id="org22abbc8">Exercise 15.21</h2>
<div class="outline-text-2" id="text-org22abbc8">
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Employee</span>
<span class="p">{</span>
<span class="k">private</span><span class="o">:</span>
  <span class="n">string</span> <span class="n">name</span><span class="p">;</span>
  <span class="n">string</span> <span class="n">department</span><span class="p">;</span>
  <span class="n">string</span> <span class="n">address</span><span class="p">;</span>
  <span class="n">string</span> <span class="n">contact</span><span class="p">;</span>
<span class="k">protected</span><span class="o">:</span>
  <span class="kt">int</span> <span class="n">salary</span><span class="p">;</span>
<span class="k">public</span><span class="o">:</span>
  <span class="n">Employee</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>
  <span class="n">Employee</span><span class="p">(</span><span class="n">string</span> <span class="n">n</span><span class="p">,</span> <span class="n">string</span> <span class="n">d</span><span class="p">,</span> <span class="n">string</span> <span class="n">a</span><span class="p">,</span> <span class="n">string</span> <span class="n">c</span><span class="p">,</span> <span class="kt">int</span> <span class="n">s</span><span class="p">)</span><span class="o">:</span>
    <span class="n">name</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">department</span><span class="p">(</span><span class="n">d</span><span class="p">),</span> <span class="n">address</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">contact</span><span class="p">(</span><span class="n">c</span><span class="p">),</span> <span class="n">salary</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="p">{}</span>
  <span class="n">string</span> <span class="n">get_name</span><span class="p">()</span> <span class="p">{</span><span class="k">return</span> <span class="n">name</span><span class="p">;}</span>
  <span class="n">string</span> <span class="n">get_department</span><span class="p">()</span> <span class="p">{</span><span class="k">return</span> <span class="n">department</span><span class="p">;}</span>
  <span class="n">string</span> <span class="n">get_address</span><span class="p">()</span> <span class="p">{</span><span class="k">return</span> <span class="n">address</span><span class="p">;}</span>
  <span class="n">string</span> <span class="n">get_contact</span><span class="p">()</span> <span class="p">{</span><span class="k">return</span> <span class="n">contact</span><span class="p">;}</span>
  <span class="k">virtual</span> <span class="kt">int</span> <span class="n">get_payment</span><span class="p">()</span> <span class="p">{</span><span class="k">return</span> <span class="n">salary</span><span class="p">;}</span>
<span class="p">};</span>
<span class="k">class</span> <span class="nc">Manager</span><span class="o">:</span> <span class="k">public</span> <span class="n">Employee</span>
<span class="p">{</span>
<span class="k">protected</span><span class="o">:</span>
  <span class="kt">int</span> <span class="n">bonus</span><span class="p">;</span>
<span class="k">public</span><span class="o">:</span>
  <span class="n">Manager</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>
  <span class="n">Manager</span><span class="p">(</span><span class="n">string</span> <span class="n">n</span><span class="p">,</span> <span class="n">string</span> <span class="n">d</span><span class="p">,</span> <span class="n">string</span> <span class="n">a</span><span class="p">,</span> <span class="n">string</span> <span class="n">c</span><span class="p">,</span> <span class="kt">int</span> <span class="n">s</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span><span class="o">:</span>
    <span class="n">Employee</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">s</span><span class="p">),</span> <span class="n">bonus</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="p">{}</span>
  <span class="kt">int</span> <span class="n">get_payment</span><span class="p">()</span> <span class="k">override</span> <span class="p">{</span><span class="k">return</span> <span class="n">salary</span> <span class="o">+</span> <span class="n">bonus</span><span class="p">;}</span>
<span class="p">};</span>
<span class="k">class</span> <span class="nc">CEO</span><span class="o">:</span> <span class="k">public</span> <span class="n">Manager</span>
<span class="p">{</span>
<span class="k">protected</span><span class="o">:</span>
  <span class="kt">int</span> <span class="n">share</span><span class="p">;</span>
<span class="k">public</span><span class="o">:</span>
  <span class="n">CEO</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>
  <span class="n">CEO</span><span class="p">(</span><span class="n">string</span> <span class="n">n</span><span class="p">,</span> <span class="n">string</span> <span class="n">d</span><span class="p">,</span> <span class="n">string</span> <span class="n">a</span><span class="p">,</span> <span class="n">string</span> <span class="n">c</span><span class="p">,</span> <span class="kt">int</span> <span class="n">s</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">,</span> <span class="kt">int</span> <span class="n">sh</span><span class="p">)</span><span class="o">:</span>
    <span class="n">Manager</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">b</span><span class="p">),</span> <span class="n">share</span><span class="p">(</span><span class="n">sh</span><span class="p">)</span> <span class="p">{}</span>
  <span class="kt">int</span> <span class="n">get_payment</span><span class="p">()</span> <span class="k">override</span> <span class="p">{</span><span class="k">return</span> <span class="n">salary</span> <span class="o">+</span> <span class="n">bonus</span> <span class="o">+</span> <span class="n">share</span><span class="p">;}</span>
<span class="p">};</span>
</pre></div>
</div>
</div>

<div id="outline-container-org9dfd212" class="outline-2">
<h2 id="org9dfd212">Exercise 15.22</h2>
<div class="outline-text-2" id="text-org9dfd212">
<div class="highlight"><pre><span></span><span class="c1">// See 15.21.cpp.</span>
</pre></div>
</div>
</div>

<div id="outline-container-orge6c76be" class="outline-2">
<h2 id="orge6c76be">15.21.cpp</h2>
<div class="outline-text-2" id="text-orge6c76be">
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Employee</span>
<span class="p">{</span>
<span class="k">private</span><span class="o">:</span>
  <span class="n">string</span> <span class="n">name</span><span class="p">;</span>
  <span class="n">string</span> <span class="n">department</span><span class="p">;</span>
  <span class="n">string</span> <span class="n">address</span><span class="p">;</span>
  <span class="n">string</span> <span class="n">contact</span><span class="p">;</span>
<span class="k">protected</span><span class="o">:</span>
  <span class="kt">int</span> <span class="n">salary</span><span class="p">;</span>
<span class="k">public</span><span class="o">:</span>
  <span class="n">Employee</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>
  <span class="n">Employee</span><span class="p">(</span><span class="n">string</span> <span class="n">n</span><span class="p">,</span> <span class="n">string</span> <span class="n">d</span><span class="p">,</span> <span class="n">string</span> <span class="n">a</span><span class="p">,</span> <span class="n">string</span> <span class="n">c</span><span class="p">,</span> <span class="kt">int</span> <span class="n">s</span><span class="p">)</span><span class="o">:</span>
    <span class="n">name</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">department</span><span class="p">(</span><span class="n">d</span><span class="p">),</span> <span class="n">address</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">contact</span><span class="p">(</span><span class="n">c</span><span class="p">),</span> <span class="n">salary</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="p">{}</span>
  <span class="n">string</span> <span class="n">get_name</span><span class="p">()</span> <span class="p">{</span><span class="k">return</span> <span class="n">name</span><span class="p">;}</span>
  <span class="n">string</span> <span class="n">get_department</span><span class="p">()</span> <span class="p">{</span><span class="k">return</span> <span class="n">department</span><span class="p">;}</span>
  <span class="n">string</span> <span class="n">get_address</span><span class="p">()</span> <span class="p">{</span><span class="k">return</span> <span class="n">address</span><span class="p">;}</span>
  <span class="n">string</span> <span class="n">get_contact</span><span class="p">()</span> <span class="p">{</span><span class="k">return</span> <span class="n">contact</span><span class="p">;}</span>
  <span class="k">virtual</span> <span class="kt">int</span> <span class="n">get_payment</span><span class="p">()</span> <span class="p">{</span><span class="k">return</span> <span class="n">salary</span><span class="p">;}</span>
<span class="p">};</span>
<span class="k">class</span> <span class="nc">Manager</span><span class="o">:</span> <span class="k">public</span> <span class="n">Employee</span>
<span class="p">{</span>
<span class="k">protected</span><span class="o">:</span>
  <span class="kt">int</span> <span class="n">bonus</span><span class="p">;</span>
<span class="k">public</span><span class="o">:</span>
  <span class="n">Manager</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>
  <span class="n">Manager</span><span class="p">(</span><span class="n">string</span> <span class="n">n</span><span class="p">,</span> <span class="n">string</span> <span class="n">d</span><span class="p">,</span> <span class="n">string</span> <span class="n">a</span><span class="p">,</span> <span class="n">string</span> <span class="n">c</span><span class="p">,</span> <span class="kt">int</span> <span class="n">s</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">)</span><span class="o">:</span>
    <span class="n">Employee</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">s</span><span class="p">),</span> <span class="n">bonus</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="p">{}</span>
  <span class="kt">int</span> <span class="n">get_payment</span><span class="p">()</span> <span class="k">override</span> <span class="p">{</span><span class="k">return</span> <span class="n">salary</span> <span class="o">+</span> <span class="n">bonus</span><span class="p">;}</span>
<span class="p">};</span>
<span class="k">class</span> <span class="nc">CEO</span><span class="o">:</span> <span class="k">public</span> <span class="n">Manager</span>
<span class="p">{</span>
<span class="k">protected</span><span class="o">:</span>
  <span class="kt">int</span> <span class="n">share</span><span class="p">;</span>
<span class="k">public</span><span class="o">:</span>
  <span class="n">CEO</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>
  <span class="n">CEO</span><span class="p">(</span><span class="n">string</span> <span class="n">n</span><span class="p">,</span> <span class="n">string</span> <span class="n">d</span><span class="p">,</span> <span class="n">string</span> <span class="n">a</span><span class="p">,</span> <span class="n">string</span> <span class="n">c</span><span class="p">,</span> <span class="kt">int</span> <span class="n">s</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">,</span> <span class="kt">int</span> <span class="n">sh</span><span class="p">)</span><span class="o">:</span>
    <span class="n">Manager</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">b</span><span class="p">),</span> <span class="n">share</span><span class="p">(</span><span class="n">sh</span><span class="p">)</span> <span class="p">{}</span>
  <span class="kt">int</span> <span class="n">get_payment</span><span class="p">()</span> <span class="k">override</span> <span class="p">{</span><span class="k">return</span> <span class="n">salary</span> <span class="o">+</span> <span class="n">bonus</span> <span class="o">+</span> <span class="n">share</span><span class="p">;}</span>
<span class="p">};</span>
</pre></div>
</div>
</div>

<div id="outline-container-org0bc6885" class="outline-2">
<h2 id="org0bc6885">Exercise 15.23</h2>
<div class="outline-text-2" id="text-org0bc6885">
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Base</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
  <span class="k">virtual</span> <span class="kt">int</span> <span class="n">fcn</span><span class="p">();</span>
<span class="p">};</span>
<span class="k">class</span> <span class="nc">D1</span><span class="o">:</span> <span class="k">public</span> <span class="n">Base</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
  <span class="kt">int</span> <span class="n">fcn</span><span class="p">()</span> <span class="k">override</span><span class="p">;</span>
  <span class="kt">int</span> <span class="nf">fcn</span><span class="p">(</span><span class="kt">int</span><span class="p">);</span>
  <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">f2</span><span class="p">();</span>
<span class="p">};</span>
<span class="k">class</span> <span class="nc">D2</span><span class="o">:</span> <span class="k">public</span> <span class="n">D1</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
  <span class="kt">int</span> <span class="n">fcn</span><span class="p">(</span><span class="kt">int</span><span class="p">);</span>
  <span class="kt">int</span> <span class="nf">fcn</span><span class="p">()</span> <span class="k">override</span><span class="p">;</span>
  <span class="kt">void</span> <span class="nf">f2</span><span class="p">()</span> <span class="k">override</span><span class="p">;</span>
<span class="p">};</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">Base</span> <span class="n">bobj</span><span class="p">;</span>
  <span class="n">D1</span> <span class="n">d1obj</span><span class="p">;</span>
  <span class="n">D2</span> <span class="n">d2obj</span><span class="p">;</span>
  <span class="n">Base</span> <span class="o">*</span><span class="n">bp1</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">bobj</span><span class="p">,</span> <span class="o">*</span><span class="n">bp2</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">d1obj</span><span class="p">,</span> <span class="o">*</span><span class="n">bp3</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">d2obj</span><span class="p">;</span>
  <span class="c1">// ...</span>
  <span class="n">bp2</span><span class="o">-&gt;</span><span class="n">fcn</span><span class="p">();</span>			<span class="c1">// D1::fcn()</span>
  <span class="c1">// ...</span>
  <span class="c1">// others stay unchanged</span>
<span class="p">}</span>
</pre></div>
</div>
</div>

<div id="outline-container-org1dd9b3a" class="outline-2">
<h2 id="org1dd9b3a">Exercise 15.24</h2>
<div class="outline-text-2" id="text-org1dd9b3a">
<div class="highlight"><pre><span></span><span class="c1">// Base class and its derived class require a virtual destructor;</span>
<span class="c1">// a virtual destructor of class type should release the resource occupied by the object of that type.</span>
</pre></div>
</div>
</div>

<div id="outline-container-orgeeba146" class="outline-2">
<h2 id="orgeeba146">Exercise 15.25</h2>
<div class="outline-text-2" id="text-orgeeba146">
<div class="highlight"><pre><span></span><span class="c1">// Due to the fact that we have defined a constructor with paremeters for Disc_quote class, then there would be no default constructor fot this class;</span>
<span class="c1">// but there is a default constructor defined within Bulk_quote class, which is a derived class of Disc_quote; when this constructor is called, it would call the default constructor of Disc_quote class to construct a Disc_quote sub-object;</span>
<span class="c1">// so we must define a default constructor for Disc_quote class, or the calling of default constructor of Bulk_quote would fail.</span>
</pre></div>
</div>
</div>

<div id="outline-container-org30f806b" class="outline-2">
<h2 id="org30f806b">Exercise 15.26</h2>
<div class="outline-text-2" id="text-org30f806b">
<div class="highlight"><pre><span></span><span class="c1">// See Quote.h and Bulk_quote.h.</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">Quote</span> <span class="n">q</span><span class="p">;</span>
  <span class="c1">// Bulk_quote b;</span>
  <span class="c1">// Quote q2 = q;</span>
  <span class="c1">// Quote q3 = std::move(q);</span>
  <span class="c1">// q = q2;</span>
  <span class="c1">// q = std::move(q3);</span>
  <span class="c1">// Bulk_quote b2 = b;</span>
  <span class="c1">// Bulk_quote b3 = std::move(b);</span>
  <span class="c1">// b = b2;</span>
  <span class="c1">// b = std::move(b2);</span>
<span class="p">}</span>
</pre></div>

<p>
<a href="#orgecc71b4">Bulk_quote.h</a>
</p>

<p>
<a href="#org9f28c2c">Quote.h</a>
</p>
</div>
</div>

<div id="outline-container-org7b9bb4f" class="outline-2">
<h2 id="org7b9bb4f">Exercise 15.27</h2>
<div class="outline-text-2" id="text-org7b9bb4f">
<div class="highlight"><pre><span></span><span class="c1">// See Bulk_quote.h.</span>
</pre></div>

<p>
<a href="#orgecc71b4">Bulk_quote.h</a>
</p>
</div>
</div>

<div id="outline-container-orgcc375b4" class="outline-2">
<h2 id="orgcc375b4">Exercise 15.28</h2>
<div class="outline-text-2" id="text-orgcc375b4">
<div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">vector</span><span class="o">&lt;</span><span class="n">Quote</span><span class="o">&gt;</span> <span class="n">basket1</span><span class="p">;</span>
  <span class="n">basket1</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">Bulk_quote</span><span class="p">(</span><span class="s">"123"</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mf">0.10</span><span class="p">));</span>
  <span class="n">basket1</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">Bulk_quote</span><span class="p">(</span><span class="s">"234"</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">));</span>
  <span class="kt">double</span> <span class="n">total</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
  <span class="k">for</span><span class="p">(</span><span class="k">const</span> <span class="k">auto</span> <span class="o">&amp;</span><span class="nl">p</span> <span class="p">:</span> <span class="n">basket1</span><span class="p">)</span>
    <span class="n">total</span> <span class="o">+=</span> <span class="n">p</span><span class="p">.</span><span class="n">net_price</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">total</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">string</span><span class="p">(</span><span class="s">"="</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">vector</span><span class="o">&lt;</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Quote</span><span class="o">&gt;&gt;</span> <span class="n">basket2</span><span class="p">;</span>
  <span class="n">basket2</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">Bulk_quote</span><span class="o">&gt;</span><span class="p">(</span><span class="s">"123"</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mf">0.10</span><span class="p">));</span>
  <span class="n">basket2</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">Bulk_quote</span><span class="o">&gt;</span><span class="p">(</span><span class="s">"234"</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">));</span>
  <span class="n">total</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
  <span class="k">for</span><span class="p">(</span><span class="k">const</span> <span class="k">auto</span> <span class="o">&amp;</span><span class="nl">p</span> <span class="p">:</span> <span class="n">basket2</span><span class="p">)</span>
    <span class="n">total</span> <span class="o">+=</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">net_price</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">total</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>

<div id="outline-container-orgad39f95" class="outline-2">
<h2 id="orgad39f95">Exercise 15.29</h2>
<div class="outline-text-2" id="text-orgad39f95">
<div class="highlight"><pre><span></span><span class="c1">// See 15.28.cpp.</span>
<span class="c1">// The output is different from the previous one;</span>
<span class="c1">// for the first version of basket's element type is Quote, when pushed a Bulk_quote object into this vector, a Quote object as a copy of the Qutoe part of Bulk_quote object is pushed in, at last we call the Quote's net_price version;</span>
<span class="c1">// for the next version of basket's element type is shared_ptr&lt;quote&gt;, a shared_ptr&lt;quote&gt; could be binded to a Bulk_quote object because Bulk_quote public derived from Quote class, then the version of net_price is determined by object's dynamic type.</span>
</pre></div>
</div>
</div>

<div id="outline-container-orga48b17f" class="outline-2">
<h2 id="orga48b17f">15.28.cpp</h2>
<div class="outline-text-2" id="text-orga48b17f">
<div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">vector</span><span class="o">&lt;</span><span class="n">Quote</span><span class="o">&gt;</span> <span class="n">basket1</span><span class="p">;</span>
  <span class="n">basket1</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">Bulk_quote</span><span class="p">(</span><span class="s">"123"</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mf">0.10</span><span class="p">));</span>
  <span class="n">basket1</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">Bulk_quote</span><span class="p">(</span><span class="s">"234"</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">));</span>
  <span class="kt">double</span> <span class="n">total</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
  <span class="k">for</span><span class="p">(</span><span class="k">const</span> <span class="k">auto</span> <span class="o">&amp;</span><span class="nl">p</span> <span class="p">:</span> <span class="n">basket1</span><span class="p">)</span>
    <span class="n">total</span> <span class="o">+=</span> <span class="n">p</span><span class="p">.</span><span class="n">net_price</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">total</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">string</span><span class="p">(</span><span class="s">"="</span><span class="p">,</span> <span class="mi">15</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">vector</span><span class="o">&lt;</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Quote</span><span class="o">&gt;&gt;</span> <span class="n">basket2</span><span class="p">;</span>
  <span class="n">basket2</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">Bulk_quote</span><span class="o">&gt;</span><span class="p">(</span><span class="s">"123"</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mf">0.10</span><span class="p">));</span>
  <span class="n">basket2</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">Bulk_quote</span><span class="o">&gt;</span><span class="p">(</span><span class="s">"234"</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">));</span>
  <span class="n">total</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
  <span class="k">for</span><span class="p">(</span><span class="k">const</span> <span class="k">auto</span> <span class="o">&amp;</span><span class="nl">p</span> <span class="p">:</span> <span class="n">basket2</span><span class="p">)</span>
    <span class="n">total</span> <span class="o">+=</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">net_price</span><span class="p">(</span><span class="mi">20</span><span class="p">);</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">total</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>

<div id="outline-container-org158eb1a" class="outline-2">
<h2 id="org158eb1a">Exercise 15.30</h2>
<div class="outline-text-2" id="text-org158eb1a">
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Basket</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
  <span class="kt">void</span> <span class="n">add_item</span><span class="p">(</span><span class="k">const</span> <span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Quote</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">sale</span><span class="p">)</span>
  <span class="p">{</span><span class="n">items</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">sale</span><span class="p">);}</span>
  <span class="kt">void</span> <span class="n">add_item</span><span class="p">(</span><span class="k">const</span> <span class="n">Quote</span> <span class="o">&amp;</span><span class="n">sale</span><span class="p">)</span>
  <span class="p">{</span><span class="n">items</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Quote</span><span class="o">&gt;</span><span class="p">(</span><span class="n">sale</span><span class="p">.</span><span class="n">clone</span><span class="p">()));}</span>
  <span class="kt">void</span> <span class="n">add_item</span><span class="p">(</span><span class="n">Quote</span> <span class="o">&amp;&amp;</span><span class="n">sale</span><span class="p">)</span>
  <span class="p">{</span><span class="n">items</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Quote</span><span class="o">&gt;</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">sale</span><span class="p">).</span><span class="n">clone</span><span class="p">()));}</span>
  <span class="kt">double</span> <span class="n">total_receipt</span><span class="p">(</span><span class="n">ostream</span> <span class="o">&amp;</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
<span class="k">private</span><span class="o">:</span>
  <span class="k">static</span> <span class="kt">bool</span> <span class="n">compare</span><span class="p">(</span><span class="k">const</span> <span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Quote</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">lhs</span><span class="p">,</span>
		    <span class="k">const</span> <span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Quote</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">rhs</span><span class="p">)</span>
  <span class="p">{</span><span class="k">return</span> <span class="n">lhs</span><span class="o">-&gt;</span><span class="n">isbn</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">rhs</span><span class="o">-&gt;</span><span class="n">isbn</span><span class="p">();}</span>
  <span class="n">multiset</span><span class="o">&lt;</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Quote</span><span class="o">&gt;</span><span class="p">,</span> <span class="k">decltype</span><span class="p">(</span><span class="n">compare</span><span class="p">)</span><span class="o">*&gt;</span>
  <span class="n">items</span><span class="p">{</span><span class="n">compare</span><span class="p">};</span>
<span class="p">};</span>
<span class="kt">double</span> <span class="n">Basket</span><span class="o">::</span><span class="n">total_receipt</span><span class="p">(</span><span class="n">ostream</span> <span class="o">&amp;</span><span class="n">os</span><span class="p">)</span> <span class="k">const</span>
<span class="p">{</span>
  <span class="kt">double</span> <span class="n">sum</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
  <span class="k">for</span><span class="p">(</span><span class="k">auto</span> <span class="n">iter</span> <span class="o">=</span> <span class="n">items</span><span class="p">.</span><span class="n">cbegin</span><span class="p">();</span>
      <span class="n">iter</span> <span class="o">!=</span> <span class="n">items</span><span class="p">.</span><span class="n">cend</span><span class="p">();</span>
      <span class="n">iter</span> <span class="o">=</span> <span class="n">items</span><span class="p">.</span><span class="n">upper_bound</span><span class="p">(</span><span class="o">*</span><span class="n">iter</span><span class="p">))</span>
    <span class="p">{</span><span class="n">sum</span> <span class="o">+=</span> <span class="n">print_total</span><span class="p">(</span><span class="n">os</span><span class="p">,</span> <span class="o">**</span><span class="n">iter</span><span class="p">,</span> <span class="n">items</span><span class="p">.</span><span class="n">count</span><span class="p">(</span><span class="o">*</span><span class="n">iter</span><span class="p">));}</span>
  <span class="n">os</span> <span class="o">&lt;&lt;</span> <span class="s">"Total Sale: "</span> <span class="o">&lt;&lt;</span> <span class="n">sum</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="k">return</span> <span class="n">sum</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">Basket</span> <span class="n">basket</span><span class="p">;</span>
  <span class="n">basket</span><span class="p">.</span><span class="n">add_item</span><span class="p">(</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">Quote</span><span class="o">&gt;</span><span class="p">(</span><span class="s">"123"</span><span class="p">,</span> <span class="mi">50</span><span class="p">));</span>
  <span class="n">basket</span><span class="p">.</span><span class="n">add_item</span><span class="p">(</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">Quote</span><span class="o">&gt;</span><span class="p">(</span><span class="s">"234"</span><span class="p">,</span> <span class="mi">60</span><span class="p">));</span>
  <span class="n">basket</span><span class="p">.</span><span class="n">total_receipt</span><span class="p">(</span><span class="n">cout</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>

<div id="outline-container-org17c040f" class="outline-2">
<h2 id="org17c040f">Exercise 15.31</h2>
<div class="outline-text-2" id="text-org17c040f">
<div class="highlight"><pre><span></span><span class="c1">// Query(s1) | Query(s2) &amp; ~Query(s3);</span>
<span class="c1">// returns a Query object binded to a AndQuery object;</span>
<span class="c1">// Query(s1) | Query(s2) returns a Query object binded to a OrQuery object;</span>
<span class="c1">// ~Query(s3) returns a Query object binded to a NotQuery object;</span>
<span class="c1">// the base level are all WordQuery objects.</span>
<span class="c1">// Query(s1) | (Query(s2) &amp; ~Query(s3));</span>
<span class="c1">// returns a Query object binded to a OrQuery object</span>
<span class="c1">// Query(s1) returns a Query object binded to WordQuery object;</span>
<span class="c1">// (Query(s2) &amp; ~Query(s3)) returns a Query object binded to a AndQuery object;</span>
<span class="c1">// ~Query(s3) returns a Query object binded to a NotQuery object;</span>
<span class="c1">// the base level are all WordQuery objects.</span>
<span class="c1">// (Query(s1) &amp; (Query(s2)) | (Query(s3) &amp; Query(s4)))</span>
<span class="c1">// returns a Query object binded to OrQuery object</span>
<span class="c1">// (Query(s1) &amp; (Query(s2))) returns a Query object binded to a AndQuery object;</span>
<span class="c1">// (Query(s3) &amp; Query(s4)) returns a Query object binded to a AndQuery object;</span>
<span class="c1">// the base level are all WordQuery objects.</span>
</pre></div>
</div>
</div>

<div id="outline-container-org44c6900" class="outline-2">
<h2 id="org44c6900">Exercise 15.32</h2>
<div class="outline-text-2" id="text-org44c6900">
<div class="highlight"><pre><span></span><span class="c1">// When a Query class type object is copied:</span>
<span class="c1">// would call the synthesized copy constructor of Query class, then the copy constructor of shared_ptr&lt;Query_base&gt; is called to constructor the new Query object's data member q, and the use count of both shared_ptr objects increase by 1;</span>
<span class="c1">// move</span>
<span class="c1">// since shared_ptr&lt;Query_base&gt; has a move constructor and there is no self-defined copy control members within Query, there is a synthesized move constructor, it is called to move construct the new Query object's data member q, the use-count stay unchanged;</span>
<span class="c1">// assignment</span>
<span class="c1">// synthesized copy-assignment operator or synthesized move-assignment operator: depenes on whether it is copy assignment or move assignment, this would call copy-assignment operator or move-assignment operator of shared_ptr&lt;Query_base&gt; to assign the left Query object's data member q, and use count increase by 1 or stay unchanged;</span>
<span class="c1">// destruction</span>
<span class="c1">// synthesized destructor: just call the destructor of shared_ptr&lt;Query_base&gt; member; depends on the use-count of this shared_ptr object, if it comes to 0 the destructor of the pointed object would be called(which destructor relies on its dynamic type).</span>
</pre></div>
</div>
</div>

<div id="outline-container-org33faf3a" class="outline-2">
<h2 id="org33faf3a">Exercise 15.33</h2>
<div class="outline-text-2" id="text-org33faf3a">
<div class="highlight"><pre><span></span><span class="c1">// This exercise should specify that the object is of derived class type whose base class is Query_base</span>
<span class="c1">// call the derived class type object's own copy control members;</span>
<span class="c1">// thus would call the synthesized version of copy control members of Query_base.</span>
</pre></div>
</div>
</div>

<div id="outline-container-org08e8a5e" class="outline-2">
<h2 id="org08e8a5e">Exercise 15.34</h2>
<div class="outline-text-2" id="text-org08e8a5e">
<div class="highlight"><pre><span></span><span class="c1">// Query q = Query("fiery") &amp; Query("bird") | Query("wind")</span>
<span class="c1">// a</span>
<span class="c1">// constructor:</span>
<span class="c1">// Query(const string &amp;);</span>
<span class="c1">// WordQuery(const string &amp;);</span>
<span class="c1">// AndQuery(const Query &amp;, cosnt Query &amp;);</span>
<span class="c1">// OrQuery(const Query &amp;, const Query &amp;);</span>
<span class="c1">// BinaryQuery(const Query &amp;, const Query &amp;, string);</span>
<span class="c1">// Query_base();</span>
<span class="c1">// Query(shared_ptr&lt;Query_base&gt;)</span>
<span class="c1">// b</span>
<span class="c1">// Query::rep() // missed in first attempt</span>
<span class="c1">// BinaryQuery::rep()</span>
<span class="c1">// WordQuery::rep()</span>
<span class="c1">// c</span>
<span class="c1">// OrQuery::eval</span>
<span class="c1">// AndQuery::eval</span>
<span class="c1">// WordQuery::eval</span>
</pre></div>
</div>
</div>

<div id="outline-container-orgbfff06d" class="outline-2">
<h2 id="orgbfff06d">Exercise 15.36</h2>
<div class="outline-text-2" id="text-orgbfff06d">
<div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">Query</span> <span class="n">q</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span><span class="s">"fiery"</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">Query</span><span class="p">(</span><span class="s">"bird"</span><span class="p">)</span> <span class="o">|</span> <span class="n">Query</span><span class="p">(</span><span class="s">"wind"</span><span class="p">);</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">q</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>

<div id="outline-container-orgff9ed25" class="outline-2">
<h2 id="orgff9ed25">Exercise 15.37</h2>
<div class="outline-text-2" id="text-orgff9ed25">
<div class="highlight"><pre><span></span><span class="c1">// Change the parameter type of 'const Query &amp;' to 'shared_ptr&lt;Query_base&gt;' for NotQuery, BinaryQuery, AndQuery and OrQuery class's constructor, use passed in argument to initialize data member shared_ptr&lt;Query_base&gt;;</span>
<span class="c1">// the call of eval and rep inside class type now uses shared_ptr&lt;Query_base&gt; data members and '-&gt;' operator.</span>
<span class="c1">// three overload operator functions should change its paramter type from 'const Query &amp;' to 'shared_ptr&lt;Query_base&gt;', and its return type from 'Query' to 'shared_ptr&lt;Query_base&gt;' too. </span>
<span class="c1">// in a word, the interface layer of Query class is replaced by direct operation of shared_ptr&lt;Query_base&gt;.</span>
</pre></div>
</div>
</div>

<div id="outline-container-orgfe57ee8" class="outline-2">
<h2 id="orgfe57ee8">Exercise 15.38</h2>
<div class="outline-text-2" id="text-orgfe57ee8">
<div class="highlight"><pre><span></span><span class="c1">// BinaryQuery a = Query("fiery") &amp; Query("bird")</span>
<span class="c1">// false;</span>
<span class="c1">// BinaryQuery is a abstract class, construct of this class type is illegal.</span>
<span class="c1">// AndQuery b = Query("fiery") &amp; Query("bird")</span>
<span class="c1">// false</span>
<span class="c1">// operator&amp;(const Query &amp;, const Query &amp;) returns a object of Query class type, not AndQuery, and there is no available way of conversion from Query to AndQuery.</span>
<span class="c1">// OrQuery b = Query("fiery") &amp; Query("bird")</span>
<span class="c1">// false</span>
<span class="c1">// operator&amp;(const Query &amp;, const Query &amp;) returns a object of Query class type, not OrQuery, and there is no available way of conversion from Query to OrQuery.</span>
</pre></div>
</div>
</div>

<div id="outline-container-org2af1b51" class="outline-2">
<h2 id="org2af1b51">Exercise 15.39</h2>
<div class="outline-text-2" id="text-org2af1b51">
<div class="highlight"><pre><span></span><span class="c1">// See 15.35.h.</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span>
<span class="p">{</span>
  <span class="n">ifstream</span> <span class="n">ifs</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
  <span class="n">TextQuery</span> <span class="n">tq</span><span class="p">(</span><span class="n">ifs</span><span class="p">);</span>
  <span class="n">Query</span> <span class="n">q</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span><span class="s">"fiery"</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">Query</span><span class="p">(</span><span class="s">"bird"</span><span class="p">)</span> <span class="o">|</span> <span class="n">Query</span><span class="p">(</span><span class="s">"wind"</span><span class="p">);</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">q</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="k">auto</span> <span class="n">result</span> <span class="o">=</span> <span class="n">q</span><span class="p">.</span><span class="n">eval</span><span class="p">(</span><span class="n">tq</span><span class="p">);</span>
  <span class="n">print</span><span class="p">(</span><span class="n">cout</span><span class="p">,</span> <span class="n">result</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>

<div id="outline-container-org33d52f8" class="outline-2">
<h2 id="org33d52f8">15.35.h</h2>
<div class="outline-text-2" id="text-org33d52f8">
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Query_base</span>
<span class="p">{</span>
  <span class="k">friend</span> <span class="k">class</span> <span class="nc">Query</span><span class="p">;</span>
<span class="k">protected</span><span class="o">:</span>
  <span class="k">using</span> <span class="n">line_no</span> <span class="o">=</span> <span class="n">TextQuery</span><span class="o">::</span><span class="n">line_no</span><span class="p">;</span>
  <span class="n">Query_base</span><span class="p">()</span> <span class="p">{</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Query_base::Query_base()"</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;}</span>
  <span class="k">virtual</span> <span class="o">~</span><span class="n">Query_base</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>
<span class="k">private</span><span class="o">:</span>
  <span class="k">virtual</span> <span class="n">QueryResult</span> <span class="n">eval</span><span class="p">(</span><span class="k">const</span> <span class="n">TextQuery</span> <span class="o">&amp;</span><span class="p">)</span> <span class="k">const</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">virtual</span> <span class="n">string</span> <span class="nf">rep</span><span class="p">()</span> <span class="k">const</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">};</span>
<span class="k">class</span> <span class="nc">Query</span>
<span class="p">{</span>
  <span class="k">friend</span> <span class="n">Query</span> <span class="k">operator</span><span class="o">~</span><span class="p">(</span><span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="p">);</span>
  <span class="k">friend</span> <span class="n">Query</span> <span class="k">operator</span><span class="o">|</span><span class="p">(</span><span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="p">,</span> <span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="p">);</span>
  <span class="k">friend</span> <span class="n">Query</span> <span class="k">operator</span><span class="o">&amp;</span><span class="p">(</span><span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="p">,</span> <span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="p">);</span>
<span class="k">public</span><span class="o">:</span>
  <span class="n">Query</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="p">);</span>
  <span class="n">QueryResult</span> <span class="nf">eval</span><span class="p">(</span><span class="k">const</span> <span class="n">TextQuery</span> <span class="o">&amp;</span><span class="n">t</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span><span class="k">return</span> <span class="n">q</span><span class="o">-&gt;</span><span class="n">eval</span><span class="p">(</span><span class="n">t</span><span class="p">);}</span>
  <span class="n">string</span> <span class="nf">rep</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Query::rep"</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span> <span class="k">return</span> <span class="n">q</span><span class="o">-&gt;</span><span class="n">rep</span><span class="p">();}</span>
<span class="k">private</span><span class="o">:</span>
 <span class="n">Query</span><span class="p">(</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Query_base</span><span class="o">&gt;</span> <span class="n">query</span><span class="p">)</span><span class="o">:</span> <span class="n">q</span><span class="p">(</span><span class="n">query</span><span class="p">)</span> <span class="p">{</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Query::Query(shared_ptr)"</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;}</span>
  <span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Query_base</span><span class="o">&gt;</span> <span class="n">q</span><span class="p">;</span>
<span class="p">};</span>
<span class="k">class</span> <span class="nc">WordQuery</span><span class="o">:</span> <span class="k">public</span> <span class="n">Query_base</span>
<span class="p">{</span>
  <span class="k">friend</span> <span class="k">class</span> <span class="nc">Query</span><span class="p">;</span>
 <span class="n">WordQuery</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="n">s</span><span class="p">)</span><span class="o">:</span> <span class="n">query_word</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="p">{</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"WordQuery::WordQuery(const string &amp;)"</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;}</span>
  <span class="n">QueryResult</span> <span class="n">eval</span><span class="p">(</span><span class="k">const</span> <span class="n">TextQuery</span> <span class="o">&amp;</span><span class="n">t</span><span class="p">)</span> <span class="k">const</span>
  <span class="p">{</span><span class="k">return</span> <span class="n">t</span><span class="p">.</span><span class="n">query</span><span class="p">(</span><span class="n">query_word</span><span class="p">);}</span>
  <span class="n">string</span> <span class="n">rep</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"WordQuery::rep"</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span> <span class="k">return</span> <span class="n">query_word</span><span class="p">;}</span>
  <span class="n">string</span> <span class="n">query_word</span><span class="p">;</span>
<span class="p">};</span>
<span class="kr">inline</span> <span class="n">Query</span><span class="o">::</span><span class="n">Query</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="n">s</span><span class="p">)</span><span class="o">:</span> <span class="n">q</span><span class="p">(</span><span class="k">new</span> <span class="n">WordQuery</span><span class="p">(</span><span class="n">s</span><span class="p">))</span> <span class="p">{</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Query::Query(const string &amp;)"</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;}</span>
<span class="k">class</span> <span class="nc">BinaryQuery</span><span class="o">:</span> <span class="k">public</span> <span class="n">Query_base</span>
<span class="p">{</span>
 <span class="k">protected</span><span class="o">:</span>
 <span class="n">BinaryQuery</span><span class="p">(</span><span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="n">l</span><span class="p">,</span> <span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="n">r</span><span class="p">,</span> <span class="n">string</span> <span class="n">s</span><span class="p">)</span><span class="o">:</span>
  <span class="n">lhs</span><span class="p">(</span><span class="n">l</span><span class="p">),</span> <span class="n">rhs</span><span class="p">(</span><span class="n">r</span><span class="p">),</span> <span class="n">opSym</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="p">{</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"BinaryQuery::BinaryQuery"</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;}</span>
  <span class="n">string</span> <span class="n">rep</span><span class="p">()</span> <span class="k">const</span>
  <span class="p">{</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"BinaryQuery::rep"</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="k">return</span> <span class="s">"("</span> <span class="o">+</span> <span class="n">lhs</span><span class="p">.</span><span class="n">rep</span><span class="p">()</span> <span class="o">+</span> <span class="s">" "</span>
      <span class="o">+</span> <span class="n">opSym</span> <span class="o">+</span> <span class="s">" "</span>
      <span class="o">+</span> <span class="n">rhs</span><span class="p">.</span><span class="n">rep</span><span class="p">()</span> <span class="o">+</span> <span class="s">")"</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">Query</span> <span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">;</span>
  <span class="n">string</span> <span class="n">opSym</span><span class="p">;</span>
<span class="p">};</span>
<span class="k">class</span> <span class="nc">AndQuery</span><span class="o">:</span> <span class="k">public</span> <span class="n">BinaryQuery</span>
<span class="p">{</span>
  <span class="k">friend</span> <span class="n">Query</span> <span class="k">operator</span><span class="o">&amp;</span><span class="p">(</span><span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="p">,</span> <span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="p">);</span>
 <span class="n">AndQuery</span><span class="p">(</span><span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="n">left</span><span class="p">,</span> <span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="n">right</span><span class="p">)</span><span class="o">:</span>
  <span class="n">BinaryQuery</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="s">"&amp;"</span><span class="p">)</span> <span class="p">{</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"AndQuery::AndQuery"</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;}</span>
  <span class="n">QueryResult</span> <span class="n">eval</span><span class="p">(</span><span class="k">const</span> <span class="n">TextQuery</span> <span class="o">&amp;</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
<span class="p">};</span>
<span class="kr">inline</span> <span class="n">Query</span> <span class="k">operator</span><span class="o">&amp;</span><span class="p">(</span><span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="n">lhs</span><span class="p">,</span> <span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="n">rhs</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Query_base</span><span class="o">&gt;</span><span class="p">(</span><span class="k">new</span> <span class="n">AndQuery</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">));</span>
<span class="p">}</span>
<span class="n">QueryResult</span>
<span class="n">AndQuery</span><span class="o">::</span><span class="n">eval</span><span class="p">(</span><span class="k">const</span> <span class="n">TextQuery</span> <span class="o">&amp;</span><span class="n">text</span><span class="p">)</span> <span class="k">const</span>
<span class="p">{</span>
  <span class="k">auto</span> <span class="n">left</span> <span class="o">=</span> <span class="n">lhs</span><span class="p">.</span><span class="n">eval</span><span class="p">(</span><span class="n">text</span><span class="p">),</span> <span class="n">right</span> <span class="o">=</span> <span class="n">rhs</span><span class="p">.</span><span class="n">eval</span><span class="p">(</span><span class="n">text</span><span class="p">);</span>
  <span class="k">auto</span> <span class="n">ret_lines</span> <span class="o">=</span> <span class="n">make_shared</span><span class="o">&lt;</span><span class="n">set</span><span class="o">&lt;</span><span class="n">line_no</span><span class="o">&gt;&gt;</span><span class="p">();</span>
  <span class="n">set_intersection</span><span class="p">(</span><span class="n">left</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">left</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span>
		<span class="n">right</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">right</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span>
		<span class="n">inserter</span><span class="p">(</span><span class="o">*</span><span class="n">ret_lines</span><span class="p">,</span> <span class="n">ret_lines</span><span class="o">-&gt;</span><span class="n">begin</span><span class="p">()));</span>
  <span class="k">return</span> <span class="nf">QueryResult</span><span class="p">(</span><span class="n">rep</span><span class="p">(),</span> <span class="n">ret_lines</span><span class="p">,</span> <span class="n">left</span><span class="p">.</span><span class="n">get_file</span><span class="p">());</span>
<span class="p">}</span>
<span class="k">class</span> <span class="nc">OrQuery</span><span class="o">:</span> <span class="k">public</span> <span class="n">BinaryQuery</span>
<span class="p">{</span>
  <span class="k">friend</span> <span class="n">Query</span> <span class="k">operator</span><span class="o">|</span><span class="p">(</span><span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="p">,</span> <span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="p">);</span>
 <span class="n">OrQuery</span><span class="p">(</span><span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="n">left</span><span class="p">,</span> <span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="n">right</span><span class="p">)</span><span class="o">:</span>
  <span class="n">BinaryQuery</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="s">"|"</span><span class="p">)</span> <span class="p">{</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"OrQUery::OrQuery"</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;}</span>
  <span class="n">QueryResult</span> <span class="n">eval</span><span class="p">(</span><span class="k">const</span> <span class="n">TextQuery</span> <span class="o">&amp;</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
<span class="p">};</span>
<span class="kr">inline</span> <span class="n">Query</span> <span class="k">operator</span><span class="o">|</span><span class="p">(</span><span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="n">lhs</span><span class="p">,</span> <span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="n">rhs</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Query_base</span><span class="o">&gt;</span><span class="p">(</span><span class="k">new</span> <span class="n">OrQuery</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">));</span>
<span class="p">}</span>
<span class="n">ostream</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="n">ostream</span> <span class="o">&amp;</span><span class="n">os</span><span class="p">,</span> <span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="n">query</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="n">os</span> <span class="o">&lt;&lt;</span> <span class="n">query</span><span class="p">.</span><span class="n">rep</span><span class="p">();</span>
<span class="p">}</span>
<span class="n">QueryResult</span> <span class="n">OrQuery</span><span class="o">::</span><span class="n">eval</span><span class="p">(</span><span class="k">const</span> <span class="n">TextQuery</span> <span class="o">&amp;</span><span class="n">text</span><span class="p">)</span> <span class="k">const</span>
<span class="p">{</span>
  <span class="k">auto</span> <span class="n">right</span> <span class="o">=</span> <span class="n">rhs</span><span class="p">.</span><span class="n">eval</span><span class="p">(</span><span class="n">text</span><span class="p">),</span> <span class="n">left</span> <span class="o">=</span> <span class="n">lhs</span><span class="p">.</span><span class="n">eval</span><span class="p">(</span><span class="n">text</span><span class="p">);</span>
  <span class="k">auto</span> <span class="n">ret_lines</span> <span class="o">=</span> <span class="n">make_shared</span><span class="o">&lt;</span><span class="n">set</span><span class="o">&lt;</span><span class="n">line_no</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="n">left</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">left</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>
  <span class="n">ret_lines</span><span class="o">-&gt;</span><span class="n">insert</span><span class="p">(</span><span class="n">right</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">right</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>
  <span class="k">return</span> <span class="nf">QueryResult</span><span class="p">(</span><span class="n">rep</span><span class="p">(),</span> <span class="n">ret_lines</span><span class="p">,</span> <span class="n">left</span><span class="p">.</span><span class="n">get_file</span><span class="p">());</span>
<span class="p">}</span>
<span class="k">class</span> <span class="nc">NotQuery</span><span class="o">:</span> <span class="k">public</span> <span class="n">Query_base</span>
<span class="p">{</span>
  <span class="k">friend</span> <span class="n">Query</span> <span class="k">operator</span><span class="o">~</span><span class="p">(</span><span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="p">);</span>
 <span class="n">NotQuery</span><span class="p">(</span><span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="n">q</span><span class="p">)</span><span class="o">:</span> <span class="n">query</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="p">{}</span>
  <span class="n">string</span> <span class="n">rep</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span><span class="k">return</span> <span class="s">"~("</span> <span class="o">+</span> <span class="n">query</span><span class="p">.</span><span class="n">rep</span><span class="p">()</span> <span class="o">+</span> <span class="s">")"</span><span class="p">;}</span>
  <span class="n">QueryResult</span> <span class="n">eval</span><span class="p">(</span><span class="k">const</span> <span class="n">TextQuery</span> <span class="o">&amp;</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
  <span class="n">Query</span> <span class="n">query</span><span class="p">;</span>
<span class="p">};</span>
<span class="kr">inline</span> <span class="n">Query</span> <span class="k">operator</span><span class="o">~</span><span class="p">(</span><span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="n">operand</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Query_base</span><span class="o">&gt;</span><span class="p">(</span><span class="k">new</span> <span class="n">NotQuery</span><span class="p">(</span><span class="n">operand</span><span class="p">));</span>
<span class="p">}</span>
<span class="n">QueryResult</span>
<span class="n">NotQuery</span><span class="o">::</span><span class="n">eval</span><span class="p">(</span><span class="k">const</span> <span class="n">TextQuery</span> <span class="o">&amp;</span><span class="n">text</span><span class="p">)</span> <span class="k">const</span>
<span class="p">{</span>
  <span class="k">auto</span> <span class="n">result</span> <span class="o">=</span> <span class="n">query</span><span class="p">.</span><span class="n">eval</span><span class="p">(</span><span class="n">text</span><span class="p">);</span>
  <span class="k">auto</span> <span class="n">ret_lines</span> <span class="o">=</span> <span class="n">make_shared</span><span class="o">&lt;</span><span class="n">set</span><span class="o">&lt;</span><span class="n">line_no</span><span class="o">&gt;&gt;</span><span class="p">();</span>
  <span class="k">auto</span> <span class="n">beg</span> <span class="o">=</span> <span class="n">result</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">end</span> <span class="o">=</span> <span class="n">result</span><span class="p">.</span><span class="n">end</span><span class="p">();</span>
  <span class="k">auto</span> <span class="n">sz</span> <span class="o">=</span> <span class="n">result</span><span class="p">.</span><span class="n">get_file</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">();</span>
  <span class="k">for</span><span class="p">(</span><span class="kt">size_t</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">n</span> <span class="o">!=</span> <span class="n">sz</span><span class="p">;</span> <span class="o">++</span><span class="n">n</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span><span class="n">beg</span> <span class="o">==</span> <span class="n">end</span> <span class="o">||</span> <span class="o">*</span><span class="n">beg</span> <span class="o">!=</span> <span class="n">n</span><span class="p">)</span>
      <span class="n">ret_lines</span><span class="o">-&gt;</span><span class="n">insert</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>
      <span class="k">else</span> <span class="nf">if</span><span class="p">(</span><span class="n">beg</span> <span class="o">!=</span> <span class="n">end</span><span class="p">)</span>
      <span class="o">++</span><span class="n">beg</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="k">return</span> <span class="n">QueryResult</span><span class="p">(</span><span class="n">rep</span><span class="p">(),</span> <span class="n">ret_lines</span><span class="p">,</span> <span class="n">result</span><span class="p">.</span><span class="n">get_file</span><span class="p">());</span>
<span class="p">}</span>
</pre></div>
</div>
</div>

<div id="outline-container-orgc2abe7d" class="outline-2">
<h2 id="orgc2abe7d">Exercise 15.40</h2>
<div class="outline-text-2" id="text-orgc2abe7d">
<div class="highlight"><pre><span></span><span class="c1">// Within OrQuery, if rhs.eval(text) returns a QueryResult object which points to an empty set, the return value of OrQuery::eval would be same as the result of lhs.eval(text);</span>
<span class="c1">// vise versa;</span>
<span class="c1">// if both results of rhs.eval and lhs.eval point to an empty set, the return QueryResult of OrQuery::eval points to an empty set, too.</span>
</pre></div>
</div>
</div>

<div id="outline-container-orgd9f63aa" class="outline-2">
<h2 id="orgd9f63aa">Exercise 15.41</h2>
<div class="outline-text-2" id="text-orgd9f63aa">
<div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span>
<span class="p">{</span>
  <span class="n">ifstream</span> <span class="n">ifs</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
  <span class="n">TextQuery</span> <span class="n">tq</span><span class="p">(</span><span class="n">ifs</span><span class="p">);</span>
  <span class="n">Query</span> <span class="n">q</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span><span class="s">"fiery"</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">Query</span><span class="p">(</span><span class="s">"bird"</span><span class="p">)</span> <span class="o">|</span> <span class="n">Query</span><span class="p">(</span><span class="s">"wind"</span><span class="p">);</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">q</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="k">auto</span> <span class="n">result</span> <span class="o">=</span> <span class="n">q</span><span class="p">.</span><span class="n">eval</span><span class="p">(</span><span class="n">tq</span><span class="p">);</span>
  <span class="n">print</span><span class="p">(</span><span class="n">cout</span><span class="p">,</span> <span class="n">result</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>

<div id="outline-container-org184b04f" class="outline-2">
<h2 id="org184b04f">15.41.h</h2>
<div class="outline-text-2" id="text-org184b04f">
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Query_base</span>
<span class="p">{</span>
  <span class="k">friend</span> <span class="k">class</span> <span class="nc">Query</span><span class="p">;</span>
<span class="k">protected</span><span class="o">:</span>
  <span class="k">using</span> <span class="n">line_no</span> <span class="o">=</span> <span class="n">TextQuery</span><span class="o">::</span><span class="n">line_no</span><span class="p">;</span>
  <span class="n">Query_base</span><span class="p">()</span> <span class="p">{}</span>
  <span class="k">virtual</span> <span class="o">~</span><span class="n">Query_base</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>
<span class="k">private</span><span class="o">:</span>
  <span class="k">virtual</span> <span class="n">QueryResult</span> <span class="n">eval</span><span class="p">(</span><span class="k">const</span> <span class="n">TextQuery</span> <span class="o">&amp;</span><span class="p">)</span> <span class="k">const</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">virtual</span> <span class="n">string</span> <span class="nf">rep</span><span class="p">()</span> <span class="k">const</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">class</span> <span class="nc">Query</span>
<span class="p">{</span>
  <span class="k">friend</span> <span class="n">Query</span> <span class="k">operator</span><span class="o">~</span><span class="p">(</span><span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="p">);</span>
  <span class="k">friend</span> <span class="n">Query</span> <span class="k">operator</span><span class="o">|</span><span class="p">(</span><span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="p">,</span> <span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="p">);</span>
  <span class="k">friend</span> <span class="n">Query</span> <span class="k">operator</span><span class="o">&amp;</span><span class="p">(</span><span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="p">,</span> <span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="p">);</span>
<span class="k">public</span><span class="o">:</span>
  <span class="n">Query</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="p">);</span>
  <span class="n">Query</span><span class="p">(</span><span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="n">p</span><span class="p">)</span><span class="o">:</span> <span class="n">q</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">q</span><span class="p">),</span> <span class="n">use</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">use</span><span class="p">)</span> <span class="p">{</span><span class="o">++*</span><span class="n">use</span><span class="p">;}</span>
  <span class="n">Query</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="n">p</span><span class="p">);</span>
  <span class="n">QueryResult</span> <span class="nf">eval</span><span class="p">(</span><span class="k">const</span> <span class="n">TextQuery</span> <span class="o">&amp;</span><span class="n">t</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span><span class="k">return</span> <span class="n">q</span><span class="o">-&gt;</span><span class="n">eval</span><span class="p">(</span><span class="n">t</span><span class="p">);}</span>
  <span class="n">string</span> <span class="nf">rep</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span><span class="k">return</span> <span class="n">q</span><span class="o">-&gt;</span><span class="n">rep</span><span class="p">();}</span>
  <span class="o">~</span><span class="n">Query</span><span class="p">()</span>
  <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="o">--*</span><span class="n">use</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
      <span class="p">{</span>
	<span class="k">delete</span> <span class="n">q</span><span class="p">;</span>
	<span class="k">delete</span> <span class="n">use</span><span class="p">;</span>
      <span class="p">}</span>
  <span class="p">}</span>
<span class="k">private</span><span class="o">:</span>
 <span class="n">Query</span><span class="p">(</span><span class="n">Query_base</span> <span class="o">*</span><span class="n">query</span><span class="p">)</span><span class="o">:</span> <span class="n">q</span><span class="p">(</span><span class="n">query</span><span class="p">),</span> <span class="n">use</span><span class="p">(</span><span class="k">new</span> <span class="kt">unsigned</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span> <span class="p">{}</span>
  <span class="n">Query_base</span> <span class="o">*</span><span class="n">q</span><span class="p">;</span>
  <span class="kt">unsigned</span> <span class="o">*</span><span class="n">use</span><span class="p">;</span>
<span class="p">};</span>

<span class="n">Query</span> <span class="o">&amp;</span><span class="n">Query</span><span class="o">::</span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="n">p</span><span class="p">)</span>
<span class="p">{</span>
  <span class="o">++*</span><span class="n">p</span><span class="p">.</span><span class="n">use</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="o">--*</span><span class="n">use</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="k">delete</span> <span class="n">use</span><span class="p">;</span>
      <span class="k">delete</span> <span class="n">q</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="n">use</span> <span class="o">=</span> <span class="n">p</span><span class="p">.</span><span class="n">use</span><span class="p">;</span>
  <span class="n">q</span> <span class="o">=</span> <span class="n">p</span><span class="p">.</span><span class="n">q</span><span class="p">;</span>
  <span class="k">return</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span> 
<span class="p">}</span>

<span class="k">class</span> <span class="nc">WordQuery</span><span class="o">:</span> <span class="k">public</span> <span class="n">Query_base</span>
<span class="p">{</span>
  <span class="k">friend</span> <span class="k">class</span> <span class="nc">Query</span><span class="p">;</span>
  <span class="n">WordQuery</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="n">s</span><span class="p">)</span><span class="o">:</span> <span class="n">query_word</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="p">{}</span>
  <span class="n">QueryResult</span> <span class="n">eval</span><span class="p">(</span><span class="k">const</span> <span class="n">TextQuery</span> <span class="o">&amp;</span><span class="n">t</span><span class="p">)</span> <span class="k">const</span>
  <span class="p">{</span><span class="k">return</span> <span class="n">t</span><span class="p">.</span><span class="n">query</span><span class="p">(</span><span class="n">query_word</span><span class="p">);}</span>
  <span class="n">string</span> <span class="n">rep</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span><span class="k">return</span> <span class="n">query_word</span><span class="p">;}</span>
  <span class="n">string</span> <span class="n">query_word</span><span class="p">;</span>
<span class="p">};</span>

<span class="kr">inline</span> <span class="n">Query</span><span class="o">::</span><span class="n">Query</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="n">s</span><span class="p">)</span><span class="o">:</span> <span class="n">q</span><span class="p">(</span><span class="k">new</span> <span class="n">WordQuery</span><span class="p">(</span><span class="n">s</span><span class="p">)),</span> <span class="n">use</span><span class="p">(</span><span class="k">new</span> <span class="kt">unsigned</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span> <span class="p">{}</span>

<span class="k">class</span> <span class="nc">BinaryQuery</span><span class="o">:</span> <span class="k">public</span> <span class="n">Query_base</span>
<span class="p">{</span>
<span class="k">protected</span><span class="o">:</span>
  <span class="n">BinaryQuery</span><span class="p">(</span><span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="n">l</span><span class="p">,</span> <span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="n">r</span><span class="p">,</span> <span class="n">string</span> <span class="n">s</span><span class="p">)</span><span class="o">:</span>
    <span class="n">lhs</span><span class="p">(</span><span class="n">l</span><span class="p">),</span> <span class="n">rhs</span><span class="p">(</span><span class="n">r</span><span class="p">),</span> <span class="n">opSym</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="p">{}</span>
  <span class="n">string</span> <span class="n">rep</span><span class="p">()</span> <span class="k">const</span>
  <span class="p">{</span>
    <span class="k">return</span> <span class="s">"("</span> <span class="o">+</span> <span class="n">lhs</span><span class="p">.</span><span class="n">rep</span><span class="p">()</span> <span class="o">+</span> <span class="s">" "</span>
      <span class="o">+</span> <span class="n">opSym</span> <span class="o">+</span> <span class="s">" "</span>
      <span class="o">+</span> <span class="n">rhs</span><span class="p">.</span><span class="n">rep</span><span class="p">()</span> <span class="o">+</span> <span class="s">")"</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">Query</span> <span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">;</span>
  <span class="n">string</span> <span class="n">opSym</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">class</span> <span class="nc">AndQuery</span><span class="o">:</span> <span class="k">public</span> <span class="n">BinaryQuery</span>
<span class="p">{</span>
  <span class="k">friend</span> <span class="n">Query</span> <span class="k">operator</span><span class="o">&amp;</span><span class="p">(</span><span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="p">,</span> <span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="p">);</span>
  <span class="n">AndQuery</span><span class="p">(</span><span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="n">left</span><span class="p">,</span> <span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="n">right</span><span class="p">)</span><span class="o">:</span>
    <span class="n">BinaryQuery</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="s">"&amp;"</span><span class="p">)</span> <span class="p">{}</span>
  <span class="n">QueryResult</span> <span class="n">eval</span><span class="p">(</span><span class="k">const</span> <span class="n">TextQuery</span> <span class="o">&amp;</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
<span class="p">};</span>

<span class="kr">inline</span> <span class="n">Query</span> <span class="k">operator</span><span class="o">&amp;</span><span class="p">(</span><span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="n">lhs</span><span class="p">,</span> <span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="n">rhs</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="k">new</span> <span class="n">AndQuery</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">QueryResult</span>
<span class="n">AndQuery</span><span class="o">::</span><span class="n">eval</span><span class="p">(</span><span class="k">const</span> <span class="n">TextQuery</span> <span class="o">&amp;</span><span class="n">text</span><span class="p">)</span> <span class="k">const</span>
<span class="p">{</span>
  <span class="k">auto</span> <span class="n">left</span> <span class="o">=</span> <span class="n">lhs</span><span class="p">.</span><span class="n">eval</span><span class="p">(</span><span class="n">text</span><span class="p">),</span> <span class="n">right</span> <span class="o">=</span> <span class="n">rhs</span><span class="p">.</span><span class="n">eval</span><span class="p">(</span><span class="n">text</span><span class="p">);</span>
  <span class="k">auto</span> <span class="n">ret_lines</span> <span class="o">=</span> <span class="n">make_shared</span><span class="o">&lt;</span><span class="n">set</span><span class="o">&lt;</span><span class="n">line_no</span><span class="o">&gt;&gt;</span><span class="p">();</span>
  <span class="n">set_intersection</span><span class="p">(</span><span class="n">left</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">left</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span>
		   <span class="n">right</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">right</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span>
		   <span class="n">inserter</span><span class="p">(</span><span class="o">*</span><span class="n">ret_lines</span><span class="p">,</span> <span class="n">ret_lines</span><span class="o">-&gt;</span><span class="n">begin</span><span class="p">()));</span>
  <span class="k">return</span> <span class="nf">QueryResult</span><span class="p">(</span><span class="n">rep</span><span class="p">(),</span> <span class="n">ret_lines</span><span class="p">,</span> <span class="n">left</span><span class="p">.</span><span class="n">get_file</span><span class="p">());</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">OrQuery</span><span class="o">:</span> <span class="k">public</span> <span class="n">BinaryQuery</span>
<span class="p">{</span>
  <span class="k">friend</span> <span class="n">Query</span> <span class="k">operator</span><span class="o">|</span><span class="p">(</span><span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="p">,</span> <span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="p">);</span>
  <span class="n">OrQuery</span><span class="p">(</span><span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="n">left</span><span class="p">,</span> <span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="n">right</span><span class="p">)</span><span class="o">:</span>
    <span class="n">BinaryQuery</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="s">"|"</span><span class="p">)</span> <span class="p">{}</span>
  <span class="n">QueryResult</span> <span class="n">eval</span><span class="p">(</span><span class="k">const</span> <span class="n">TextQuery</span> <span class="o">&amp;</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
<span class="p">};</span>

<span class="kr">inline</span> <span class="n">Query</span> <span class="k">operator</span><span class="o">|</span><span class="p">(</span><span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="n">lhs</span><span class="p">,</span> <span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="n">rhs</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="k">new</span> <span class="n">OrQuery</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">ostream</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="n">ostream</span> <span class="o">&amp;</span><span class="n">os</span><span class="p">,</span> <span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="n">query</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="n">os</span> <span class="o">&lt;&lt;</span> <span class="n">query</span><span class="p">.</span><span class="n">rep</span><span class="p">();</span>
<span class="p">}</span>

<span class="n">QueryResult</span> <span class="n">OrQuery</span><span class="o">::</span><span class="n">eval</span><span class="p">(</span><span class="k">const</span> <span class="n">TextQuery</span> <span class="o">&amp;</span><span class="n">text</span><span class="p">)</span> <span class="k">const</span>
<span class="p">{</span>
  <span class="k">auto</span> <span class="n">right</span> <span class="o">=</span> <span class="n">rhs</span><span class="p">.</span><span class="n">eval</span><span class="p">(</span><span class="n">text</span><span class="p">),</span> <span class="n">left</span> <span class="o">=</span> <span class="n">lhs</span><span class="p">.</span><span class="n">eval</span><span class="p">(</span><span class="n">text</span><span class="p">);</span>
  <span class="k">auto</span> <span class="n">ret_lines</span> <span class="o">=</span> <span class="n">make_shared</span><span class="o">&lt;</span><span class="n">set</span><span class="o">&lt;</span><span class="n">line_no</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="n">left</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">left</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>
  <span class="n">ret_lines</span><span class="o">-&gt;</span><span class="n">insert</span><span class="p">(</span><span class="n">right</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">right</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>
  <span class="k">return</span> <span class="nf">QueryResult</span><span class="p">(</span><span class="n">rep</span><span class="p">(),</span> <span class="n">ret_lines</span><span class="p">,</span> <span class="n">left</span><span class="p">.</span><span class="n">get_file</span><span class="p">());</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">NotQuery</span><span class="o">:</span> <span class="k">public</span> <span class="n">Query_base</span>
<span class="p">{</span>
  <span class="k">friend</span> <span class="n">Query</span> <span class="k">operator</span><span class="o">~</span><span class="p">(</span><span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="p">);</span>
  <span class="n">NotQuery</span><span class="p">(</span><span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="n">q</span><span class="p">)</span><span class="o">:</span> <span class="n">query</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="p">{}</span>
  <span class="n">string</span> <span class="n">rep</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span><span class="k">return</span> <span class="s">"~("</span> <span class="o">+</span> <span class="n">query</span><span class="p">.</span><span class="n">rep</span><span class="p">()</span> <span class="o">+</span> <span class="s">")"</span><span class="p">;}</span>
  <span class="n">QueryResult</span> <span class="n">eval</span><span class="p">(</span><span class="k">const</span> <span class="n">TextQuery</span> <span class="o">&amp;</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
  <span class="n">Query</span> <span class="n">query</span><span class="p">;</span>
<span class="p">};</span>

<span class="kr">inline</span> <span class="n">Query</span> <span class="k">operator</span><span class="o">~</span><span class="p">(</span><span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="n">operand</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="k">new</span> <span class="n">NotQuery</span><span class="p">(</span><span class="n">operand</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">QueryResult</span>
<span class="n">NotQuery</span><span class="o">::</span><span class="n">eval</span><span class="p">(</span><span class="k">const</span> <span class="n">TextQuery</span> <span class="o">&amp;</span><span class="n">text</span><span class="p">)</span> <span class="k">const</span>
<span class="p">{</span>
  <span class="k">auto</span> <span class="n">result</span> <span class="o">=</span> <span class="n">query</span><span class="p">.</span><span class="n">eval</span><span class="p">(</span><span class="n">text</span><span class="p">);</span>
  <span class="k">auto</span> <span class="n">ret_lines</span> <span class="o">=</span> <span class="n">make_shared</span><span class="o">&lt;</span><span class="n">set</span><span class="o">&lt;</span><span class="n">line_no</span><span class="o">&gt;&gt;</span><span class="p">();</span>
  <span class="k">auto</span> <span class="n">beg</span> <span class="o">=</span> <span class="n">result</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">end</span> <span class="o">=</span> <span class="n">result</span><span class="p">.</span><span class="n">end</span><span class="p">();</span>
  <span class="k">auto</span> <span class="n">sz</span> <span class="o">=</span> <span class="n">result</span><span class="p">.</span><span class="n">get_file</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">();</span>
  <span class="k">for</span><span class="p">(</span><span class="kt">size_t</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">n</span> <span class="o">!=</span> <span class="n">sz</span><span class="p">;</span> <span class="o">++</span><span class="n">n</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span><span class="n">beg</span> <span class="o">==</span> <span class="n">end</span> <span class="o">||</span> <span class="o">*</span><span class="n">beg</span> <span class="o">!=</span> <span class="n">n</span><span class="p">)</span>
	<span class="n">ret_lines</span><span class="o">-&gt;</span><span class="n">insert</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>
      <span class="k">else</span> <span class="nf">if</span><span class="p">(</span><span class="n">beg</span> <span class="o">!=</span> <span class="n">end</span><span class="p">)</span>
	<span class="o">++</span><span class="n">beg</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="k">return</span> <span class="n">QueryResult</span><span class="p">(</span><span class="n">rep</span><span class="p">(),</span> <span class="n">ret_lines</span><span class="p">,</span> <span class="n">result</span><span class="p">.</span><span class="n">get_file</span><span class="p">());</span>
<span class="p">}</span>
</pre></div>
</div>
</div>

<div id="outline-container-orgba18bf3" class="outline-2">
<h2 id="orgba18bf3">Exercise 15.42</h2>
<div class="outline-text-2" id="text-orgba18bf3">
<div class="highlight"><pre><span></span><span class="c1">// implement (a)</span>
<span class="c1">// modify TextQuery.h</span>
<span class="c1">// see TextQuery-1542.h</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span>
<span class="p">{</span>
  <span class="n">ifstream</span> <span class="n">ifs</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
  <span class="n">TextQuery</span> <span class="n">tq</span><span class="p">(</span><span class="n">ifs</span><span class="p">);</span>
  <span class="n">Query</span> <span class="n">q</span> <span class="o">=</span> <span class="n">Query</span><span class="p">(</span><span class="s">"fiery"</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">Query</span><span class="p">(</span><span class="s">"bird"</span><span class="p">)</span> <span class="o">|</span> <span class="n">Query</span><span class="p">(</span><span class="s">"wind"</span><span class="p">);</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">q</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="k">auto</span> <span class="n">result</span> <span class="o">=</span> <span class="n">q</span><span class="p">.</span><span class="n">eval</span><span class="p">(</span><span class="n">tq</span><span class="p">);</span>
  <span class="n">print</span><span class="p">(</span><span class="n">cout</span><span class="p">,</span> <span class="n">result</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>

<div id="outline-container-org0baa087" class="outline-2">
<h2 id="org0baa087">15.42.h</h2>
<div class="outline-text-2" id="text-org0baa087">
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Query_base</span>
<span class="p">{</span>
  <span class="k">friend</span> <span class="k">class</span> <span class="nc">Query</span><span class="p">;</span>
<span class="k">protected</span><span class="o">:</span>
  <span class="k">using</span> <span class="n">line_no</span> <span class="o">=</span> <span class="n">TextQuery</span><span class="o">::</span><span class="n">line_no</span><span class="p">;</span>
  <span class="n">Query_base</span><span class="p">()</span> <span class="p">{</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Query_base::Query_base()"</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;}</span>
  <span class="k">virtual</span> <span class="o">~</span><span class="n">Query_base</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>
<span class="k">private</span><span class="o">:</span>
  <span class="k">virtual</span> <span class="n">QueryResult</span> <span class="n">eval</span><span class="p">(</span><span class="k">const</span> <span class="n">TextQuery</span> <span class="o">&amp;</span><span class="p">)</span> <span class="k">const</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">virtual</span> <span class="n">string</span> <span class="nf">rep</span><span class="p">()</span> <span class="k">const</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">class</span> <span class="nc">Query</span>
<span class="p">{</span>
  <span class="k">friend</span> <span class="n">Query</span> <span class="k">operator</span><span class="o">~</span><span class="p">(</span><span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="p">);</span>
  <span class="k">friend</span> <span class="n">Query</span> <span class="k">operator</span><span class="o">|</span><span class="p">(</span><span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="p">,</span> <span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="p">);</span>
  <span class="k">friend</span> <span class="n">Query</span> <span class="k">operator</span><span class="o">&amp;</span><span class="p">(</span><span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="p">,</span> <span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="p">);</span>
<span class="k">public</span><span class="o">:</span>
  <span class="n">Query</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="p">);</span>
  <span class="n">QueryResult</span> <span class="nf">eval</span><span class="p">(</span><span class="k">const</span> <span class="n">TextQuery</span> <span class="o">&amp;</span><span class="n">t</span><span class="p">)</span> <span class="k">const</span> <span class="p">{</span><span class="k">return</span> <span class="n">q</span><span class="o">-&gt;</span><span class="n">eval</span><span class="p">(</span><span class="n">t</span><span class="p">);}</span>
  <span class="n">string</span> <span class="nf">rep</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Query::rep"</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span> <span class="k">return</span> <span class="n">q</span><span class="o">-&gt;</span><span class="n">rep</span><span class="p">();}</span>
<span class="k">private</span><span class="o">:</span>
 <span class="n">Query</span><span class="p">(</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Query_base</span><span class="o">&gt;</span> <span class="n">query</span><span class="p">)</span><span class="o">:</span> <span class="n">q</span><span class="p">(</span><span class="n">query</span><span class="p">)</span> <span class="p">{</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Query::Query(shared_ptr)"</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;}</span>
  <span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Query_base</span><span class="o">&gt;</span> <span class="n">q</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">class</span> <span class="nc">WordQuery</span><span class="o">:</span> <span class="k">public</span> <span class="n">Query_base</span>
<span class="p">{</span>
  <span class="k">friend</span> <span class="k">class</span> <span class="nc">Query</span><span class="p">;</span>
 <span class="n">WordQuery</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="n">s</span><span class="p">)</span><span class="o">:</span> <span class="n">query_word</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="p">{</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"WordQuery::WordQuery(const string &amp;)"</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;}</span>
  <span class="n">QueryResult</span> <span class="n">eval</span><span class="p">(</span><span class="k">const</span> <span class="n">TextQuery</span> <span class="o">&amp;</span><span class="n">t</span><span class="p">)</span> <span class="k">const</span>
  <span class="p">{</span><span class="k">return</span> <span class="n">t</span><span class="p">.</span><span class="n">query</span><span class="p">(</span><span class="n">query_word</span><span class="p">);}</span>
  <span class="n">string</span> <span class="n">rep</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"WordQuery::rep"</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span> <span class="k">return</span> <span class="n">query_word</span><span class="p">;}</span>
  <span class="n">string</span> <span class="n">query_word</span><span class="p">;</span>
<span class="p">};</span>

<span class="kr">inline</span> <span class="n">Query</span><span class="o">::</span><span class="n">Query</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="n">s</span><span class="p">)</span><span class="o">:</span> <span class="n">q</span><span class="p">(</span><span class="k">new</span> <span class="n">WordQuery</span><span class="p">(</span><span class="n">s</span><span class="p">))</span> <span class="p">{</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Query::Query(const string &amp;)"</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;}</span>

<span class="k">class</span> <span class="nc">BinaryQuery</span><span class="o">:</span> <span class="k">public</span> <span class="n">Query_base</span>
<span class="p">{</span>
 <span class="k">protected</span><span class="o">:</span>
 <span class="n">BinaryQuery</span><span class="p">(</span><span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="n">l</span><span class="p">,</span> <span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="n">r</span><span class="p">,</span> <span class="n">string</span> <span class="n">s</span><span class="p">)</span><span class="o">:</span>
  <span class="n">lhs</span><span class="p">(</span><span class="n">l</span><span class="p">),</span> <span class="n">rhs</span><span class="p">(</span><span class="n">r</span><span class="p">),</span> <span class="n">opSym</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="p">{</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"BinaryQuery::BinaryQuery"</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;}</span>
  <span class="n">string</span> <span class="n">rep</span><span class="p">()</span> <span class="k">const</span>
  <span class="p">{</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"BinaryQuery::rep"</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="k">return</span> <span class="s">"("</span> <span class="o">+</span> <span class="n">lhs</span><span class="p">.</span><span class="n">rep</span><span class="p">()</span> <span class="o">+</span> <span class="s">" "</span>
      <span class="o">+</span> <span class="n">opSym</span> <span class="o">+</span> <span class="s">" "</span>
      <span class="o">+</span> <span class="n">rhs</span><span class="p">.</span><span class="n">rep</span><span class="p">()</span> <span class="o">+</span> <span class="s">")"</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="n">Query</span> <span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">;</span>
  <span class="n">string</span> <span class="n">opSym</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">class</span> <span class="nc">AndQuery</span><span class="o">:</span> <span class="k">public</span> <span class="n">BinaryQuery</span>
<span class="p">{</span>
  <span class="k">friend</span> <span class="n">Query</span> <span class="k">operator</span><span class="o">&amp;</span><span class="p">(</span><span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="p">,</span> <span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="p">);</span>
 <span class="n">AndQuery</span><span class="p">(</span><span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="n">left</span><span class="p">,</span> <span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="n">right</span><span class="p">)</span><span class="o">:</span>
  <span class="n">BinaryQuery</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="s">"&amp;"</span><span class="p">)</span> <span class="p">{</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"AndQuery::AndQuery"</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;}</span>
  <span class="n">QueryResult</span> <span class="n">eval</span><span class="p">(</span><span class="k">const</span> <span class="n">TextQuery</span> <span class="o">&amp;</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
<span class="p">};</span>

<span class="kr">inline</span> <span class="n">Query</span> <span class="k">operator</span><span class="o">&amp;</span><span class="p">(</span><span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="n">lhs</span><span class="p">,</span> <span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="n">rhs</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Query_base</span><span class="o">&gt;</span><span class="p">(</span><span class="k">new</span> <span class="n">AndQuery</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">));</span>
<span class="p">}</span>

<span class="n">QueryResult</span>
<span class="n">AndQuery</span><span class="o">::</span><span class="n">eval</span><span class="p">(</span><span class="k">const</span> <span class="n">TextQuery</span> <span class="o">&amp;</span><span class="n">text</span><span class="p">)</span> <span class="k">const</span>
<span class="p">{</span>
  <span class="k">auto</span> <span class="n">left</span> <span class="o">=</span> <span class="n">lhs</span><span class="p">.</span><span class="n">eval</span><span class="p">(</span><span class="n">text</span><span class="p">),</span> <span class="n">right</span> <span class="o">=</span> <span class="n">rhs</span><span class="p">.</span><span class="n">eval</span><span class="p">(</span><span class="n">text</span><span class="p">);</span>
  <span class="k">auto</span> <span class="n">ret_lines</span> <span class="o">=</span> <span class="n">make_shared</span><span class="o">&lt;</span><span class="n">set</span><span class="o">&lt;</span><span class="n">line_no</span><span class="o">&gt;&gt;</span><span class="p">();</span>
  <span class="n">set_intersection</span><span class="p">(</span><span class="n">left</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">left</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span>
		  <span class="n">right</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">right</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span>
		  <span class="n">inserter</span><span class="p">(</span><span class="o">*</span><span class="n">ret_lines</span><span class="p">,</span> <span class="n">ret_lines</span><span class="o">-&gt;</span><span class="n">begin</span><span class="p">()));</span>
  <span class="k">return</span> <span class="nf">QueryResult</span><span class="p">(</span><span class="n">rep</span><span class="p">(),</span> <span class="n">ret_lines</span><span class="p">,</span> <span class="n">left</span><span class="p">.</span><span class="n">get_file</span><span class="p">());</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">OrQuery</span><span class="o">:</span> <span class="k">public</span> <span class="n">BinaryQuery</span>
<span class="p">{</span>
  <span class="k">friend</span> <span class="n">Query</span> <span class="k">operator</span><span class="o">|</span><span class="p">(</span><span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="p">,</span> <span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="p">);</span>
 <span class="n">OrQuery</span><span class="p">(</span><span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="n">left</span><span class="p">,</span> <span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="n">right</span><span class="p">)</span><span class="o">:</span>
  <span class="n">BinaryQuery</span><span class="p">(</span><span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span> <span class="s">"|"</span><span class="p">)</span> <span class="p">{</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"OrQUery::OrQuery"</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;}</span>
  <span class="n">QueryResult</span> <span class="n">eval</span><span class="p">(</span><span class="k">const</span> <span class="n">TextQuery</span> <span class="o">&amp;</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
<span class="p">};</span>

<span class="kr">inline</span> <span class="n">Query</span> <span class="k">operator</span><span class="o">|</span><span class="p">(</span><span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="n">lhs</span><span class="p">,</span> <span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="n">rhs</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Query_base</span><span class="o">&gt;</span><span class="p">(</span><span class="k">new</span> <span class="n">OrQuery</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">));</span>
<span class="p">}</span>

<span class="n">ostream</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="n">ostream</span> <span class="o">&amp;</span><span class="n">os</span><span class="p">,</span> <span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="n">query</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="n">os</span> <span class="o">&lt;&lt;</span> <span class="n">query</span><span class="p">.</span><span class="n">rep</span><span class="p">();</span>
<span class="p">}</span>

<span class="n">QueryResult</span> <span class="n">OrQuery</span><span class="o">::</span><span class="n">eval</span><span class="p">(</span><span class="k">const</span> <span class="n">TextQuery</span> <span class="o">&amp;</span><span class="n">text</span><span class="p">)</span> <span class="k">const</span>
<span class="p">{</span>
  <span class="k">auto</span> <span class="n">right</span> <span class="o">=</span> <span class="n">rhs</span><span class="p">.</span><span class="n">eval</span><span class="p">(</span><span class="n">text</span><span class="p">),</span> <span class="n">left</span> <span class="o">=</span> <span class="n">lhs</span><span class="p">.</span><span class="n">eval</span><span class="p">(</span><span class="n">text</span><span class="p">);</span>
  <span class="k">auto</span> <span class="n">ret_lines</span> <span class="o">=</span> <span class="n">make_shared</span><span class="o">&lt;</span><span class="n">set</span><span class="o">&lt;</span><span class="n">line_no</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="n">left</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">left</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>
  <span class="n">ret_lines</span><span class="o">-&gt;</span><span class="n">insert</span><span class="p">(</span><span class="n">right</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">right</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>
  <span class="k">return</span> <span class="nf">QueryResult</span><span class="p">(</span><span class="n">rep</span><span class="p">(),</span> <span class="n">ret_lines</span><span class="p">,</span> <span class="n">left</span><span class="p">.</span><span class="n">get_file</span><span class="p">());</span>
<span class="p">}</span>

<span class="k">class</span> <span class="nc">NotQuery</span><span class="o">:</span> <span class="k">public</span> <span class="n">Query_base</span>
<span class="p">{</span>
  <span class="k">friend</span> <span class="n">Query</span> <span class="k">operator</span><span class="o">~</span><span class="p">(</span><span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="p">);</span>
 <span class="n">NotQuery</span><span class="p">(</span><span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="n">q</span><span class="p">)</span><span class="o">:</span> <span class="n">query</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="p">{}</span>
  <span class="n">string</span> <span class="n">rep</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span><span class="k">return</span> <span class="s">"~("</span> <span class="o">+</span> <span class="n">query</span><span class="p">.</span><span class="n">rep</span><span class="p">()</span> <span class="o">+</span> <span class="s">")"</span><span class="p">;}</span>
  <span class="n">QueryResult</span> <span class="n">eval</span><span class="p">(</span><span class="k">const</span> <span class="n">TextQuery</span> <span class="o">&amp;</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
  <span class="n">Query</span> <span class="n">query</span><span class="p">;</span>
<span class="p">};</span>

<span class="kr">inline</span> <span class="n">Query</span> <span class="k">operator</span><span class="o">~</span><span class="p">(</span><span class="k">const</span> <span class="n">Query</span> <span class="o">&amp;</span><span class="n">operand</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Query_base</span><span class="o">&gt;</span><span class="p">(</span><span class="k">new</span> <span class="n">NotQuery</span><span class="p">(</span><span class="n">operand</span><span class="p">));</span>
<span class="p">}</span>

<span class="n">QueryResult</span>
<span class="n">NotQuery</span><span class="o">::</span><span class="n">eval</span><span class="p">(</span><span class="k">const</span> <span class="n">TextQuery</span> <span class="o">&amp;</span><span class="n">text</span><span class="p">)</span> <span class="k">const</span>
<span class="p">{</span>
  <span class="k">auto</span> <span class="n">result</span> <span class="o">=</span> <span class="n">query</span><span class="p">.</span><span class="n">eval</span><span class="p">(</span><span class="n">text</span><span class="p">);</span>
  <span class="k">auto</span> <span class="n">ret_lines</span> <span class="o">=</span> <span class="n">make_shared</span><span class="o">&lt;</span><span class="n">set</span><span class="o">&lt;</span><span class="n">line_no</span><span class="o">&gt;&gt;</span><span class="p">();</span>
  <span class="k">auto</span> <span class="n">beg</span> <span class="o">=</span> <span class="n">result</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">end</span> <span class="o">=</span> <span class="n">result</span><span class="p">.</span><span class="n">end</span><span class="p">();</span>
  <span class="k">auto</span> <span class="n">sz</span> <span class="o">=</span> <span class="n">result</span><span class="p">.</span><span class="n">get_file</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">();</span>
  <span class="k">for</span><span class="p">(</span><span class="kt">size_t</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">n</span> <span class="o">!=</span> <span class="n">sz</span><span class="p">;</span> <span class="o">++</span><span class="n">n</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span><span class="n">beg</span> <span class="o">==</span> <span class="n">end</span> <span class="o">||</span> <span class="o">*</span><span class="n">beg</span> <span class="o">!=</span> <span class="n">n</span><span class="p">)</span>
	<span class="n">ret_lines</span><span class="o">-&gt;</span><span class="n">insert</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>
      <span class="k">else</span> <span class="nf">if</span><span class="p">(</span><span class="n">beg</span> <span class="o">!=</span> <span class="n">end</span><span class="p">)</span>
	<span class="o">++</span><span class="n">beg</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="k">return</span> <span class="n">QueryResult</span><span class="p">(</span><span class="n">rep</span><span class="p">(),</span> <span class="n">ret_lines</span><span class="p">,</span> <span class="n">result</span><span class="p">.</span><span class="n">get_file</span><span class="p">());</span>
<span class="p">}</span>
<span class="cp">#endif</span>
</pre></div>
</div>
</div>

<div id="outline-container-orge090f1f" class="outline-2">
<h2 id="orge090f1f">TextQuery-1542.h</h2>
<div class="outline-text-2" id="text-orge090f1f">
<div class="highlight"><pre><span></span><span class="cp">#ifndef TEXTQUERY1542_H</span>
<span class="cp">#define TEXTQUERY1542_H</span>
<span class="k">class</span> <span class="nc">QueryResult</span><span class="p">;</span>
<span class="k">class</span> <span class="nc">TextQuery</span>
<span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="k">using</span> <span class="n">line_no</span> <span class="o">=</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;::</span><span class="n">size_type</span><span class="p">;</span>
  <span class="n">TextQuery</span><span class="p">(</span><span class="n">ifstream</span> <span class="o">&amp;</span><span class="n">infile</span><span class="p">);</span>
  <span class="n">TextQuery</span><span class="p">(</span><span class="k">const</span> <span class="n">TextQuery</span> <span class="o">&amp;</span><span class="p">);</span>
  <span class="n">TextQuery</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">TextQuery</span> <span class="o">&amp;</span><span class="p">);</span>
  <span class="n">QueryResult</span> <span class="nf">query</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="n">s</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
 <span class="k">private</span><span class="o">:</span>
  <span class="k">friend</span> <span class="n">QueryResult</span><span class="p">;</span>
  <span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;&gt;</span> <span class="n">sp1</span><span class="p">;</span>
  <span class="n">map</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span> <span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">set</span><span class="o">&lt;</span><span class="n">line_no</span><span class="o">&gt;&gt;&gt;</span> <span class="n">mp</span><span class="p">;</span>
<span class="p">};</span>
<span class="n">istream</span> <span class="o">&amp;</span><span class="n">get_sentence</span><span class="p">(</span><span class="n">istream</span> <span class="o">&amp;</span><span class="n">is</span><span class="p">,</span> <span class="n">string</span> <span class="o">&amp;</span><span class="n">s</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">s</span> <span class="o">=</span> <span class="s">""</span><span class="p">;</span>
  <span class="n">string</span> <span class="n">word</span><span class="p">;</span>
  <span class="k">while</span><span class="p">(</span><span class="n">is</span> <span class="o">&gt;&gt;</span> <span class="n">word</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="kt">char</span> <span class="n">symbol</span> <span class="o">=</span> <span class="n">word</span><span class="p">[</span><span class="n">word</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">];</span>
      <span class="k">if</span><span class="p">(</span><span class="n">ispunct</span><span class="p">(</span><span class="n">symbol</span><span class="p">))</span>
      <span class="p">{</span>
	<span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="n">word</span><span class="p">;</span>
	<span class="k">break</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">else</span>
      <span class="n">s</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="n">word</span> <span class="o">+</span> <span class="s">" "</span><span class="p">;</span> 
    <span class="p">}</span>
  <span class="k">return</span> <span class="n">is</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">TextQuery</span><span class="o">::</span><span class="n">TextQuery</span><span class="p">(</span><span class="n">ifstream</span> <span class="o">&amp;</span><span class="n">infile</span><span class="p">)</span><span class="o">:</span>
<span class="n">sp1</span><span class="p">(</span><span class="k">new</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span><span class="p">)</span>
<span class="p">{</span>  
  <span class="n">line_no</span> <span class="n">line_number</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">string</span> <span class="n">sentence</span><span class="p">;</span>
  <span class="k">while</span><span class="p">(</span><span class="n">get_sentence</span><span class="p">(</span><span class="n">infile</span><span class="p">,</span> <span class="n">sentence</span><span class="p">))</span>
    <span class="p">{</span>
      <span class="c1">// store sentence in vector&lt;string&gt;</span>
      <span class="n">sp1</span><span class="o">-&gt;</span><span class="n">push_back</span><span class="p">(</span><span class="n">sentence</span><span class="p">);</span>
      <span class="c1">// scan through the sentence      </span>
      <span class="n">istringstream</span> <span class="nf">ist</span><span class="p">(</span><span class="n">sentence</span><span class="p">);</span>
      <span class="n">string</span> <span class="n">word</span><span class="p">;</span>
      <span class="k">while</span><span class="p">(</span><span class="n">ist</span> <span class="o">&gt;&gt;</span> <span class="n">word</span><span class="p">)</span>
      <span class="p">{</span>
	<span class="k">if</span><span class="p">(</span><span class="n">ispunct</span><span class="p">(</span><span class="n">word</span><span class="p">[</span><span class="n">word</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]))</span>
	  <span class="n">word</span><span class="p">.</span><span class="n">erase</span><span class="p">(</span><span class="n">word</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
	<span class="k">auto</span> <span class="o">&amp;</span><span class="n">lines</span> <span class="o">=</span> <span class="n">mp</span><span class="p">[</span><span class="n">word</span><span class="p">];</span>
	<span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">lines</span><span class="p">)</span> <span class="n">lines</span><span class="p">.</span><span class="n">reset</span><span class="p">(</span><span class="k">new</span> <span class="n">set</span><span class="o">&lt;</span><span class="n">line_no</span><span class="o">&gt;</span><span class="p">);</span>
	<span class="n">lines</span><span class="o">-&gt;</span><span class="n">insert</span><span class="p">(</span><span class="n">line_number</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="c1">// increase the line_number</span>
      <span class="o">++</span><span class="n">line_number</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="n">TextQuery</span><span class="o">::</span><span class="n">TextQuery</span><span class="p">(</span><span class="k">const</span> <span class="n">TextQuery</span> <span class="o">&amp;</span><span class="n">t</span><span class="p">)</span><span class="o">:</span> <span class="n">sp1</span><span class="p">(</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="o">*</span><span class="n">t</span><span class="p">.</span><span class="n">sp1</span><span class="p">)),</span> <span class="n">mp</span><span class="p">(</span><span class="n">t</span><span class="p">.</span><span class="n">mp</span><span class="p">)</span> <span class="p">{}</span>
<span class="n">TextQuery</span> <span class="o">&amp;</span><span class="n">TextQuery</span><span class="o">::</span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">TextQuery</span> <span class="o">&amp;</span><span class="n">t</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">sp1</span> <span class="o">=</span> <span class="n">make_shared</span><span class="o">&lt;</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="o">*</span><span class="n">t</span><span class="p">.</span><span class="n">sp1</span><span class="p">);</span>
  <span class="n">mp</span> <span class="o">=</span> <span class="n">t</span><span class="p">.</span><span class="n">mp</span><span class="p">;</span>
  <span class="k">return</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span>
<span class="p">}</span>
  <span class="k">class</span> <span class="nc">QueryResult</span>
  <span class="p">{</span>
    <span class="k">friend</span> <span class="n">ostream</span> <span class="o">&amp;</span><span class="n">print</span><span class="p">(</span><span class="n">ostream</span> <span class="o">&amp;</span><span class="p">,</span> <span class="k">const</span> <span class="n">QueryResult</span> <span class="o">&amp;</span><span class="p">);</span>
    <span class="n">string</span> <span class="n">search_word</span><span class="p">;</span>
    <span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;&gt;</span> <span class="n">sp1</span><span class="p">;</span>
    <span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">set</span><span class="o">&lt;</span><span class="n">TextQuery</span><span class="o">::</span><span class="n">line_no</span><span class="o">&gt;&gt;</span> <span class="n">sp2</span><span class="p">;</span>
  <span class="k">public</span><span class="o">:</span>
  <span class="n">QueryResult</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="n">s</span><span class="p">,</span>
	    <span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">set</span><span class="o">&lt;</span><span class="n">TextQuery</span><span class="o">::</span><span class="n">line_no</span><span class="o">&gt;&gt;</span> <span class="n">p</span><span class="p">,</span>
	    <span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;&gt;</span> <span class="n">file</span><span class="p">)</span><span class="o">:</span> <span class="n">search_word</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="n">sp1</span><span class="p">(</span><span class="n">file</span><span class="p">),</span> <span class="n">sp2</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="p">{}</span>
    <span class="n">QueryResult</span><span class="p">(</span><span class="k">const</span> <span class="n">QueryResult</span> <span class="o">&amp;</span><span class="p">);</span>
    <span class="n">QueryResult</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">QueryResult</span> <span class="o">&amp;</span><span class="p">);</span>
    <span class="n">set</span><span class="o">&lt;</span><span class="n">TextQuery</span><span class="o">::</span><span class="n">line_no</span><span class="o">&gt;::</span><span class="n">iterator</span> <span class="n">begin</span><span class="p">()</span> <span class="p">{</span><span class="k">return</span> <span class="n">sp2</span><span class="o">-&gt;</span><span class="n">begin</span><span class="p">();}</span>
    <span class="n">set</span><span class="o">&lt;</span><span class="n">TextQuery</span><span class="o">::</span><span class="n">line_no</span><span class="o">&gt;::</span><span class="n">iterator</span> <span class="n">end</span><span class="p">()</span> <span class="p">{</span><span class="k">return</span> <span class="n">sp2</span><span class="o">-&gt;</span><span class="n">end</span><span class="p">();}</span> 
    <span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;&gt;</span> <span class="n">get_file</span><span class="p">()</span> <span class="p">{</span><span class="k">return</span> <span class="n">sp1</span><span class="p">;}</span>
  <span class="p">};</span>
<span class="n">QueryResult</span><span class="o">::</span><span class="n">QueryResult</span><span class="p">(</span><span class="k">const</span> <span class="n">QueryResult</span> <span class="o">&amp;</span><span class="n">q</span><span class="p">)</span><span class="o">:</span> <span class="n">sp1</span><span class="p">(</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="o">*</span><span class="n">q</span><span class="p">.</span><span class="n">sp1</span><span class="p">)),</span> <span class="n">sp2</span><span class="p">(</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">set</span><span class="o">&lt;</span><span class="n">TextQuery</span><span class="o">::</span><span class="n">line_no</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="o">*</span><span class="n">q</span><span class="p">.</span><span class="n">sp2</span><span class="p">)),</span> <span class="n">search_word</span><span class="p">(</span><span class="n">q</span><span class="p">.</span><span class="n">search_word</span><span class="p">)</span> <span class="p">{}</span>
<span class="n">QueryResult</span> <span class="o">&amp;</span><span class="n">QueryResult</span><span class="o">::</span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">QueryResult</span> <span class="o">&amp;</span><span class="n">q</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">sp1</span> <span class="o">=</span> <span class="n">make_shared</span><span class="o">&lt;</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="o">*</span><span class="n">q</span><span class="p">.</span><span class="n">sp1</span><span class="p">);</span>
  <span class="n">sp2</span> <span class="o">=</span> <span class="n">make_shared</span><span class="o">&lt;</span><span class="n">set</span><span class="o">&lt;</span><span class="n">TextQuery</span><span class="o">::</span><span class="n">line_no</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="o">*</span><span class="n">q</span><span class="p">.</span><span class="n">sp2</span><span class="p">);</span>
  <span class="n">search_word</span> <span class="o">=</span> <span class="n">q</span><span class="p">.</span><span class="n">search_word</span><span class="p">;</span>
  <span class="k">return</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span>
<span class="p">}</span>
  <span class="n">ostream</span> <span class="o">&amp;</span><span class="n">print</span><span class="p">(</span><span class="n">ostream</span> <span class="o">&amp;</span><span class="n">o</span><span class="p">,</span> <span class="k">const</span> <span class="n">QueryResult</span> <span class="o">&amp;</span><span class="n">q</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="k">auto</span> <span class="n">n</span> <span class="o">=</span> <span class="n">q</span><span class="p">.</span><span class="n">sp2</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">();</span>
    <span class="n">o</span> <span class="o">&lt;&lt;</span> <span class="s">"element occurs "</span> <span class="o">&lt;&lt;</span> <span class="n">n</span> <span class="o">&lt;&lt;</span> <span class="s">" times"</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="k">auto</span> <span class="n">result</span> <span class="o">=</span> <span class="o">*</span><span class="n">q</span><span class="p">.</span><span class="n">sp2</span><span class="p">;</span>
    <span class="k">for</span><span class="p">(</span><span class="k">const</span> <span class="k">auto</span> <span class="o">&amp;</span><span class="nl">l</span> <span class="p">:</span> <span class="n">result</span><span class="p">)</span>
      <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\t</span><span class="s">(sentence "</span> <span class="o">&lt;&lt;</span> <span class="n">l</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="s">") "</span>
	 <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="o">*</span><span class="n">q</span><span class="p">.</span><span class="n">sp1</span><span class="p">)[</span><span class="n">l</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="k">return</span> <span class="n">o</span><span class="p">;</span>
  <span class="p">}</span>
<span class="n">QueryResult</span> <span class="n">TextQuery</span><span class="o">::</span><span class="n">query</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="n">s</span><span class="p">)</span> <span class="k">const</span>
<span class="p">{</span>
  <span class="k">static</span> <span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">set</span><span class="o">&lt;</span><span class="n">line_no</span><span class="o">&gt;&gt;</span> <span class="n">nodata</span><span class="p">(</span><span class="k">new</span> <span class="n">set</span><span class="o">&lt;</span><span class="n">line_no</span><span class="o">&gt;</span><span class="p">);</span>
  <span class="k">auto</span> <span class="n">iter</span> <span class="o">=</span> <span class="n">mp</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">s</span><span class="p">);</span>
  <span class="k">auto</span> <span class="n">last</span> <span class="o">=</span> <span class="n">mp</span><span class="p">.</span><span class="n">end</span><span class="p">();</span>
  <span class="k">if</span><span class="p">(</span><span class="n">iter</span> <span class="o">!=</span> <span class="n">last</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">QueryResult</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">iter</span><span class="o">-&gt;</span><span class="n">second</span><span class="p">,</span> <span class="n">sp1</span><span class="p">);</span>
  <span class="k">else</span>
    <span class="k">return</span> <span class="nf">QueryResult</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">nodata</span><span class="p">,</span> <span class="n">sp1</span><span class="p">);</span>
<span class="p">}</span>
<span class="cp">#endif</span>
</pre></div>
</div>
</div>
            
        
        <div id="disqus_thread"></div>
        <script>
        var disqus_shortname ="https-zero4drift-github-io",
            disqus_url="https://zero4drift.github.io/posts/Cpp-Primer-5th-Exercises-Chapter-15/",
        disqus_title="Cpp-Primer-5th-Exercises-Chapter-15",
        disqus_identifier="cache/posts/Cpp-Primer-5th-Exercises-Chapter-15.html",
        disqus_config = function () {
            this.language = "en";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.async = true;
            dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
    <a href="https://disqus.com" class="dsq-brlink" rel="nofollow">Comments powered by <span class="logo-disqus">Disqus</span></a>


        
    


        </div>
    </div>

    
    <footer><div class="container">
            <div class="social">



                <div class="social-entry">
                    <a href="../../rss.xml" target="_blank">
                        <i class="fa fa-rss"></i> 
                    </a>
                </div>
            </div>
                <div class="copyright">
                    Contents © 2018         <a href="mailto:fang0052@e.ntu.edu.sg">zero4drift</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         
                    
                </div>
           
        </div>
    </footer><script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?06e0ade16d98033ac1aad78106d873c8";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script src="../../assets/js/all-nocdn.js" type="text/javascript"></script>
</body>
</html>
