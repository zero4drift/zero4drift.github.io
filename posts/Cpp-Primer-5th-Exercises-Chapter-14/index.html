<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " vocab="http://ogp.me/ns" lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="Cpp Primer 5th chapter-14 Exercises">
<meta name="viewport" content="width=device-width">
<title>Cpp-Primer-5th-Exercises-Chapter-14 | Procrastination Prescription</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link rel="alternate" type="application/rss+xml" title="RSS" href="../../rss.xml">
<link rel="canonical" href="https://zero4drift.github.io/posts/Cpp-Primer-5th-Exercises-Chapter-14/">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="zero4drift">
<meta property="og:site_name" content="Procrastination Prescription">
<meta property="og:title" content="Cpp-Primer-5th-Exercises-Chapter-14">
<meta property="og:url" content="https://zero4drift.github.io/posts/Cpp-Primer-5th-Exercises-Chapter-14/">
<meta property="og:description" content="Cpp Primer 5th chapter-14 Exercises">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2018-07-05T17:53:39+08:00">
<meta property="article:tag" content="C++">
</head>
<body>
    

    <header id="header" class="navbar"><div class="container">
            
    <div class="brand">

        <div class="brand-text">
            <a href="https://zero4drift.github.io/" title="Procrastination Prescription" rel="home">
                Procrastination Prescription
            </a>
        </div>

        <a id="btn-toggle-nav" class="navbar-toggle">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </a>
    </div>

            
    <nav class="navbar-collapse collapse"><ul class="nav">
<li><a href="../../archive.html">Archive</a></li>
                <li><a href="https://github.com/zero4drift">Github</a></li>
                <li><a href="../../categories/">Tags</a></li>
                <li><a href="../../rss.xml">RSS feed</a></li>
    
    
    </ul></nav>
</div>
    </header><div class="header-padding"> </div>

    
    <div class="post-header">
        <div class="container">
            <div class="title">
                Cpp-Primer-5th-Exercises-Chapter-14
            </div>
        </div>
    </div>

    <div class="post-meta">
      <div class="container">
	<div class="meta clearfix">
	  <div class="authordate">
	    <time class="timeago" datetime="2018-07-05T17:53:39+08:00">2018/07/05</time>
</div>
	  <div class="post-tags">
	    <div class="tag">
	      <a href="../../categories/c%2B%2B/" rel="tag">C++</a>
	    </div>
	  </div>
	</div>
      </div>
    </div>
    
    
    <div id="post-main" class="main">
        <div class="container">
        <div id="outline-container-org88f8fb1" class="outline-2">
<h2 id="org88f8fb1">Exercise 14.1</h2>
<div class="outline-text-2" id="text-org88f8fb1">
<div class="highlight"><pre><span></span><span class="cm">/* diff */</span>
<span class="c1">// 1. an overload operator function could be called directly.</span>
<span class="c1">// 2. an overload operator function must either be a member of class of have at least one parameter of class type.</span>
<span class="c1">// 3. A few built-in operators guarantee the order in which operands are evaluated. These overload versions of these operators do not preserve order of evaluation and/or shourt-circuit evaluation, it is usually a bad idea to overload them.</span>
<span class="cm">/* same */</span>
<span class="c1">// The logic pattern are identical, for example, the overload operator should return a reference if the related built-in operator returns a reference.</span>
</pre></div>
</div>
</div>

<div id="outline-container-orgb4bc392" class="outline-2">
<h2 id="orgb4bc392">Exercise 14.2</h2>
<div class="outline-text-2" id="text-orgb4bc392">
<div class="highlight"><pre><span></span><span class="c1">// See Sales_data.h and Sales_data.cpp.</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">Sales_data</span> <span class="n">data</span><span class="p">(</span><span class="s">"1234"</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mf">78.1</span><span class="p">);</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">data</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>

<div id="outline-container-org98cde39" class="outline-2">
<h2 id="org98cde39">Sales_data.cpp</h2>
<div class="outline-text-2" id="text-org98cde39">
<div class="highlight"><pre><span></span><span class="n">Sales_data</span><span class="o">&amp;</span> <span class="n">Sales_data</span><span class="o">::</span><span class="n">combine</span><span class="p">(</span><span class="k">const</span> <span class="n">Sales_data</span> <span class="o">&amp;</span><span class="n">rhs</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">units_sold</span> <span class="o">+=</span> <span class="n">rhs</span><span class="p">.</span><span class="n">units_sold</span><span class="p">;</span>
  <span class="n">revenue</span> <span class="o">+=</span> <span class="n">rhs</span><span class="p">.</span><span class="n">revenue</span><span class="p">;</span>
  <span class="k">return</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span>
<span class="p">}</span>
<span class="kr">inline</span> <span class="kt">double</span> <span class="n">Sales_data</span><span class="o">::</span><span class="n">avg_price</span><span class="p">()</span> <span class="k">const</span>
<span class="p">{</span>
  <span class="k">if</span><span class="p">(</span><span class="n">units_sold</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">revenue</span><span class="o">/</span><span class="n">units_sold</span><span class="p">;</span>
  <span class="k">else</span>
    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">istream</span> <span class="o">&amp;</span><span class="n">read</span><span class="p">(</span><span class="n">istream</span> <span class="o">&amp;</span><span class="n">is</span><span class="p">,</span> <span class="n">Sales_data</span> <span class="o">&amp;</span><span class="n">item</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">double</span> <span class="n">price</span><span class="p">;</span>
  <span class="n">is</span> <span class="o">&gt;&gt;</span> <span class="n">item</span><span class="p">.</span><span class="n">bookNo</span> <span class="o">&gt;&gt;</span> <span class="n">item</span><span class="p">.</span><span class="n">units_sold</span> <span class="o">&gt;&gt;</span> <span class="n">price</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="n">is</span><span class="p">)</span>
    <span class="n">item</span><span class="p">.</span><span class="n">revenue</span> <span class="o">=</span> <span class="n">price</span> <span class="o">*</span> <span class="n">item</span><span class="p">.</span><span class="n">units_sold</span><span class="p">;</span>
  <span class="k">else</span>
    <span class="n">item</span> <span class="o">=</span> <span class="n">Sales_data</span><span class="p">();</span>
  <span class="k">return</span> <span class="n">is</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">istream</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="n">istream</span> <span class="o">&amp;</span><span class="n">i</span><span class="p">,</span> <span class="n">Sales_data</span> <span class="o">&amp;</span><span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">double</span> <span class="n">price</span><span class="p">;</span>
  <span class="n">i</span> <span class="o">&gt;&gt;</span> <span class="n">data</span><span class="p">.</span><span class="n">bookNo</span> <span class="o">&gt;&gt;</span> <span class="n">data</span><span class="p">.</span><span class="n">units_sold</span> <span class="o">&gt;&gt;</span> <span class="n">price</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="n">data</span><span class="p">.</span><span class="n">revenue</span> <span class="o">=</span> <span class="n">price</span> <span class="o">*</span> <span class="n">data</span><span class="p">.</span><span class="n">units_sold</span><span class="p">;</span>
  <span class="k">else</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">Sales_data</span><span class="p">();</span>
  <span class="k">return</span> <span class="n">i</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">ostream</span> <span class="o">&amp;</span><span class="n">print</span><span class="p">(</span><span class="n">ostream</span> <span class="o">&amp;</span><span class="n">os</span><span class="p">,</span> <span class="k">const</span> <span class="n">Sales_data</span> <span class="o">&amp;</span><span class="n">item</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">os</span> <span class="o">&lt;&lt;</span> <span class="n">item</span><span class="p">.</span><span class="n">isbn</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">" "</span> <span class="o">&lt;&lt;</span> <span class="n">item</span><span class="p">.</span><span class="n">units_sold</span> <span class="o">&lt;&lt;</span> <span class="s">" "</span> <span class="o">&lt;&lt;</span> <span class="n">item</span><span class="p">.</span><span class="n">revenue</span> <span class="o">&lt;&lt;</span> <span class="s">" "</span> <span class="o">&lt;&lt;</span> <span class="n">item</span><span class="p">.</span><span class="n">avg_price</span><span class="p">();</span>
  <span class="k">return</span> <span class="n">os</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">ostream</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="n">ostream</span> <span class="o">&amp;</span><span class="n">o</span><span class="p">,</span> <span class="k">const</span> <span class="n">Sales_data</span> <span class="o">&amp;</span><span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">o</span> <span class="o">&lt;&lt;</span> <span class="n">data</span><span class="p">.</span><span class="n">isbn</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">" "</span> <span class="o">&lt;&lt;</span> <span class="n">data</span><span class="p">.</span><span class="n">units_sold</span> <span class="o">&lt;&lt;</span> <span class="s">" "</span> <span class="o">&lt;&lt;</span> <span class="n">data</span><span class="p">.</span><span class="n">revenue</span> <span class="o">&lt;&lt;</span> <span class="s">" "</span> <span class="o">&lt;&lt;</span> <span class="n">data</span><span class="p">.</span><span class="n">avg_price</span><span class="p">();</span>
  <span class="k">return</span> <span class="n">o</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">Sales_data</span> <span class="n">add</span><span class="p">(</span><span class="k">const</span> <span class="n">Sales_data</span> <span class="o">&amp;</span><span class="n">item1</span><span class="p">,</span> <span class="k">const</span> <span class="n">Sales_data</span> <span class="o">&amp;</span><span class="n">item2</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">Sales_data</span> <span class="n">result</span> <span class="o">=</span> <span class="n">item1</span><span class="p">;</span>
  <span class="k">return</span> <span class="n">result</span><span class="p">.</span><span class="n">combine</span><span class="p">(</span><span class="n">item2</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">Sales_data</span> <span class="o">&amp;</span><span class="n">Sales_data</span><span class="o">::</span><span class="k">operator</span><span class="o">+=</span><span class="p">(</span><span class="k">const</span> <span class="n">Sales_data</span> <span class="o">&amp;</span><span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="n">combine</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">Sales_data</span> <span class="o">&amp;</span><span class="n">Sales_data</span><span class="o">::</span><span class="k">operator</span><span class="o">-=</span><span class="p">(</span><span class="k">const</span> <span class="n">Sales_data</span> <span class="o">&amp;</span><span class="n">data</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">units_sold</span> <span class="o">-=</span> <span class="n">data</span><span class="p">.</span><span class="n">units_sold</span><span class="p">;</span>
  <span class="n">revenue</span> <span class="o">-=</span> <span class="n">data</span><span class="p">.</span><span class="n">revenue</span><span class="p">;</span>
  <span class="k">return</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">Sales_data</span> <span class="o">&amp;</span><span class="n">Sales_data</span><span class="o">::</span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="n">s</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">bookNo</span> <span class="o">=</span> <span class="n">s</span><span class="p">;</span>
  <span class="n">units_sold</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">revenue</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
  <span class="k">return</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">Sales_data</span> <span class="k">operator</span><span class="o">+</span><span class="p">(</span><span class="k">const</span> <span class="n">Sales_data</span> <span class="o">&amp;</span><span class="n">data1</span><span class="p">,</span> <span class="k">const</span> <span class="n">Sales_data</span> <span class="o">&amp;</span><span class="n">data2</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">Sales_data</span> <span class="n">temp</span> <span class="o">=</span> <span class="n">data1</span><span class="p">;</span>
  <span class="n">temp</span> <span class="o">+=</span> <span class="n">data2</span><span class="p">;</span>
  <span class="k">return</span> <span class="n">temp</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">Sales_data</span> <span class="k">operator</span><span class="o">-</span><span class="p">(</span><span class="k">const</span> <span class="n">Sales_data</span> <span class="o">&amp;</span><span class="n">data1</span><span class="p">,</span> <span class="k">const</span> <span class="n">Sales_data</span> <span class="o">&amp;</span><span class="n">data2</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">Sales_data</span> <span class="n">temp</span> <span class="o">=</span> <span class="n">data1</span><span class="p">;</span>
  <span class="n">temp</span> <span class="o">-=</span> <span class="n">data2</span><span class="p">;</span>
  <span class="k">return</span> <span class="n">temp</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">bool</span> <span class="k">operator</span><span class="o">==</span><span class="p">(</span><span class="k">const</span> <span class="n">Sales_data</span> <span class="o">&amp;</span><span class="n">data1</span><span class="p">,</span> <span class="k">const</span> <span class="n">Sales_data</span> <span class="o">&amp;</span><span class="n">data2</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="n">data1</span><span class="p">.</span><span class="n">bookNo</span> <span class="o">==</span> <span class="n">data2</span><span class="p">.</span><span class="n">bookNo</span> <span class="o">&amp;&amp;</span>
    <span class="n">data1</span><span class="p">.</span><span class="n">units_sold</span> <span class="o">==</span> <span class="n">data2</span><span class="p">.</span><span class="n">units_sold</span> <span class="o">&amp;&amp;</span>
    <span class="n">data1</span><span class="p">.</span><span class="n">revenue</span> <span class="o">==</span> <span class="n">data2</span><span class="p">.</span><span class="n">revenue</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">bool</span> <span class="k">operator</span><span class="o">!=</span><span class="p">(</span><span class="k">const</span> <span class="n">Sales_data</span> <span class="o">&amp;</span><span class="n">data1</span><span class="p">,</span> <span class="k">const</span> <span class="n">Sales_data</span> <span class="o">&amp;</span><span class="n">data2</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="o">!</span><span class="p">(</span><span class="n">data1</span> <span class="o">==</span> <span class="n">data2</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>

<div id="outline-container-orgb2a283f" class="outline-2">
<h2 id="orgb2a283f">Sales_data.h</h2>
<div class="outline-text-2" id="text-orgb2a283f">
<div class="highlight"><pre><span></span><span class="cp">#ifndef SALES_DATA_H</span>
<span class="cp">#define SALES_DATA_H</span>
<span class="k">struct</span> <span class="n">Sales_data</span><span class="p">;</span>
<span class="n">istream</span> <span class="o">&amp;</span><span class="n">read</span><span class="p">(</span><span class="n">istream</span> <span class="o">&amp;</span><span class="n">is</span><span class="p">,</span> <span class="n">Sales_data</span> <span class="o">&amp;</span><span class="n">item</span><span class="p">);</span>
<span class="n">ostream</span> <span class="o">&amp;</span><span class="n">print</span><span class="p">(</span><span class="n">ostream</span> <span class="o">&amp;</span><span class="n">os</span><span class="p">,</span> <span class="k">const</span> <span class="n">Sales_data</span> <span class="o">&amp;</span><span class="n">item</span><span class="p">);</span>
<span class="n">Sales_data</span> <span class="nf">add</span><span class="p">(</span><span class="k">const</span> <span class="n">Sales_data</span> <span class="o">&amp;</span><span class="n">item1</span><span class="p">,</span> <span class="k">const</span> <span class="n">Sales_data</span> <span class="o">&amp;</span><span class="n">item2</span><span class="p">);</span>
<span class="k">struct</span> <span class="n">Sales_data</span> <span class="p">{</span>
  <span class="k">friend</span> <span class="n">istream</span> <span class="o">&amp;</span><span class="n">read</span><span class="p">(</span><span class="n">istream</span> <span class="o">&amp;</span><span class="p">,</span> <span class="n">Sales_data</span> <span class="o">&amp;</span><span class="p">);</span> 
  <span class="k">friend</span> <span class="n">ostream</span> <span class="o">&amp;</span><span class="n">print</span><span class="p">(</span><span class="n">ostream</span> <span class="o">&amp;</span><span class="p">,</span> <span class="k">const</span> <span class="n">Sales_data</span> <span class="o">&amp;</span><span class="p">);</span>
  <span class="k">friend</span> <span class="n">Sales_data</span> <span class="nf">add</span><span class="p">(</span><span class="k">const</span> <span class="n">Sales_data</span> <span class="o">&amp;</span><span class="n">item1</span><span class="p">,</span> <span class="k">const</span> <span class="n">Sales_data</span> <span class="o">&amp;</span><span class="n">item2</span><span class="p">);</span>
  <span class="k">friend</span> <span class="n">Sales_data</span> <span class="k">operator</span><span class="o">+</span><span class="p">(</span><span class="k">const</span> <span class="n">Sales_data</span> <span class="o">&amp;</span><span class="p">,</span> <span class="k">const</span> <span class="n">Sales_data</span> <span class="o">&amp;</span><span class="p">);</span>
  <span class="k">friend</span> <span class="n">istream</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="n">istream</span> <span class="o">&amp;</span><span class="p">,</span> <span class="n">Sales_data</span> <span class="o">&amp;</span><span class="p">);</span>
  <span class="k">friend</span> <span class="n">ostream</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="n">ostream</span> <span class="o">&amp;</span><span class="p">,</span> <span class="k">const</span> <span class="n">Sales_data</span> <span class="o">&amp;</span><span class="p">);</span>
  <span class="k">friend</span> <span class="kt">bool</span> <span class="k">operator</span><span class="o">==</span><span class="p">(</span><span class="k">const</span> <span class="n">Sales_data</span> <span class="o">&amp;</span><span class="p">,</span> <span class="k">const</span> <span class="n">Sales_data</span> <span class="o">&amp;</span><span class="p">);</span>
  <span class="k">friend</span> <span class="kt">bool</span> <span class="k">operator</span><span class="o">!=</span><span class="p">(</span><span class="k">const</span> <span class="n">Sales_data</span> <span class="o">&amp;</span><span class="p">,</span> <span class="k">const</span> <span class="n">Sales_data</span> <span class="o">&amp;</span><span class="p">);</span>
  <span class="k">friend</span> <span class="n">Sales_data</span> <span class="k">operator</span><span class="o">-</span><span class="p">(</span><span class="k">const</span> <span class="n">Sales_data</span> <span class="o">&amp;</span><span class="p">,</span> <span class="k">const</span> <span class="n">Sales_data</span> <span class="o">&amp;</span><span class="p">);</span>
<span class="k">public</span><span class="o">:</span>
  <span class="c1">// Sales_data(): bookNo(""), units_sold(0), revenue(0) {}</span>
  <span class="c1">// Exercise 7.14 above has misleading due to the CN version.</span>
  <span class="c1">// It's ok to use the in-class initializer values.</span>
<span class="n">Sales_data</span><span class="p">()</span><span class="o">:</span> <span class="n">Sales_data</span><span class="p">(</span><span class="s">""</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
  <span class="p">{</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">" Default"</span><span class="p">;};</span>
<span class="n">Sales_data</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="n">s</span><span class="p">)</span><span class="o">:</span> <span class="n">Sales_data</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
  <span class="p">{</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">" With string argument"</span><span class="p">;}</span>
<span class="n">Sales_data</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="n">s</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="n">n</span><span class="p">,</span> <span class="kt">double</span> <span class="n">p</span><span class="p">)</span><span class="o">:</span>
  <span class="n">bookNo</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="n">units_sold</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">revenue</span><span class="p">(</span><span class="n">p</span><span class="o">*</span><span class="n">n</span><span class="p">)</span>
  <span class="p">{</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">" With three arguments"</span><span class="p">;}</span>
<span class="n">Sales_data</span><span class="p">(</span><span class="n">istream</span> <span class="o">&amp;</span><span class="n">is</span><span class="p">)</span><span class="o">:</span> <span class="n">Sales_data</span><span class="p">()</span>
  <span class="p">{</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">" With istream argument"</span><span class="p">;</span> <span class="n">read</span><span class="p">(</span><span class="n">is</span><span class="p">,</span> <span class="o">*</span><span class="k">this</span><span class="p">);}</span>
  <span class="n">string</span> <span class="n">isbn</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span><span class="k">return</span> <span class="n">bookNo</span><span class="p">;}</span>
  <span class="n">Sales_data</span><span class="o">&amp;</span> <span class="n">combine</span><span class="p">(</span><span class="k">const</span> <span class="n">Sales_data</span><span class="o">&amp;</span><span class="p">);</span>
  <span class="n">Sales_data</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">+=</span><span class="p">(</span><span class="k">const</span> <span class="n">Sales_data</span> <span class="o">&amp;</span><span class="p">);</span>
  <span class="n">Sales_data</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">-=</span><span class="p">(</span><span class="k">const</span> <span class="n">Sales_data</span> <span class="o">&amp;</span><span class="p">);</span>
  <span class="n">Sales_data</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="p">);</span>
  <span class="k">operator</span> <span class="nf">string</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span><span class="k">return</span> <span class="n">bookNo</span><span class="p">;}</span>
  <span class="k">operator</span> <span class="nf">double</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span><span class="k">return</span> <span class="n">revenue</span><span class="p">;}</span>
<span class="k">private</span><span class="o">:</span>
  <span class="kt">double</span> <span class="n">avg_price</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
  <span class="n">string</span> <span class="n">bookNo</span><span class="p">;</span>
  <span class="kt">unsigned</span> <span class="n">units_sold</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="kt">double</span> <span class="n">revenue</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
<span class="p">};</span>
<span class="cp">#endif</span>
</pre></div>
</div>
</div>

<div id="outline-container-orgc0468b6" class="outline-2">
<h2 id="orgc0468b6">Exercise 14.3</h2>
<div class="outline-text-2" id="text-orgc0468b6">
<div class="highlight"><pre><span></span><span class="c1">// a "cobble" == "stone"; neither(unspecified behaviour, use strcmp instead)</span>
<span class="c1">// b svec1[0] == svec2[0]; overload == operator of string</span>
<span class="c1">// c svec1 == svec2; overload == operator of vector</span>
<span class="c1">// d svec1[0] == "stone"; overload == operator of string</span>
</pre></div>
</div>
</div>

<div id="outline-container-orge083fae" class="outline-2">
<h2 id="orge083fae">Exercise 14.4</h2>
<div class="outline-text-2" id="text-orge083fae">
<div class="highlight"><pre><span></span><span class="c1">// a %; not a member of class type, 1st: does not modify the operands, 2nd: operands may need convertion;</span>
<span class="c1">// b %=; should ba a member of class type, 1st: would modiry the left operand;</span>
<span class="c1">// c ++; member, same reason as b;</span>
<span class="c1">// d -&gt;; member, -&gt; operator must be a member of class type.</span>
<span class="c1">// e &lt;&lt;: shoud not be member, because left operand is ostream object, even though there is a overload &lt;&lt; operator defined within class type as member, the expression would not call it.</span>
<span class="c1">// f &amp;&amp;: not a member, same reason as a;</span>
<span class="c1">// g ==: not a member, same reason as a;</span>
<span class="c1">// f (): member, () operator must be a member of class type.</span>
</pre></div>
</div>
</div>

<div id="outline-container-org4fcbd29" class="outline-2">
<h2 id="org4fcbd29">Exercise 14.5</h2>
<div class="outline-text-2" id="text-org4fcbd29">
<div class="highlight"><pre><span></span><span class="c1">// See Employee.h.</span>
</pre></div>
</div>
</div>

<div id="outline-container-org882577f" class="outline-2">
<h2 id="org882577f">Employee.h</h2>
<div class="outline-text-2" id="text-org882577f">
<div class="highlight"><pre><span></span><span class="cp">#ifndef EMPLOYEE_H</span>
<span class="cp">#define EMPLOYEE_H</span>
<span class="k">class</span> <span class="nc">Employee</span><span class="p">;</span>
<span class="n">istream</span> <span class="o">&amp;</span><span class="n">read</span><span class="p">(</span><span class="n">istream</span> <span class="o">&amp;</span><span class="n">is</span><span class="p">,</span> <span class="n">Employee</span> <span class="o">&amp;</span><span class="n">e</span><span class="p">);</span>
<span class="k">class</span> <span class="nc">Employee</span>
<span class="p">{</span>
  <span class="k">friend</span> <span class="n">istream</span> <span class="o">&amp;</span><span class="n">read</span><span class="p">(</span><span class="n">istream</span> <span class="o">&amp;</span><span class="n">is</span><span class="p">,</span> <span class="n">Employee</span> <span class="o">&amp;</span><span class="n">e</span><span class="p">);</span>
  <span class="k">friend</span> <span class="n">istream</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="n">istream</span> <span class="o">&amp;</span><span class="n">is</span><span class="p">,</span> <span class="n">Employee</span> <span class="o">&amp;</span><span class="n">e</span><span class="p">);</span>
  <span class="k">friend</span> <span class="n">ostream</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="n">ostream</span> <span class="o">&amp;</span><span class="n">os</span><span class="p">,</span> <span class="k">const</span> <span class="n">Employee</span> <span class="o">&amp;</span><span class="n">e</span><span class="p">);</span>
  <span class="k">friend</span> <span class="kt">bool</span> <span class="k">operator</span><span class="o">==</span><span class="p">(</span><span class="k">const</span> <span class="n">Employee</span> <span class="o">&amp;</span><span class="n">e1</span><span class="p">,</span> <span class="k">const</span> <span class="n">Employee</span> <span class="o">&amp;</span><span class="n">e2</span><span class="p">);</span>
  <span class="k">friend</span> <span class="kt">bool</span> <span class="k">operator</span><span class="o">!=</span><span class="p">(</span><span class="k">const</span> <span class="n">Employee</span> <span class="o">&amp;</span><span class="n">e1</span><span class="p">,</span> <span class="k">const</span> <span class="n">Employee</span> <span class="o">&amp;</span><span class="n">e2</span><span class="p">);</span>
  <span class="k">using</span> <span class="n">str</span> <span class="o">=</span> <span class="n">string</span><span class="p">;</span>
  <span class="n">str</span> <span class="n">name</span><span class="p">;</span>
  <span class="n">str</span> <span class="n">address</span><span class="p">;</span>
  <span class="n">str</span> <span class="n">contact</span><span class="p">;</span>
  <span class="n">str</span> <span class="n">department</span><span class="p">;</span>
  <span class="n">str</span> <span class="n">job</span><span class="p">;</span>
 <span class="k">public</span><span class="o">:</span>
 <span class="n">Employee</span><span class="p">()</span><span class="o">:</span> <span class="n">Employee</span><span class="p">(</span><span class="s">""</span><span class="p">)</span> <span class="p">{};</span>
 <span class="n">Employee</span><span class="p">(</span><span class="n">str</span> <span class="n">n</span><span class="p">,</span> <span class="n">str</span> <span class="n">a</span> <span class="o">=</span> <span class="s">""</span><span class="p">,</span> <span class="n">str</span> <span class="n">c</span> <span class="o">=</span> <span class="s">""</span><span class="p">,</span> <span class="n">str</span> <span class="n">d</span> <span class="o">=</span> <span class="s">""</span><span class="p">,</span> <span class="n">str</span> <span class="n">j</span> <span class="o">=</span> <span class="s">""</span><span class="p">)</span><span class="o">:</span>
  <span class="n">name</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">address</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">contact</span><span class="p">(</span><span class="n">c</span><span class="p">),</span>  <span class="n">department</span><span class="p">(</span><span class="n">d</span><span class="p">),</span> <span class="n">job</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="p">{}</span>
  <span class="c1">// Exercise 7.40: An Employee object better has a name, left could be filled later</span>
  <span class="c1">// And compiler could be able to distinguish above two constructors</span>
 <span class="n">Employee</span><span class="p">(</span><span class="n">istream</span> <span class="o">&amp;</span><span class="n">is</span><span class="p">)</span><span class="o">:</span> <span class="n">Employee</span><span class="p">()</span> <span class="p">{</span><span class="n">is</span> <span class="o">&gt;&gt;</span> <span class="o">*</span><span class="k">this</span><span class="p">;}</span>
  <span class="n">Employee</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">Employee</span> <span class="o">&amp;</span><span class="p">);</span>
  <span class="n">Employee</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="n">Employee</span> <span class="o">&amp;&amp;</span><span class="p">)</span> <span class="k">noexcept</span><span class="p">;</span>
  <span class="n">Employee</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="p">);</span>
  <span class="k">explicit</span> <span class="k">operator</span> <span class="nf">bool</span><span class="p">()</span> <span class="k">const</span>
  <span class="p">{</span><span class="k">return</span> <span class="n">name</span><span class="p">.</span><span class="n">size</span><span class="p">();}</span>
<span class="p">};</span>
<span class="cp">#endif</span>
</pre></div>
</div>
</div>

<div id="outline-container-orgcae9221" class="outline-2">
<h2 id="orgcae9221">Exercise 14.6</h2>
<div class="outline-text-2" id="text-orgcae9221">
<div class="highlight"><pre><span></span><span class="c1">// See Sales_data.h and Sales_data.cpp.</span>
</pre></div>

<p>
<a href="#org98cde39">Sales_data.cpp</a>
</p>

<p>
<a href="#orgb2a283f">Sales_data.h</a>
</p>
</div>
</div>

<div id="outline-container-org5910a2e" class="outline-2">
<h2 id="org5910a2e">Exercise 14.7</h2>
<div class="outline-text-2" id="text-org5910a2e">
<div class="highlight"><pre><span></span><span class="c1">// See String.h.</span>
</pre></div>
</div>
</div>

<div id="outline-container-orgf340f15" class="outline-2">
<h2 id="orgf340f15">String.h</h2>
<div class="outline-text-2" id="text-orgf340f15">
<div class="highlight"><pre><span></span><span class="cp">#ifndef STRING_H_EX</span>
<span class="cp">#define STRING_H_EX</span>
<span class="k">class</span> <span class="nc">String</span>
<span class="p">{</span>
  <span class="k">friend</span> <span class="kt">bool</span> <span class="k">operator</span><span class="o">==</span><span class="p">(</span><span class="k">const</span> <span class="n">String</span> <span class="o">&amp;</span><span class="p">,</span> <span class="k">const</span> <span class="n">String</span> <span class="o">&amp;</span><span class="p">);</span>
  <span class="k">friend</span> <span class="kt">bool</span> <span class="k">operator</span><span class="o">!=</span><span class="p">(</span><span class="k">const</span> <span class="n">String</span> <span class="o">&amp;</span><span class="p">,</span> <span class="k">const</span> <span class="n">String</span> <span class="o">&amp;</span><span class="p">);</span>
  <span class="k">friend</span> <span class="kt">bool</span> <span class="k">operator</span><span class="o">&lt;</span><span class="p">(</span><span class="k">const</span> <span class="n">String</span> <span class="o">&amp;</span><span class="p">,</span> <span class="k">const</span> <span class="n">String</span> <span class="o">&amp;</span><span class="p">);</span>
  <span class="k">friend</span> <span class="n">ostream</span><span class="o">&amp;</span> <span class="k">operator</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="n">ostream</span> <span class="o">&amp;</span><span class="p">,</span> <span class="k">const</span> <span class="n">String</span><span class="o">&amp;</span><span class="p">);</span>
 <span class="k">public</span><span class="o">:</span>
 <span class="n">String</span><span class="p">()</span><span class="o">:</span> <span class="n">elements</span><span class="p">(</span><span class="k">nullptr</span><span class="p">),</span> <span class="n">first_free</span><span class="p">(</span><span class="k">nullptr</span><span class="p">),</span> <span class="n">cap</span><span class="p">(</span><span class="k">nullptr</span><span class="p">)</span> <span class="p">{}</span>
  <span class="n">String</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="p">);</span>
  <span class="n">String</span><span class="p">(</span><span class="k">const</span> <span class="n">String</span> <span class="o">&amp;</span><span class="p">);</span>
  <span class="n">String</span><span class="p">(</span><span class="n">String</span> <span class="o">&amp;&amp;</span><span class="p">)</span> <span class="k">noexcept</span><span class="p">;</span>
  <span class="n">String</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">String</span> <span class="o">&amp;</span><span class="p">);</span>
  <span class="n">String</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="n">String</span> <span class="o">&amp;&amp;</span><span class="p">)</span> <span class="k">noexcept</span><span class="p">;</span>
  <span class="kt">char</span> <span class="o">&amp;</span><span class="k">operator</span><span class="p">[](</span><span class="kt">size_t</span> <span class="n">n</span><span class="p">);</span>
  <span class="k">const</span> <span class="kt">char</span> <span class="o">&amp;</span><span class="k">operator</span><span class="p">[](</span><span class="kt">size_t</span> <span class="n">n</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
  <span class="o">~</span><span class="n">String</span><span class="p">();</span>
  <span class="kt">void</span> <span class="nf">push_back</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">&amp;</span><span class="p">);</span>
  <span class="kt">size_t</span> <span class="nf">size</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span><span class="k">return</span> <span class="n">first_free</span> <span class="o">-</span> <span class="n">elements</span><span class="p">;}</span>
  <span class="kt">size_t</span> <span class="nf">capacity</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span><span class="k">return</span> <span class="n">cap</span> <span class="o">-</span> <span class="n">elements</span><span class="p">;}</span>
  <span class="kt">char</span> <span class="o">*</span><span class="nf">begin</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span><span class="k">return</span> <span class="n">elements</span><span class="p">;}</span>
  <span class="kt">char</span> <span class="o">*</span><span class="nf">end</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span><span class="k">return</span> <span class="n">first_free</span><span class="p">;}</span>
  <span class="n">ostream</span> <span class="o">&amp;</span><span class="n">print</span><span class="p">();</span>
 <span class="k">private</span><span class="o">:</span>
  <span class="n">allocator</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span> <span class="n">alloc</span><span class="p">;</span> <span class="cm">/* it using static, 'undefined reference' reported when compile */</span>
  <span class="kt">void</span> <span class="nf">chk_n_alloc</span><span class="p">()</span>
  <span class="p">{</span><span class="k">if</span><span class="p">(</span><span class="n">size</span><span class="p">()</span> <span class="o">==</span> <span class="n">capacity</span><span class="p">())</span> <span class="n">reallocate</span><span class="p">();}</span>
  <span class="n">pair</span><span class="o">&lt;</span><span class="kt">char</span> <span class="o">*</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*&gt;</span> <span class="n">alloc_n_copy</span>
    <span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="p">);</span>
  <span class="kt">void</span> <span class="nf">free</span><span class="p">();</span>
  <span class="kt">void</span> <span class="nf">reallocate</span><span class="p">(</span><span class="kt">size_t</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span><span class="p">);</span>
  <span class="kt">char</span> <span class="o">*</span><span class="n">elements</span><span class="p">;</span>
  <span class="kt">char</span> <span class="o">*</span><span class="n">first_free</span><span class="p">;</span>
  <span class="kt">char</span> <span class="o">*</span><span class="n">cap</span><span class="p">;</span>
<span class="p">};</span>
<span class="cp">#endif</span>
</pre></div>
</div>
</div>

<div id="outline-container-orgd6a8a7b" class="outline-2">
<h2 id="orgd6a8a7b">Exercise 14.8</h2>
<div class="outline-text-2" id="text-orgd6a8a7b">
<div class="highlight"><pre><span></span><span class="c1">// See Employee.h</span>
</pre></div>

<p>
<a href="#org882577f">Employee.h</a>
</p>
</div>
</div>

<div id="outline-container-orgfce1447" class="outline-2">
<h2 id="orgfce1447">Exercise 14.9</h2>
<div class="outline-text-2" id="text-orgfce1447">
<div class="highlight"><pre><span></span><span class="c1">// See Sales_data.h and Sales_data.cpp.</span>
</pre></div>

<p>
<a href="#org98cde39">Sales_data.cpp</a>
</p>

<p>
<a href="#orgb2a283f">Sales_data.h</a>
</p>
</div>
</div>

<div id="outline-container-orgd7605a4" class="outline-2">
<h2 id="orgd7605a4">Exercise 14.10</h2>
<div class="outline-text-2" id="text-orgd7605a4">
<div class="highlight"><pre><span></span><span class="c1">// a, 0-201-99999-9 10 24.95 generates a valid Sales_data object with right data members.</span>
<span class="c1">// illegal input, the interger part of 24.95 would be stored in data member units_sold, then left part .95 would be treated as third input and converted to a float stored in this object as data member price; finally the data of this object contains is false.</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">Sales_data</span> <span class="n">a</span><span class="p">;</span>
  <span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">a</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">a</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>

<div id="outline-container-org49baf80" class="outline-2">
<h2 id="org49baf80">Exercise 14.11</h2>
<div class="outline-text-2" id="text-org49baf80">
<div class="highlight"><pre><span></span><span class="c1">// This overload &gt;&gt; verseion illustrated in text is exactly the most original version I implemented before.</span>
<span class="c1">// Of course bug exists.</span>
<span class="c1">// It does not check the state of the istream object, the final Sales_data object modified throuth istream may be unexpected, for the data members of which may not be associated as one valid Sales_data object.</span>
</pre></div>
</div>
</div>

<div id="outline-container-orgffac863" class="outline-2">
<h2 id="orgffac863">Exercise 14.12</h2>
<div class="outline-text-2" id="text-orgffac863">
<div class="highlight"><pre><span></span><span class="c1">// See Employee.h.</span>
</pre></div>

<p>
<a href="#org882577f">Employee.h</a>
</p>
</div>
</div>

<div id="outline-container-org882638f" class="outline-2">
<h2 id="org882638f">Exercise 14.13</h2>
<div class="outline-text-2" id="text-org882638f">
<div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>

<div id="outline-container-org4d18fc1" class="outline-2">
<h2 id="org4d18fc1">Exercise 14.14</h2>
<div class="outline-text-2" id="text-org4d18fc1">
<div class="highlight"><pre><span></span><span class="c1">// refraction friendly;</span>
<span class="c1">// simplified code;</span>
</pre></div>
</div>
</div>

<div id="outline-container-org7c4fd62" class="outline-2">
<h2 id="org7c4fd62">Exercise 14.15</h2>
<div class="outline-text-2" id="text-org7c4fd62">
<div class="highlight"><pre><span></span><span class="c1">// No;</span>
<span class="c1">// for the Employee class type defined before, to overload arithmetic operators for it is meaningless, due to that calculating the sum or something else of Employee objects is pointless.</span>
</pre></div>
</div>
</div>

<div id="outline-container-orga146106" class="outline-2">
<h2 id="orga146106">Exercise 14.16</h2>
<div class="outline-text-2" id="text-orga146106">
<div class="highlight"><pre><span></span><span class="c1">// See StrBlob.h, StrVec.h, String.h.</span>
</pre></div>

<p>
<a href="#orgf340f15">String.h</a>
</p>
</div>
</div>

<div id="outline-container-orga40cb34" class="outline-2">
<h2 id="orga40cb34">StrBlob.h</h2>
<div class="outline-text-2" id="text-orga40cb34">
<div class="highlight"><pre><span></span><span class="cp">#ifndef STRBLOB_H</span>
<span class="cp">#define STRBLOB_H</span>
<span class="k">class</span> <span class="nc">StrBlobPtr</span><span class="p">;</span>
<span class="k">class</span> <span class="nc">StrBlob</span>
<span class="p">{</span>
  <span class="k">friend</span> <span class="k">class</span> <span class="nc">StrBlobPtr</span><span class="p">;</span>
  <span class="k">friend</span> <span class="k">class</span> <span class="nc">ConstStrBlobPtr</span><span class="p">;</span>
  <span class="k">friend</span> <span class="kt">bool</span> <span class="k">operator</span><span class="o">==</span><span class="p">(</span><span class="k">const</span> <span class="n">StrBlob</span> <span class="o">&amp;</span><span class="p">,</span> <span class="k">const</span> <span class="n">StrBlob</span> <span class="o">&amp;</span><span class="p">);</span>
  <span class="k">friend</span> <span class="kt">bool</span> <span class="k">operator</span><span class="o">!=</span><span class="p">(</span><span class="k">const</span> <span class="n">StrBlob</span> <span class="o">&amp;</span><span class="p">,</span> <span class="k">const</span> <span class="n">StrBlob</span> <span class="o">&amp;</span><span class="p">);</span>
  <span class="k">friend</span> <span class="kt">bool</span> <span class="k">operator</span><span class="o">&lt;</span><span class="p">(</span><span class="k">const</span> <span class="n">StrBlob</span> <span class="o">&amp;</span><span class="p">,</span> <span class="k">const</span> <span class="n">StrBlob</span> <span class="o">&amp;</span><span class="p">);</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="k">typedef</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;::</span><span class="n">size_type</span> <span class="n">size_type</span><span class="p">;</span>
  <span class="n">StrBlob</span><span class="p">();</span>
  <span class="n">StrBlob</span><span class="p">(</span><span class="n">initializer_list</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">il</span><span class="p">);</span>
  <span class="n">StrBlob</span><span class="p">(</span><span class="k">const</span> <span class="n">StrBlob</span> <span class="o">&amp;</span><span class="p">);</span>
  <span class="n">StrBlob</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">StrBlob</span> <span class="o">&amp;</span><span class="p">);</span>
  <span class="n">string</span> <span class="o">&amp;</span><span class="k">operator</span><span class="p">[](</span><span class="kt">size_t</span> <span class="n">n</span><span class="p">);</span>
  <span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="k">operator</span><span class="p">[](</span><span class="kt">size_t</span> <span class="n">n</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
  <span class="n">size_type</span> <span class="nf">size</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span><span class="k">return</span> <span class="n">data</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">();}</span>
  <span class="kt">bool</span> <span class="nf">empty</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span><span class="k">return</span> <span class="n">data</span><span class="o">-&gt;</span><span class="n">empty</span><span class="p">();}</span>
  <span class="kt">void</span> <span class="nf">push_back</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="n">t</span><span class="p">)</span> <span class="p">{</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">push_back</span><span class="p">(</span><span class="n">t</span><span class="p">);}</span>
  <span class="kt">void</span> <span class="nf">push_back</span><span class="p">(</span><span class="n">string</span> <span class="o">&amp;&amp;</span><span class="n">t</span><span class="p">)</span> <span class="p">{</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">push_back</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">t</span><span class="p">));}</span>
  <span class="kt">void</span> <span class="nf">pop_back</span><span class="p">();</span>
  <span class="n">string</span> <span class="o">&amp;</span><span class="n">front</span><span class="p">();</span>
  <span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="n">front</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
  <span class="n">string</span> <span class="o">&amp;</span><span class="n">back</span><span class="p">();</span>
  <span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="n">back</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
  <span class="n">StrBlobPtr</span> <span class="nf">begin</span><span class="p">();</span>
    <span class="n">StrBlobPtr</span> <span class="nf">end</span><span class="p">();</span>
 <span class="k">private</span><span class="o">:</span>
  <span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;&gt;</span> <span class="n">data</span><span class="p">;</span>
  <span class="kt">void</span> <span class="nf">check</span><span class="p">(</span><span class="n">size_type</span> <span class="n">i</span><span class="p">,</span> <span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="n">msg</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
<span class="p">};</span>
<span class="k">class</span> <span class="nc">StrBlobPtr</span>
<span class="p">{</span>
  <span class="k">friend</span> <span class="kt">bool</span> <span class="k">operator</span><span class="o">==</span><span class="p">(</span><span class="k">const</span> <span class="n">StrBlobPtr</span> <span class="o">&amp;</span><span class="p">,</span> <span class="k">const</span> <span class="n">StrBlobPtr</span> <span class="o">&amp;</span><span class="p">);</span>
  <span class="k">friend</span> <span class="kt">bool</span> <span class="k">operator</span><span class="o">!=</span><span class="p">(</span><span class="k">const</span> <span class="n">StrBlobPtr</span> <span class="o">&amp;</span><span class="p">,</span> <span class="k">const</span> <span class="n">StrBlobPtr</span> <span class="o">&amp;</span><span class="p">);</span>
  <span class="k">friend</span> <span class="kt">bool</span> <span class="k">operator</span><span class="o">&lt;</span><span class="p">(</span><span class="k">const</span> <span class="n">StrBlobPtr</span> <span class="o">&amp;</span><span class="p">,</span> <span class="k">const</span> <span class="n">StrBlobPtr</span> <span class="o">&amp;</span><span class="p">);</span>
  <span class="k">friend</span> <span class="n">StrBlobPtr</span> <span class="k">operator</span><span class="o">+</span><span class="p">(</span><span class="k">const</span> <span class="n">StrBlobPtr</span> <span class="o">&amp;</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">n</span><span class="p">);</span>
  <span class="k">friend</span> <span class="n">StrBlobPtr</span> <span class="k">operator</span><span class="o">-</span><span class="p">(</span><span class="k">const</span> <span class="n">StrBlobPtr</span> <span class="o">&amp;</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">n</span><span class="p">);</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="n">string</span> <span class="o">&amp;</span><span class="k">operator</span><span class="p">[](</span><span class="kt">size_t</span> <span class="n">n</span><span class="p">);</span>
  <span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="k">operator</span><span class="p">[](</span><span class="kt">size_t</span> <span class="n">n</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
  <span class="n">StrBlobPtr</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">++</span><span class="p">();</span>
  <span class="n">StrBlobPtr</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">--</span><span class="p">();</span>
  <span class="n">StrBlobPtr</span> <span class="k">operator</span><span class="o">++</span><span class="p">(</span><span class="kt">int</span><span class="p">);</span>
  <span class="n">StrBlobPtr</span> <span class="k">operator</span><span class="o">--</span><span class="p">(</span><span class="kt">int</span><span class="p">);</span>
  <span class="n">string</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">*</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
  <span class="n">string</span> <span class="o">*</span><span class="k">operator</span><span class="o">-&gt;</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
 <span class="n">StrBlobPtr</span><span class="p">()</span><span class="o">:</span> <span class="n">curr</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">{}</span>
 <span class="n">StrBlobPtr</span><span class="p">(</span><span class="n">StrBlob</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">sz</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span><span class="o">:</span>
  <span class="n">wptr</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">data</span><span class="p">),</span> <span class="n">curr</span><span class="p">(</span><span class="n">sz</span><span class="p">)</span> <span class="p">{}</span>
  <span class="n">string</span> <span class="o">&amp;</span><span class="n">deref</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
  <span class="n">StrBlobPtr</span> <span class="o">&amp;</span><span class="n">incr</span><span class="p">();</span>
 <span class="k">private</span><span class="o">:</span>
  <span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;&gt;</span> <span class="n">check</span><span class="p">(</span><span class="kt">size_t</span><span class="p">,</span><span class="k">const</span> <span class="n">string</span><span class="o">&amp;</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
  <span class="n">weak_ptr</span><span class="o">&lt;</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;&gt;</span> <span class="n">wptr</span><span class="p">;</span>
  <span class="kt">size_t</span> <span class="n">curr</span><span class="p">;</span>
<span class="p">};</span>
<span class="k">class</span> <span class="nc">ConstStrBlobPtr</span>
<span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
 <span class="n">ConstStrBlobPtr</span><span class="p">()</span><span class="o">:</span> <span class="n">curr</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">{}</span>
 <span class="n">ConstStrBlobPtr</span><span class="p">(</span><span class="k">const</span> <span class="n">StrBlob</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">sz</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span><span class="o">:</span>
  <span class="n">wptr</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">data</span><span class="p">),</span> <span class="n">curr</span><span class="p">(</span><span class="n">sz</span><span class="p">)</span> <span class="p">{}</span>
  <span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="n">deref</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
  <span class="n">ConstStrBlobPtr</span> <span class="o">&amp;</span><span class="n">incr</span><span class="p">();</span>
  <span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">*</span><span class="p">();</span>
  <span class="k">const</span> <span class="n">string</span> <span class="o">*</span><span class="k">operator</span><span class="o">-&gt;</span><span class="p">();</span>
 <span class="k">private</span><span class="o">:</span>
  <span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;&gt;</span> <span class="n">check</span><span class="p">(</span><span class="kt">size_t</span><span class="p">,</span> <span class="k">const</span> <span class="n">string</span><span class="o">&amp;</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
  <span class="n">weak_ptr</span><span class="o">&lt;</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;&gt;</span> <span class="n">wptr</span><span class="p">;</span>
  <span class="kt">size_t</span> <span class="n">curr</span><span class="p">;</span>
<span class="p">};</span>
<span class="cp">#endif</span>
</pre></div>
</div>
</div>

<div id="outline-container-org14e0778" class="outline-2">
<h2 id="org14e0778">StrVec.h</h2>
<div class="outline-text-2" id="text-org14e0778">
<div class="highlight"><pre><span></span><span class="cp">#ifndef STRVEC_H</span>
<span class="cp">#define STRVEC_H</span>
<span class="k">class</span> <span class="nc">StrVec</span>
<span class="p">{</span>
  <span class="k">friend</span> <span class="kt">bool</span> <span class="k">operator</span><span class="o">==</span><span class="p">(</span><span class="k">const</span> <span class="n">StrVec</span> <span class="o">&amp;</span><span class="p">,</span> <span class="k">const</span> <span class="n">StrVec</span> <span class="o">&amp;</span><span class="p">);</span>
  <span class="k">friend</span> <span class="kt">bool</span> <span class="k">operator</span><span class="o">!=</span><span class="p">(</span><span class="k">const</span> <span class="n">StrVec</span> <span class="o">&amp;</span><span class="p">,</span> <span class="k">const</span> <span class="n">StrVec</span> <span class="o">&amp;</span><span class="p">);</span>
  <span class="k">friend</span> <span class="kt">bool</span> <span class="k">operator</span><span class="o">&lt;</span><span class="p">(</span><span class="k">const</span> <span class="n">StrVec</span> <span class="o">&amp;</span><span class="p">,</span> <span class="k">const</span> <span class="n">StrVec</span> <span class="o">&amp;</span><span class="p">);</span>
 <span class="k">public</span><span class="o">:</span>
 <span class="n">StrVec</span><span class="p">()</span><span class="o">:</span> <span class="n">elements</span><span class="p">(</span><span class="k">nullptr</span><span class="p">),</span> <span class="n">first_free</span><span class="p">(</span><span class="k">nullptr</span><span class="p">),</span> <span class="n">cap</span><span class="p">(</span><span class="k">nullptr</span><span class="p">)</span> <span class="p">{}</span>
  <span class="n">StrVec</span><span class="p">(</span><span class="k">const</span> <span class="n">StrVec</span> <span class="o">&amp;</span><span class="p">);</span>
  <span class="n">StrVec</span><span class="p">(</span><span class="n">StrVec</span> <span class="o">&amp;&amp;</span><span class="p">)</span> <span class="k">noexcept</span><span class="p">;</span>
  <span class="n">StrVec</span><span class="p">(</span><span class="k">const</span> <span class="n">initializer_list</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">is</span><span class="p">);</span>
  <span class="n">StrVec</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">StrVec</span> <span class="o">&amp;</span><span class="p">);</span>
  <span class="n">StrVec</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="n">StrVec</span> <span class="o">&amp;&amp;</span><span class="p">)</span> <span class="k">noexcept</span><span class="p">;</span>
  <span class="n">StrVec</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">initializer_list</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="p">);</span>
  <span class="n">string</span> <span class="o">&amp;</span><span class="k">operator</span><span class="p">[](</span><span class="kt">size_t</span> <span class="n">n</span><span class="p">);</span>
  <span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="k">operator</span><span class="p">[](</span><span class="kt">size_t</span> <span class="n">n</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
  <span class="o">~</span><span class="n">StrVec</span><span class="p">();</span>
  <span class="kt">void</span> <span class="nf">push_back</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="p">);</span>
  <span class="kt">size_t</span> <span class="nf">size</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span><span class="k">return</span> <span class="n">first_free</span> <span class="o">-</span> <span class="n">elements</span><span class="p">;}</span>
  <span class="kt">size_t</span> <span class="nf">capacity</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span><span class="k">return</span> <span class="n">cap</span> <span class="o">-</span> <span class="n">elements</span><span class="p">;}</span>
  <span class="kt">void</span> <span class="nf">reserve</span><span class="p">(</span><span class="kt">size_t</span><span class="p">);</span>
  <span class="kt">void</span> <span class="nf">resize</span><span class="p">(</span><span class="kt">size_t</span> <span class="n">n</span><span class="p">,</span> <span class="n">string</span> <span class="n">s</span> <span class="o">=</span> <span class="s">""</span><span class="p">);</span>
  <span class="n">string</span> <span class="o">*</span><span class="nf">begin</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span><span class="k">return</span> <span class="n">elements</span><span class="p">;}</span>
  <span class="n">string</span> <span class="o">*</span><span class="nf">end</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span><span class="k">return</span> <span class="n">first_free</span><span class="p">;}</span>
 <span class="k">private</span><span class="o">:</span>
  <span class="n">allocator</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">alloc</span><span class="p">;</span> <span class="cm">/* it using static, 'undefined reference' reported when compile */</span>
  <span class="kt">void</span> <span class="nf">chk_n_alloc</span><span class="p">()</span>
  <span class="p">{</span><span class="k">if</span><span class="p">(</span><span class="n">size</span><span class="p">()</span> <span class="o">==</span> <span class="n">capacity</span><span class="p">())</span> <span class="n">reallocate</span><span class="p">();}</span>
  <span class="n">pair</span><span class="o">&lt;</span><span class="n">string</span> <span class="o">*</span><span class="p">,</span> <span class="n">string</span> <span class="o">*&gt;</span> <span class="n">alloc_n_copy</span>
    <span class="p">(</span><span class="k">const</span> <span class="n">string</span> <span class="o">*</span><span class="p">,</span> <span class="k">const</span> <span class="n">string</span> <span class="o">*</span><span class="p">);</span>
  <span class="kt">void</span> <span class="nf">free</span><span class="p">();</span>
  <span class="kt">void</span> <span class="nf">reallocate</span><span class="p">(</span><span class="kt">size_t</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span><span class="p">);</span>
  <span class="n">string</span> <span class="o">*</span><span class="n">elements</span><span class="p">;</span>
  <span class="n">string</span> <span class="o">*</span><span class="n">first_free</span><span class="p">;</span>
  <span class="n">string</span> <span class="o">*</span><span class="n">cap</span><span class="p">;</span>
<span class="p">};</span>
<span class="cp">#endif</span>
</pre></div>
</div>
</div>

<div id="outline-container-org0d808db" class="outline-2">
<h2 id="org0d808db">Exercise 14.17</h2>
<div class="outline-text-2" id="text-org0d808db">
<div class="highlight"><pre><span></span><span class="c1">// Yes;</span>
<span class="c1">// See Employee.h.</span>
</pre></div>

<p>
<a href="#org882577f">Employee.h</a>
</p>
</div>
</div>

<div id="outline-container-orgecb2153" class="outline-2">
<h2 id="orgecb2153">Exercise 14.18</h2>
<div class="outline-text-2" id="text-orgecb2153">
<div class="highlight"><pre><span></span><span class="c1">// See StrBlob.h, StrVec.h and String.h.</span>
</pre></div>

<p>
<a href="#orga40cb34">StrBlob.h</a>
</p>

<p>
<a href="#org14e0778">StrVec.h</a>
</p>

<p>
<a href="#orgf340f15">String.h</a>
</p>
</div>
</div>

<div id="outline-container-orge0564eb" class="outline-2">
<h2 id="orge0564eb">Exercise 14.19</h2>
<div class="outline-text-2" id="text-orge0564eb">
<div class="highlight"><pre><span></span><span class="c1">// No;</span>
<span class="c1">// overload relationship operators of it, like operator &lt;, is not logic reliable;</span>
<span class="c1">// because there are several data members contained in Employee class type, relationship could be concluded based on name, address or job, etc;</span>
<span class="c1">// there would be conflict between relationship operators and == operator.</span>
</pre></div>
</div>
</div>

<div id="outline-container-orgb67f085" class="outline-2">
<h2 id="orgb67f085">Exercise 14.20</h2>
<div class="outline-text-2" id="text-orgb67f085">
<div class="highlight"><pre><span></span><span class="c1">// See Sales_data.h and Sales_data.cpp.</span>
</pre></div>

<p>
<a href="#org98cde39">Sales_data.cpp</a>
</p>

<p>
<a href="#orgb2a283f">Sales_data.h</a>
</p>
</div>
</div>

<div id="outline-container-orgc3d8ff8" class="outline-2">
<h2 id="orgc3d8ff8">Exercise 14.21</h2>
<div class="outline-text-2" id="text-orgc3d8ff8">
<div class="highlight"><pre><span></span><span class="c1">//////////////////////////////////////////////////////////////////////</span>
<span class="c1">// Sales_data operator+(const Sales_data &amp;d1, const Sales_data &amp;d2) //</span>
<span class="c1">// {								    //</span>
<span class="c1">//   Sales_data temp(d1);					    //</span>
<span class="c1">//   temp.units_sold += d2.units_sold;				    //</span>
<span class="c1">//   temp.revenue += d2.revenue;				    //</span>
<span class="c1">//   return temp;						    //</span>
<span class="c1">// }								    //</span>
<span class="c1">// 								    //</span>
<span class="c1">// Sales_data &amp;Sales_data::operator+=(const Sales_data &amp;d)	    //</span>
<span class="c1">// {								    //</span>
<span class="c1">//   *this = *this + d;						    //</span>
<span class="c1">//   return *this;						    //</span>
<span class="c1">// }								    //</span>
<span class="c1">//////////////////////////////////////////////////////////////////////</span>
<span class="c1">// disadvantages:</span>
<span class="c1">// redundant work compared to the original version defined in section 14.3 and 14.4, for example, the unnecessary copy-assignment operation within overload operator +=.</span>
</pre></div>
</div>
</div>

<div id="outline-container-org40e62d9" class="outline-2">
<h2 id="org40e62d9">Exercise 14.22</h2>
<div class="outline-text-2" id="text-org40e62d9">
<div class="highlight"><pre><span></span><span class="c1">// See Sales_data.h and Sales_data.cpp.</span>
</pre></div>

<p>
<a href="#org98cde39">Sales_data.cpp</a>
</p>

<p>
<a href="#orgb2a283f">Sales_data.h</a>
</p>
</div>
</div>

<div id="outline-container-org219045b" class="outline-2">
<h2 id="org219045b">Exercise 14.23</h2>
<div class="outline-text-2" id="text-org219045b">
<div class="highlight"><pre><span></span><span class="c1">// See StrVec.h.</span>
</pre></div>

<p>
<a href="#org14e0778">StrVec.h</a>
</p>
</div>
</div>

<div id="outline-container-orga8ef8ca" class="outline-2">
<h2 id="orga8ef8ca">Exercise 14.24</h2>
<div class="outline-text-2" id="text-orga8ef8ca">
<div class="highlight"><pre><span></span><span class="c1">// Yes;</span>
<span class="c1">// See Employee.h.</span>
</pre></div>

<p>
<a href="#org882577f">Employee.h</a>
</p>
</div>
</div>

<div id="outline-container-orgd26aae1" class="outline-2">
<h2 id="orgd26aae1">Exercise 14.25</h2>
<div class="outline-text-2" id="text-orgd26aae1">
<div class="highlight"><pre><span></span><span class="c1">// Needs another overload assignment operator which accepts one const string &amp; parameter, this parameter would be used to assign data member 'name';</span>
<span class="c1">// the right operand should be string object, or object which could be implicitly converted to string object, for the data member 'name' is a string type object.</span>
</pre></div>
</div>
</div>

<div id="outline-container-org3d6d5aa" class="outline-2">
<h2 id="org3d6d5aa">Exercise 14.27</h2>
<div class="outline-text-2" id="text-org3d6d5aa">
<div class="highlight"><pre><span></span><span class="c1">// Seee StrBlob.h and StrBlob.cpp.</span>
</pre></div>

<p>
<a href="#orga40cb34">StrBlob.h</a>
</p>
</div>
</div>

<div id="outline-container-org1339b99" class="outline-2">
<h2 id="org1339b99">StrBlob.cpp</h2>
<div class="outline-text-2" id="text-org1339b99">
<div class="highlight"><pre><span></span><span class="c1">// StrBlob member</span>
<span class="n">StrBlob</span><span class="o">::</span><span class="n">StrBlob</span><span class="p">()</span><span class="o">:</span> <span class="n">data</span><span class="p">(</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;&gt;</span><span class="p">())</span> <span class="p">{}</span>
<span class="n">StrBlob</span><span class="o">::</span><span class="n">StrBlob</span><span class="p">(</span><span class="n">initializer_list</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">il</span><span class="p">)</span><span class="o">:</span>
<span class="n">data</span><span class="p">(</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="n">il</span><span class="p">))</span> <span class="p">{}</span>
<span class="n">StrBlob</span><span class="o">::</span><span class="n">StrBlob</span><span class="p">(</span><span class="k">const</span> <span class="n">StrBlob</span> <span class="o">&amp;</span><span class="n">s</span><span class="p">)</span><span class="o">:</span> <span class="n">data</span><span class="p">(</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="o">*</span><span class="n">s</span><span class="p">.</span><span class="n">data</span><span class="p">))</span> <span class="p">{}</span>
<span class="n">StrBlob</span> <span class="o">&amp;</span><span class="n">StrBlob</span><span class="o">::</span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">StrBlob</span> <span class="o">&amp;</span><span class="n">s</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">data</span> <span class="o">=</span> <span class="n">make_shared</span><span class="o">&lt;</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="o">*</span><span class="n">s</span><span class="p">.</span><span class="n">data</span><span class="p">);</span>
  <span class="k">return</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span>
<span class="p">}</span>
<span class="kr">inline</span> <span class="n">string</span> <span class="o">&amp;</span><span class="n">StrBlob</span><span class="o">::</span><span class="k">operator</span><span class="p">[](</span><span class="kt">size_t</span> <span class="n">n</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="n">data</span><span class="o">-&gt;</span><span class="n">at</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>
<span class="p">}</span>
<span class="kr">inline</span> <span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="n">StrBlob</span><span class="o">::</span><span class="k">operator</span><span class="p">[](</span><span class="kt">size_t</span> <span class="n">n</span><span class="p">)</span> <span class="k">const</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="n">data</span><span class="o">-&gt;</span><span class="n">at</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="n">StrBlob</span><span class="o">::</span><span class="n">check</span><span class="p">(</span><span class="n">size_type</span> <span class="n">i</span><span class="p">,</span> <span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="n">msg</span><span class="p">)</span> <span class="k">const</span>
<span class="p">{</span>
  <span class="k">if</span><span class="p">(</span><span class="n">i</span> <span class="o">&gt;=</span> <span class="n">data</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">())</span>
    <span class="k">throw</span> <span class="n">out_of_range</span><span class="p">(</span><span class="n">msg</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">string</span> <span class="o">&amp;</span><span class="n">StrBlob</span><span class="o">::</span><span class="n">front</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">check</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s">"front on empty StrBlob"</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">data</span><span class="o">-&gt;</span><span class="n">front</span><span class="p">();</span>
<span class="p">}</span>
<span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="n">StrBlob</span><span class="o">::</span><span class="n">front</span><span class="p">()</span> <span class="k">const</span>
<span class="p">{</span>
  <span class="n">check</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s">"front on empty StrBlob"</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">data</span><span class="o">-&gt;</span><span class="n">front</span><span class="p">();</span>
<span class="p">}</span>
<span class="n">string</span> <span class="o">&amp;</span><span class="n">StrBlob</span><span class="o">::</span><span class="n">back</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">check</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s">"badk on empty StrBlob"</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">data</span><span class="o">-&gt;</span><span class="n">back</span><span class="p">();</span>
<span class="p">}</span>
<span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="n">StrBlob</span><span class="o">::</span><span class="n">back</span><span class="p">()</span> <span class="k">const</span>
<span class="p">{</span>
  <span class="n">check</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s">"back on empty StrBlob"</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">data</span><span class="o">-&gt;</span><span class="n">back</span><span class="p">();</span>
<span class="p">}</span>
<span class="kt">bool</span> <span class="k">operator</span><span class="o">==</span><span class="p">(</span><span class="k">const</span> <span class="n">StrBlob</span> <span class="o">&amp;</span><span class="n">s1</span><span class="p">,</span> <span class="k">const</span> <span class="n">StrBlob</span> <span class="o">&amp;</span><span class="n">s2</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="o">*</span><span class="p">(</span><span class="n">s1</span><span class="p">.</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="o">*</span><span class="p">(</span><span class="n">s2</span><span class="p">.</span><span class="n">data</span><span class="p">);</span>
<span class="p">}</span>
<span class="kt">bool</span> <span class="k">operator</span><span class="o">!=</span><span class="p">(</span><span class="k">const</span> <span class="n">StrBlob</span> <span class="o">&amp;</span><span class="n">s1</span><span class="p">,</span> <span class="k">const</span> <span class="n">StrBlob</span> <span class="o">&amp;</span><span class="n">s2</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="o">!</span><span class="p">(</span><span class="n">s1</span> <span class="o">==</span> <span class="n">s2</span><span class="p">);</span>
<span class="p">}</span>
<span class="kt">bool</span> <span class="k">operator</span><span class="o">&lt;</span><span class="p">(</span><span class="k">const</span> <span class="n">StrBlob</span> <span class="o">&amp;</span><span class="n">s1</span><span class="p">,</span> <span class="k">const</span> <span class="n">StrBlob</span> <span class="o">&amp;</span><span class="n">s2</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="o">*</span><span class="p">(</span><span class="n">s1</span><span class="p">.</span><span class="n">data</span><span class="p">)</span> <span class="o">&lt;</span> <span class="o">*</span><span class="p">(</span><span class="n">s2</span><span class="p">.</span><span class="n">data</span><span class="p">);</span>
<span class="p">}</span>
<span class="c1">// StrBlobPtr member</span>
<span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;&gt;</span> <span class="n">StrBlobPtr</span><span class="o">::</span><span class="n">check</span><span class="p">(</span><span class="kt">size_t</span> <span class="n">i</span><span class="p">,</span> <span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="n">msg</span><span class="p">)</span> <span class="k">const</span>
<span class="p">{</span>
  <span class="k">auto</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">wptr</span><span class="p">.</span><span class="n">lock</span><span class="p">();</span>
  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">ret</span><span class="p">)</span>
    <span class="k">throw</span> <span class="n">runtime_error</span><span class="p">(</span><span class="s">"unbound StrBlobPtr"</span><span class="p">);</span>
  <span class="k">if</span><span class="p">(</span><span class="n">i</span> <span class="o">&gt;=</span> <span class="n">ret</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">())</span>
    <span class="k">throw</span> <span class="n">out_of_range</span><span class="p">(</span><span class="n">msg</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">string</span> <span class="o">&amp;</span><span class="n">StrBlobPtr</span><span class="o">::</span><span class="k">operator</span><span class="p">[](</span><span class="kt">size_t</span> <span class="n">n</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">auto</span> <span class="n">p</span> <span class="o">=</span> <span class="n">check</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="s">"out of range"</span><span class="p">);</span>
  <span class="k">return</span> <span class="p">(</span><span class="o">*</span><span class="n">p</span><span class="p">)[</span><span class="n">n</span><span class="p">];</span>
<span class="p">}</span>
<span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="n">StrBlobPtr</span><span class="o">::</span><span class="k">operator</span><span class="p">[](</span><span class="kt">size_t</span> <span class="n">n</span><span class="p">)</span> <span class="k">const</span>
<span class="p">{</span>
  <span class="k">auto</span> <span class="n">p</span> <span class="o">=</span> <span class="n">check</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="s">"out of range"</span><span class="p">);</span>
  <span class="k">return</span> <span class="p">(</span><span class="o">*</span><span class="n">p</span><span class="p">)[</span><span class="n">n</span><span class="p">];</span>
<span class="p">}</span>
<span class="n">StrBlobPtr</span> <span class="o">&amp;</span><span class="n">StrBlobPtr</span><span class="o">::</span><span class="k">operator</span><span class="o">++</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">check</span><span class="p">(</span><span class="n">curr</span><span class="p">,</span> <span class="s">"increment past end of StrBlobPtr"</span><span class="p">);</span>
  <span class="o">++</span><span class="n">curr</span><span class="p">;</span>
  <span class="k">return</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">StrBlobPtr</span> <span class="o">&amp;</span><span class="n">StrBlobPtr</span><span class="o">::</span><span class="k">operator</span><span class="o">--</span><span class="p">()</span>
<span class="p">{</span>
  <span class="o">--</span><span class="n">curr</span><span class="p">;</span>
  <span class="n">check</span><span class="p">(</span><span class="n">curr</span><span class="p">,</span> <span class="s">"increment past end of StrBlobPtr"</span><span class="p">);</span>
  <span class="k">return</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">StrBlobPtr</span> <span class="n">StrBlobPtr</span><span class="o">::</span><span class="k">operator</span><span class="o">++</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">StrBlobPtr</span> <span class="n">ret</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">);</span>
  <span class="o">++*</span><span class="k">this</span><span class="p">;</span>
  <span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">StrBlobPtr</span> <span class="n">StrBlobPtr</span><span class="o">::</span><span class="k">operator</span><span class="o">--</span><span class="p">(</span><span class="kt">int</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">StrBlobPtr</span> <span class="n">ret</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">);</span>
  <span class="o">--*</span><span class="k">this</span><span class="p">;</span>
  <span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">string</span> <span class="o">&amp;</span><span class="n">StrBlobPtr</span><span class="o">::</span><span class="k">operator</span><span class="o">*</span><span class="p">()</span> <span class="k">const</span>
<span class="p">{</span>
  <span class="k">auto</span> <span class="n">p</span> <span class="o">=</span> <span class="n">check</span><span class="p">(</span><span class="n">curr</span><span class="p">,</span> <span class="s">"dereference pass end"</span><span class="p">);</span>
  <span class="k">return</span> <span class="p">(</span><span class="o">*</span><span class="n">p</span><span class="p">)[</span><span class="n">curr</span><span class="p">];</span>
<span class="p">}</span>
<span class="n">string</span> <span class="o">*</span><span class="n">StrBlobPtr</span><span class="o">::</span><span class="k">operator</span><span class="o">-&gt;</span><span class="p">()</span> <span class="k">const</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="o">&amp;</span><span class="k">this</span><span class="o">-&gt;</span><span class="k">operator</span><span class="o">*</span><span class="p">();</span>
<span class="p">}</span>
<span class="n">string</span> <span class="o">&amp;</span><span class="n">StrBlobPtr</span><span class="o">::</span><span class="n">deref</span><span class="p">()</span> <span class="k">const</span>
<span class="p">{</span>
  <span class="k">auto</span> <span class="n">p</span> <span class="o">=</span> <span class="n">check</span><span class="p">(</span><span class="n">curr</span><span class="p">,</span> <span class="s">"deference pass end"</span><span class="p">);</span>
  <span class="k">return</span> <span class="p">(</span><span class="o">*</span><span class="n">p</span><span class="p">)[</span><span class="n">curr</span><span class="p">];</span>
<span class="p">}</span>
<span class="n">StrBlobPtr</span> <span class="o">&amp;</span><span class="n">StrBlobPtr</span><span class="o">::</span><span class="n">incr</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">check</span><span class="p">(</span><span class="n">curr</span><span class="p">,</span> <span class="s">"increment pass end of StrBlobPtr"</span><span class="p">);</span>
  <span class="o">++</span><span class="n">curr</span><span class="p">;</span>
  <span class="k">return</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">bool</span> <span class="k">operator</span><span class="o">==</span><span class="p">(</span><span class="k">const</span> <span class="n">StrBlobPtr</span> <span class="o">&amp;</span><span class="n">s1</span><span class="p">,</span> <span class="k">const</span> <span class="n">StrBlobPtr</span> <span class="o">&amp;</span><span class="n">s2</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="n">s1</span><span class="p">.</span><span class="n">curr</span> <span class="o">==</span> <span class="n">s2</span><span class="p">.</span><span class="n">curr</span><span class="p">;</span>	<span class="c1">// both StrBlobPtr object points to the same StrBlob object.</span>
<span class="p">}</span>
<span class="kt">bool</span> <span class="k">operator</span><span class="o">!=</span><span class="p">(</span><span class="k">const</span> <span class="n">StrBlobPtr</span> <span class="o">&amp;</span><span class="n">s1</span><span class="p">,</span> <span class="k">const</span> <span class="n">StrBlobPtr</span> <span class="o">&amp;</span><span class="n">s2</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="o">!</span><span class="p">(</span><span class="n">s1</span> <span class="o">==</span> <span class="n">s2</span><span class="p">);</span>
<span class="p">}</span>
<span class="kt">bool</span> <span class="k">operator</span><span class="o">&lt;</span><span class="p">(</span><span class="k">const</span> <span class="n">StrBlobPtr</span> <span class="o">&amp;</span><span class="n">s1</span><span class="p">,</span> <span class="k">const</span> <span class="n">StrBlobPtr</span> <span class="o">&amp;</span><span class="n">s2</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="n">s1</span><span class="p">.</span><span class="n">curr</span> <span class="o">&lt;</span> <span class="n">s2</span><span class="p">.</span><span class="n">curr</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">StrBlobPtr</span> <span class="k">operator</span><span class="o">+</span><span class="p">(</span><span class="k">const</span> <span class="n">StrBlobPtr</span> <span class="o">&amp;</span><span class="n">s1</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">n</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">StrBlobPtr</span> <span class="n">ret</span><span class="p">(</span><span class="n">s1</span><span class="p">);</span>
  <span class="k">while</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="o">++</span><span class="n">ret</span><span class="p">;</span>
      <span class="o">--</span><span class="n">n</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">StrBlobPtr</span> <span class="k">operator</span><span class="o">-</span><span class="p">(</span><span class="k">const</span> <span class="n">StrBlobPtr</span> <span class="o">&amp;</span><span class="n">s1</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">n</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">StrBlobPtr</span> <span class="n">ret</span><span class="p">(</span><span class="n">s1</span><span class="p">);</span>
  <span class="k">while</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="o">--</span><span class="n">ret</span><span class="p">;</span>
      <span class="o">--</span><span class="n">n</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">// ConstStrBlobPtr member</span>
<span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;&gt;</span> <span class="n">ConstStrBlobPtr</span><span class="o">::</span><span class="n">check</span><span class="p">(</span><span class="kt">size_t</span> <span class="n">i</span><span class="p">,</span> <span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="n">msg</span><span class="p">)</span> <span class="k">const</span>
<span class="p">{</span>
  <span class="k">auto</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">wptr</span><span class="p">.</span><span class="n">lock</span><span class="p">();</span>
  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">ret</span><span class="p">)</span>
    <span class="k">throw</span> <span class="n">runtime_error</span><span class="p">(</span><span class="s">"unbound StrBlobPtr"</span><span class="p">);</span>
  <span class="k">if</span><span class="p">(</span><span class="n">i</span> <span class="o">&gt;=</span> <span class="n">ret</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">())</span>
    <span class="k">throw</span> <span class="n">out_of_range</span><span class="p">(</span><span class="n">msg</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="n">ConstStrBlobPtr</span><span class="o">::</span><span class="n">deref</span><span class="p">()</span> <span class="k">const</span>
<span class="p">{</span>
  <span class="k">auto</span> <span class="n">p</span> <span class="o">=</span> <span class="n">check</span><span class="p">(</span><span class="n">curr</span><span class="p">,</span> <span class="s">"dereference pass end"</span><span class="p">);</span>
  <span class="k">return</span> <span class="p">(</span><span class="o">*</span><span class="n">p</span><span class="p">)[</span><span class="n">curr</span><span class="p">];</span>
<span class="p">}</span>
<span class="n">ConstStrBlobPtr</span> <span class="o">&amp;</span><span class="n">ConstStrBlobPtr</span><span class="o">::</span><span class="n">incr</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">check</span><span class="p">(</span><span class="n">curr</span><span class="p">,</span> <span class="s">"increment pass end of StrBlobPtr"</span><span class="p">);</span>
  <span class="o">++</span><span class="n">curr</span><span class="p">;</span>
  <span class="k">return</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="n">ConstStrBlobPtr</span><span class="o">::</span><span class="k">operator</span><span class="o">*</span><span class="p">()</span>
<span class="p">{</span>
  <span class="k">auto</span> <span class="n">p</span> <span class="o">=</span> <span class="n">check</span><span class="p">(</span><span class="n">curr</span><span class="p">,</span> <span class="s">"deference past end"</span><span class="p">);</span>
  <span class="k">return</span> <span class="p">(</span><span class="o">*</span><span class="n">p</span><span class="p">)[</span><span class="n">curr</span><span class="p">];</span>
<span class="p">}</span>
<span class="k">const</span> <span class="n">string</span> <span class="o">*</span><span class="n">ConstStrBlobPtr</span><span class="o">::</span><span class="k">operator</span><span class="o">-&gt;</span><span class="p">()</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="o">&amp;</span><span class="k">this</span><span class="o">-&gt;</span><span class="k">operator</span><span class="o">*</span><span class="p">();</span>
<span class="p">}</span>
<span class="n">StrBlobPtr</span> <span class="n">StrBlob</span><span class="o">::</span><span class="n">begin</span><span class="p">()</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="n">StrBlobPtr</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">);</span>
<span class="p">}</span>
<span class="n">StrBlobPtr</span> <span class="n">StrBlob</span><span class="o">::</span><span class="n">end</span><span class="p">()</span>
<span class="p">{</span>
  <span class="k">auto</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">StrBlobPtr</span><span class="p">(</span><span class="o">*</span><span class="k">this</span><span class="p">,</span> <span class="n">data</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">());</span>
    <span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>

<div id="outline-container-org69e6a86" class="outline-2">
<h2 id="org69e6a86">Exercise 14.28</h2>
<div class="outline-text-2" id="text-org69e6a86">
<div class="highlight"><pre><span></span><span class="c1">// See StrBlob.h and StrBlob.cpp.</span>
</pre></div>

<p>
<a href="#org1339b99">StrBlob.cpp</a>
</p>

<p>
<a href="#orga40cb34">StrBlob.h</a>
</p>
</div>
</div>

<div id="outline-container-org502761a" class="outline-2">
<h2 id="org502761a">Exercise 14.29</h2>
<div class="outline-text-2" id="text-org502761a">
<div class="highlight"><pre><span></span><span class="c1">// The overload ++ &amp; -- operators as member functions could not be defined as const member functions,</span>
<span class="c1">// because within these functions'body, the caller StrBlobPtr object would be modified, and const object could not be modified.</span>
</pre></div>
</div>
</div>

<div id="outline-container-orgc9e95ba" class="outline-2">
<h2 id="orgc9e95ba">Exercise 14.30</h2>
<div class="outline-text-2" id="text-orgc9e95ba">
<div class="highlight"><pre><span></span><span class="c1">// See StrBlob.h and StrBlob.cpp.</span>
</pre></div>

<p>
<a href="#org1339b99">StrBlob.cpp</a>
</p>

<p>
<a href="#orga40cb34">StrBlob.h</a>
</p>
</div>
</div>

<div id="outline-container-org093c21b" class="outline-2">
<h2 id="org093c21b">Exercise 14.31</h2>
<div class="outline-text-2" id="text-org093c21b">
<div class="highlight"><pre><span></span><span class="c1">// StrBlobPtr behaves like iterator, the most convenient way to get a StrBlobPtr object is to call the begin or end member function of StrBlob object, this way is not only convenient but also safe and clean.</span>
<span class="c1">// the synthesized copy constructor, copy-assignment operator and destructor already satisfy our needs, define spedified copy constructor or copy-assignment operator would introduce uncertanity and complexity.</span>
</pre></div>
</div>
</div>

<div id="outline-container-org5d69fda" class="outline-2">
<h2 id="org5d69fda">Exercise 14.32</h2>
<div class="outline-text-2" id="text-org5d69fda">
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">StrBlobPtr_Ptr</span>
<span class="p">{</span>
  <span class="n">StrBlobPtr</span> <span class="o">*</span><span class="n">ptr</span> <span class="o">=</span> <span class="k">nullptr</span><span class="p">;</span>
<span class="k">public</span><span class="o">:</span>
  <span class="n">StrBlobPtr_Ptr</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>
  <span class="n">StrBlobPtr_Ptr</span><span class="p">(</span><span class="n">StrBlobPtr</span> <span class="o">*</span><span class="n">p</span><span class="p">)</span><span class="o">:</span> <span class="n">ptr</span><span class="p">(</span><span class="n">p</span><span class="p">)</span> <span class="p">{}</span>
  <span class="n">StrBlobPtr</span> <span class="k">operator</span><span class="o">-&gt;</span><span class="p">();</span>
  <span class="c1">// maybe StrBlobPtr *operator-&gt;(); ?</span>
<span class="p">};</span>
<span class="n">StrBlobPtr</span> <span class="n">StrBlobPtr_Ptr</span><span class="o">::</span><span class="k">operator</span><span class="o">-&gt;</span><span class="p">()</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="o">*</span><span class="n">ptr</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">StrBlob</span> <span class="n">sb</span><span class="p">{</span><span class="s">"hello"</span><span class="p">,</span> <span class="s">"world"</span><span class="p">};</span>
  <span class="n">StrBlobPtr</span> <span class="n">iter</span> <span class="o">=</span> <span class="n">sb</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span>
  <span class="n">StrBlobPtr_Ptr</span> <span class="nf">p</span><span class="p">(</span><span class="o">&amp;</span><span class="n">iter</span><span class="p">);</span>
  <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">p</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span> <span class="c1">// finally calls size() member function of string class type. </span>
<span class="p">}</span>
</pre></div>
</div>
</div>

<div id="outline-container-orga8140ab" class="outline-2">
<h2 id="orga8140ab">Exercise 14.33</h2>
<div class="outline-text-2" id="text-orga8140ab">
<div class="highlight"><pre><span></span><span class="c1">// overload () operator could accept arbitrary(in fact, the actual amount is around 256 settled by compiler) operands, the implicit pointer of caller object and rest passed in arguments.</span>
</pre></div>
</div>
</div>

<div id="outline-container-org240bc8b" class="outline-2">
<h2 id="org240bc8b">Exercise 14.34</h2>
<div class="outline-text-2" id="text-org240bc8b">
<div class="highlight"><pre><span></span><span class="k">struct</span> <span class="n">If_Then_Else</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="k">operator</span><span class="p">()(</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
<span class="p">};</span>
<span class="kt">int</span> <span class="n">If_Then_Else</span><span class="o">::</span><span class="k">operator</span><span class="p">()(</span><span class="kt">int</span> <span class="n">a</span><span class="p">,</span> <span class="kt">int</span> <span class="n">b</span><span class="p">,</span> <span class="kt">int</span> <span class="n">c</span><span class="p">)</span> <span class="k">const</span>
<span class="p">{</span>
  <span class="k">if</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">b</span><span class="p">;</span>
  <span class="k">else</span>
    <span class="k">return</span> <span class="n">c</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>

<div id="outline-container-org2506700" class="outline-2">
<h2 id="org2506700">Exercise 14.35</h2>
<div class="outline-text-2" id="text-org2506700">
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ReadString</span>
<span class="p">{</span>
  <span class="n">istream</span> <span class="o">&amp;</span><span class="n">is</span><span class="p">;</span>
<span class="k">public</span><span class="o">:</span>
  <span class="n">ReadString</span><span class="p">(</span><span class="n">istream</span> <span class="o">&amp;</span><span class="n">i</span> <span class="o">=</span> <span class="n">cin</span><span class="p">)</span><span class="o">:</span> <span class="n">is</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="p">{};</span>
  <span class="n">string</span> <span class="nf">operator</span><span class="p">()()</span> <span class="k">const</span><span class="p">;</span>
<span class="p">};</span>

<span class="n">string</span> <span class="n">ReadString</span><span class="o">::</span><span class="k">operator</span><span class="p">()()</span> <span class="k">const</span>
<span class="p">{</span>
  <span class="n">string</span> <span class="n">result</span><span class="p">;</span>
  <span class="n">getline</span><span class="p">(</span><span class="n">is</span><span class="p">,</span> <span class="n">result</span><span class="p">);</span>
  <span class="k">if</span><span class="p">(</span><span class="n">is</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span><span class="p">;</span>
  <span class="k">else</span>
    <span class="k">return</span> <span class="s">""</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>

<div id="outline-container-orgeaa1246" class="outline-2">
<h2 id="orgeaa1246">Exercise 14.36</h2>
<div class="outline-text-2" id="text-orgeaa1246">
<div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">vector</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">vs</span><span class="p">;</span>
  <span class="n">ReadString</span> <span class="n">rs</span><span class="p">;</span>
  <span class="n">string</span> <span class="n">result</span><span class="p">;</span>
  <span class="k">while</span><span class="p">((</span><span class="n">result</span> <span class="o">=</span> <span class="n">rs</span><span class="p">()).</span><span class="n">size</span><span class="p">())</span>
    <span class="n">vs</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">result</span><span class="p">);</span>
  <span class="k">for</span><span class="p">(</span><span class="k">const</span> <span class="k">auto</span> <span class="o">&amp;</span><span class="nl">i</span> <span class="p">:</span> <span class="n">vs</span><span class="p">)</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">i</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>

<div id="outline-container-orgdecd4fd" class="outline-2">
<h2 id="orgdecd4fd">Exercise 14.37</h2>
<div class="outline-text-2" id="text-orgdecd4fd">
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Equal</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">base</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">public</span><span class="o">:</span>
  <span class="n">Equal</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>
  <span class="n">Equal</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="p">)</span><span class="o">:</span> <span class="n">base</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="p">{};</span>
  <span class="kt">bool</span> <span class="nf">operator</span><span class="p">()(</span><span class="kt">int</span> <span class="n">i</span><span class="p">);</span>
<span class="p">};</span>
<span class="kt">bool</span> <span class="n">Equal</span><span class="o">::</span><span class="k">operator</span><span class="p">()(</span><span class="kt">int</span> <span class="n">i</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="n">i</span> <span class="o">==</span> <span class="n">base</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">Equal</span> <span class="n">eq</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>
  <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">vi</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">};</span>
  <span class="n">replace_if</span><span class="p">(</span><span class="n">vi</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">vi</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">eq</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
  <span class="k">for</span><span class="p">(</span><span class="k">const</span> <span class="k">auto</span> <span class="o">&amp;</span><span class="nl">i</span> <span class="p">:</span> <span class="n">vi</span><span class="p">)</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">i</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>

<div id="outline-container-org5b98bf2" class="outline-2">
<h2 id="org5b98bf2">Exercise 14.38</h2>
<div class="outline-text-2" id="text-org5b98bf2">
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">EqLength</span>
<span class="p">{</span>
  <span class="kt">size_t</span> <span class="n">length</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">public</span><span class="o">:</span>
  <span class="n">EqLength</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>
  <span class="n">EqLength</span><span class="p">(</span><span class="kt">size_t</span> <span class="n">n</span><span class="p">)</span><span class="o">:</span> <span class="n">length</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="p">{}</span>
  <span class="kt">bool</span> <span class="k">operator</span><span class="p">()(</span><span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
<span class="p">};</span>
<span class="kt">bool</span> <span class="n">EqLength</span><span class="o">::</span><span class="k">operator</span><span class="p">()(</span><span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="n">s</span><span class="p">)</span> <span class="k">const</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="n">s</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">==</span> <span class="n">length</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="n">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span>
<span class="p">{</span>
  <span class="k">if</span><span class="p">(</span><span class="n">argc</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">"False command-line arguments, expects "</span>
       <span class="o">&lt;&lt;</span> <span class="n">argc</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">ifstream</span> <span class="nf">ifs</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
  <span class="n">istream_iterator</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">beg</span><span class="p">(</span><span class="n">ifs</span><span class="p">);</span>
  <span class="n">istream_iterator</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">eof</span><span class="p">;</span>
  <span class="k">for</span><span class="p">(</span><span class="kt">size_t</span> <span class="n">l</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">l</span> <span class="o">&lt;</span> <span class="mi">11</span><span class="p">;</span> <span class="o">++</span><span class="n">l</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Length "</span> <span class="o">&lt;&lt;</span> <span class="n">l</span>
	 <span class="o">&lt;&lt;</span> <span class="s">" "</span> <span class="o">&lt;&lt;</span> <span class="n">count_if</span><span class="p">(</span><span class="n">beg</span><span class="p">,</span> <span class="n">eof</span><span class="p">,</span> <span class="n">EqLength</span><span class="p">(</span><span class="n">l</span><span class="p">))</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>

<div id="outline-container-orge814d34" class="outline-2">
<h2 id="orge814d34">Exercise 14.39</h2>
<div class="outline-text-2" id="text-orge814d34">
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">EqLength</span>
<span class="p">{</span>
  <span class="kt">size_t</span> <span class="n">length</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">public</span><span class="o">:</span>
  <span class="n">EqLength</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>
  <span class="n">EqLength</span><span class="p">(</span><span class="kt">size_t</span> <span class="n">n</span><span class="p">)</span><span class="o">:</span> <span class="n">length</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="p">{}</span>
  <span class="kt">bool</span> <span class="k">operator</span><span class="p">()(</span><span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
<span class="p">};</span>
<span class="kt">bool</span> <span class="n">EqLength</span><span class="o">::</span><span class="k">operator</span><span class="p">()(</span><span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="n">s</span><span class="p">)</span> <span class="k">const</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="n">s</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">==</span> <span class="n">length</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">class</span> <span class="nc">GeLength</span>
<span class="p">{</span>
  <span class="kt">size_t</span> <span class="n">length</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">public</span><span class="o">:</span>
  <span class="n">GeLength</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>
  <span class="n">GeLength</span><span class="p">(</span><span class="kt">size_t</span> <span class="n">n</span><span class="p">)</span><span class="o">:</span> <span class="n">length</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="p">{}</span>
  <span class="kt">bool</span> <span class="k">operator</span><span class="p">()(</span><span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
<span class="p">};</span>
<span class="kt">bool</span> <span class="n">GeLength</span><span class="o">::</span><span class="k">operator</span><span class="p">()(</span><span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="n">s</span><span class="p">)</span> <span class="k">const</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="n">s</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="n">length</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="n">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span>
<span class="p">{</span>
  <span class="k">if</span><span class="p">(</span><span class="n">argc</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="s">"False command-line arguments, expects "</span>
       <span class="o">&lt;&lt;</span> <span class="n">argc</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">ifstream</span> <span class="nf">ifs</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
  <span class="n">istream_iterator</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">beg</span><span class="p">(</span><span class="n">ifs</span><span class="p">);</span>
  <span class="n">istream_iterator</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">eof</span><span class="p">;</span>
  <span class="k">for</span><span class="p">(</span><span class="kt">size_t</span> <span class="n">l</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">l</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">;</span> <span class="o">++</span><span class="n">l</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Length "</span> <span class="o">&lt;&lt;</span> <span class="n">l</span>
	 <span class="o">&lt;&lt;</span> <span class="s">" "</span> <span class="o">&lt;&lt;</span> <span class="n">count_if</span><span class="p">(</span><span class="n">beg</span><span class="p">,</span> <span class="n">eof</span><span class="p">,</span> <span class="n">EqLength</span><span class="p">(</span><span class="n">l</span><span class="p">))</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Length not smaller than 10 "</span> <span class="o">&lt;&lt;</span> <span class="n">count_if</span><span class="p">(</span><span class="n">beg</span><span class="p">,</span> <span class="n">eof</span><span class="p">,</span> <span class="n">GeLength</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>

<div id="outline-container-orgd496b60" class="outline-2">
<h2 id="orgd496b60">Exercise 14.40</h2>
<div class="outline-text-2" id="text-orgd496b60">
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">SizeSmaller</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
  <span class="kt">bool</span> <span class="k">operator</span><span class="p">()(</span><span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="n">w1</span><span class="p">,</span> <span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="n">w2</span><span class="p">)</span> <span class="k">const</span>
  <span class="p">{</span><span class="k">return</span> <span class="n">w1</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">w2</span><span class="p">.</span><span class="n">size</span><span class="p">();}</span>
<span class="p">};</span>
<span class="k">class</span> <span class="nc">SizeGE</span>
<span class="p">{</span>
  <span class="kt">size_t</span> <span class="n">sz</span><span class="p">;</span>
<span class="k">public</span><span class="o">:</span>
  <span class="n">SizeGE</span><span class="p">(</span><span class="kt">size_t</span> <span class="n">n</span><span class="p">)</span><span class="o">:</span> <span class="n">sz</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="p">{}</span>
  <span class="kt">bool</span> <span class="k">operator</span><span class="p">()(</span><span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="n">word</span><span class="p">)</span> <span class="k">const</span>
  <span class="p">{</span><span class="k">return</span> <span class="n">word</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="n">sz</span><span class="p">;}</span>
<span class="p">};</span>
<span class="k">class</span> <span class="nc">PrintString</span>
<span class="p">{</span>
  <span class="n">ostream</span> <span class="o">&amp;</span><span class="n">o</span><span class="p">;</span>
  <span class="kt">char</span> <span class="n">sep</span><span class="p">;</span>
<span class="k">public</span><span class="o">:</span>
  <span class="n">PrintString</span><span class="p">(</span><span class="n">ostream</span> <span class="o">&amp;</span><span class="n">os</span> <span class="o">=</span> <span class="n">cout</span><span class="p">,</span> <span class="kt">char</span> <span class="n">c</span> <span class="o">=</span> <span class="sc">' '</span><span class="p">)</span><span class="o">:</span> <span class="n">o</span><span class="p">(</span><span class="n">os</span><span class="p">),</span> <span class="n">sep</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="p">{}</span>
  <span class="kt">void</span> <span class="k">operator</span><span class="p">()(</span><span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="n">s</span><span class="p">)</span> <span class="k">const</span>
  <span class="p">{</span><span class="n">o</span> <span class="o">&lt;&lt;</span> <span class="n">s</span> <span class="o">&lt;&lt;</span> <span class="n">sep</span><span class="p">;}</span>
<span class="p">};</span>
<span class="kt">void</span> <span class="nf">elimDups</span><span class="p">(</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">words</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">sort</span><span class="p">(</span><span class="n">words</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">words</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>
  <span class="k">auto</span> <span class="n">end_unique</span> <span class="o">=</span> <span class="n">unique</span><span class="p">(</span><span class="n">words</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">words</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>
  <span class="n">words</span><span class="p">.</span><span class="n">erase</span><span class="p">(</span><span class="n">end_unique</span><span class="p">,</span> <span class="n">words</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="nf">biggies</span><span class="p">(</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">words</span><span class="p">,</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;::</span><span class="n">size_type</span> <span class="n">sz</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">elimDups</span><span class="p">(</span><span class="n">words</span><span class="p">);</span>
  <span class="n">stable_sort</span><span class="p">(</span><span class="n">words</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">words</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">SizeSmaller</span><span class="p">());</span>
  <span class="k">auto</span> <span class="n">iter</span> <span class="o">=</span> <span class="n">partition</span><span class="p">(</span><span class="n">words</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">words</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">SizeGE</span><span class="p">(</span><span class="n">sz</span><span class="p">));</span>
  <span class="k">auto</span> <span class="n">count</span> <span class="o">=</span> <span class="n">iter</span> <span class="o">-</span> <span class="n">words</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">count</span> <span class="o">&lt;&lt;</span> <span class="s">" words"</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">for_each</span><span class="p">(</span><span class="n">words</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">iter</span><span class="p">,</span> <span class="n">PrintString</span><span class="p">(</span><span class="n">cout</span><span class="p">,</span> <span class="sc">'\n'</span><span class="p">));</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">vector</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">vs</span> <span class="o">=</span>
    <span class="p">{</span><span class="s">"the"</span><span class="p">,</span> <span class="s">"time"</span><span class="p">,</span> <span class="s">"is"</span><span class="p">,</span> <span class="s">"near"</span><span class="p">,</span> <span class="s">"near"</span><span class="p">,</span> <span class="s">"the"</span><span class="p">,</span> <span class="s">"sunrise"</span><span class="p">};</span>
  <span class="n">biggies</span><span class="p">(</span><span class="n">vs</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>

<div id="outline-container-org41a127e" class="outline-2">
<h2 id="org41a127e">Exercise 14.41</h2>
<div class="outline-text-2" id="text-org41a127e">
<div class="highlight"><pre><span></span><span class="c1">// lambda as a new feature introduced in new C++11 standard could make code easier to write, understand and debug;</span>
<span class="c1">// lambda expression would be applied if the predicate is one-time-use and not complicated;</span>
<span class="c1">// else function object is better.</span>
</pre></div>
</div>
</div>

<div id="outline-container-org95bcb77" class="outline-2">
<h2 id="org95bcb77">Exercise 14.42</h2>
<div class="outline-text-2" id="text-org95bcb77">
<div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
  <span class="k">auto</span> <span class="n">greater1024</span> <span class="o">=</span> <span class="n">bind</span><span class="p">(</span><span class="n">greater</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(),</span> <span class="n">_1</span><span class="p">,</span> <span class="mi">1024</span><span class="p">);</span>
  <span class="k">auto</span> <span class="n">not_equal_to_pooh</span> <span class="o">=</span> <span class="n">bind</span><span class="p">(</span><span class="n">not_equal_to</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span><span class="p">(),</span> <span class="n">_1</span><span class="p">,</span> <span class="s">"pooh"</span><span class="p">);</span>
  <span class="k">auto</span> <span class="n">multiplies_2</span> <span class="o">=</span> <span class="n">bind</span><span class="p">(</span><span class="n">multiplies</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(),</span> <span class="n">_1</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>

<div id="outline-container-org9e54ff2" class="outline-2">
<h2 id="org9e54ff2">Exercise 14.43</h2>
<div class="outline-text-2" id="text-org9e54ff2">
<div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
  <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">vi</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Please input integers: "</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="k">while</span><span class="p">(</span><span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">i</span><span class="p">)</span>
    <span class="n">vi</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
  <span class="n">cin</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
  <span class="kt">int</span> <span class="n">j</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Please input a interger to test: "</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">j</span><span class="p">;</span>
  <span class="k">auto</span> <span class="n">modulus_left</span> <span class="o">=</span> <span class="n">bind</span><span class="p">(</span><span class="n">modulus</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(),</span> <span class="n">j</span><span class="p">,</span> <span class="n">_1</span><span class="p">);</span>
  <span class="k">auto</span> <span class="n">iter</span> <span class="o">=</span> <span class="n">find_if</span><span class="p">(</span><span class="n">vi</span><span class="p">.</span><span class="n">cbegin</span><span class="p">(),</span> <span class="n">vi</span><span class="p">.</span><span class="n">cend</span><span class="p">(),</span> <span class="n">modulus_left</span><span class="p">);</span>
  <span class="k">if</span><span class="p">(</span><span class="n">iter</span> <span class="o">==</span> <span class="n">vi</span><span class="p">.</span><span class="n">cend</span><span class="p">())</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"ok"</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="k">else</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"bad"</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>

<div id="outline-container-orgf883429" class="outline-2">
<h2 id="orgf883429">Exercise 14.44</h2>
<div class="outline-text-2" id="text-orgf883429">
<div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">add</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="kt">int</span> <span class="n">j</span><span class="p">)</span> <span class="p">{</span><span class="k">return</span> <span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="p">;}</span>
<span class="k">auto</span> <span class="n">mod</span> <span class="o">=</span> <span class="p">[](</span><span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="kt">int</span> <span class="n">j</span><span class="p">)</span> <span class="p">{</span><span class="k">return</span> <span class="n">i</span> <span class="o">%</span> <span class="n">j</span><span class="p">;};</span>
<span class="k">struct</span> <span class="n">divide</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="k">operator</span><span class="p">()(</span><span class="kt">int</span> <span class="n">denominator</span><span class="p">,</span> <span class="kt">int</span> <span class="n">divisor</span><span class="p">)</span>
  <span class="p">{</span><span class="k">return</span> <span class="n">denominator</span> <span class="o">/</span> <span class="n">divisor</span><span class="p">;}</span>
<span class="p">};</span>
<span class="n">map</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span> <span class="n">function</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">(</span><span class="kt">int</span><span class="p">,</span> <span class="kt">int</span><span class="p">)</span><span class="o">&gt;&gt;</span> <span class="n">binops</span> <span class="o">=</span>
  <span class="p">{</span>
    <span class="p">{</span><span class="s">"+"</span><span class="p">,</span> <span class="n">add</span><span class="p">},</span>
    <span class="p">{</span><span class="s">"-"</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">minus</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">()},</span>
    <span class="p">{</span><span class="s">"/"</span><span class="p">,</span> <span class="n">divide</span><span class="p">()},</span>
    <span class="p">{</span><span class="s">"*"</span><span class="p">,</span> <span class="p">[](</span><span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="kt">int</span> <span class="n">j</span><span class="p">)</span> <span class="p">{</span><span class="k">return</span> <span class="n">i</span> <span class="o">*</span> <span class="n">j</span><span class="p">;}},</span>
    <span class="p">{</span><span class="s">"%"</span><span class="p">,</span> <span class="n">mod</span><span class="p">}</span>
  <span class="p">};</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">binops</span><span class="p">[</span><span class="s">"-"</span><span class="p">](</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>

<div id="outline-container-org8d051bc" class="outline-2">
<h2 id="org8d051bc">Exercise 14.45</h2>
<div class="outline-text-2" id="text-org8d051bc">
<div class="highlight"><pre><span></span><span class="c1">// See Sales_data.h.</span>
</pre></div>

<p>
<a href="#orgb2a283f">Sales_data.h</a>
</p>
</div>
</div>

<div id="outline-container-orgce02df1" class="outline-2">
<h2 id="orgce02df1">Exercise 14.46</h2>
<div class="outline-text-2" id="text-orgce02df1">
<div class="highlight"><pre><span></span><span class="c1">// We should define the conversion operators illustrated in exercise 14.45 for Sales_data class type;</span>
<span class="c1">// and the first conversion operators should be explicit, for when there is a expression includes operands of Sales_data object and string object, due to that Sales_data class type has a constructor accepts one const string reference, causes amgibuous situation then this expression is illegal;</span>
<span class="c1">// the second one does not need to be explicit, there's no such concern for it as the first one.</span>
</pre></div>
</div>
</div>

<div id="outline-container-org0354adc" class="outline-2">
<h2 id="org0354adc">Exercise 14.47</h2>
<div class="outline-text-2" id="text-org0354adc">
<div class="highlight"><pre><span></span><span class="k">struct</span> <span class="n">Integral</span>
<span class="p">{</span>
  <span class="k">operator</span> <span class="k">const</span> <span class="kt">int</span><span class="p">();</span>		<span class="c1">// meaningless, for onr conversion operator should not define return type, this 'const' here is unspecified, it will be ignored by compiler.</span>
  <span class="k">operator</span> <span class="nf">int</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>		<span class="c1">// Not only non-const but also const Integral objects could call this one, Integral objects would be converted to int.</span>
<span class="p">};</span>
</pre></div>
</div>
</div>

<div id="outline-container-orgfbcd706" class="outline-2">
<h2 id="orgfbcd706">Exercise 14.48</h2>
<div class="outline-text-2" id="text-orgfbcd706">
<div class="highlight"><pre><span></span><span class="c1">// See Employee.h.</span>
<span class="c1">// class type Employee should define its bool conversion operator, for one Employee object may has no content if it is default constructed(or its data member 'name' is an empty string), and such object used as condition should be converted to bool;</span>
<span class="c1">// the bool conversion operator should be explicit, for it is only used in condition case(compiler would implicitly call this explicit conversion operator when encountered in condition expression), and it should not be implicitly called in other cases.</span>
</pre></div>

<p>
<a href="#org882577f">Employee.h</a>
</p>
</div>
</div>

<div id="outline-container-org9d4124c" class="outline-2">
<h2 id="org9d4124c">Exercise 14.49</h2>
<div class="outline-text-2" id="text-org9d4124c">
<div class="highlight"><pre><span></span><span class="c1">// See Employee.h.</span>
</pre></div>

<p>
<a href="#org882577f">Employee.h</a>
</p>
</div>
</div>

<div id="outline-container-org1319d5e" class="outline-2">
<h2 id="org1319d5e">Exercise 14.50</h2>
<div class="outline-text-2" id="text-org1319d5e">
<div class="highlight"><pre><span></span><span class="k">struct</span> <span class="n">LongDouble</span>
<span class="p">{</span>
  <span class="n">LongDouble</span><span class="p">(</span><span class="kt">double</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">);</span>
  <span class="k">operator</span> <span class="nf">double</span><span class="p">();</span>
  <span class="k">operator</span> <span class="nf">float</span><span class="p">();</span>
<span class="p">};</span>
<span class="n">LongDouble</span> <span class="n">ldObj</span><span class="p">;</span>
<span class="kt">int</span> <span class="n">ex1</span> <span class="o">=</span> <span class="n">ldObj</span><span class="p">;</span>		<span class="c1">// illegal</span>
<span class="c1">// could call ldObj.double() and then convert double to int;</span>
<span class="c1">// could call ldObj.float() and then convert float to int;</span>
<span class="c1">// both are at same level, this expression introduces ambiguous call.</span>
<span class="kt">float</span> <span class="n">ex2</span> <span class="o">=</span> <span class="n">ldObj</span><span class="p">;</span>		<span class="c1">// legal</span>
<span class="c1">// call ldObj.float() and no more built-in type conversion</span>
<span class="c1">// best match. </span>
</pre></div>
</div>
</div>

<div id="outline-container-org11f6d9a" class="outline-2">
<h2 id="org11f6d9a">Exercise 14.51</h2>
<div class="outline-text-2" id="text-org11f6d9a">
<div class="highlight"><pre><span></span><span class="c1">// void calc(int);</span>
<span class="c1">// void calc(LongDouble);		// class LongDouble defined in 14.50</span>
<span class="c1">// double dval;</span>
<span class="c1">// calc(dval);			// finally call 'void calc(int)'</span>
<span class="c1">// double object dval converted to int type: built-in type conversion;</span>
<span class="c1">// double object dval converted to LongDouble class type: class type conversion</span>
<span class="c1">// for built-in arithmetical type conversion has higher priority than class type conversion;</span>
<span class="c1">// then the first calc one would be called.</span>
</pre></div>
</div>
</div>

<div id="outline-container-org13152fc" class="outline-2">
<h2 id="org13152fc">Exercise 14.52</h2>
<div class="outline-text-2" id="text-org13152fc">
<div class="highlight"><pre><span></span><span class="c1">// LongDouble operator+(LongDouble &amp;, double);</span>
<span class="c1">// SamllInt si;</span>
<span class="c1">// LongDouble ld;</span>
<span class="c1">// ld = si + ld;</span>
<span class="c1">// candidates:</span>
<span class="c1">// 1. LongDouble operator+(LongDouble &amp;, double);</span>
<span class="c1">// 2. member function: SmallInt operator+(const SmallInt &amp;, const SmallInt &amp;);</span>
<span class="c1">// 3. built-in + operator; ambiguous.</span>
<span class="c1">// none of these matchs.</span>
<span class="c1">// ld = ld + si;</span>
<span class="c1">// candidates:</span>
<span class="c1">// 1. LongDouble operator+(LongDouble &amp;, double); si converted to int by class type conversion, and then int converted to double by built-in type conversion.</span>
<span class="c1">// 2. member function: LongDouble operator+(const SmallInt &amp;); si const conversion.</span>
<span class="c1">// 3. built-in + operator; ambiguous</span>
<span class="c1">// candidate 2 is applied.</span>
</pre></div>
</div>
</div>

<div id="outline-container-orgaa0350b" class="outline-2">
<h2 id="orgaa0350b">Exercise 14.53</h2>
<div class="outline-text-2" id="text-orgaa0350b">
<div class="highlight"><pre><span></span><span class="c1">// Based on class type SmallInt defined in section 14.9.3;</span>
<span class="c1">// SmallInt sl;</span>
<span class="c1">// double d = s1 + 3.14;</span>
<span class="c1">// illegal, ambiguous calling;</span>
<span class="c1">// 1. member function: SmallInt operator+(const SmallInt &amp;, const SmallInt &amp;);</span>
<span class="c1">// 2. built-in + operator;</span>
<span class="c1">// fix:</span>
<span class="c1">// double d = static_cast&lt;int&gt;(s1) + 3.14;</span>
</pre></div>
</div>
</div>
            
        
        <div id="disqus_thread"></div>
        <script>
        var disqus_shortname ="https-zero4drift-github-io",
            disqus_url="https://zero4drift.github.io/posts/Cpp-Primer-5th-Exercises-Chapter-14/",
        disqus_title="Cpp-Primer-5th-Exercises-Chapter-14",
        disqus_identifier="cache/posts/Cpp-Primer-5th-Exercises-Chapter-14.html",
        disqus_config = function () {
            this.language = "en";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.async = true;
            dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
    <a href="https://disqus.com" class="dsq-brlink" rel="nofollow">Comments powered by <span class="logo-disqus">Disqus</span></a>


        
    


        </div>
    </div>

    
    <footer><div class="container">
            <div class="social">



                <div class="social-entry">
                    <a href="../../rss.xml" target="_blank">
                        <i class="fa fa-rss"></i> 
                    </a>
                </div>
            </div>
                <div class="copyright">
                    Contents © 2018         <a href="mailto:fang0052@e.ntu.edu.sg">zero4drift</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         
                    
                </div>
           
        </div>
    </footer><script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?06e0ade16d98033ac1aad78106d873c8";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script src="../../assets/js/all-nocdn.js" type="text/javascript"></script>
</body>
</html>
