<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " vocab="http://ogp.me/ns" lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="Refresher of SICP chapter 2.2 abstraction data 构造数据抽象">
<meta name="viewport" content="width=device-width">
<title>SICP-Refresher-Chapter-2(2) | 钉钉是世界上最傻逼的app</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link rel="alternate" type="application/rss+xml" title="RSS" href="../../rss.xml">
<link rel="canonical" href="https://zero4drift.github.io/posts/sicp-refresher-chapter-2%282%29/">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="zero4drift">
<meta property="og:site_name" content="钉钉是世界上最傻逼的app">
<meta property="og:title" content="SICP-Refresher-Chapter-2(2)">
<meta property="og:url" content="https://zero4drift.github.io/posts/sicp-refresher-chapter-2%282%29/">
<meta property="og:description" content="Refresher of SICP chapter 2.2 abstraction data 构造数据抽象">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2018-12-19T13:45:33+08:00">
<meta property="article:tag" content="Scheme">
<meta property="article:tag" content="SICP">
</head>
<body>
    

    <header id="header" class="navbar"><div class="container">
            
    <div class="brand">

        <div class="brand-text">
            <a href="https://zero4drift.github.io/" title="钉钉是世界上最傻逼的app" rel="home">
                钉钉是世界上最傻逼的app
            </a>
        </div>

        <a id="btn-toggle-nav" class="navbar-toggle">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </a>
    </div>

            
    <nav class="navbar-collapse collapse"><ul class="nav">
<li><a href="../../archive.html">Archive</a></li>
                <li><a href="https://github.com/zero4drift">Github</a></li>
                <li><a href="../../categories/">Tags</a></li>
                <li><a href="../../rss.xml">RSS feed</a></li>
    
    
    </ul></nav>
</div>
    </header><div class="header-padding"> </div>

    
    <div class="post-header">
        <div class="container">
            <div class="title">
                SICP-Refresher-Chapter-2(2)
            </div>
        </div>
    </div>

    <div class="post-meta">
      <div class="container">
	<div class="meta clearfix">
	  <div class="authordate">
	    <time class="timeago" datetime="2018-12-19T13:45:33+08:00">2018/12/19</time>
</div>
	  <div class="post-tags">
	    <div class="tag">
	      <a href="../../categories/scheme/" rel="tag">Scheme</a>
	    </div>
	    <div class="tag">
	      <a href="../../categories/sicp/" rel="tag">SICP</a>
	    </div>
	  </div>
	</div>
      </div>
    </div>
    
    
    <div id="post-main" class="main">
        <div class="container">
        <div id="outline-container-orgd265b3c" class="outline-2">
<h2 id="orgd265b3c">层次性数据和闭包性质</h2>
<div class="outline-text-2" id="text-orgd265b3c">
<ol class="org-ol">
<li>序对使用的是一种被称为 <b>盒子和指针</b> 的表示方式：
<ol class="org-ol">
<li>序对的每个对象表示为指向 <b>盒子</b> 的 <b>指针</b>;</li>
<li>与序对的元素相对应的 <b>盒子</b> 里包含着该元素的表示。</li>
</ol>
</li>
<li>用于表示序对的结构实际上是一对方盒，其中左边的方盒里放着序对的 car（指向
car 的指针），右边部分放着相应的 cdr（指向 cdr 的指针）；</li>
<li>序对就是一种通用的建筑砌块，通过它可以构造起所有不同种类的数据结构来；</li>
<li>建立元素本身也是序对的序对，是 <b>表结构</b> 得以作为一种表示工具的根本基础，这
种能力称为 cons 的 <b>闭包</b> 性质：即组合起数据对象得到的结果本身还可以通过同
样的操作再进行组合，建立起 <b>层次性</b> 的结构；</li>
<li>第一章中开始，就提到，组合式的成员本身还可以是组合式，也是闭包性质的一种体
现。</li>
</ol>
</div>

<div id="outline-container-org4edb67b" class="outline-3">
<h3 id="org4edb67b">序列的表示</h3>
<div class="outline-text-3" id="text-org4edb67b">
<ol class="org-ol">
<li>在用序对构成的层次性结构的一种链条表示中，最后的一个序对的 cdr 用一个能辨
明不是序对的值表示，标明序列的结束，在程序里用变量 nil 的值；</li>
<li>术语 <b>表</b> 专指那些有表尾结束标记的序对的链；相对应的，术语 <b>表结构</b> 指所
有的由序对构造起来的数据结构，而不仅是 <b>表</b>;</li>
<li>
<code>(list &lt;a1&gt; &lt;a2&gt; ... &lt;a3&gt;)</code> 等价于 <code>(cons &lt;a1&gt; (cons &lt;a2&gt; (cons
       ... (cons &lt;an&gt; nil)...)))</code> ;</li>
<li>nil 也可以当作一个不包含任何元素的序列： <b>空表</b>;</li>
<li>嵌套应用 car 和 cdr 可以取出一个表里的第二，第三以及后面的各项，但是使用
起来比较麻烦，提供缩写形式：cadr, 所有这类过程的名字都以 c 开头，以 r 结
束，其中的每个 a 表示一个 car 操作，每个 d 表示一个 cdr 操作，按照它们在
名字中出现的顺序应用；</li>
<li>表操作：
<ol class="org-ol">
<li>list-ref 返回表中的第 n 项（表元素编号从0开始）；</li>
<li>null? 检查表是不是空表；</li>
<li>length 返回表的长度；</li>
<li>append 以两个表为参数，用它们的元素组合成一个新表；</li>
</ol>
</li>
<li>带点尾部记法：在一个过程定义中，如果在形式参数表的最后一个参数之前有一个
点号，那就表明，当这一过程被实际调用时，前面各个形式参数（如果有的话）将
以前面的各个实际参数为值，与平常一样。但最后一个形式参数将以所有剩下的实
际参数的表为值；</li>
<li>对表的映射：map
<ol class="org-ol">
<li>scheme 内置的 map 以一个取 n 个参数的过程和 n 个表为参数，将这个过程应
用于所有表的第一个元素，而后应用于它们的第二个元素，如此下去，最后返回
所有结果的 <b>表</b> ；</li>
<li>map 帮我们建立起了一层抽象屏障，将实现表转换的过程的实现，与如何提取表
中元素以及组合结果的细节隔离开，这种抽象也提供了新的灵活性，使我们有可
能在保持从序列到序列的变换操作框架的同时，改变序列实现的底层细节。</li>
</ol>
</li>
</ol>
</div>
</div>

<div id="outline-container-orgdb5428c" class="outline-3">
<h3 id="orgdb5428c">练习 2.17-2.23</h3>
<div class="outline-text-3" id="text-orgdb5428c">
</div>
<div id="outline-container-org6849468" class="outline-4">
<h4 id="org6849468">2.17</h4>
<div class="outline-text-4" id="text-org6849468">
<div class="highlight"><pre><span></span>     <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">last-pair</span> <span class="nv">items</span><span class="p">)</span>
       <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">left</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">items</span><span class="p">)))</span>
	 <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">null? </span><span class="nv">left</span><span class="p">)</span>
	     <span class="p">(</span><span class="nb">car </span><span class="nv">items</span><span class="p">)</span>
	     <span class="p">(</span><span class="nf">last-pair</span> <span class="nv">left</span><span class="p">))))</span>
</pre></div>
</div>
</div>

<div id="outline-container-org3b6452d" class="outline-4">
<h4 id="org3b6452d">2.18</h4>
<div class="outline-text-4" id="text-org3b6452d">
<div class="highlight"><pre><span></span>     <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nb">reverse </span><span class="nv">items</span><span class="p">)</span>
       <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">iter</span> <span class="nv">items</span> <span class="nv">result</span><span class="p">)</span>
	 <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">null? </span><span class="nv">items</span><span class="p">)</span>
	     <span class="nv">result</span>
	     <span class="p">(</span><span class="nf">iter</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">items</span><span class="p">)</span> <span class="p">(</span><span class="nb">cons </span><span class="p">(</span><span class="nb">car </span><span class="nv">items</span><span class="p">)</span> <span class="nv">result</span><span class="p">))))</span>
       <span class="p">(</span><span class="nf">iter</span> <span class="nv">items</span> <span class="o">'</span><span class="p">()))</span>
</pre></div>
</div>
</div>

<div id="outline-container-org3e57aa0" class="outline-4">
<h4 id="org3e57aa0">2.19</h4>
<div class="outline-text-4" id="text-org3e57aa0">
<div class="highlight"><pre><span></span>     <span class="p">(</span><span class="k">define </span><span class="nv">us-coins</span> <span class="p">(</span><span class="nb">list </span><span class="mi">50</span> <span class="mi">25</span> <span class="mi">10</span> <span class="mi">5</span> <span class="mi">1</span><span class="p">))</span>

     <span class="p">(</span><span class="k">define </span><span class="nv">uk-coins</span> <span class="p">(</span><span class="nb">list </span><span class="mi">100</span> <span class="mi">50</span> <span class="mi">20</span> <span class="mi">10</span> <span class="mi">5</span> <span class="mi">2</span> <span class="mi">1</span> <span class="mf">0.5</span><span class="p">))</span>

     <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">cc</span> <span class="nv">amount</span> <span class="nv">coin-values</span><span class="p">)</span>
       <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nb">= </span><span class="nv">amount</span> <span class="mi">0</span><span class="p">)</span> <span class="mi">1</span><span class="p">)</span>
	     <span class="p">((</span><span class="k">or </span><span class="p">(</span><span class="nb">&lt; </span><span class="nv">amount</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="nf">no-more?</span> <span class="nv">coin-values</span><span class="p">))</span> <span class="mi">0</span><span class="p">)</span>
	     <span class="p">(</span><span class="nf">else</span>
	      <span class="p">(</span><span class="nb">+ </span><span class="p">(</span><span class="nf">cc</span> <span class="nv">amount</span>
		     <span class="p">(</span><span class="nf">except-first-denomination</span> <span class="nv">coin-values</span><span class="p">))</span>
		 <span class="p">(</span><span class="nf">cc</span> <span class="p">(</span><span class="nb">- </span><span class="nv">amount</span>
			<span class="p">(</span><span class="nf">first-denomination</span> <span class="nv">coin-values</span><span class="p">))</span>
		     <span class="nv">coin-values</span><span class="p">)))))</span>

     <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">first-denomination</span> <span class="nv">items</span><span class="p">)</span>
       <span class="p">(</span><span class="nb">car </span><span class="nv">items</span><span class="p">))</span>

     <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">except-first-denomination</span> <span class="nv">items</span><span class="p">)</span>
       <span class="p">(</span><span class="nb">cdr </span><span class="nv">items</span><span class="p">))</span>

     <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">no-more?</span> <span class="nv">items</span><span class="p">)</span>
       <span class="p">(</span><span class="nb">null? </span><span class="nv">items</span><span class="p">))</span>

     <span class="c1">;; coin-values 的排列顺序不会影响 cc 给出的回答；</span>
     <span class="c1">;; 因为代码逻辑上具有一致性，排列顺序的不同只会影响中间结果，不会影响最终的解。</span>
</pre></div>
</div>
</div>

<div id="outline-container-org2ee95c8" class="outline-4">
<h4 id="org2ee95c8">2.20</h4>
<div class="outline-text-4" id="text-org2ee95c8">
<div class="highlight"><pre><span></span>     <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">same-parity</span> <span class="nv">signal</span> <span class="o">.</span> <span class="nv">test</span><span class="p">)</span>
       <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">fetch</span> <span class="nv">items</span> <span class="nv">p</span><span class="p">)</span>
	 <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">null? </span><span class="nv">items</span><span class="p">)</span>
	     <span class="nv">items</span>
	     <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">first</span> <span class="p">(</span><span class="nb">car </span><span class="nv">items</span><span class="p">)))</span>
	       <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nf">p</span> <span class="nv">first</span><span class="p">)</span>
		   <span class="p">(</span><span class="nb">cons </span><span class="nv">first</span> <span class="p">(</span><span class="nf">fetch</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">items</span><span class="p">)</span> <span class="nv">p</span><span class="p">))</span>
		   <span class="p">(</span><span class="nf">fetch</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">items</span><span class="p">)</span> <span class="nv">p</span><span class="p">)))))</span>
	 <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">even? </span><span class="nv">signal</span><span class="p">)</span>
	   <span class="p">(</span><span class="nb">cons </span><span class="nv">signal</span> <span class="p">(</span><span class="nf">fetch</span> <span class="nv">test</span> <span class="nv">even?</span><span class="p">))</span>
	   <span class="p">(</span><span class="nb">cons </span><span class="nv">signal</span> <span class="p">(</span><span class="nf">fetch</span> <span class="nv">test</span> <span class="nv">odd?</span><span class="p">))))</span>      
</pre></div>
</div>
</div>

<div id="outline-container-org86e80e6" class="outline-4">
<h4 id="org86e80e6">2.21</h4>
<div class="outline-text-4" id="text-org86e80e6">
<div class="highlight"><pre><span></span>     <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">square-list</span> <span class="nv">items</span><span class="p">)</span>
       <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">null? </span><span class="nv">items</span><span class="p">)</span>
	   <span class="o">'</span><span class="p">()</span>
	   <span class="p">(</span><span class="nb">cons </span><span class="p">(</span><span class="nf">square</span> <span class="p">(</span><span class="nb">car </span><span class="nv">items</span><span class="p">))</span> <span class="p">(</span><span class="nf">square-list</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">items</span><span class="p">)))))</span>

     <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">square-list</span> <span class="nv">items</span><span class="p">)</span>
       <span class="p">(</span><span class="nb">map </span><span class="nv">square</span> <span class="nv">items</span><span class="p">))</span>
</pre></div>
</div>
</div>

<div id="outline-container-orgb10386f" class="outline-4">
<h4 id="orgb10386f">2.22</h4>
<div class="outline-text-4" id="text-orgb10386f">
<div class="highlight"><pre><span></span>     <span class="c1">;; 主要是因为这条语句：(iter (cdr things) (cons (square (car things)) answer))</span>
     <span class="c1">;; 这样的话，逻辑上就是把传入的表参数的元素平方以后不停压入结果表，</span>
     <span class="c1">;; 最后的结果表的元素顺序与需求相反；</span>

     <span class="c1">;; 第二次修改 (iter (cdr things) (cons answer (square (car things))))</span>
     <span class="c1">;; 使序对层次结构的最后一个元素不是 nil.</span>
     <span class="c1">;; 这样计算的结果不但元素顺序没有修正，而且不是合法的‘表’表示了。</span>
</pre></div>
</div>
</div>

<div id="outline-container-orga7a2317" class="outline-4">
<h4 id="orga7a2317">2.23</h4>
<div class="outline-text-4" id="text-orga7a2317">
<div class="highlight"><pre><span></span>     <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nb">for-each </span><span class="nv">proc</span> <span class="nv">items</span><span class="p">)</span>
       <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">null? </span><span class="nv">items</span><span class="p">)</span>
	   <span class="nv">true</span>
	   <span class="p">(</span><span class="k">begin </span><span class="p">(</span><span class="nf">proc</span> <span class="p">(</span><span class="nb">car </span><span class="nv">items</span><span class="p">))</span>
		  <span class="p">(</span><span class="nb">for-each </span><span class="nv">proc</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">items</span><span class="p">)))))</span>
</pre></div>
</div>
</div>
</div>

<div id="outline-container-org095572f" class="outline-3">
<h3 id="org095572f">层次性结构</h3>
<div class="outline-text-3" id="text-org095572f">
<ol class="org-ol">
<li>序列的元素本身也可以是序列，可以把这样的结构看作是 <b>树</b> ，而那些本身也是
序列的元素就是形成了树中的 <b>子树</b> ，往下深入直到序列元素不是序列时，把这种元
素当作树的 <b>叶子</b>;</li>
<li>表操作补遗：
<ol class="org-ol">
<li>pair? 检查参数是否为序对；</li>
</ol>
</li>
<li>map 与递归的结合也是处理树的一种强有力的抽象。</li>
</ol>
</div>
</div>

<div id="outline-container-orgcc6ef1f" class="outline-3">
<h3 id="orgcc6ef1f">练习 2.24-2.32</h3>
<div class="outline-text-3" id="text-orgcc6ef1f">
</div>
<div id="outline-container-org0a86bfd" class="outline-4">
<h4 id="org0a86bfd">2.24</h4>
<div class="outline-text-4" id="text-org0a86bfd">
<div class="highlight"><pre><span></span>     <span class="c1">;; (1 (2 (3 4)))</span>
     <span class="c1">;; 盒子指针结构和树结构很容易理解，图示就免了。</span>
</pre></div>
</div>
</div>

<div id="outline-container-orga034027" class="outline-4">
<h4 id="orga034027">2.25</h4>
<div class="outline-text-4" id="text-orga034027">
<div class="highlight"><pre><span></span>     <span class="c1">;; (1 3 (5 7) 9)</span>
     <span class="c1">;;(car (cdr (car (cdr (cdr '(1 3 (5 7) 9))))))</span>

     <span class="c1">;; ((7))</span>
     <span class="c1">;; (car (car '((7))))</span>

     <span class="c1">;; (1 (2 (3 (4 (5 (6 7)))))))</span>
     <span class="c1">;; (cadr (cadr (cadr (cadr (cadr (cadr third))))))</span>
</pre></div>
</div>
</div>

<div id="outline-container-orgbac4a6d" class="outline-4">
<h4 id="orgbac4a6d">2.26</h4>
<div class="outline-text-4" id="text-orgbac4a6d">
<div class="highlight"><pre><span></span>     <span class="p">(</span><span class="k">define </span><span class="nv">x</span> <span class="p">(</span><span class="nb">list </span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">))</span>

     <span class="p">(</span><span class="k">define </span><span class="nv">y</span> <span class="p">(</span><span class="nb">list </span><span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span><span class="p">))</span>

     <span class="c1">;; (append x y) '(1 2 3 4 5 6)</span>
     <span class="c1">;; (cons x y) '('(1 2 3) 4 5 6)</span>
     <span class="c1">;; (list x y) '('(1 2 3) '(4 5 6))</span>
</pre></div>
</div>
</div>

<div id="outline-container-org7bd3e80" class="outline-4">
<h4 id="org7bd3e80">2.27</h4>
<div class="outline-text-4" id="text-org7bd3e80">
<div class="highlight"><pre><span></span>     <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">deep-reverse</span> <span class="nv">items</span><span class="p">)</span>
       <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">iter</span> <span class="nv">items</span> <span class="nv">result</span><span class="p">)</span>
	 <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nb">null? </span><span class="nv">items</span><span class="p">)</span> <span class="nv">result</span><span class="p">)</span>
	       <span class="p">((</span><span class="nb">pair? </span><span class="p">(</span><span class="nb">car </span><span class="nv">items</span><span class="p">))</span>
		<span class="p">(</span><span class="nf">iter</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">items</span><span class="p">)</span>
		      <span class="p">(</span><span class="nb">cons </span><span class="p">(</span><span class="nf">deep-reverse</span> <span class="p">(</span><span class="nb">car </span><span class="nv">items</span><span class="p">))</span> <span class="nv">result</span><span class="p">)))</span>
	       <span class="p">(</span><span class="k">else </span><span class="p">(</span><span class="nf">iter</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">items</span><span class="p">)</span> <span class="p">(</span><span class="nb">cons </span><span class="p">(</span><span class="nb">car </span><span class="nv">items</span><span class="p">)</span> <span class="nv">result</span><span class="p">)))))</span>
       <span class="p">(</span><span class="nf">iter</span> <span class="nv">items</span> <span class="o">'</span><span class="p">()))</span>
</pre></div>
</div>
</div>

<div id="outline-container-orga6f8b84" class="outline-4">
<h4 id="orga6f8b84">2.28</h4>
<div class="outline-text-4" id="text-orga6f8b84">
<div class="highlight"><pre><span></span>     <span class="c1">;; (load "./2.18.scm")</span>

     <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nb">append </span><span class="nv">list1</span> <span class="nv">list2</span><span class="p">)</span>
       <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">null? </span><span class="nv">list1</span><span class="p">)</span>
	   <span class="nv">list2</span>
	   <span class="p">(</span><span class="nb">cons </span><span class="p">(</span><span class="nb">car </span><span class="nv">list1</span><span class="p">)</span> <span class="p">(</span><span class="nb">append </span><span class="p">(</span><span class="nb">cdr </span><span class="nv">list1</span><span class="p">)</span> <span class="nv">list2</span><span class="p">))))</span>

     <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">fringe</span> <span class="nv">tree</span><span class="p">)</span>
       <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">iter</span> <span class="nv">tree</span> <span class="nv">result</span><span class="p">)</span>
	 <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nb">null? </span><span class="nv">tree</span><span class="p">)</span> <span class="nv">result</span><span class="p">)</span>
	       <span class="p">((</span><span class="nb">pair? </span><span class="p">(</span><span class="nb">car </span><span class="nv">tree</span><span class="p">))</span> <span class="p">(</span><span class="nf">iter</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">tree</span><span class="p">)</span> <span class="p">(</span><span class="nb">append </span><span class="p">(</span><span class="nf">fringe</span> <span class="p">(</span><span class="nb">car </span><span class="nv">tree</span><span class="p">))</span> <span class="nv">result</span><span class="p">)))</span>
	       <span class="p">(</span><span class="k">else </span><span class="p">(</span><span class="nf">iter</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">tree</span><span class="p">)</span> <span class="p">(</span><span class="nb">cons </span><span class="p">(</span><span class="nb">car </span><span class="nv">tree</span><span class="p">)</span> <span class="nv">result</span><span class="p">)))))</span>
       <span class="p">(</span><span class="nb">reverse </span><span class="p">(</span><span class="nf">iter</span> <span class="nv">tree</span> <span class="o">'</span><span class="p">())))</span>
</pre></div>
</div>
</div>

<div id="outline-container-org45b2718" class="outline-4">
<h4 id="org45b2718">2.29</h4>
<div class="outline-text-4" id="text-org45b2718">
<div class="highlight"><pre><span></span>     <span class="c1">;; a</span>

     <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-mobile</span> <span class="nv">left</span> <span class="nv">right</span><span class="p">)</span>
       <span class="p">(</span><span class="nb">list </span><span class="nv">left</span> <span class="nv">right</span><span class="p">))</span>

     <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-branch</span> <span class="nv">length</span> <span class="nv">structure</span><span class="p">)</span>
       <span class="p">(</span><span class="nb">list </span><span class="nv">length</span> <span class="nv">structure</span><span class="p">))</span>

     <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">left-branch</span> <span class="nv">item</span><span class="p">)</span>
       <span class="p">(</span><span class="nb">car </span><span class="nv">item</span><span class="p">))</span>

     <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">right-branch</span> <span class="nv">item</span><span class="p">)</span>
       <span class="p">(</span><span class="nb">car </span><span class="p">(</span><span class="nb">cdr </span><span class="nv">item</span><span class="p">)))</span>

     <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">branch-length</span> <span class="nv">branch</span><span class="p">)</span>
       <span class="p">(</span><span class="nb">car </span><span class="nv">branch</span><span class="p">))</span>

     <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">branch-structure</span> <span class="nv">branch</span><span class="p">)</span>
       <span class="p">(</span><span class="nb">car </span><span class="p">(</span><span class="nb">cdr </span><span class="nv">branch</span><span class="p">)))</span>

     <span class="c1">;; b</span>

     <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">total-weight</span> <span class="nv">item</span><span class="p">)</span>
       <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">recursive</span> <span class="nv">item</span><span class="p">)</span>
	 <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nb">null? </span><span class="nv">item</span><span class="p">)</span> <span class="mi">0</span><span class="p">)</span>
	       <span class="p">((</span><span class="nb">number? </span><span class="nv">item</span><span class="p">)</span> <span class="nv">item</span><span class="p">)</span>
	       <span class="p">(</span><span class="k">else </span><span class="p">(</span><span class="nb">+ </span><span class="p">(</span><span class="nf">recursive</span> <span class="p">(</span><span class="nf">branch-structure</span> <span class="p">(</span><span class="nf">left-branch</span> <span class="nv">item</span><span class="p">)))</span>
			<span class="p">(</span><span class="nf">recursive</span> <span class="p">(</span><span class="nf">branch-structure</span> <span class="p">(</span><span class="nf">right-branch</span> <span class="nv">item</span><span class="p">)))))))</span>
       <span class="p">(</span><span class="nf">recursive</span> <span class="nv">item</span><span class="p">))</span>

     <span class="c1">;; c</span>

     <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">total-moment</span> <span class="nv">item</span><span class="p">)</span>
       <span class="p">(</span><span class="nb">* </span><span class="p">(</span><span class="nf">branch-length</span> <span class="nv">item</span><span class="p">)</span> <span class="p">(</span><span class="nf">total-weight</span> <span class="p">(</span><span class="nf">branch-structure</span> <span class="nv">item</span><span class="p">))))</span>

     <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">balance?</span> <span class="nv">item</span><span class="p">)</span>
       <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">not </span><span class="p">(</span><span class="nb">pair? </span><span class="nv">item</span><span class="p">))</span>
	   <span class="nv">true</span>
	   <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">left</span> <span class="p">(</span><span class="nf">left-branch</span> <span class="nv">item</span><span class="p">))</span> <span class="p">(</span><span class="nf">right</span> <span class="p">(</span><span class="nf">right-branch</span> <span class="nv">item</span><span class="p">)))</span>
	     <span class="p">(</span><span class="k">and </span><span class="p">(</span><span class="nb">= </span><span class="p">(</span><span class="nf">total-moment</span> <span class="nv">left</span><span class="p">)</span> <span class="p">(</span><span class="nf">total-moment</span> <span class="nv">right</span><span class="p">))</span>
		  <span class="p">(</span><span class="nf">balance?</span> <span class="p">(</span><span class="nf">branch-structure</span> <span class="nv">left</span><span class="p">))</span>
		  <span class="p">(</span><span class="nf">balance?</span> <span class="p">(</span><span class="nf">branch-structure</span> <span class="nv">right</span><span class="p">))))))</span>

     <span class="c1">;; d</span>

     <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-mobile-mod</span> <span class="nv">left</span> <span class="nv">right</span><span class="p">)</span>
       <span class="p">(</span><span class="nb">cons </span><span class="nv">left</span> <span class="nv">right</span><span class="p">))</span>

     <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-branch-mod</span> <span class="nv">length</span> <span class="nv">structure</span><span class="p">)</span>
       <span class="p">(</span><span class="nb">cons </span><span class="nv">length</span> <span class="nv">structure</span><span class="p">))</span>


     <span class="c1">;; just modify right-branch and branch-structure</span>

     <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">right-branch-mod</span> <span class="nv">item</span><span class="p">)</span>
       <span class="p">(</span><span class="nb">cdr </span><span class="nv">item</span><span class="p">))</span>

     <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">branch-structure-mod</span> <span class="nv">branch</span><span class="p">)</span>
       <span class="p">(</span><span class="nb">cdr </span><span class="nv">branch</span><span class="p">))</span>
</pre></div>
</div>
</div>

<div id="outline-container-org4b63211" class="outline-4">
<h4 id="org4b63211">2.30</h4>
<div class="outline-text-4" id="text-org4b63211">
<div class="highlight"><pre><span></span>     <span class="c1">;; with map</span>

     <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">square-tree</span> <span class="nv">tree</span><span class="p">)</span>
       <span class="p">(</span><span class="nb">map </span><span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">sub-tree</span><span class="p">)</span>
	      <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">pair? </span><span class="nv">sub-tree</span><span class="p">)</span>
		  <span class="p">(</span><span class="nf">square-tree</span> <span class="nv">sub-tree</span><span class="p">)</span>
		  <span class="p">(</span><span class="nf">square</span> <span class="nv">sub-tree</span><span class="p">)))</span>
	    <span class="nv">tree</span><span class="p">))</span>

     <span class="c1">;; without map</span>

     <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">square-tree-simple</span> <span class="nv">tree</span><span class="p">)</span>
       <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nb">null? </span><span class="nv">tree</span><span class="p">)</span> <span class="o">'</span><span class="p">())</span>
	     <span class="p">((</span><span class="nb">not </span><span class="p">(</span><span class="nb">pair? </span><span class="nv">tree</span><span class="p">))</span> <span class="p">(</span><span class="nf">square</span> <span class="nv">tree</span><span class="p">))</span>
	     <span class="p">(</span><span class="k">else </span><span class="p">(</span><span class="nb">cons </span><span class="p">(</span><span class="nf">square-tree-simple</span> <span class="p">(</span><span class="nb">car </span><span class="nv">tree</span><span class="p">))</span>
			 <span class="p">(</span><span class="nf">square-tree-simple</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">tree</span><span class="p">))))))</span>
</pre></div>
</div>
</div>

<div id="outline-container-org443fed3" class="outline-4">
<h4 id="org443fed3">2.31</h4>
<div class="outline-text-4" id="text-org443fed3">
<div class="highlight"><pre><span></span>     <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">tree-map</span> <span class="nv">op</span> <span class="nv">tree</span><span class="p">)</span>
       <span class="p">(</span><span class="nb">map </span><span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">sub-tree</span><span class="p">)</span>
	      <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">pair? </span><span class="nv">sub-tree</span><span class="p">)</span>
		  <span class="p">(</span><span class="nf">tree-map</span> <span class="nv">op</span> <span class="nv">sub-tree</span><span class="p">)</span>
		  <span class="p">(</span><span class="nf">op</span> <span class="nv">sub-tree</span><span class="p">)))</span>
	    <span class="nv">tree</span><span class="p">))</span>

     <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">square-tree</span> <span class="nv">tree</span><span class="p">)</span>
       <span class="p">(</span><span class="nf">tree-map</span> <span class="nv">square</span> <span class="nv">tree</span><span class="p">))</span>
</pre></div>
</div>
</div>

<div id="outline-container-org75b7ea5" class="outline-4">
<h4 id="org75b7ea5">2.32</h4>
<div class="outline-text-4" id="text-org75b7ea5">
<div class="highlight"><pre><span></span>     <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">subsets</span> <span class="nv">s</span><span class="p">)</span>
       <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">null? </span><span class="nv">s</span><span class="p">)</span>
	   <span class="p">(</span><span class="nb">list </span><span class="o">'</span><span class="p">())</span>
	   <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">rest</span> <span class="p">(</span><span class="nf">subsets</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">s</span><span class="p">))))</span>
	     <span class="p">(</span><span class="nb">append </span><span class="nv">rest</span> <span class="p">(</span><span class="nb">map </span><span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span><span class="p">)</span>
				 <span class="p">(</span><span class="nb">cons </span><span class="p">(</span><span class="nb">car </span><span class="nv">s</span><span class="p">)</span> <span class="nv">x</span><span class="p">))</span>
			       <span class="nv">rest</span><span class="p">)))))</span>
</pre></div>
</div>
</div>
</div>

<div id="outline-container-org2cd63ab" class="outline-3">
<h3 id="org2cd63ab">序列作为一种约定的界面</h3>
<div class="outline-text-3" id="text-org2cd63ab">
<ol class="org-ol">
<li>将注意力集中在处理过程中从一个步骤流向下一个步骤的“信号”，如果用一些表来
表示这些信号，那么就可以利用表操作实现每一步骤的处理；</li>
<li>将程序表示为一些针对序列的操作，这样做的价值就在于能帮助我们得到 <b>模块化</b>
的程序设计，也就是说，得到由一些比较独立的片段的组合构成的设计；</li>
<li>模块化结构是控制复杂性的一种威力强大的策略，能形成一个可以 <b>混合和匹配</b>
使用和搭配的标准的程序元素库；</li>
<li>在书中，用表实现的序列被作为一种方便的接口，可以利用这种接口去组合去组合
起各种处理模块；</li>
<li>而且有了一种统一的数据表示结构，就可以将程序对数据结构的依赖性局限到不多
的数据结构操作上，只要修改这些操作并保持接口约定，就能在数据结构的不同表
示之间切换，并保持程序的整体设计不变。</li>
</ol>
</div>
</div>

<div id="outline-container-org51ffadf" class="outline-3">
<h3 id="org51ffadf">练习 2.33-2.43</h3>
<div class="outline-text-3" id="text-org51ffadf">
</div>
<div id="outline-container-orgfb38a76" class="outline-4">
<h4 id="orgfb38a76">2.33</h4>
<div class="outline-text-4" id="text-orgfb38a76">
<div class="highlight"><pre><span></span>     <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">accumulate</span> <span class="nv">op</span> <span class="nv">initial</span> <span class="nv">sequence</span><span class="p">)</span>
       <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">null? </span><span class="nv">sequence</span><span class="p">)</span>
	   <span class="nv">initial</span>
	   <span class="p">(</span><span class="nf">op</span> <span class="p">(</span><span class="nb">car </span><span class="nv">sequence</span><span class="p">)</span>
	       <span class="p">(</span><span class="nf">accumulate</span> <span class="nv">op</span> <span class="nv">initial</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">sequence</span><span class="p">)))))</span>

     <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nb">map </span><span class="nv">p</span> <span class="nv">sequence</span><span class="p">)</span>
       <span class="p">(</span><span class="nf">accumulate</span> <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span> <span class="nv">y</span><span class="p">)</span> <span class="p">(</span><span class="nb">cons </span><span class="p">(</span><span class="nf">p</span> <span class="nv">x</span><span class="p">)</span> <span class="nv">y</span><span class="p">))</span> <span class="o">'</span><span class="p">()</span> <span class="nv">sequence</span><span class="p">))</span>

     <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nb">append </span><span class="nv">seq1</span> <span class="nv">seq2</span><span class="p">)</span>
       <span class="p">(</span><span class="nf">accumulate</span> <span class="nv">cons</span> <span class="nv">seq2</span> <span class="nv">seq1</span><span class="p">))</span>

     <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nb">length </span><span class="nv">sequence</span><span class="p">)</span>
       <span class="p">(</span><span class="nf">accumulate</span> <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span> <span class="nv">y</span><span class="p">)</span> <span class="p">(</span><span class="nb">+ </span><span class="mi">1</span> <span class="nv">y</span><span class="p">))</span> <span class="mi">0</span> <span class="nv">sequence</span><span class="p">))</span>
</pre></div>
</div>
</div>

<div id="outline-container-orgf6bc18e" class="outline-4">
<h4 id="orgf6bc18e">2.34</h4>
<div class="outline-text-4" id="text-orgf6bc18e">
<div class="highlight"><pre><span></span>     <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">horner-eval</span> <span class="nv">x</span> <span class="nv">coefficient-sequence</span><span class="p">)</span>
       <span class="p">(</span><span class="nf">accumulate</span> <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">this-coeff</span> <span class="nv">higher-terms</span><span class="p">)</span> <span class="p">(</span><span class="nb">+ </span><span class="nv">this-coeff</span> <span class="p">(</span><span class="nb">* </span><span class="nv">x</span> <span class="nv">higher-terms</span><span class="p">)))</span>
		   <span class="mi">0</span>
		   <span class="nv">coefficient-sequence</span><span class="p">))</span>
</pre></div>
</div>
</div>

<div id="outline-container-orgf0a38a3" class="outline-4">
<h4 id="orgf0a38a3">2.35</h4>
<div class="outline-text-4" id="text-orgf0a38a3">
<div class="highlight"><pre><span></span>     <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">count-leaves</span> <span class="nv">t</span><span class="p">)</span>
       <span class="p">(</span><span class="nf">accumulate</span> <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span> <span class="nv">y</span><span class="p">)</span> <span class="p">(</span><span class="nb">+ </span><span class="p">(</span><span class="nb">length </span><span class="nv">x</span><span class="p">)</span> <span class="nv">y</span><span class="p">))</span> <span class="mi">0</span> <span class="p">(</span><span class="nb">map </span><span class="nv">enumerate-tree</span> <span class="nv">t</span><span class="p">)))</span>
</pre></div>
</div>
</div>

<div id="outline-container-org74dcaa6" class="outline-4">
<h4 id="org74dcaa6">2.36</h4>
<div class="outline-text-4" id="text-org74dcaa6">
<div class="highlight"><pre><span></span>     <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">accumulate-n</span> <span class="nv">op</span> <span class="nv">init</span> <span class="nv">seqs</span><span class="p">)</span>
       <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">null? </span><span class="p">(</span><span class="nb">car </span><span class="nv">seqs</span><span class="p">))</span>
	   <span class="o">'</span><span class="p">()</span>
	   <span class="p">(</span><span class="nb">cons </span><span class="p">(</span><span class="nf">accumulate</span> <span class="nv">op</span> <span class="nv">init</span> <span class="p">(</span><span class="nb">map </span><span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">car </span><span class="nv">x</span><span class="p">))</span> <span class="nv">seqs</span><span class="p">))</span>
		 <span class="p">(</span><span class="nf">accumulate-n</span> <span class="nv">op</span> <span class="nv">init</span> <span class="p">(</span><span class="nb">map </span><span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">x</span><span class="p">))</span> <span class="nv">seqs</span><span class="p">)))))</span>
</pre></div>
</div>
</div>

<div id="outline-container-org7c936b6" class="outline-4">
<h4 id="org7c936b6">2.37</h4>
<div class="outline-text-4" id="text-org7c936b6">
<div class="highlight"><pre><span></span>     <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">dot-product</span> <span class="nv">v</span> <span class="nv">w</span><span class="p">)</span>
       <span class="p">(</span><span class="nf">accumulate</span> <span class="nv">+</span> <span class="mi">0</span> <span class="p">(</span><span class="nb">map </span><span class="nv">*</span> <span class="nv">v</span> <span class="nv">w</span><span class="p">)))</span>

     <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">martix-*-vector</span> <span class="nv">m</span> <span class="nv">v</span><span class="p">)</span>
       <span class="p">(</span><span class="nb">map </span><span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span><span class="p">)</span> <span class="p">(</span><span class="nf">dot-product</span> <span class="nv">x</span> <span class="nv">v</span><span class="p">))</span> <span class="nv">m</span><span class="p">))</span>

     <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">transpose</span> <span class="nv">mat</span><span class="p">)</span>
       <span class="p">(</span><span class="nf">accumulate-n</span> <span class="nv">cons</span> <span class="o">'</span><span class="p">()</span> <span class="nv">mat</span><span class="p">))</span>

     <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">martix-*-matrix</span> <span class="nv">m</span> <span class="nv">n</span><span class="p">)</span>
       <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">cols</span> <span class="p">(</span><span class="nf">transpose</span> <span class="nv">n</span><span class="p">)))</span>
	 <span class="p">(</span><span class="nb">map </span><span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">v</span><span class="p">)</span> <span class="p">(</span><span class="nf">martix-*-vector</span> <span class="nv">cols</span> <span class="nv">v</span><span class="p">))</span> <span class="nv">m</span><span class="p">)))</span>
</pre></div>
</div>
</div>

<div id="outline-container-org54c46a1" class="outline-4">
<h4 id="org54c46a1">2.38</h4>
<div class="outline-text-4" id="text-org54c46a1">
<div class="highlight"><pre><span></span>     <span class="c1">;; (fold-left / 1 (list 1 2 3)) 1/6</span>
     <span class="c1">;; (fold-right /1 (list 1 2 3)) 3/2</span>
     <span class="c1">;; (fold-right list nil (list 1 2 3)) (1 (2 (3 ())))</span>
     <span class="c1">;; (fold-left list nil (list 1 2 3)) (((() 1) 2) 3)</span>

     <span class="c1">;; op should be commutative &amp; associative（自己去网上找详细的解释）</span>
</pre></div>
</div>
</div>

<div id="outline-container-org23036eb" class="outline-4">
<h4 id="org23036eb">2.39</h4>
<div class="outline-text-4" id="text-org23036eb">
<div class="highlight"><pre><span></span>     <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">reverse-right</span> <span class="nv">sequence</span><span class="p">)</span>
       <span class="p">(</span><span class="nf">accumulate</span> <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span> <span class="nv">y</span><span class="p">)</span> <span class="p">(</span><span class="nb">append </span><span class="nv">y</span> <span class="p">(</span><span class="nb">list </span><span class="nv">x</span><span class="p">)))</span> <span class="o">'</span><span class="p">()</span> <span class="nv">sequence</span><span class="p">))</span>

     <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">reverse-left</span> <span class="nv">sequence</span><span class="p">)</span>
       <span class="p">(</span><span class="nf">fold-left</span> <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">x</span> <span class="nv">y</span><span class="p">)</span> <span class="p">(</span><span class="nb">cons </span><span class="nv">y</span> <span class="nv">x</span><span class="p">))</span> <span class="o">'</span><span class="p">()</span> <span class="nv">sequence</span><span class="p">))</span>
</pre></div>
</div>
</div>

<div id="outline-container-org1291691" class="outline-4">
<h4 id="org1291691">2.40</h4>
<div class="outline-text-4" id="text-org1291691">
<div class="highlight"><pre><span></span>     <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">flatmap</span> <span class="nv">proc</span> <span class="nv">seq</span><span class="p">)</span>
       <span class="p">(</span><span class="nf">accumulate</span> <span class="nv">append</span> <span class="o">'</span><span class="p">()</span> <span class="p">(</span><span class="nb">map </span><span class="nv">proc</span> <span class="nv">seq</span><span class="p">)))</span>

     <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">prime-sum?</span> <span class="nv">pair</span><span class="p">)</span>
       <span class="p">(</span><span class="nf">prime?</span> <span class="p">(</span><span class="nb">+ </span><span class="p">(</span><span class="nb">car </span><span class="nv">pair</span><span class="p">)</span> <span class="p">(</span><span class="nb">cadr </span><span class="nv">pair</span><span class="p">))))</span>

     <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">enumerate-interval</span> <span class="nv">low</span> <span class="nv">high</span><span class="p">)</span>
       <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">&gt; </span><span class="nv">low</span> <span class="nv">high</span><span class="p">)</span>
	   <span class="o">'</span><span class="p">()</span>
	   <span class="p">(</span><span class="nb">cons </span><span class="nv">low</span> <span class="p">(</span><span class="nf">enumerate-interval</span> <span class="p">(</span><span class="nb">+ </span><span class="nv">low</span> <span class="mi">1</span><span class="p">)</span> <span class="nv">high</span><span class="p">))))</span>

     <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-pair-sum</span> <span class="nv">pair</span><span class="p">)</span>
       <span class="p">(</span><span class="nb">list </span><span class="p">(</span><span class="nb">car </span><span class="nv">pair</span><span class="p">)</span> <span class="p">(</span><span class="nb">cadr </span><span class="nv">pair</span><span class="p">)</span> <span class="p">(</span><span class="nb">+ </span><span class="p">(</span><span class="nb">car </span><span class="nv">pair</span><span class="p">)</span> <span class="p">(</span><span class="nb">cadr </span><span class="nv">pair</span><span class="p">))))</span>

     <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">unique-pairs</span> <span class="nv">n</span><span class="p">)</span>
       <span class="p">(</span><span class="nf">flatmap</span>
	<span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">i</span><span class="p">)</span>
	  <span class="p">(</span><span class="nb">map </span><span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">j</span><span class="p">)</span> <span class="p">(</span><span class="nb">list </span><span class="nv">i</span> <span class="nv">j</span><span class="p">))</span>
	       <span class="p">(</span><span class="nf">enumerate-interval</span> <span class="mi">1</span> <span class="p">(</span><span class="nb">- </span><span class="nv">i</span> <span class="mi">1</span><span class="p">))))</span>
	<span class="p">(</span><span class="nf">enumerate-interval</span> <span class="mi">1</span> <span class="nv">n</span><span class="p">)))</span>

     <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">prime-sum-pairs</span> <span class="nv">n</span><span class="p">)</span>
       <span class="p">(</span><span class="nb">map </span><span class="nv">make-pair-sum</span>
	    <span class="p">(</span><span class="nf">filter</span> <span class="nv">prime-sum?</span> <span class="p">(</span><span class="nf">unique-pairs</span> <span class="nv">n</span><span class="p">))))</span>
</pre></div>
</div>
</div>

<div id="outline-container-orgdfc6166" class="outline-4">
<h4 id="orgdfc6166">2.41</h4>
<div class="outline-text-4" id="text-orgdfc6166">
<div class="highlight"><pre><span></span>     <span class="c1">;; (load "2.33.scm")</span>
     <span class="c1">;; (load "2.40.scm")</span>

     <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">filter</span> <span class="nv">p</span> <span class="nv">s</span><span class="p">)</span>
       <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nb">null? </span><span class="nv">s</span><span class="p">)</span> <span class="o">'</span><span class="p">())</span>
	     <span class="p">((</span><span class="nf">p</span> <span class="p">(</span><span class="nb">car </span><span class="nv">s</span><span class="p">))</span>
	      <span class="p">(</span><span class="nb">cons </span><span class="p">(</span><span class="nb">car </span><span class="nv">s</span><span class="p">)</span> <span class="p">(</span><span class="nf">filter</span> <span class="nv">p</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">s</span><span class="p">))))</span>
	     <span class="p">(</span><span class="k">else </span><span class="p">(</span><span class="nf">filter</span> <span class="nv">p</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">s</span><span class="p">)))))</span>

     <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">triple-pair-sum</span> <span class="nv">p</span><span class="p">)</span>
       <span class="p">(</span><span class="nf">accumulate</span> <span class="nv">+</span> <span class="mi">0</span> <span class="nv">p</span><span class="p">))</span>

     <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">triple-pair</span> <span class="nv">n</span><span class="p">)</span>
       <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">range</span> <span class="p">(</span><span class="nf">enumerate-interval</span> <span class="mi">1</span> <span class="nv">n</span><span class="p">)))</span>
	 <span class="p">(</span><span class="nf">flatmap</span>
	  <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">a</span><span class="p">)</span>
	    <span class="p">(</span><span class="nf">flatmap</span>
	     <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">b</span><span class="p">)</span>
	       <span class="p">(</span><span class="nb">map </span><span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">c</span><span class="p">)</span> <span class="p">(</span><span class="nb">list </span><span class="nv">c</span> <span class="nv">b</span> <span class="nv">a</span><span class="p">))</span>
		    <span class="p">(</span><span class="nf">enumerate-interval</span> <span class="p">(</span><span class="nb">+ </span><span class="nv">b</span> <span class="mi">1</span><span class="p">)</span> <span class="nv">n</span><span class="p">)))</span>
	     <span class="p">(</span><span class="nf">enumerate-interval</span> <span class="p">(</span><span class="nb">+ </span><span class="nv">a</span> <span class="mi">1</span><span class="p">)</span> <span class="nv">n</span><span class="p">)))</span>
	  <span class="nv">range</span><span class="p">)))</span>

     <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">triple-pair-sum-n</span> <span class="nv">n</span> <span class="nv">s</span><span class="p">)</span>
       <span class="p">(</span><span class="nf">filter</span>
	<span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">p</span><span class="p">)</span> <span class="p">(</span><span class="nb">= </span><span class="nv">s</span> <span class="p">(</span><span class="nf">triple-pair-sum</span> <span class="nv">p</span><span class="p">)))</span>
	<span class="p">(</span><span class="nf">triple-pair</span> <span class="nv">n</span><span class="p">)))</span>
</pre></div>
</div>
</div>

<div id="outline-container-orge0011a8" class="outline-4">
<h4 id="orge0011a8">2.42</h4>
<div class="outline-text-4" id="text-orge0011a8">
<div class="highlight"><pre><span></span>     <span class="c1">;; (load "2.33.scm")</span>
     <span class="c1">;; (load "2.40.scm")</span>
     <span class="c1">;; (load "2.41.scm")</span>

     <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">queens</span> <span class="nv">board-size</span><span class="p">)</span>
       <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">queen-cols</span> <span class="nv">k</span><span class="p">)</span>
	 <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">= </span><span class="nv">k</span> <span class="mi">0</span><span class="p">)</span>
	     <span class="p">(</span><span class="nb">list </span><span class="nv">empty-board</span><span class="p">)</span>
	     <span class="p">(</span><span class="nf">filter</span>
	      <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">positions</span><span class="p">)</span> <span class="p">(</span><span class="nf">safe?</span> <span class="nv">k</span> <span class="nv">positions</span><span class="p">))</span>
	      <span class="p">(</span><span class="nf">flatmap</span>
	       <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">rest-of-queens</span><span class="p">)</span>
		 <span class="p">(</span><span class="nb">map </span><span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">new-row</span><span class="p">)</span>
			<span class="p">(</span><span class="nf">adjoin-position</span> <span class="nv">new-row</span> <span class="nv">k</span> <span class="nv">rest-of-queens</span><span class="p">))</span>
		      <span class="p">(</span><span class="nf">enumerate-interval</span> <span class="mi">1</span> <span class="nv">board-size</span><span class="p">)))</span>
	       <span class="p">(</span><span class="nf">queen-cols</span> <span class="p">(</span><span class="nb">- </span><span class="nv">k</span> <span class="mi">1</span><span class="p">))))))</span>
       <span class="p">(</span><span class="nf">queen-cols</span> <span class="nv">board-size</span><span class="p">))</span>

     <span class="p">(</span><span class="k">define </span><span class="nv">empty-board</span> <span class="o">'</span><span class="p">())</span>

     <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-position</span> <span class="nv">row</span> <span class="nv">k</span><span class="p">)</span>
       <span class="p">(</span><span class="nb">list </span><span class="nv">k</span> <span class="nv">row</span><span class="p">))</span>

     <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">row-position</span> <span class="nv">p</span><span class="p">)</span>
       <span class="p">(</span><span class="nb">cadr </span><span class="nv">p</span><span class="p">))</span>

     <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">k-position</span> <span class="nv">p</span><span class="p">)</span>
       <span class="p">(</span><span class="nb">car </span><span class="nv">p</span><span class="p">))</span>

     <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">adjoin-position</span> <span class="nv">new-row</span> <span class="nv">k</span> <span class="nv">rest-of-queens</span><span class="p">)</span>
       <span class="p">(</span><span class="nb">cons </span><span class="p">(</span><span class="nf">make-position</span> <span class="nv">new-row</span> <span class="nv">k</span><span class="p">)</span> <span class="nv">rest-of-queens</span><span class="p">))</span>

     <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">get-row</span> <span class="nv">positions</span> <span class="nv">k</span><span class="p">)</span>
       <span class="p">(</span><span class="k">cond </span><span class="p">((</span><span class="nb">null? </span><span class="p">(</span><span class="nb">car </span><span class="nv">positions</span><span class="p">))</span> <span class="p">(</span><span class="nf">error</span> <span class="s">"invalid operation"</span> <span class="nv">k</span><span class="p">))</span>
	     <span class="p">((</span><span class="nb">= </span><span class="p">(</span><span class="nf">k-position</span> <span class="p">(</span><span class="nb">car </span><span class="nv">positions</span><span class="p">))</span> <span class="nv">k</span><span class="p">)</span> <span class="p">(</span><span class="nf">row-position</span> <span class="p">(</span><span class="nb">car </span><span class="nv">positions</span><span class="p">)))</span>
	     <span class="p">(</span><span class="k">else </span><span class="p">(</span><span class="nf">get-row</span> <span class="p">(</span><span class="nb">cdr </span><span class="nv">positions</span><span class="p">)</span> <span class="nv">k</span><span class="p">))))</span>

     <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">safe?</span> <span class="nv">k</span> <span class="nv">positions</span><span class="p">)</span>
       <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">= </span><span class="nv">k</span> <span class="mi">1</span><span class="p">)</span>
	   <span class="ss">'true</span>
	   <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">r1</span> <span class="p">(</span><span class="nf">get-row</span> <span class="nv">positions</span> <span class="nv">k</span><span class="p">))</span>
		 <span class="p">(</span><span class="nf">r2</span> <span class="p">(</span><span class="nf">get-row</span> <span class="nv">positions</span> <span class="p">(</span><span class="nb">- </span><span class="nv">k</span> <span class="mi">1</span><span class="p">))))</span>
	     <span class="p">(</span><span class="nf">and</span>
	      <span class="p">(</span><span class="nb">not </span><span class="p">(</span><span class="nb">= </span><span class="nv">r1</span> <span class="nv">r2</span><span class="p">))</span>
	      <span class="p">(</span><span class="nb">not </span><span class="p">(</span><span class="nb">= </span><span class="p">(</span><span class="nb">+ </span><span class="mi">1</span> <span class="nv">r1</span><span class="p">)</span> <span class="nv">r2</span><span class="p">))</span>
	      <span class="p">(</span><span class="nb">not </span><span class="p">(</span><span class="nb">= </span><span class="p">(</span><span class="nb">+ </span><span class="mi">1</span> <span class="nv">r2</span><span class="p">)</span> <span class="nv">r1</span><span class="p">))))))</span>
</pre></div>
</div>
</div>

<div id="outline-container-orgb9d755e" class="outline-4">
<h4 id="orgb9d755e">2.43</h4>
<div class="outline-text-4" id="text-orgb9d755e">
<div class="highlight"><pre><span></span>     <span class="c1">;; (queens-cols (- k 1)) 的大量重复计算</span>
     <span class="c1">;; (* (expt n n) T)</span>
</pre></div>
</div>
</div>
</div>

<div id="outline-container-org08a30b2" class="outline-3">
<h3 id="org08a30b2">实例：一个图形语言</h3>
<div class="outline-text-3" id="text-org08a30b2">
<ol class="org-ol">
<li>我们所用的数据在组合方式下的 <b>闭包</b> 性质非常重要，因为这使我们能用不多几
个操作就可以构造出各种复杂的结构；</li>
<li>中文版 p93：将画家表示为过程，就在这一图形语言中竖立起一道强有力的抽象屏
障，这就使我们可以创建和混合基于图形能力的各种类型的基本画家，任何过程只
要能取一个框架作为参数(<b>框架位置形状可能不同但框架的组织是不变的</b>)，画出
某些可以伸缩后适合这个框架的东西：
<ol class="org-ol">
<li>比如 p93 <code>segments-&gt;painter</code> 就是以相对于单位正方形坐标的线段列表为参
数，在返回的匿名过程内部使用 <code>draw-line</code> 画出线段列表参数映射到框架上
的直线；</li>
<li>如脚注94所述，可以推测 rogers painter 应该是以一个相对于单位正方形坐标
的 <b>坐标－灰度序对</b> 列表（表示一个标准灰度图），然后在返回的匿名过程内
部根据传入的画家参数－灰度图，在框架上依次映射坐标并根据灰度着色，就可
以在指定的框架上画出一张肖像图；</li>
<li>这一实例展现并发扬了 <b>抽象数据</b> 思想：2.1.3 提到一种有理数表示可以是任
何的东西，只要它能满足适当的条件；这里，一个画家可以以任何方式实现，只
要它能在指定的框架里画出一些东西来；</li>
</ol>
</li>
<li>
<b>分层设计</b>: 一个复杂的系统应该通过一些列的层次构造出来：
<ol class="org-ol">
<li>构造各个层次的方式，就是设法用各种基本元素组合起作为这一层次中的部件，
而这样构造出的部件又可以作为另一个层次里的基本元素；</li>
<li>每个层次上所用的语言都提供了一些基本元素，组合手段，还有对该层次中的适
当细节做抽象的手段；</li>
<li>分层设计有助于使程序更加强健，使我们更有可能在给定规范发生一些小改变时，
只需要对程序做少量的修改，分层结构中的每个层次都为表述系统的特征提供了
一套独特词汇，以及一套修改这一系统的方式。</li>
</ol>
</li>
</ol>
</div>
</div>

<div id="outline-container-org89d86d5" class="outline-3">
<h3 id="org89d86d5">练习 2.44-2.52</h3>
<div class="outline-text-3" id="text-org89d86d5">
</div>
<div id="outline-container-org3849198" class="outline-4">
<h4 id="org3849198">2.44</h4>
<div class="outline-text-4" id="text-org3849198">
<div class="highlight"><pre><span></span>     <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">up-split</span> <span class="nv">painter</span> <span class="nv">n</span><span class="p">)</span>
       <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">= </span><span class="nv">n</span> <span class="mi">0</span><span class="p">)</span>
	   <span class="nv">painter</span>
	   <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">smaller</span> <span class="p">(</span><span class="nf">up-split</span> <span class="nv">painter</span> <span class="p">(</span><span class="nb">- </span><span class="nv">n</span> <span class="mi">1</span><span class="p">))))</span>
	     <span class="p">(</span><span class="nf">below</span> <span class="nv">painter</span> <span class="p">(</span><span class="nf">beside</span> <span class="nv">smaller</span> <span class="nv">smaller</span><span class="p">)))))</span>
</pre></div>
</div>
</div>

<div id="outline-container-org61799c6" class="outline-4">
<h4 id="org61799c6">2.45</h4>
<div class="outline-text-4" id="text-org61799c6">
<div class="highlight"><pre><span></span>     <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">split</span> <span class="nv">arrangement1</span> <span class="nv">arrangement2</span><span class="p">)</span>
       <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">painter</span> <span class="nv">n</span><span class="p">)</span>
	 <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">= </span><span class="nv">n</span> <span class="mi">0</span><span class="p">)</span>
	     <span class="nv">painter</span>
	     <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">smaller</span> <span class="p">((</span><span class="nf">split</span> <span class="nv">arrangement1</span> <span class="nv">arrangement2</span><span class="p">)</span> <span class="nv">painter</span> <span class="p">(</span><span class="nb">- </span><span class="nv">n</span> <span class="mi">1</span><span class="p">))))</span>
	       <span class="p">(</span><span class="nf">arrangement1</span> <span class="nv">painter</span> <span class="p">(</span><span class="nf">arrangement2</span> <span class="nv">smaller</span> <span class="nv">smaller</span><span class="p">))))))</span>
</pre></div>
</div>
</div>

<div id="outline-container-org1691666" class="outline-4">
<h4 id="org1691666">2.46</h4>
<div class="outline-text-4" id="text-org1691666">
<div class="highlight"><pre><span></span>     <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-vect</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">)</span>
       <span class="p">(</span><span class="nb">cons </span><span class="nv">x</span> <span class="nv">y</span><span class="p">))</span>

     <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">xcor-vect</span> <span class="nv">v</span><span class="p">)</span>
       <span class="p">(</span><span class="nb">car </span><span class="nv">v</span><span class="p">))</span>

     <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">ycor-vect</span> <span class="nv">v</span><span class="p">)</span>
       <span class="p">(</span><span class="nb">cdr </span><span class="nv">v</span><span class="p">))</span>

     <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">add-vect</span> <span class="nv">v1</span> <span class="nv">v2</span><span class="p">)</span>
       <span class="p">(</span><span class="nf">make-vect</span>
	<span class="p">(</span><span class="nb">+ </span><span class="p">(</span><span class="nf">xcor-vect</span> <span class="nv">v1</span><span class="p">)</span> <span class="p">(</span><span class="nf">xcor-vect</span> <span class="nv">v2</span><span class="p">))</span>
	<span class="p">(</span><span class="nb">+ </span><span class="p">(</span><span class="nf">ycor-vect</span> <span class="nv">v1</span><span class="p">)</span> <span class="p">(</span><span class="nf">ycor-vect</span> <span class="nv">v2</span><span class="p">))))</span>

     <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">sub-vect</span> <span class="nv">v1</span> <span class="nv">v2</span><span class="p">)</span>
       <span class="p">(</span><span class="nf">make-vect</span>
	<span class="p">(</span><span class="nb">- </span><span class="p">(</span><span class="nf">xcor-vect</span> <span class="nv">v1</span><span class="p">)</span> <span class="p">(</span><span class="nf">xcor-vect</span> <span class="nv">v2</span><span class="p">))</span>
	<span class="p">(</span><span class="nb">- </span><span class="p">(</span><span class="nf">ycor-vect</span> <span class="nv">v1</span><span class="p">)</span> <span class="p">(</span><span class="nf">ycor-vect</span> <span class="nv">v2</span><span class="p">))))</span>

     <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">divide-vect</span> <span class="nv">v1</span> <span class="nv">v2</span><span class="p">)</span>
       <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="k">or </span><span class="p">(</span><span class="nb">= </span><span class="mi">0</span> <span class="p">(</span><span class="nf">xcor-vect</span> <span class="nv">v2</span><span class="p">))</span> <span class="p">(</span><span class="nb">= </span><span class="mi">0</span> <span class="p">(</span><span class="nf">ycor-vect</span> <span class="nv">v2</span><span class="p">)))</span>
	   <span class="p">(</span><span class="nf">error</span> <span class="s">"invalid second vector"</span><span class="p">)</span>
	   <span class="p">(</span><span class="nf">make-vect</span>
	    <span class="p">(</span><span class="nb">/ </span><span class="p">(</span><span class="nf">xcor-vect</span> <span class="nv">v1</span><span class="p">)</span> <span class="p">(</span><span class="nf">xcor-vect</span> <span class="nv">v2</span><span class="p">))</span>
	    <span class="p">(</span><span class="nb">/ </span><span class="p">(</span><span class="nf">ycor-vect</span> <span class="nv">v1</span><span class="p">)</span> <span class="p">(</span><span class="nf">ycor-vect</span> <span class="nv">v2</span><span class="p">)))))</span>

     <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">scale-vect</span> <span class="nv">s</span> <span class="nv">v</span><span class="p">)</span>
       <span class="p">(</span><span class="nf">make-vect</span>
	<span class="p">(</span><span class="nb">* </span><span class="nv">s</span> <span class="p">(</span><span class="nf">xcor-vect</span> <span class="nv">v</span><span class="p">))</span>
	<span class="p">(</span><span class="nb">* </span><span class="nv">s</span> <span class="p">(</span><span class="nf">ycor-vect</span> <span class="nv">v</span><span class="p">))))</span>
</pre></div>
</div>
</div>

<div id="outline-container-orgee3386f" class="outline-4">
<h4 id="orgee3386f">2.47</h4>
<div class="outline-text-4" id="text-orgee3386f">
<div class="highlight"><pre><span></span>     <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-frame</span> <span class="nv">origin</span> <span class="nv">edge1</span> <span class="nv">edge2</span><span class="p">)</span>
       <span class="p">(</span><span class="nb">list </span><span class="nv">origin</span> <span class="nv">edge1</span> <span class="nv">edge2</span><span class="p">))</span>

     <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">origin-frame</span> <span class="nv">frame</span><span class="p">)</span>
       <span class="p">(</span><span class="nb">car </span><span class="nv">frame</span><span class="p">))</span>

     <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">edge1-frame</span> <span class="nv">frame</span><span class="p">)</span>
       <span class="p">(</span><span class="nb">cadr </span><span class="nv">frame</span><span class="p">))</span>

     <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">edge2-frame</span> <span class="nv">frame</span><span class="p">)</span>
       <span class="p">(</span><span class="nb">caddr </span><span class="nv">frame</span><span class="p">))</span>


     <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-frame</span> <span class="nv">origin</span> <span class="nv">edge1</span> <span class="nv">edge2</span><span class="p">)</span>
       <span class="p">(</span><span class="nb">cons </span><span class="nv">origin</span> <span class="p">(</span><span class="nb">cons </span><span class="nv">edge1</span> <span class="nv">edge2</span><span class="p">)))</span>

     <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">origin-frame</span> <span class="nv">frame</span><span class="p">)</span>
       <span class="p">(</span><span class="nb">car </span><span class="nv">frame</span><span class="p">))</span>

     <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">edge1-frame</span> <span class="nv">frame</span><span class="p">)</span>
       <span class="p">(</span><span class="nb">cadr </span><span class="nv">frame</span><span class="p">))</span>

     <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">edge2-frame</span> <span class="nv">frame</span><span class="p">)</span>
       <span class="p">(</span><span class="nb">cddr </span><span class="nv">frame</span><span class="p">))</span>
</pre></div>
</div>
</div>

<div id="outline-container-orge9bd19f" class="outline-4">
<h4 id="orge9bd19f">2.48</h4>
<div class="outline-text-4" id="text-orge9bd19f">
<div class="highlight"><pre><span></span>     <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">make-segment</span> <span class="nv">x</span> <span class="nv">y</span> <span class="nv">m</span> <span class="nv">n</span><span class="p">)</span>
       <span class="p">(</span><span class="nb">cons </span><span class="p">(</span><span class="nf">make-vect</span> <span class="nv">x</span> <span class="nv">y</span><span class="p">)</span>
	     <span class="p">(</span><span class="nf">make-vect</span> <span class="nv">m</span> <span class="nv">n</span><span class="p">)))</span>

     <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">start-segment</span> <span class="nv">segment</span><span class="p">)</span>
       <span class="p">(</span><span class="nb">car </span><span class="nv">segment</span><span class="p">))</span>

     <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">end-segment</span> <span class="nv">segment</span><span class="p">)</span>
       <span class="p">(</span><span class="nb">cdr </span><span class="nv">segment</span><span class="p">))</span>
</pre></div>
</div>
</div>

<div id="outline-container-org0d8d1f6" class="outline-4">
<h4 id="org0d8d1f6">2.49</h4>
<div class="outline-text-4" id="text-org0d8d1f6">
<div class="highlight"><pre><span></span>     <span class="c1">;; a</span>

     <span class="p">(</span><span class="k">define </span><span class="nv">segment-list1</span> <span class="p">(</span><span class="nf">list</span>
			   <span class="p">(</span><span class="nf">make-segment</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">1</span><span class="p">)</span>
			   <span class="p">(</span><span class="nf">make-segment</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">0</span><span class="p">)</span>
			   <span class="p">(</span><span class="nf">make-segment</span> <span class="mi">1</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">1</span><span class="p">)</span>
			   <span class="p">(</span><span class="nf">make-segment</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">1</span> <span class="mi">1</span><span class="p">)))</span>

     <span class="p">(</span><span class="nf">segments-&gt;painter</span> <span class="nv">segment-list1</span><span class="p">)</span>

     <span class="c1">;; b</span>

     <span class="p">(</span><span class="k">define </span><span class="nv">segment-list2</span> <span class="p">(</span><span class="nf">list</span>
			    <span class="p">(</span><span class="nf">make-segment</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">1</span><span class="p">)</span>
			    <span class="p">(</span><span class="nf">make-segment</span> <span class="mi">0</span> <span class="mi">1</span> <span class="mi">1</span> <span class="mi">0</span><span class="p">)))</span>

     <span class="p">(</span><span class="nf">segments-&gt;painter</span> <span class="nv">segment-list2</span><span class="p">)</span>

     <span class="c1">;; c</span>

     <span class="p">(</span><span class="k">define </span><span class="nv">segment-list3</span> <span class="p">(</span><span class="nf">list</span>
			    <span class="p">(</span><span class="nf">make-segment</span> <span class="mf">0.5</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mf">0.5</span><span class="p">)</span>
			    <span class="p">(</span><span class="nf">make-segment</span> <span class="mi">0</span> <span class="mf">0.5</span> <span class="mf">0.5</span> <span class="mi">1</span><span class="p">)</span>
			    <span class="p">(</span><span class="nf">make-segment</span> <span class="mf">0.5</span> <span class="mi">1</span> <span class="mi">1</span> <span class="mf">0.5</span><span class="p">)</span>
			    <span class="p">(</span><span class="nf">make-segment</span> <span class="mi">1</span> <span class="mf">0.5</span> <span class="mf">0.5</span> <span class="mi">0</span><span class="p">)))</span>

     <span class="p">(</span><span class="nf">segments-&gt;painter</span> <span class="nv">segment-list3</span><span class="p">)</span>

     <span class="c1">;; d</span>
     <span class="c1">;; 计算坐标重复劳动，没什么意思，就不做了。</span>
</pre></div>
</div>
</div>

<div id="outline-container-org99a4cda" class="outline-4">
<h4 id="org99a4cda">2.50</h4>
<div class="outline-text-4" id="text-org99a4cda">
<div class="highlight"><pre><span></span>     <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">flip-horiz</span>  <span class="nv">painter</span><span class="p">)</span>
       <span class="p">(</span><span class="nf">transform-painter</span> <span class="nv">painter</span>
			  <span class="p">(</span><span class="nf">make-vect</span> <span class="mf">1.0</span> <span class="mf">0.0</span><span class="p">)</span>
			  <span class="p">(</span><span class="nf">make-vect</span> <span class="mf">0.0</span> <span class="mf">0.0</span><span class="p">)</span>
			  <span class="p">(</span><span class="nf">make-vect</span> <span class="mf">1.0</span> <span class="mf">1.0</span><span class="p">)))</span>

     <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">rotate180</span> <span class="nv">painter</span><span class="p">)</span>
       <span class="p">(</span><span class="nf">transform-painter</span> <span class="nv">painter</span>
			  <span class="p">(</span><span class="nf">make-vect</span> <span class="mf">1.0</span> <span class="mf">1.0</span><span class="p">)</span>
			  <span class="p">(</span><span class="nf">make-vect</span> <span class="mf">0.0</span> <span class="mf">1.0</span><span class="p">)</span>
			  <span class="p">(</span><span class="nf">make-vect</span> <span class="mf">1.0</span> <span class="mf">0.0</span><span class="p">)))</span>

     <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">rotate270</span> <span class="nv">painter</span><span class="p">)</span>
       <span class="p">(</span><span class="nf">transform-painter</span> <span class="nv">painter</span>
			  <span class="p">(</span><span class="nf">make-vect</span> <span class="mf">0.0</span> <span class="mf">1.0</span><span class="p">)</span>
			  <span class="p">(</span><span class="nf">make-vect</span> <span class="mf">0.0</span> <span class="mf">0.0</span><span class="p">)</span>
			  <span class="p">(</span><span class="nf">make-vect</span> <span class="mf">1.0</span> <span class="mf">1.0</span><span class="p">)))</span>
</pre></div>
</div>
</div>

<div id="outline-container-org98aacce" class="outline-4">
<h4 id="org98aacce">2.51</h4>
<div class="outline-text-4" id="text-org98aacce">
<div class="highlight"><pre><span></span>     <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">below</span> <span class="nv">painter1</span> <span class="nv">painter2</span><span class="p">)</span>
       <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">split-point</span> <span class="p">(</span><span class="nf">make-vect</span> <span class="mf">0.0</span> <span class="mf">0.5</span><span class="p">)))</span>
	 <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">paint-top</span>
		<span class="p">(</span><span class="nf">transform-painter</span> <span class="nv">painter2</span>
				   <span class="nv">split-point</span>
				   <span class="p">(</span><span class="nf">make-vect</span> <span class="mf">1.0</span> <span class="mf">0.5</span><span class="p">)</span>
				   <span class="p">(</span><span class="nf">make-vect</span> <span class="mf">0.0</span> <span class="mf">1.0</span><span class="p">)))</span>
	       <span class="p">(</span><span class="nf">paint-bottom</span>
		<span class="p">(</span><span class="nf">transform-painter</span> <span class="nv">painter1</span>
				   <span class="p">(</span><span class="nf">make-vect</span> <span class="mf">0.0</span> <span class="mf">0.0</span><span class="p">)</span>
				   <span class="p">(</span><span class="nf">make-vect</span> <span class="mf">1.0</span> <span class="mf">0.0</span><span class="p">)</span>
				   <span class="nv">split-point</span><span class="p">)))</span>
	   <span class="p">(</span><span class="k">lambda </span><span class="p">(</span><span class="nf">frame</span><span class="p">)</span>
	     <span class="p">(</span><span class="nf">paint-top</span> <span class="nv">frame</span><span class="p">)</span>
	     <span class="p">(</span><span class="nf">paint-bottom</span> <span class="nv">frame</span><span class="p">)))))</span>

     <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">below</span> <span class="nv">painter1</span> <span class="nv">painter2</span><span class="p">)</span>
       <span class="p">(</span><span class="nf">rotate90</span> <span class="p">(</span><span class="nf">beside</span> <span class="p">(</span><span class="nf">rotate270</span> <span class="nv">painter1</span><span class="p">)</span> <span class="p">(</span><span class="nf">rotate270</span> <span class="nv">painter2</span><span class="p">))))</span>
</pre></div>
</div>
</div>

<div id="outline-container-org9ebde2b" class="outline-4">
<h4 id="org9ebde2b">2.52</h4>
<div class="outline-text-4" id="text-org9ebde2b">
<div class="highlight"><pre><span></span>     <span class="c1">;; a</span>
     <span class="c1">;; 没心情算坐标</span>

     <span class="c1">;; b</span>

     <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">corner-split</span> <span class="nv">painter</span> <span class="nv">n</span><span class="p">)</span>
       <span class="p">(</span><span class="k">if </span><span class="p">(</span><span class="nb">= </span><span class="nv">n</span> <span class="mi">0</span><span class="p">)</span>
	   <span class="nv">painter</span>
	   <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">up</span> <span class="p">(</span><span class="nf">up-split</span> <span class="nv">painter</span> <span class="nv">n</span><span class="p">))</span>
		 <span class="p">(</span><span class="nf">right</span> <span class="p">(</span><span class="nf">right-split</span> <span class="nv">painter</span> <span class="nv">n</span><span class="p">)))</span>
	     <span class="p">(</span><span class="nf">beside</span> <span class="p">(</span><span class="nf">below</span> <span class="nv">painter</span> <span class="nv">up</span><span class="p">)</span>
		     <span class="p">(</span><span class="nf">below</span> <span class="nv">right</span> <span class="p">(</span><span class="nf">corner-split</span> <span class="nv">painter</span> <span class="p">(</span><span class="nb">- </span><span class="nv">n</span> <span class="mi">1</span><span class="p">)))))))</span>

     <span class="c1">;; c</span>

     <span class="p">(</span><span class="k">define </span><span class="p">(</span><span class="nf">square-limit</span> <span class="nv">painter</span> <span class="nv">n</span><span class="p">)</span>
       <span class="p">(</span><span class="k">let </span><span class="p">((</span><span class="nf">combine4</span> <span class="p">((</span><span class="nf">square-of-four</span> <span class="nv">flip-vert</span> <span class="nv">rotate180</span>
					<span class="nv">identity</span> <span class="nv">flip-horiz</span><span class="p">))))</span>
	 <span class="p">(</span><span class="nf">combine4</span> <span class="p">(</span><span class="nf">corner-split</span> <span class="nv">painter</span> <span class="nv">n</span><span class="p">))))</span>
</pre></div>
</div>
</div>
</div>
</div>
            
        
        <div id="disqus_thread"></div>
        <script>
        var disqus_shortname ="https-zero4drift-github-io",
            disqus_url="https://zero4drift.github.io/posts/sicp-refresher-chapter-2%282%29/",
        disqus_title="SICP-Refresher-Chapter-2(2)",
        disqus_identifier="cache/posts/sicp-refresher-chapter-2(2).html",
        disqus_config = function () {
            this.language = "en";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.async = true;
            dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
    <a href="https://disqus.com" class="dsq-brlink" rel="nofollow">Comments powered by <span class="logo-disqus">Disqus</span></a>


        
    


        </div>
    </div>

    
    <footer><div class="container">
            <div class="social">



                <div class="social-entry">
                    <a href="../../rss.xml" target="_blank">
                        <i class="fa fa-rss"></i> 
                    </a>
                </div>
            </div>
                <div class="copyright">
                    Contents © 2018         <a href="mailto:fang0052@e.ntu.edu.sg">zero4drift</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         
                    
                </div>
           
        </div>
    </footer><script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?06e0ade16d98033ac1aad78106d873c8";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script src="../../assets/js/all-nocdn.js" type="text/javascript"></script>
</body>
</html>
