<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# " vocab="http://ogp.me/ns" lang="en">
<head>
<meta charset="utf-8">
<meta name="description" content="Cpp Primer 5th chapter-16 Exercises">
<meta name="viewport" content="width=device-width">
<title>Cpp-Primer-5th-Exercises-Chapter-16 | Procrastination Prescription</title>
<link href="../../assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<link rel="alternate" type="application/rss+xml" title="RSS" href="../../rss.xml">
<link rel="canonical" href="https://zero4drift.github.io/posts/Cpp-Primer-5th-Exercises-Chapter-16/">
<!--[if lt IE 9]><script src="../../assets/js/html5.js"></script><![endif]--><meta name="author" content="zero4drift">
<meta property="og:site_name" content="Procrastination Prescription">
<meta property="og:title" content="Cpp-Primer-5th-Exercises-Chapter-16">
<meta property="og:url" content="https://zero4drift.github.io/posts/Cpp-Primer-5th-Exercises-Chapter-16/">
<meta property="og:description" content="Cpp Primer 5th chapter-16 Exercises">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2018-07-20T16:47:24+08:00">
<meta property="article:tag" content="C++">
</head>
<body>
    

    <header id="header" class="navbar"><div class="container">
            
    <div class="brand">

        <div class="brand-text">
            <a href="https://zero4drift.github.io/" title="Procrastination Prescription" rel="home">
                Procrastination Prescription
            </a>
        </div>

        <a id="btn-toggle-nav" class="navbar-toggle">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </a>
    </div>

            
    <nav class="navbar-collapse collapse"><ul class="nav">
<li><a href="../../archive.html">Archive</a></li>
                <li><a href="https://github.com/zero4drift">Github</a></li>
                <li><a href="../../categories/">Tags</a></li>
                <li><a href="../../rss.xml">RSS feed</a></li>
    
    
    </ul></nav>
</div>
    </header><div class="header-padding"> </div>

    
    <div class="post-header">
        <div class="container">
            <div class="title">
                Cpp-Primer-5th-Exercises-Chapter-16
            </div>
        </div>
    </div>

    <div class="post-meta">
      <div class="container">
	<div class="meta clearfix">
	  <div class="authordate">
	    <time class="timeago" datetime="2018-07-20T16:47:24+08:00">2018/07/20</time>
</div>
	  <div class="post-tags">
	    <div class="tag">
	      <a href="../../categories/c%2B%2B/" rel="tag">C++</a>
	    </div>
	  </div>
	</div>
      </div>
    </div>
    
    
    <div id="post-main" class="main">
        <div class="container">
        <div id="outline-container-orgbd1ea15" class="outline-2">
<h2 id="orgbd1ea15">Exercise 16.1</h2>
<div class="outline-text-2" id="text-orgbd1ea15">
<div class="highlight"><pre><span></span><span class="c1">// instantiate</span>
<span class="c1">// generate a spedified version of function or class based on template and passed in template arguments.</span>
</pre></div>
</div>
</div>

<div id="outline-container-org0f32cc7" class="outline-2">
<h2 id="org0f32cc7">Exercise 16.2</h2>
<div class="outline-text-2" id="text-org0f32cc7">
<div class="highlight"><pre><span></span><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
<span class="kt">int</span> <span class="n">compare</span><span class="p">(</span><span class="k">const</span> <span class="n">T</span> <span class="o">&amp;</span><span class="n">v1</span><span class="p">,</span> <span class="k">const</span> <span class="n">T</span> <span class="o">&amp;</span><span class="n">v2</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span><span class="p">(</span><span class="n">v1</span> <span class="o">&lt;</span> <span class="n">v2</span><span class="p">)</span> <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="n">v2</span> <span class="o">&lt;</span> <span class="n">v1</span><span class="p">)</span> <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">compare</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
  <span class="c1">// compare(Sales_data(), Sales_data());</span>
  <span class="c1">// compiler error:</span>
  <span class="c1">// ...</span>
  <span class="c1">// no match for 'operator&lt;' ...</span>
<span class="p">}</span>
</pre></div>
</div>
</div>

<div id="outline-container-org5161d19" class="outline-2">
<h2 id="org5161d19">Exercise 16.3</h2>
<div class="outline-text-2" id="text-org5161d19">
<div class="highlight"><pre><span></span><span class="c1">// See 16.2.cpp</span>
</pre></div>
</div>
</div>

<div id="outline-container-org8c3efa7" class="outline-2">
<h2 id="org8c3efa7">16.2.cpp</h2>
<div class="outline-text-2" id="text-org8c3efa7">
<div class="highlight"><pre><span></span><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
<span class="kt">int</span> <span class="n">compare</span><span class="p">(</span><span class="k">const</span> <span class="n">T</span> <span class="o">&amp;</span><span class="n">v1</span><span class="p">,</span> <span class="k">const</span> <span class="n">T</span> <span class="o">&amp;</span><span class="n">v2</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span><span class="p">(</span><span class="n">v1</span> <span class="o">&lt;</span> <span class="n">v2</span><span class="p">)</span> <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="n">v2</span> <span class="o">&lt;</span> <span class="n">v1</span><span class="p">)</span> <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">compare</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
  <span class="c1">// compare(Sales_data(), Sales_data());</span>
  <span class="c1">// compiler error:</span>
  <span class="c1">// ...</span>
  <span class="c1">// no match for 'operator&lt;' ...</span>
<span class="p">}</span>
</pre></div>
</div>
</div>

<div id="outline-container-orgd63e175" class="outline-2">
<h2 id="orgd63e175">Exercise 16.4</h2>
<div class="outline-text-2" id="text-orgd63e175">
<div class="highlight"><pre><span></span><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">It</span><span class="p">,</span> <span class="k">typename</span> <span class="n">T2</span><span class="o">&gt;</span>
<span class="n">It</span> <span class="n">new_find</span><span class="p">(</span><span class="n">It</span> <span class="n">it1</span><span class="p">,</span> <span class="n">It</span> <span class="n">it2</span><span class="p">,</span> <span class="k">const</span> <span class="n">T2</span> <span class="o">&amp;</span><span class="n">var</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">while</span><span class="p">(</span><span class="n">it1</span> <span class="o">!=</span> <span class="n">it2</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span><span class="o">*</span><span class="n">it1</span> <span class="o">==</span> <span class="n">var</span><span class="p">)</span>
      <span class="k">return</span> <span class="n">it1</span><span class="p">;</span>
      <span class="k">else</span>
      <span class="o">++</span><span class="n">it1</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="k">return</span> <span class="n">it2</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">vi</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">};</span>
  <span class="n">list</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">li</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">};</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="o">*</span><span class="n">new_find</span><span class="p">(</span><span class="n">vi</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">vi</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="mi">3</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>

<div id="outline-container-org5e0ce34" class="outline-2">
<h2 id="org5e0ce34">Exercise 16.5</h2>
<div class="outline-text-2" id="text-org5e0ce34">
<div class="highlight"><pre><span></span><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T1</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="n">N</span><span class="o">&gt;</span>
<span class="kt">void</span> <span class="n">print</span><span class="p">(</span><span class="k">const</span> <span class="n">T1</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">array</span><span class="p">)[</span><span class="n">N</span><span class="p">])</span>
<span class="p">{</span>
  <span class="k">for</span><span class="p">(</span><span class="kt">unsigned</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">N</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">array</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="s">" "</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">a</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">};</span>
  <span class="n">print</span><span class="p">(</span><span class="n">a</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>

<div id="outline-container-orga817c30" class="outline-2">
<h2 id="orga817c30">Exercise 16.6</h2>
<div class="outline-text-2" id="text-orga817c30">
<div class="highlight"><pre><span></span><span class="c1">// begin function which accepts an array argument returns the pointer points to the first element of array;</span>
<span class="c1">// end function returns the pointer points to the tail off element of array.</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T1</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="n">N</span><span class="o">&gt;</span>
<span class="k">const</span> <span class="n">T1</span> <span class="o">*</span><span class="n">new_begin</span><span class="p">(</span><span class="k">const</span> <span class="n">T1</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">array</span><span class="p">)[</span><span class="n">N</span><span class="p">])</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="n">array</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T1</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="n">N</span><span class="o">&gt;</span>
<span class="k">const</span> <span class="n">T1</span> <span class="o">*</span><span class="n">new_end</span><span class="p">(</span><span class="k">const</span> <span class="n">T1</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">array</span><span class="p">)[</span><span class="n">N</span><span class="p">])</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="n">new_begin</span><span class="p">(</span><span class="n">array</span><span class="p">)</span> <span class="o">+</span> <span class="n">N</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">a</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">};</span>
  <span class="k">for</span><span class="p">(</span><span class="k">auto</span> <span class="n">first</span> <span class="o">=</span> <span class="n">new_begin</span><span class="p">(</span><span class="n">a</span><span class="p">);</span> <span class="n">first</span> <span class="o">!=</span> <span class="n">new_end</span><span class="p">(</span><span class="n">a</span><span class="p">);</span> <span class="o">++</span><span class="n">first</span><span class="p">)</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="o">*</span><span class="n">first</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>

<div id="outline-container-org861804a" class="outline-2">
<h2 id="org861804a">Exercise 16.7</h2>
<div class="outline-text-2" id="text-org861804a">
<div class="highlight"><pre><span></span><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="n">N</span><span class="o">&gt;</span>
<span class="k">constexpr</span> <span class="kt">unsigned</span> <span class="n">number</span><span class="p">(</span><span class="k">const</span> <span class="n">T</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">array</span><span class="p">)[</span><span class="n">N</span><span class="p">])</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="n">N</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">a</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">};</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">number</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>

<div id="outline-container-orge8bbc10" class="outline-2">
<h2 id="orge8bbc10">Exercise 16.8</h2>
<div class="outline-text-2" id="text-orge8bbc10">
<div class="highlight"><pre><span></span><span class="c1">// Because overload '!=' operator is more widely implemented in C++ standard library class types than overload '&lt;' operator;</span>
<span class="c1">// then when define a template which would compare two objects, code assumes that passed in arguments'type supports specified relationship operator, use '!=' operator is safer than '&lt;'.</span>
</pre></div>
</div>
</div>

<div id="outline-container-orga59d668" class="outline-2">
<h2 id="orga59d668">Exercise 16.9</h2>
<div class="outline-text-2" id="text-orga59d668">
<div class="highlight"><pre><span></span><span class="c1">// function template</span>
<span class="c1">// protype of function, could instantiate a specified version of function based on type and nontype arguments;</span>
<span class="c1">// class template</span>
<span class="c1">// protype of class, could instantiate a specified version of class based on type and nontype arguments;</span>
<span class="c1">// while compiler could not deduce the template parameter types for a class template;</span>
<span class="c1">// we must provide every additional information the template needs.</span>
</pre></div>
</div>
</div>

<div id="outline-container-orgc58dccb" class="outline-2">
<h2 id="orgc58dccb">Exercise 16.10</h2>
<div class="outline-text-2" id="text-orgc58dccb">
<div class="highlight"><pre><span></span><span class="c1">// When a class template is instantiated:</span>
<span class="c1">// rewrite template, every instance of template type parameters would be replaced by given template type arguments, generate an individual class based on given template arguments;</span>
<span class="c1">// member functions of class template would be instantiated until they are called in program.</span>
</pre></div>
</div>
</div>

<div id="outline-container-org2c35f40" class="outline-2">
<h2 id="org2c35f40">Exercise 16.11</h2>
<div class="outline-text-2" id="text-org2c35f40">
<div class="highlight"><pre><span></span><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">elemType</span><span class="o">&gt;</span> <span class="k">class</span> <span class="nc">ListItem</span><span class="p">;</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">elemType</span><span class="o">&gt;</span> <span class="k">class</span> <span class="nc">List</span>
<span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
  <span class="n">List</span><span class="o">&lt;</span><span class="n">elemType</span><span class="o">&gt;</span><span class="p">();</span>
  <span class="n">List</span><span class="o">&lt;</span><span class="n">elemType</span><span class="o">&gt;</span><span class="p">(</span><span class="k">const</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">elemType</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="p">);</span>
  <span class="n">List</span><span class="o">&lt;</span><span class="n">elemType</span><span class="o">&gt;&amp;</span> <span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">elemType</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="p">);</span>
  <span class="o">~</span><span class="n">List</span><span class="p">();</span>
  <span class="kt">void</span> <span class="nf">insert</span><span class="p">(</span><span class="n">ListItem</span><span class="o">&lt;</span><span class="n">elemType</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">ptr</span><span class="p">,</span> <span class="n">elemType</span> <span class="n">value</span><span class="p">);</span>
<span class="k">private</span><span class="o">:</span>
  <span class="n">ListItem</span><span class="o">&lt;</span><span class="n">elemType</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">front</span><span class="p">,</span> <span class="o">*</span><span class="n">end</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
</div>

<div id="outline-container-org0d86e52" class="outline-2">
<h2 id="org0d86e52">Exercise 16.12</h2>
<div class="outline-text-2" id="text-org0d86e52">
<div class="highlight"><pre><span></span><span class="c1">// See Blob.h</span>
</pre></div>
</div>
</div>

<div id="outline-container-orga480e2d" class="outline-2">
<h2 id="orga480e2d">Blob.h</h2>
<div class="outline-text-2" id="text-orga480e2d">
<div class="highlight"><pre><span></span><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span> <span class="k">class</span> <span class="nc">BlobPtr</span><span class="p">;</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span> <span class="k">class</span> <span class="nc">Blob</span>
<span class="p">{</span>
  <span class="k">friend</span> <span class="k">class</span> <span class="nc">BlobPtr</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">;</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="k">using</span> <span class="n">sh</span> <span class="o">=</span> <span class="n">My_shared_ptr</span><span class="o">&lt;</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span><span class="p">;</span>
  <span class="k">typedef</span> <span class="k">typename</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::</span><span class="n">size_type</span> <span class="n">size_type</span><span class="p">;</span>
  <span class="n">Blob</span><span class="p">();</span>
  <span class="n">Blob</span><span class="p">(</span><span class="n">initializer_list</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">il</span><span class="p">);</span>
  <span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">It</span><span class="o">&gt;</span> <span class="n">Blob</span><span class="p">(</span><span class="n">It</span> <span class="n">it1</span><span class="p">,</span> <span class="n">It</span> <span class="n">it2</span><span class="p">);</span>
  <span class="n">size_type</span> <span class="nf">size</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span><span class="k">return</span> <span class="n">data</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">();}</span>
  <span class="kt">bool</span> <span class="nf">empty</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span><span class="k">return</span> <span class="n">data</span><span class="o">-&gt;</span><span class="n">empty</span><span class="p">();}</span>
  <span class="kt">void</span> <span class="nf">push_back</span><span class="p">(</span><span class="k">const</span> <span class="n">T</span> <span class="o">&amp;</span><span class="n">t</span><span class="p">)</span> <span class="p">{</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">push_back</span><span class="p">(</span><span class="n">t</span><span class="p">);}</span>
  <span class="kt">void</span> <span class="nf">push_back</span><span class="p">(</span><span class="n">T</span> <span class="o">&amp;&amp;</span><span class="n">t</span><span class="p">)</span> <span class="p">{</span><span class="n">data</span><span class="o">-&gt;</span><span class="n">push_back</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">t</span><span class="p">));}</span>
  <span class="kt">void</span> <span class="nf">pop_back</span><span class="p">();</span>
  <span class="n">T</span> <span class="o">&amp;</span><span class="n">front</span><span class="p">();</span>
  <span class="k">const</span> <span class="n">T</span> <span class="o">&amp;</span><span class="n">front</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
  <span class="n">T</span> <span class="o">&amp;</span><span class="n">back</span><span class="p">();</span>
  <span class="k">const</span> <span class="n">T</span> <span class="o">&amp;</span><span class="n">back</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
  <span class="n">T</span> <span class="o">&amp;</span><span class="k">operator</span><span class="p">[](</span><span class="n">size_type</span> <span class="n">i</span><span class="p">);</span>
  <span class="n">BlobPtr</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">begin</span><span class="p">();</span>
  <span class="n">BlobPtr</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">end</span><span class="p">();</span>
 <span class="k">private</span><span class="o">:</span>
  <span class="n">sh</span> <span class="n">data</span><span class="p">;</span>
  <span class="kt">void</span> <span class="nf">check</span><span class="p">(</span><span class="n">size_type</span> <span class="n">i</span><span class="p">,</span> <span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="n">msg</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
<span class="p">};</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span> <span class="n">Blob</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::</span><span class="n">Blob</span><span class="p">()</span><span class="o">:</span> <span class="n">data</span><span class="p">(</span><span class="n">sh</span><span class="p">())</span> <span class="p">{}</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span> <span class="n">Blob</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::</span><span class="n">Blob</span><span class="p">(</span><span class="n">initializer_list</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">il</span><span class="p">)</span><span class="o">:</span>
<span class="n">data</span><span class="p">(</span><span class="n">sh</span><span class="p">(</span><span class="n">il</span><span class="p">))</span> <span class="p">{}</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">It</span><span class="o">&gt;</span>
<span class="n">Blob</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::</span><span class="n">Blob</span><span class="p">(</span><span class="n">It</span> <span class="n">it1</span><span class="p">,</span> <span class="n">It</span> <span class="n">it2</span><span class="p">)</span><span class="o">:</span> <span class="n">data</span><span class="p">(</span><span class="n">sh</span><span class="p">(</span><span class="n">it1</span><span class="p">,</span> <span class="n">it2</span><span class="p">))</span> <span class="p">{}</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span> <span class="kt">void</span> <span class="n">Blob</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::</span><span class="n">check</span><span class="p">(</span><span class="n">size_type</span> <span class="n">i</span><span class="p">,</span> <span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="n">msg</span><span class="p">)</span> <span class="k">const</span>
<span class="p">{</span>
  <span class="k">if</span><span class="p">(</span><span class="n">i</span> <span class="o">&gt;=</span> <span class="n">data</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">())</span>
    <span class="k">throw</span> <span class="n">out_of_range</span><span class="p">(</span><span class="n">msg</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span> <span class="n">T</span><span class="o">&amp;</span> <span class="n">Blob</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::</span><span class="n">front</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">check</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s">"front on empty Blob"</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">data</span><span class="o">-&gt;</span><span class="n">front</span><span class="p">();</span>
<span class="p">}</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span> <span class="k">const</span> <span class="n">T</span> <span class="o">&amp;</span><span class="n">Blob</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::</span><span class="n">front</span><span class="p">()</span> <span class="k">const</span>
<span class="p">{</span>
  <span class="n">check</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s">"front on empty Blob"</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">data</span><span class="o">-&gt;</span><span class="n">front</span><span class="p">();</span>
<span class="p">}</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span> <span class="n">T</span> <span class="o">&amp;</span><span class="n">Blob</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::</span><span class="n">back</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">check</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s">"badk on empty Blob"</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">data</span><span class="o">-&gt;</span><span class="n">back</span><span class="p">();</span>
<span class="p">}</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span> <span class="k">const</span> <span class="n">T</span> <span class="o">&amp;</span><span class="n">Blob</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::</span><span class="n">back</span><span class="p">()</span> <span class="k">const</span>
<span class="p">{</span>
  <span class="n">check</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s">"back on empty Blob"</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">data</span><span class="o">-&gt;</span><span class="n">back</span><span class="p">();</span>
<span class="p">}</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span> <span class="n">T</span> <span class="o">&amp;</span><span class="n">Blob</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::</span><span class="k">operator</span><span class="p">[](</span><span class="n">size_type</span> <span class="n">i</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">check</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="s">"subscript out of range"</span><span class="p">);</span>
  <span class="k">return</span> <span class="p">(</span><span class="o">*</span><span class="n">data</span><span class="p">)[</span><span class="n">i</span><span class="p">];</span>
<span class="p">}</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span> <span class="kt">bool</span> <span class="k">operator</span><span class="o">==</span><span class="p">(</span><span class="k">const</span> <span class="n">BlobPtr</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">,</span> <span class="k">const</span> <span class="n">BlobPtr</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">wptr</span><span class="p">.</span><span class="n">lock</span><span class="p">()</span> <span class="o">==</span> <span class="n">b</span><span class="p">.</span><span class="n">wptr</span><span class="p">.</span><span class="n">lock</span><span class="p">())</span>
    <span class="p">{</span>
      <span class="k">throw</span> <span class="n">runtime_error</span><span class="p">(</span><span class="s">"ptrs to different Blobs!"</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="k">return</span> <span class="n">a</span><span class="p">.</span><span class="n">curr</span> <span class="o">==</span> <span class="n">b</span><span class="p">.</span><span class="n">curr</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span> <span class="kt">bool</span> <span class="k">operator</span><span class="o">&lt;</span> <span class="p">(</span><span class="k">const</span> <span class="n">BlobPtr</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">,</span> <span class="k">const</span> <span class="n">BlobPtr</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">wptr</span><span class="p">.</span><span class="n">lock</span><span class="p">()</span> <span class="o">!=</span> <span class="n">rhs</span><span class="p">.</span><span class="n">wptr</span><span class="p">.</span><span class="n">lock</span><span class="p">())</span>
    <span class="p">{</span>
      <span class="k">throw</span> <span class="n">runtime_error</span><span class="p">(</span><span class="s">"ptrs to different Blobs!"</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="k">return</span> <span class="n">a</span><span class="p">.</span><span class="n">curr</span> <span class="o">&lt;</span> <span class="n">b</span><span class="p">.</span><span class="n">curr</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span> <span class="k">class</span> <span class="nc">BlobPtr</span>
<span class="p">{</span>
  <span class="k">friend</span> <span class="kt">bool</span> <span class="k">operator</span><span class="o">==&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">(</span><span class="k">const</span> <span class="n">BlobPtr</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="p">,</span> <span class="k">const</span> <span class="n">BlobPtr</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="p">);</span>
  <span class="k">friend</span> <span class="kt">bool</span> <span class="k">operator</span><span class="o">&lt;</span> <span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span>
    <span class="p">(</span><span class="k">const</span> <span class="n">BlobPtr</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="p">,</span> <span class="k">const</span> <span class="n">BlobPtr</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="p">);</span>
 <span class="k">public</span><span class="o">:</span>
 <span class="n">BlobPtr</span><span class="p">()</span><span class="o">:</span> <span class="n">curr</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">{}</span>
 <span class="n">BlobPtr</span><span class="p">(</span><span class="n">Blob</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">a</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">sz</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span><span class="o">:</span> <span class="n">wptr</span><span class="p">(</span><span class="n">a</span><span class="p">.</span><span class="n">data</span><span class="p">),</span> <span class="n">curr</span><span class="p">(</span><span class="n">sz</span><span class="p">)</span> <span class="p">{}</span>
  <span class="n">T</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">*</span><span class="p">()</span> <span class="k">const</span>
    <span class="p">{</span>
      <span class="k">auto</span> <span class="n">p</span> <span class="o">=</span> <span class="n">check</span><span class="p">(</span><span class="n">curr</span><span class="p">,</span> <span class="s">"dereference past end"</span><span class="p">);</span>
      <span class="k">return</span> <span class="p">(</span><span class="o">*</span><span class="n">p</span><span class="p">)[</span><span class="n">curr</span><span class="p">];</span>
    <span class="p">}</span>
  <span class="n">BlobPtr</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">++</span><span class="p">();</span>
  <span class="n">BlobPtr</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">--</span><span class="p">();</span>
 <span class="k">private</span><span class="o">:</span>
  <span class="n">My_shared_ptr</span><span class="o">&lt;</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span> <span class="n">check</span><span class="p">(</span><span class="kt">size_t</span><span class="p">,</span><span class="k">const</span> <span class="n">string</span><span class="o">&amp;</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
  <span class="n">weak_ptr</span><span class="o">&lt;</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span> <span class="n">wptr</span><span class="p">;</span>
  <span class="kt">size_t</span> <span class="n">curr</span><span class="p">;</span>
<span class="p">};</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
<span class="n">BlobPtr</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">BlobPtr</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::</span><span class="k">operator</span><span class="o">++</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">check</span><span class="p">(</span><span class="n">curr</span><span class="p">,</span> <span class="s">"increment past end of StrBlobPtr"</span><span class="p">);</span>
  <span class="o">++</span><span class="n">curr</span><span class="p">;</span>
  <span class="k">return</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
<span class="n">BlobPtr</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">BlobPtr</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::</span><span class="k">operator</span><span class="o">--</span><span class="p">()</span>
<span class="p">{</span>
  <span class="o">--</span><span class="n">curr</span><span class="p">;</span>
  <span class="n">check</span><span class="p">(</span><span class="n">curr</span><span class="p">,</span> <span class="s">"increment past end of StrBlobPtr"</span><span class="p">);</span>
  <span class="k">return</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span> <span class="n">My_shared_ptr</span><span class="o">&lt;</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span> <span class="n">BlobPtr</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::</span><span class="n">check</span><span class="p">(</span><span class="kt">size_t</span> <span class="n">i</span><span class="p">,</span> <span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="n">msg</span><span class="p">)</span> <span class="k">const</span>
<span class="p">{</span>
  <span class="k">auto</span> <span class="n">ret</span> <span class="o">=</span> <span class="n">wptr</span><span class="p">.</span><span class="n">lock</span><span class="p">();</span>
  <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">ret</span><span class="p">)</span>
    <span class="k">throw</span> <span class="n">runtime_error</span><span class="p">(</span><span class="s">"unbound BlobPtr"</span><span class="p">);</span>
  <span class="k">if</span><span class="p">(</span><span class="n">i</span> <span class="o">&gt;=</span> <span class="n">ret</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">())</span>
    <span class="k">throw</span> <span class="n">out_of_range</span><span class="p">(</span><span class="n">msg</span><span class="p">);</span>
  <span class="k">return</span> <span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>

<div id="outline-container-orgbf24eda" class="outline-2">
<h2 id="orgbf24eda">Exercise 16.13</h2>
<div class="outline-text-2" id="text-orgbf24eda">
<div class="highlight"><pre><span></span><span class="c1">// See Blob.h.</span>
<span class="c1">// overload '==' operator function is a friend to BlobPtr class which is instantiated by the same type applied in the instantiation of this operator function.</span>
</pre></div>

<p>
<a href="#orga480e2d">Blob.h</a>
</p>
</div>
</div>

<div id="outline-container-org3a3a36a" class="outline-2">
<h2 id="org3a3a36a">Exercise 16.14</h2>
<div class="outline-text-2" id="text-org3a3a36a">
<div class="highlight"><pre><span></span><span class="c1">// See Screen.h.</span>
</pre></div>
</div>
</div>

<div id="outline-container-org78fff3b" class="outline-2">
<h2 id="org78fff3b">Screen.h</h2>
<div class="outline-text-2" id="text-org78fff3b">
<div class="highlight"><pre><span></span><span class="k">template</span> <span class="o">&lt;</span><span class="kt">unsigned</span> <span class="n">L</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="n">W</span><span class="o">&gt;</span> <span class="k">class</span> <span class="nc">Screen</span><span class="p">;</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="kt">unsigned</span> <span class="n">L</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="n">W</span><span class="o">&gt;</span> <span class="n">ostream</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="n">ostream</span> <span class="o">&amp;</span><span class="n">os</span><span class="p">,</span> <span class="n">Screen</span><span class="o">&lt;</span><span class="n">L</span><span class="p">,</span> <span class="n">W</span><span class="o">&gt;</span> <span class="n">s</span><span class="p">){</span>
  <span class="n">os</span> <span class="o">&lt;&lt;</span> <span class="s">"Length "</span> <span class="o">&lt;&lt;</span> <span class="n">s</span><span class="p">.</span><span class="n">length</span>
       <span class="o">&lt;&lt;</span> <span class="s">"Width "</span> <span class="o">&lt;&lt;</span> <span class="n">s</span><span class="p">.</span><span class="n">width</span><span class="p">;</span>
  <span class="k">return</span> <span class="n">os</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="kt">unsigned</span> <span class="n">L</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="n">W</span><span class="o">&gt;</span> <span class="n">istream</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="n">istream</span> <span class="o">&amp;</span><span class="n">is</span><span class="p">,</span> <span class="n">Screen</span><span class="o">&lt;</span><span class="n">L</span><span class="p">,</span> <span class="n">W</span><span class="o">&gt;</span> <span class="n">s</span><span class="p">){</span>
  <span class="n">is</span> <span class="o">&gt;&gt;</span> <span class="n">s</span><span class="p">.</span><span class="n">length</span> <span class="o">&gt;&gt;</span> <span class="n">s</span><span class="p">.</span><span class="n">width</span><span class="p">;</span>
  <span class="k">return</span> <span class="n">is</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="kt">unsigned</span> <span class="n">L</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="n">W</span><span class="o">&gt;</span>
<span class="k">class</span> <span class="nc">Screen</span>
<span class="p">{</span>
  <span class="c1">// operator&lt;&lt; access private member of instance of this template</span>
  <span class="c1">// both class and function instantiated by same template nontype arguments.</span>
  <span class="k">friend</span> <span class="n">ostream</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">&lt;&lt;&lt;</span><span class="n">L</span><span class="p">,</span> <span class="n">W</span><span class="o">&gt;</span><span class="p">(</span><span class="n">ostream</span> <span class="o">&amp;</span><span class="p">,</span> <span class="n">Screen</span><span class="o">&lt;</span><span class="n">L</span><span class="p">,</span> <span class="n">W</span><span class="o">&gt;</span><span class="p">);</span>
  <span class="c1">// operator&gt;&gt; access private member of instance of this template</span>
  <span class="c1">// both class and function instantiated by same template nontype arguments.</span>
  <span class="k">friend</span> <span class="n">istream</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">&gt;&gt;&lt;</span><span class="n">L</span><span class="p">,</span> <span class="n">W</span><span class="o">&gt;</span><span class="p">(</span><span class="n">istream</span> <span class="o">&amp;</span><span class="p">,</span> <span class="n">Screen</span><span class="o">&lt;</span><span class="n">L</span><span class="p">,</span> <span class="n">W</span><span class="o">&gt;</span><span class="p">);</span>
  <span class="kt">unsigned</span> <span class="n">lenth</span> <span class="o">=</span> <span class="n">L</span><span class="p">;</span>
  <span class="kt">unsigned</span> <span class="n">width</span> <span class="o">=</span> <span class="n">W</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
</div>

<div id="outline-container-org5aa0298" class="outline-2">
<h2 id="org5aa0298">Exercise 16.15</h2>
<div class="outline-text-2" id="text-org5aa0298">
<div class="highlight"><pre><span></span><span class="c1">// See Screen.h.</span>
</pre></div>

<p>
<a href="#org78fff3b">Screen.h</a>
</p>
</div>
</div>

<div id="outline-container-org5e85105" class="outline-2">
<h2 id="org5e85105">Exercise 16.16</h2>
<div class="outline-text-2" id="text-org5e85105">
<div class="highlight"><pre><span></span><span class="c1">// See StrVec.h.</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">Vec</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">vi1</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">};</span>
  <span class="n">Vec</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">vi2</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">};</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">vi1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">vi1</span> <span class="o">==</span> <span class="n">vi2</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>

<div id="outline-container-org8a607f1" class="outline-2">
<h2 id="org8a607f1">StrVec.h</h2>
<div class="outline-text-2" id="text-org8a607f1">
<div class="highlight"><pre><span></span><span class="cp">#ifndef STRVEC_H</span>
<span class="cp">#define STRVEC_H</span>
<span class="k">class</span> <span class="nc">StrVec</span>
<span class="p">{</span>
  <span class="k">friend</span> <span class="kt">bool</span> <span class="k">operator</span><span class="o">==</span><span class="p">(</span><span class="k">const</span> <span class="n">StrVec</span> <span class="o">&amp;</span><span class="p">,</span> <span class="k">const</span> <span class="n">StrVec</span> <span class="o">&amp;</span><span class="p">);</span>
  <span class="k">friend</span> <span class="kt">bool</span> <span class="k">operator</span><span class="o">!=</span><span class="p">(</span><span class="k">const</span> <span class="n">StrVec</span> <span class="o">&amp;</span><span class="p">,</span> <span class="k">const</span> <span class="n">StrVec</span> <span class="o">&amp;</span><span class="p">);</span>
  <span class="k">friend</span> <span class="kt">bool</span> <span class="k">operator</span><span class="o">&lt;</span><span class="p">(</span><span class="k">const</span> <span class="n">StrVec</span> <span class="o">&amp;</span><span class="p">,</span> <span class="k">const</span> <span class="n">StrVec</span> <span class="o">&amp;</span><span class="p">);</span>
 <span class="k">public</span><span class="o">:</span>
 <span class="n">StrVec</span><span class="p">()</span><span class="o">:</span> <span class="n">elements</span><span class="p">(</span><span class="k">nullptr</span><span class="p">),</span> <span class="n">first_free</span><span class="p">(</span><span class="k">nullptr</span><span class="p">),</span> <span class="n">cap</span><span class="p">(</span><span class="k">nullptr</span><span class="p">)</span> <span class="p">{}</span>
  <span class="n">StrVec</span><span class="p">(</span><span class="k">const</span> <span class="n">StrVec</span> <span class="o">&amp;</span><span class="p">);</span>
  <span class="n">StrVec</span><span class="p">(</span><span class="n">StrVec</span> <span class="o">&amp;&amp;</span><span class="p">)</span> <span class="k">noexcept</span><span class="p">;</span>
  <span class="n">StrVec</span><span class="p">(</span><span class="k">const</span> <span class="n">initializer_list</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">is</span><span class="p">);</span>
  <span class="n">StrVec</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">StrVec</span> <span class="o">&amp;</span><span class="p">);</span>
  <span class="n">StrVec</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="n">StrVec</span> <span class="o">&amp;&amp;</span><span class="p">)</span> <span class="k">noexcept</span><span class="p">;</span>
  <span class="n">StrVec</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">initializer_list</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="p">);</span>
  <span class="n">string</span> <span class="o">&amp;</span><span class="k">operator</span><span class="p">[](</span><span class="kt">size_t</span> <span class="n">n</span><span class="p">);</span>
  <span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="k">operator</span><span class="p">[](</span><span class="kt">size_t</span> <span class="n">n</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
  <span class="o">~</span><span class="n">StrVec</span><span class="p">();</span>
  <span class="kt">void</span> <span class="nf">push_back</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="p">);</span>
  <span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span><span class="p">...</span> <span class="n">Args</span><span class="o">&gt;</span> <span class="kt">void</span> <span class="n">emplace_back</span><span class="p">(</span><span class="n">Args</span><span class="o">&amp;&amp;</span><span class="p">...);</span>
  <span class="kt">size_t</span> <span class="nf">size</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span><span class="k">return</span> <span class="n">first_free</span> <span class="o">-</span> <span class="n">elements</span><span class="p">;}</span>
  <span class="kt">size_t</span> <span class="nf">capacity</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span><span class="k">return</span> <span class="n">cap</span> <span class="o">-</span> <span class="n">elements</span><span class="p">;}</span>
  <span class="kt">void</span> <span class="nf">reserve</span><span class="p">(</span><span class="kt">size_t</span><span class="p">);</span>
  <span class="kt">void</span> <span class="nf">resize</span><span class="p">(</span><span class="kt">size_t</span> <span class="n">n</span><span class="p">,</span> <span class="n">string</span> <span class="n">s</span> <span class="o">=</span> <span class="s">""</span><span class="p">);</span>
  <span class="n">string</span> <span class="o">*</span><span class="nf">begin</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span><span class="k">return</span> <span class="n">elements</span><span class="p">;}</span>
  <span class="n">string</span> <span class="o">*</span><span class="nf">end</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span><span class="k">return</span> <span class="n">first_free</span><span class="p">;}</span>
 <span class="k">private</span><span class="o">:</span>
  <span class="n">allocator</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">alloc</span><span class="p">;</span> <span class="cm">/* it using static, 'undefined reference' reported when compile */</span>
  <span class="kt">void</span> <span class="nf">chk_n_alloc</span><span class="p">()</span>
  <span class="p">{</span><span class="k">if</span><span class="p">(</span><span class="n">size</span><span class="p">()</span> <span class="o">==</span> <span class="n">capacity</span><span class="p">())</span> <span class="n">reallocate</span><span class="p">();}</span>
  <span class="n">pair</span><span class="o">&lt;</span><span class="n">string</span> <span class="o">*</span><span class="p">,</span> <span class="n">string</span> <span class="o">*&gt;</span> <span class="n">alloc_n_copy</span>
    <span class="p">(</span><span class="k">const</span> <span class="n">string</span> <span class="o">*</span><span class="p">,</span> <span class="k">const</span> <span class="n">string</span> <span class="o">*</span><span class="p">);</span>
  <span class="kt">void</span> <span class="nf">free</span><span class="p">();</span>
  <span class="kt">void</span> <span class="nf">reallocate</span><span class="p">(</span><span class="kt">size_t</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span><span class="p">);</span>
  <span class="n">string</span> <span class="o">*</span><span class="n">elements</span><span class="p">;</span>
  <span class="n">string</span> <span class="o">*</span><span class="n">first_free</span><span class="p">;</span>
  <span class="n">string</span> <span class="o">*</span><span class="n">cap</span><span class="p">;</span>
<span class="p">};</span>
<span class="cp">#endif</span>
</pre></div>
</div>
</div>

<div id="outline-container-org9e8fe8d" class="outline-2">
<h2 id="org9e8fe8d">Exercise 16.17</h2>
<div class="outline-text-2" id="text-org9e8fe8d">
<div class="highlight"><pre><span></span><span class="c1">// There is no difference between keyword typename and class;</span>
<span class="c1">// keyword typename would make template declaration and definition much straighter, for 'typename' could be referred as built-in type or class type, while 'class' is more likely regarded as class type.</span>
</pre></div>
</div>
</div>

<div id="outline-container-org071689f" class="outline-2">
<h2 id="org071689f">Exercise 16.18</h2>
<div class="outline-text-2" id="text-org071689f">
<div class="highlight"><pre><span></span><span class="c1">// (a)</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="p">,</span> <span class="k">typename</span> <span class="n">U</span><span class="p">,</span> <span class="k">typename</span> <span class="n">V</span><span class="o">&gt;</span> <span class="kt">void</span> <span class="n">f1</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">U</span><span class="p">,</span> <span class="n">V</span><span class="p">);</span>
<span class="c1">// (b)</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span> <span class="n">T</span> <span class="n">f2</span><span class="p">(</span><span class="n">T</span> <span class="o">&amp;</span><span class="p">);</span>
<span class="c1">// (c)</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span> <span class="kr">inline</span> <span class="n">T</span> <span class="n">foo</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="kt">unsigned</span> <span class="kt">int</span><span class="o">*</span><span class="p">);</span>
<span class="c1">// (d)</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span> <span class="kt">void</span> <span class="n">f4</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">T</span><span class="p">);</span>
<span class="c1">// (e)</span>
<span class="k">typedef</span> <span class="kt">char</span> <span class="n">Ctype</span><span class="p">;</span>
<span class="c1">// template declaration below hides this typedef</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">Ctype</span><span class="o">&gt;</span> <span class="n">Ctype</span> <span class="n">f5</span><span class="p">(</span><span class="n">Ctype</span> <span class="n">a</span><span class="p">);</span>
</pre></div>
</div>
</div>

<div id="outline-container-org36b9a86" class="outline-2">
<h2 id="org36b9a86">Exercise 16.19</h2>
<div class="outline-text-2" id="text-org36b9a86">
<div class="highlight"><pre><span></span><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span> <span class="n">ostream</span> <span class="o">&amp;</span><span class="n">print_container</span><span class="p">(</span><span class="k">const</span> <span class="n">T</span> <span class="o">&amp;</span><span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">for</span><span class="p">(</span><span class="k">typename</span> <span class="n">T</span><span class="o">::</span><span class="n">size_type</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">c</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">c</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="s">" "</span><span class="p">;</span>
  <span class="k">return</span> <span class="n">cout</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">vi</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">};</span>
  <span class="n">print_container</span><span class="p">(</span><span class="n">vi</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>

<div id="outline-container-orga7f5fab" class="outline-2">
<h2 id="orga7f5fab">Exercise 16.20</h2>
<div class="outline-text-2" id="text-orga7f5fab">
<div class="highlight"><pre><span></span><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span> <span class="n">ostream</span> <span class="o">&amp;</span><span class="n">print_container</span><span class="p">(</span><span class="k">const</span> <span class="n">T</span> <span class="o">&amp;</span><span class="n">c</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">for</span><span class="p">(</span><span class="k">typename</span> <span class="n">T</span><span class="o">::</span><span class="n">const_iterator</span> <span class="n">beg</span> <span class="o">=</span> <span class="n">c</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span> <span class="n">beg</span> <span class="o">!=</span> <span class="n">c</span><span class="p">.</span><span class="n">end</span><span class="p">();</span> <span class="o">++</span><span class="n">beg</span><span class="p">)</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="o">*</span><span class="n">beg</span> <span class="o">&lt;&lt;</span> <span class="s">" "</span><span class="p">;</span>
  <span class="k">return</span> <span class="n">cout</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">vi</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">};</span>
  <span class="n">print_container</span><span class="p">(</span><span class="n">vi</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>

<div id="outline-container-org90b5d51" class="outline-2">
<h2 id="org90b5d51">Exercise 16.21</h2>
<div class="outline-text-2" id="text-org90b5d51">
<div class="highlight"><pre><span></span><span class="c1">// See DebugDelete.h.</span>
</pre></div>
</div>
</div>

<div id="outline-container-orgb1bbeea" class="outline-2">
<h2 id="orgb1bbeea">DebugDelete.h</h2>
<div class="outline-text-2" id="text-orgb1bbeea">
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">DebugDelete</span>
<span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
 <span class="n">DebugDelete</span><span class="p">(</span><span class="n">ostream</span> <span class="o">&amp;</span><span class="n">s</span> <span class="o">=</span> <span class="n">cerr</span><span class="p">)</span><span class="o">:</span> <span class="n">os</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="p">{}</span>
  <span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span> <span class="kt">void</span> <span class="k">operator</span><span class="p">()(</span><span class="n">T</span> <span class="o">*</span><span class="n">p</span><span class="p">)</span> <span class="k">const</span>
    <span class="p">{</span><span class="n">os</span> <span class="o">&lt;&lt;</span> <span class="s">"deleting unique_ptr"</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span> <span class="k">delete</span> <span class="n">p</span><span class="p">;}</span>
 <span class="k">private</span><span class="o">:</span>
  <span class="n">ostream</span> <span class="o">&amp;</span><span class="n">os</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
</div>

<div id="outline-container-orgc6c30af" class="outline-2">
<h2 id="orgc6c30af">Exercise 16.22</h2>
<div class="outline-text-2" id="text-orgc6c30af">
<div class="highlight"><pre><span></span><span class="c1">// See TextQuery.h.</span>
</pre></div>
</div>
</div>

<div id="outline-container-org0e2cde1" class="outline-2">
<h2 id="org0e2cde1">TextQuery.h</h2>
<div class="outline-text-2" id="text-org0e2cde1">
<div class="highlight"><pre><span></span><span class="cp">#ifndef TEXTQUERY_H</span>
<span class="cp">#define TEXTQUERY_H</span>
<span class="k">class</span> <span class="nc">QueryResult</span><span class="p">;</span>
<span class="k">class</span> <span class="nc">TextQuery</span>
<span class="p">{</span>
  <span class="k">friend</span> <span class="n">QueryResult</span><span class="p">;</span>
  <span class="n">My_shared_ptr</span><span class="o">&lt;</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;&gt;</span> <span class="n">sp1</span><span class="p">;</span>
  <span class="n">My_shared_ptr</span><span class="o">&lt;</span><span class="n">map</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span> <span class="n">set</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="o">&gt;&gt;&gt;</span> <span class="n">sp2</span><span class="p">;</span> 
 <span class="k">public</span><span class="o">:</span>
  <span class="n">TextQuery</span><span class="p">(</span><span class="n">ifstream</span> <span class="o">&amp;</span><span class="n">infile</span><span class="p">);</span>
  <span class="n">QueryResult</span> <span class="nf">query</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="n">s</span><span class="p">);</span>
<span class="p">};</span>
<span class="n">TextQuery</span><span class="o">::</span><span class="n">TextQuery</span><span class="p">(</span><span class="n">ifstream</span> <span class="o">&amp;</span><span class="n">infile</span><span class="p">)</span><span class="o">:</span>
<span class="n">sp1</span><span class="p">(</span><span class="k">new</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span><span class="p">(),</span> <span class="n">DebugDelete</span><span class="p">()),</span> <span class="n">sp2</span><span class="p">(</span><span class="k">new</span> <span class="n">map</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span> <span class="n">set</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="o">&gt;&gt;</span><span class="p">(),</span> <span class="n">DebugDelete</span><span class="p">())</span>
<span class="p">{</span>  
  <span class="kt">size_t</span> <span class="n">line_number</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">string</span> <span class="n">line</span><span class="p">;</span>
  <span class="k">while</span><span class="p">(</span><span class="n">getline</span><span class="p">(</span><span class="n">infile</span><span class="p">,</span> <span class="n">line</span><span class="p">))</span>
    <span class="p">{</span>
      <span class="c1">// store line in vector&lt;string&gt;</span>
      <span class="n">sp1</span><span class="o">-&gt;</span><span class="n">push_back</span><span class="p">(</span><span class="n">line</span><span class="p">);</span>
      <span class="c1">// scan through the line      </span>
      <span class="n">istringstream</span> <span class="nf">ist</span><span class="p">(</span><span class="n">line</span><span class="p">);</span>
      <span class="n">string</span> <span class="n">word</span><span class="p">;</span>
      <span class="k">while</span><span class="p">(</span><span class="n">ist</span> <span class="o">&gt;&gt;</span> <span class="n">word</span><span class="p">)</span>
      <span class="p">(</span><span class="o">*</span><span class="n">sp2</span><span class="p">)[</span><span class="n">word</span><span class="p">].</span><span class="n">insert</span><span class="p">(</span><span class="n">line_number</span><span class="p">);</span>
      <span class="c1">// increase the line_number</span>
      <span class="o">++</span><span class="n">line_number</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="k">class</span> <span class="nc">QueryResult</span>
<span class="p">{</span>
  <span class="kt">size_t</span> <span class="n">times</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="n">string</span> <span class="n">search_word</span><span class="p">;</span>
  <span class="n">map</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="p">,</span> <span class="n">string</span><span class="o">&gt;</span> <span class="n">result</span><span class="p">;</span>
  <span class="n">My_shared_ptr</span><span class="o">&lt;</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;&gt;</span> <span class="n">sp1</span><span class="p">;</span>
  <span class="n">My_shared_ptr</span><span class="o">&lt;</span><span class="n">map</span><span class="o">&lt;</span><span class="n">string</span><span class="p">,</span> <span class="n">set</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="o">&gt;&gt;&gt;</span> <span class="n">sp2</span><span class="p">;</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="n">QueryResult</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="n">s</span><span class="p">,</span> <span class="n">TextQuery</span> <span class="o">&amp;</span><span class="n">t</span><span class="p">);</span>
  <span class="kt">size_t</span> <span class="nf">get_times</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span><span class="k">return</span> <span class="n">times</span><span class="p">;}</span>
  <span class="k">const</span> <span class="n">map</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="p">,</span> <span class="n">string</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">get_result</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span><span class="k">return</span> <span class="n">result</span><span class="p">;}</span>
<span class="p">};</span>
<span class="n">QueryResult</span><span class="o">::</span><span class="n">QueryResult</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="n">s</span><span class="p">,</span> <span class="n">TextQuery</span> <span class="o">&amp;</span><span class="n">t</span><span class="p">)</span><span class="o">:</span>
<span class="n">sp1</span><span class="p">(</span><span class="n">t</span><span class="p">.</span><span class="n">sp1</span><span class="p">),</span> <span class="n">sp2</span><span class="p">(</span><span class="n">t</span><span class="p">.</span><span class="n">sp2</span><span class="p">),</span> <span class="n">search_word</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">set</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="o">&gt;</span> <span class="n">line_numbers</span><span class="p">;</span>
  <span class="k">auto</span> <span class="n">iter</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">sp2</span><span class="p">).</span><span class="n">find</span><span class="p">(</span><span class="n">search_word</span><span class="p">);</span>
  <span class="k">auto</span> <span class="n">last</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">sp2</span><span class="p">).</span><span class="n">end</span><span class="p">();</span>
  <span class="k">if</span><span class="p">(</span><span class="n">iter</span> <span class="o">!=</span> <span class="n">last</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="n">line_numbers</span> <span class="o">=</span> <span class="n">iter</span><span class="o">-&gt;</span><span class="n">second</span><span class="p">;</span>
      <span class="k">for</span><span class="p">(</span><span class="k">const</span> <span class="k">auto</span> <span class="o">&amp;</span><span class="nl">n</span> <span class="p">:</span> <span class="n">line_numbers</span><span class="p">)</span>
      <span class="p">{</span>
	<span class="n">result</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">sp1</span><span class="p">)[</span><span class="n">n</span><span class="p">];</span>
	<span class="o">++</span><span class="n">times</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="n">ostream</span> <span class="o">&amp;</span><span class="n">print</span><span class="p">(</span><span class="n">ostream</span> <span class="o">&amp;</span><span class="n">o</span><span class="p">,</span> <span class="k">const</span> <span class="n">QueryResult</span> <span class="o">&amp;</span><span class="n">q</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">o</span> <span class="o">&lt;&lt;</span> <span class="s">"element occurs "</span> <span class="o">&lt;&lt;</span> <span class="n">q</span><span class="p">.</span><span class="n">get_times</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="s">" times"</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="n">q</span><span class="p">.</span><span class="n">get_times</span><span class="p">())</span>
    <span class="p">{</span>
      <span class="k">auto</span> <span class="n">result</span> <span class="o">=</span> <span class="n">q</span><span class="p">.</span><span class="n">get_result</span><span class="p">();</span>
      <span class="k">for</span><span class="p">(</span><span class="k">const</span> <span class="k">auto</span> <span class="o">&amp;</span><span class="nl">p</span> <span class="p">:</span> <span class="n">result</span><span class="p">)</span>
      <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"</span><span class="se">\t</span><span class="s">(line "</span> <span class="o">&lt;&lt;</span> <span class="n">p</span><span class="p">.</span><span class="n">first</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="s">") "</span>
	   <span class="o">&lt;&lt;</span> <span class="n">p</span><span class="p">.</span><span class="n">second</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="k">return</span> <span class="n">o</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">QueryResult</span> <span class="n">TextQuery</span><span class="o">::</span><span class="n">query</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="n">s</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="n">QueryResult</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="o">*</span><span class="k">this</span><span class="p">);</span>
<span class="p">}</span>
<span class="cp">#endif</span>
</pre></div>
</div>
</div>

<div id="outline-container-org1839b50" class="outline-2">
<h2 id="org1839b50">Exercise 16.23</h2>
<div class="outline-text-2" id="text-org1839b50">
<div class="highlight"><pre><span></span><span class="c1">// When the use count of shared_ptr object decreases to 0, operator() member function of DebugDelete class type object would be called to release the resource allocated in dynamic memory.</span>
<span class="c1">// Like, when the query program reaches to the end of function runQueries and returns.</span>
</pre></div>
</div>
</div>

<div id="outline-container-org01a6769" class="outline-2">
<h2 id="org01a6769">Exercise 16.24</h2>
<div class="outline-text-2" id="text-org01a6769">
<div class="highlight"><pre><span></span><span class="c1">// See Blob.h.</span>
</pre></div>

<p>
<a href="#orga480e2d">Blob.h</a>
</p>
</div>
</div>

<div id="outline-container-org8f1619e" class="outline-2">
<h2 id="org8f1619e">Exercise 16.25</h2>
<div class="outline-text-2" id="text-org8f1619e">
<div class="highlight"><pre><span></span><span class="k">extern</span> <span class="k">template</span> <span class="k">class</span> <span class="nc">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">;</span> <span class="c1">// instantiation declaration, the definition of it is somewhere else</span>
<span class="k">template</span> <span class="k">class</span> <span class="nc">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Sales_data</span><span class="o">&gt;</span><span class="p">;</span>		<span class="c1">// instantiation definition, the compiler will generate code fot it. </span>
</pre></div>
</div>
</div>

<div id="outline-container-orgdb52b6f" class="outline-2">
<h2 id="orgdb52b6f">Exercise 16.26</h2>
<div class="outline-text-2" id="text-orgdb52b6f">
<div class="highlight"><pre><span></span><span class="c1">// No;</span>
<span class="c1">// explicit instantiation of 'template &lt;typename T&gt; vector&lt;T&gt;' would instantiates every member of this class;</span>
<span class="c1">// for some constructors of class vector&lt;T&gt; would call class T's default constructor, this requiers that type T owns a default constructor;</span>
<span class="c1">// if there is no default constructor defined within class NoDefault, corresponding constructor as member function could not be instantiated;</span>
<span class="c1">// then this explicit instantiation failed.</span>
</pre></div>
</div>
</div>

<div id="outline-container-org1be545f" class="outline-2">
<h2 id="org1be545f">Exercise 16.27</h2>
<div class="outline-text-2" id="text-org1be545f">
<div class="highlight"><pre><span></span><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span> <span class="k">class</span> <span class="nc">Stack</span> <span class="p">{};</span>
<span class="kt">void</span> <span class="nf">f1</span><span class="p">(</span><span class="n">Stack</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="p">);</span>		<span class="c1">// instantiation of Stack&lt;char&gt;, statement as 'Stack&lt;char&gt;' first appearance</span>
<span class="k">class</span> <span class="nc">Exercise</span>
<span class="p">{</span>
  <span class="n">Stack</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">rsd</span><span class="p">;</span>		<span class="c1">// instantiation of Stack&lt;double&gt;, its first appearance in context </span>
  <span class="n">Stack</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">si</span><span class="p">;</span>		<span class="c1">// instantiation of Stack&lt;int&gt;, its first appearance int context</span>
<span class="p">};</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">Stack</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">sc</span><span class="p">;</span>		<span class="c1">// no instantiation, class instantiated before;</span>
  <span class="n">f1</span><span class="p">(</span><span class="o">*</span><span class="n">sc</span><span class="p">);</span>			<span class="c1">// no instantiated, just call function</span>
  <span class="kt">int</span> <span class="n">iObj</span> <span class="o">=</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">Stack</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span><span class="p">);</span> <span class="c1">// instantiation, its first appearance in context</span>
<span class="p">}</span>
</pre></div>
</div>
</div>

<div id="outline-container-org2fdbc74" class="outline-2">
<h2 id="org2fdbc74">Exercise 16.28</h2>
<div class="outline-text-2" id="text-org2fdbc74">
<div class="highlight"><pre><span></span><span class="c1">// See My_shared_ptr.h and My_unique_ptr.h.</span>
<span class="kt">void</span> <span class="nf">runQueries</span><span class="p">(</span><span class="n">ifstream</span> <span class="o">&amp;</span><span class="n">infile</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">TextQuery</span> <span class="n">tq</span><span class="p">(</span><span class="n">infile</span><span class="p">);</span>
  <span class="n">string</span> <span class="n">s</span><span class="p">;</span>
  <span class="k">do</span>
    <span class="p">{</span>
      <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Enter word to look for, or q to quit: "</span><span class="p">;</span>
      <span class="n">cin</span> <span class="o">&gt;&gt;</span> <span class="n">s</span><span class="p">;</span>
      <span class="n">print</span><span class="p">(</span><span class="n">cout</span><span class="p">,</span> <span class="n">tq</span><span class="p">.</span><span class="n">query</span><span class="p">(</span><span class="n">s</span><span class="p">))</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="k">while</span><span class="p">(</span><span class="n">cin</span> <span class="o">&amp;&amp;</span> <span class="n">s</span> <span class="o">!=</span> <span class="s">"q"</span><span class="p">);</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">argv</span><span class="p">[])</span>
<span class="p">{</span>
  <span class="n">ifstream</span> <span class="n">ifs</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
  <span class="n">runQueries</span><span class="p">(</span><span class="n">ifs</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>

<div id="outline-container-org64fbdeb" class="outline-2">
<h2 id="org64fbdeb">My_shared_ptr.h</h2>
<div class="outline-text-2" id="text-org64fbdeb">
<div class="highlight"><pre><span></span><span class="cp">#ifndef MY_SHARED_PTR_H</span>
<span class="cp">#define MY_SHARED_PTR_H</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span> <span class="k">class</span> <span class="nc">My_shared_ptr</span>
<span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="k">using</span> <span class="n">del_type</span> <span class="o">=</span> <span class="n">function</span><span class="o">&lt;</span><span class="kt">void</span><span class="p">(</span><span class="n">T</span><span class="o">*</span><span class="p">)</span><span class="o">&gt;</span><span class="p">;</span>
 <span class="n">My_shared_ptr</span><span class="p">()</span><span class="o">:</span> <span class="n">p</span><span class="p">(</span><span class="k">new</span> <span class="n">T</span><span class="p">()),</span> <span class="n">use_count</span><span class="p">(</span><span class="k">new</span> <span class="kt">unsigned</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span> <span class="p">{}</span>
 <span class="n">My_shared_ptr</span><span class="p">(</span><span class="n">T</span> <span class="o">*</span><span class="n">q</span><span class="p">)</span><span class="o">:</span> <span class="n">p</span><span class="p">(</span><span class="n">q</span><span class="p">),</span> <span class="n">use_count</span><span class="p">(</span><span class="k">new</span> <span class="kt">unsigned</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span> <span class="p">{}</span>
 <span class="n">My_shared_ptr</span><span class="p">(</span><span class="n">T</span> <span class="o">*</span><span class="n">q</span><span class="p">,</span> <span class="n">del_type</span> <span class="n">d</span><span class="p">)</span><span class="o">:</span> <span class="n">p</span><span class="p">(</span><span class="n">q</span><span class="p">),</span> <span class="n">del</span><span class="p">(</span><span class="n">d</span><span class="p">),</span> <span class="n">use_count</span><span class="p">(</span><span class="k">new</span> <span class="kt">unsigned</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span> <span class="p">{}</span>
 <span class="n">My_shared_ptr</span><span class="p">(</span><span class="k">const</span> <span class="n">My_shared_ptr</span> <span class="o">&amp;</span><span class="n">m</span><span class="p">)</span><span class="o">:</span> <span class="n">p</span><span class="p">(</span><span class="n">m</span><span class="p">.</span><span class="n">p</span><span class="p">),</span> <span class="n">del</span><span class="p">(</span><span class="n">m</span><span class="p">.</span><span class="n">del</span><span class="p">),</span> <span class="n">use_count</span><span class="p">(</span><span class="n">m</span><span class="p">.</span><span class="n">use_count</span><span class="p">)</span> <span class="p">{</span><span class="o">++*</span><span class="n">use_count</span><span class="p">;}</span>
 <span class="n">My_shared_ptr</span><span class="p">(</span><span class="n">initializer_list</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">::</span><span class="n">value_type</span><span class="o">&gt;</span> <span class="n">il</span><span class="p">)</span><span class="o">:</span> <span class="n">p</span><span class="p">(</span><span class="k">new</span> <span class="n">T</span><span class="p">(</span><span class="n">il</span><span class="p">)),</span> <span class="n">use_count</span><span class="p">(</span><span class="k">new</span> <span class="kt">unsigned</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span> <span class="p">{}</span>
 <span class="n">My_shared_ptr</span><span class="p">(</span><span class="k">typename</span> <span class="n">T</span><span class="o">::</span><span class="n">iterator</span> <span class="n">it1</span><span class="p">,</span> <span class="k">typename</span> <span class="n">T</span><span class="o">::</span><span class="n">iterator</span> <span class="n">it2</span><span class="p">)</span><span class="o">:</span>
  <span class="n">p</span><span class="p">(</span><span class="k">new</span> <span class="n">T</span><span class="p">(</span><span class="n">it1</span><span class="p">,</span> <span class="n">it2</span><span class="p">)),</span> <span class="n">use_count</span><span class="p">(</span><span class="k">new</span> <span class="kt">unsigned</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span> <span class="p">{}</span>
  <span class="n">My_shared_ptr</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">My_shared_ptr</span> <span class="o">&amp;</span><span class="n">m</span><span class="p">);</span>
  <span class="kt">void</span> <span class="nf">reset</span><span class="p">();</span>
  <span class="kt">void</span> <span class="nf">reset</span><span class="p">(</span><span class="n">T</span> <span class="o">*</span><span class="n">q</span><span class="p">);</span>
  <span class="kt">void</span> <span class="nf">reset</span><span class="p">(</span><span class="n">T</span> <span class="o">*</span><span class="n">q</span><span class="p">,</span> <span class="n">del_type</span> <span class="n">d</span><span class="p">);</span>
  <span class="n">T</span> <span class="o">*</span><span class="k">operator</span><span class="o">-&gt;</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span><span class="k">return</span> <span class="n">p</span><span class="p">;}</span>
  <span class="n">T</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">*</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span><span class="k">return</span> <span class="o">*</span><span class="n">p</span><span class="p">;}</span>
  <span class="o">~</span><span class="n">My_shared_ptr</span><span class="p">();</span>
 <span class="k">private</span><span class="o">:</span>
  <span class="n">T</span><span class="o">*</span> <span class="n">p</span><span class="p">;</span>
  <span class="kt">unsigned</span> <span class="o">*</span><span class="n">use_count</span><span class="p">;</span>
  <span class="n">del_type</span> <span class="n">del</span> <span class="o">=</span> <span class="p">[]</span> <span class="p">(</span><span class="n">T</span> <span class="o">*</span><span class="n">p</span><span class="p">)</span> <span class="p">{</span><span class="k">delete</span> <span class="n">p</span><span class="p">;};</span>
<span class="p">};</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
<span class="n">My_shared_ptr</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">My_shared_ptr</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::</span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">My_shared_ptr</span> <span class="o">&amp;</span><span class="n">m</span><span class="p">)</span>
<span class="p">{</span>
  <span class="o">++*</span><span class="n">m</span><span class="p">.</span><span class="n">use_count</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="o">--*</span><span class="n">use_count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="n">del</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
      <span class="k">delete</span> <span class="n">use_count</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="n">p</span> <span class="o">=</span> <span class="n">m</span><span class="p">.</span><span class="n">p</span><span class="p">;</span>
  <span class="n">use_count</span> <span class="o">=</span> <span class="n">m</span><span class="p">.</span><span class="n">use_count</span><span class="p">;</span>
  <span class="k">return</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span>
<span class="p">}</span>
  <span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span> <span class="kt">void</span> <span class="n">My_shared_ptr</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::</span><span class="n">reset</span><span class="p">()</span>
  <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="o">--*</span><span class="n">use_count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> 
      <span class="n">del</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
    <span class="n">p</span> <span class="o">=</span> <span class="k">nullptr</span><span class="p">;</span>
    <span class="o">*</span><span class="n">use_count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">}</span>
<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span> <span class="kt">void</span> <span class="n">My_shared_ptr</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::</span><span class="n">reset</span><span class="p">(</span><span class="n">T</span> <span class="o">*</span><span class="n">q</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span><span class="p">(</span><span class="o">--*</span><span class="n">use_count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> 
    <span class="n">del</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
  <span class="n">p</span> <span class="o">=</span> <span class="n">q</span><span class="p">;</span>
  <span class="o">*</span><span class="n">use_count</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span> <span class="kt">void</span> <span class="n">My_shared_ptr</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::</span><span class="n">reset</span><span class="p">(</span><span class="n">T</span> <span class="o">*</span><span class="n">q</span><span class="p">,</span> <span class="n">del_type</span> <span class="n">d</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span><span class="p">(</span><span class="o">--*</span><span class="n">use_count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> 
    <span class="n">del</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
  <span class="n">p</span> <span class="o">=</span> <span class="n">q</span><span class="p">;</span>
  <span class="n">del</span> <span class="o">=</span> <span class="n">d</span><span class="p">;</span>
  <span class="o">*</span><span class="n">use_count</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span> <span class="n">My_shared_ptr</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::~</span><span class="n">My_shared_ptr</span><span class="p">()</span>
<span class="p">{</span>
  <span class="k">if</span><span class="p">(</span><span class="o">--*</span><span class="n">use_count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="n">del</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
      <span class="k">delete</span> <span class="n">use_count</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">#endif</span>
</pre></div>
</div>
</div>

<div id="outline-container-org39b8d5d" class="outline-2">
<h2 id="org39b8d5d">My_unique_ptr.h</h2>
<div class="outline-text-2" id="text-org39b8d5d">
<div class="highlight"><pre><span></span><span class="cp">#ifndef MY_UNIQUE_PTR_H</span>
<span class="cp">#define MY_UNIQUE_PTR_H</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span> <span class="k">class</span> <span class="nc">Delete</span>
<span class="p">{</span>
 <span class="k">public</span><span class="o">:</span>
  <span class="kt">void</span> <span class="k">operator</span><span class="p">()(</span><span class="n">T</span> <span class="o">*</span><span class="n">p</span><span class="p">)</span>
  <span class="p">{</span>
    <span class="k">delete</span> <span class="n">p</span><span class="p">;</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"class Delete"</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">};</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="p">,</span> <span class="k">typename</span> <span class="n">U</span> <span class="o">=</span> <span class="n">Delete</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span> <span class="k">class</span> <span class="nc">My_unique_ptr</span>
  <span class="p">{</span>
  <span class="k">public</span><span class="o">:</span>
  <span class="n">My_unique_ptr</span><span class="p">()</span><span class="o">:</span> <span class="n">p</span><span class="p">(</span><span class="k">new</span> <span class="n">T</span><span class="p">())</span> <span class="p">{}</span>
  <span class="n">My_unique_ptr</span><span class="p">(</span><span class="n">T</span> <span class="o">*</span><span class="n">q</span><span class="p">)</span><span class="o">:</span> <span class="n">p</span><span class="p">(</span><span class="n">q</span><span class="p">)</span> <span class="p">{}</span>
  <span class="n">My_unique_ptr</span><span class="p">(</span><span class="n">T</span> <span class="o">*</span><span class="n">q</span><span class="p">,</span> <span class="n">U</span> <span class="n">d</span><span class="p">)</span><span class="o">:</span> <span class="n">p</span><span class="p">(</span><span class="n">q</span><span class="p">),</span> <span class="n">del</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="p">{}</span>
  <span class="kt">void</span> <span class="n">reset</span><span class="p">()</span> <span class="p">{</span><span class="n">del</span><span class="p">(</span><span class="n">p</span><span class="p">);</span> <span class="n">p</span> <span class="o">=</span> <span class="k">nullptr</span><span class="p">;}</span>
  <span class="kt">void</span> <span class="n">reset</span><span class="p">(</span><span class="n">T</span> <span class="o">*</span><span class="n">q</span><span class="p">)</span> <span class="p">{</span><span class="n">del</span><span class="p">(</span><span class="n">p</span><span class="p">);</span> <span class="n">p</span> <span class="o">=</span> <span class="n">q</span><span class="p">;};</span>
  <span class="o">~</span><span class="n">My_unique_ptr</span><span class="p">()</span> <span class="p">{</span><span class="n">del</span><span class="p">(</span><span class="n">p</span><span class="p">);}</span>
  <span class="n">My_unique_ptr</span><span class="p">(</span><span class="k">const</span> <span class="n">My_unique_ptr</span> <span class="o">&amp;</span><span class="n">m</span><span class="p">)</span> <span class="o">=</span> <span class="k">delete</span><span class="p">;</span>
  <span class="n">My_unique_ptr</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">My_unique_ptr</span> <span class="o">&amp;</span><span class="n">m</span><span class="p">)</span> <span class="o">=</span> <span class="k">delete</span><span class="p">;</span>
  <span class="k">private</span><span class="o">:</span>
  <span class="n">T</span> <span class="o">*</span><span class="n">p</span><span class="p">;</span>
  <span class="n">U</span> <span class="n">del</span><span class="p">;</span>
  <span class="p">};</span>
<span class="cp">#endif</span>
</pre></div>
</div>
</div>

<div id="outline-container-orge687b0f" class="outline-2">
<h2 id="orge687b0f">Exercise 16.29</h2>
<div class="outline-text-2" id="text-orge687b0f">
<div class="highlight"><pre><span></span><span class="c1">// See Blob.h.</span>
</pre></div>

<p>
<a href="#orga480e2d">Blob.h</a>
</p>
</div>
</div>

<div id="outline-container-org6aa3c9f" class="outline-2">
<h2 id="org6aa3c9f">Exercise 16.30</h2>
<div class="outline-text-2" id="text-org6aa3c9f">
<div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">Blob</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">b</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">};</span>
  <span class="k">auto</span> <span class="n">length</span> <span class="o">=</span> <span class="n">b</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
  <span class="k">for</span><span class="p">(</span><span class="kt">size_t</span> <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">index</span> <span class="o">!=</span> <span class="n">length</span><span class="p">;</span> <span class="o">++</span><span class="n">index</span><span class="p">)</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">b</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>

<div id="outline-container-orga4cea17" class="outline-2">
<h2 id="orga4cea17">Exercise 16.31</h2>
<div class="outline-text-2" id="text-orga4cea17">
<div class="highlight"><pre><span></span><span class="c1">// As described in My_unique_ptr.h;</span>
<span class="c1">// if given a statement like this: My_unique_ptr&lt;int, DebugDelete&gt;</span>
<span class="c1">// code of destructor: ~My_unique_ptr() {del(p);}</span>
<span class="c1">// the destructor of this instantiated class would be expanded like:</span>
<span class="c1">// ~My_unique_ptr()</span>
<span class="c1">// {</span>
<span class="c1">//   cerr &lt;&lt; "deleting unique_ptr" &lt;&lt; endl;</span>
<span class="c1">//   delete p;</span>
<span class="c1">// }</span>
</pre></div>
</div>
</div>

<div id="outline-container-org52cf477" class="outline-2">
<h2 id="org52cf477">Exercise 16.32</h2>
<div class="outline-text-2" id="text-org52cf477">
<div class="highlight"><pre><span></span><span class="c1">// During template argument deduction:</span>
<span class="c1">// as for function template, compiler deduces the template argument from the passed in function arguments, instantiates a version of the function best matches the given call;</span>
<span class="c1">// if one function paramenter uses template type parameter, only const conversion and array-pointer &amp; function-pointer conversion could be applied to corresponding passed in arguments;</span>
<span class="c1">// usually compiler does not apply conversion to arguments, but instantiates a new template instance based on the type of arguments.</span>
</pre></div>
</div>
</div>

<div id="outline-container-org4a69960" class="outline-2">
<h2 id="org4a69960">Exercise 16.33</h2>
<div class="outline-text-2" id="text-org4a69960">
<div class="highlight"><pre><span></span><span class="c1">// 1. const conversion</span>
<span class="c1">// 2. if the function parmeter is not a reference type, array argument converted to pointer which points to the its first element; function argument converted to pointer which points to this function.</span>
</pre></div>
</div>
</div>

<div id="outline-container-org0d069b7" class="outline-2">
<h2 id="org0d069b7">Exercise 16.34</h2>
<div class="outline-text-2" id="text-org0d069b7">
<div class="highlight"><pre><span></span><span class="k">template</span> <span class="o">&lt;</span><span class="k">class</span> <span class="nc">T</span><span class="o">&gt;</span> <span class="kt">int</span> <span class="n">compare</span><span class="p">(</span><span class="k">const</span> <span class="n">T</span> <span class="o">&amp;</span><span class="p">,</span> <span class="k">const</span> <span class="n">T</span> <span class="o">&amp;</span><span class="p">);</span>
<span class="c1">// a. compare("hi", "world");</span>
<span class="c1">// illegal;</span>
<span class="c1">// the function parameters have same type, and both are reference;</span>
<span class="c1">// and "hi" and "world" passed in as function arguments, the first's type is 'const char[3]', the second is 'const char[6]'</span>
<span class="c1">// T deduced from first function argument and second does not match.</span>
<span class="c1">// b. compare("bye", "dad");</span>
<span class="c1">// legal;</span>
<span class="c1">// same theory as mentioned in a:</span>
<span class="c1">// now T deduced from first function argument and second matches;</span>
<span class="c1">// T: char[3]</span>
</pre></div>
</div>
</div>

<div id="outline-container-org098eaa7" class="outline-2">
<h2 id="org098eaa7">Exercise 16.35</h2>
<div class="outline-text-2" id="text-org098eaa7">
<div class="highlight"><pre><span></span><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span> <span class="n">T</span> <span class="n">calc</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="kt">int</span><span class="p">);</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span> <span class="n">T</span> <span class="n">fcn</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">T</span><span class="p">);</span>
<span class="kt">double</span> <span class="n">d</span><span class="p">;</span> <span class="kt">float</span> <span class="n">f</span><span class="p">;</span> <span class="kt">char</span> <span class="n">c</span><span class="p">;</span>
<span class="c1">// a. calc(c, 'c');</span>
<span class="c1">// legal, T: char;</span>
<span class="c1">// b. calc(d, f);</span>
<span class="c1">// legal, T: double</span>
<span class="c1">// c. fcn(c, 'c');</span>
<span class="c1">// legal, T: char</span>
<span class="c1">// d. fcn(d, f);</span>
<span class="c1">// illegal, function template fcn's parameter list accepts two paramters with same type which is template type parameter, now for first time template type parameter deduced from function argument is double, second time float, not match.</span>
</pre></div>
</div>
</div>

<div id="outline-container-orgcf3a037" class="outline-2">
<h2 id="orgcf3a037">Exercise 16.36</h2>
<div class="outline-text-2" id="text-orgcf3a037">
<div class="highlight"><pre><span></span><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span> <span class="kt">void</span> <span class="n">f1</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">T</span><span class="p">);</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T1</span><span class="p">,</span> <span class="k">typename</span> <span class="n">T2</span><span class="o">&gt;</span> <span class="kt">void</span> <span class="n">f2</span><span class="p">(</span><span class="n">T1</span><span class="p">,</span> <span class="n">T2</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">42</span><span class="p">,</span> <span class="o">*</span><span class="n">p1</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">i</span><span class="p">,</span> <span class="o">*</span><span class="n">p2</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">j</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="o">*</span><span class="n">cp1</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">i</span><span class="p">,</span> <span class="o">*</span><span class="n">cp2</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">j</span><span class="p">;</span>
<span class="c1">// a. f1(p1, p2);</span>
<span class="c1">// T of first template deduced as int*, instantiates a template instance: f1(int*, int*);</span>
<span class="c1">// b. f2(p1, p2);</span>
<span class="c1">// T1 of second template deduced as int*, T2 as int*, new instance: f2(int*, int*);</span>
<span class="c1">// c. f1(cp1, cp2);</span>
<span class="c1">// T of first template deduced as const int*, nes instance: f1(const int*, const int*)</span>
<span class="c1">// d. f2(cp1, cp2);</span>
<span class="c1">// T1 of second template deduced as const int*, second as const int*, new instance: f2(const int*, const int*)</span>
<span class="c1">// e. f1(p1, cp2);</span>
<span class="c1">// illegal;</span>
<span class="c1">// T deduced from first argument of f1 is int*, deduced from seond argument is const int*, not match</span>
<span class="c1">// f. f2(p1, cp1);</span>
<span class="c1">// T1 of second template deduced as int*, T2 of second template deduced as const int*, new instance: f2(int*, const int*)</span>
</pre></div>
</div>
</div>

<div id="outline-container-orgacc5a26" class="outline-2">
<h2 id="orgacc5a26">Exercise 16.37</h2>
<div class="outline-text-2" id="text-orgacc5a26">
<div class="highlight"><pre><span></span><span class="c1">// legal;</span>
<span class="c1">// just offer an explicit template argument;</span>
<span class="c1">// int a = 1;</span>
<span class="c1">// double b = 2.1;</span>
<span class="c1">// max&lt;double&gt;(a, b);</span>
</pre></div>
</div>
</div>

<div id="outline-container-org86d62db" class="outline-2">
<h2 id="org86d62db">Exercise 16.38</h2>
<div class="outline-text-2" id="text-org86d62db">
<div class="highlight"><pre><span></span><span class="c1">// function template instance make_shared&lt;T&gt; accepts function arguments which could be passed in to type T's corresponding constructor to initialize a T type object allocated in dynamic memory;</span>
<span class="c1">// and compiler could not deduce T from function arguments of call of make_shared without specify any explicit template type argument;</span>
<span class="c1">// then a call like make_shared(args) is illegal.</span>
</pre></div>
</div>
</div>

<div id="outline-container-orgc6101a6" class="outline-2">
<h2 id="orgc6101a6">Exercise 16.39</h2>
<div class="outline-text-2" id="text-orgc6101a6">
<div class="highlight"><pre><span></span><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
<span class="kt">int</span> <span class="n">compare</span><span class="p">(</span><span class="k">const</span> <span class="n">T</span> <span class="o">&amp;</span><span class="n">v1</span><span class="p">,</span> <span class="k">const</span> <span class="n">T</span> <span class="o">&amp;</span><span class="n">v2</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span><span class="p">(</span><span class="n">v1</span> <span class="o">&lt;</span> <span class="n">v2</span><span class="p">)</span> <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="n">v2</span> <span class="o">&lt;</span> <span class="n">v1</span><span class="p">)</span> <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">compare</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="p">(</span><span class="s">"hello"</span><span class="p">,</span> <span class="s">"world"</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>

<div id="outline-container-org7748054" class="outline-2">
<h2 id="org7748054">Exercise 16.40</h2>
<div class="outline-text-2" id="text-org7748054">
<div class="highlight"><pre><span></span><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">It</span><span class="o">&gt;</span>
<span class="k">auto</span> <span class="n">fcn3</span><span class="p">(</span><span class="n">It</span> <span class="n">beg</span><span class="p">,</span> <span class="n">It</span> <span class="n">end</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="k">decltype</span><span class="p">(</span><span class="o">*</span><span class="n">beg</span> <span class="o">+</span> <span class="mi">0</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="o">*</span><span class="n">beg</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">// legal;</span>
<span class="c1">// the type of passed in arguments of fcn3 must support '*' operator;</span>
<span class="c1">// and type of object of *beg should support '+' operator;</span>
<span class="c1">// return type is the type of element which is pointed by beg.</span>
</pre></div>
</div>
</div>

<div id="outline-container-orgba7ee92" class="outline-2">
<h2 id="orgba7ee92">Exercise 16.41</h2>
<div class="outline-text-2" id="text-orgba7ee92">
<div class="highlight"><pre><span></span><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
<span class="k">auto</span> <span class="n">sum</span><span class="p">(</span><span class="n">T</span> <span class="n">a</span><span class="p">,</span> <span class="n">T</span> <span class="n">b</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="k">decltype</span><span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="n">a</span> <span class="o">+</span> <span class="n">b</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
  <span class="k">auto</span> <span class="n">s</span> <span class="o">=</span> <span class="n">sum</span><span class="p">(</span><span class="mi">123456789123456789123456789123456789123456789</span><span class="p">,</span> <span class="mi">123456789123456789123456789123456789123456789</span><span class="p">);</span>
  <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">s</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>

<div id="outline-container-org6ccaa29" class="outline-2">
<h2 id="org6ccaa29">Exercise 16.42</h2>
<div class="outline-text-2" id="text-org6ccaa29">
<div class="highlight"><pre><span></span><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span> <span class="kt">void</span> <span class="n">g</span><span class="p">(</span><span class="n">T</span><span class="o">&amp;&amp;</span> <span class="n">val</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="k">const</span> <span class="kt">int</span> <span class="n">ci</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
<span class="c1">// a. g(i);</span>
<span class="c1">// T: int&amp;</span>
<span class="c1">// val: int&amp;</span>
<span class="c1">// b. g(ci);</span>
<span class="c1">// T: const int&amp;</span>
<span class="c1">// val: const int&amp;</span>
<span class="c1">// c. g(i * ci);</span>
<span class="c1">// T: int</span>
<span class="c1">// val: int&amp;&amp;</span>
</pre></div>
</div>
</div>

<div id="outline-container-orgec9fa8d" class="outline-2">
<h2 id="orgec9fa8d">Exercise 16.43</h2>
<div class="outline-text-2" id="text-orgec9fa8d">
<div class="highlight"><pre><span></span><span class="c1">// template defined in 16.42.cpp</span>
<span class="c1">// g(i = ci)</span>
<span class="c1">// T: int&amp;</span>
</pre></div>
</div>
</div>

<div id="outline-container-orge208c56" class="outline-2">
<h2 id="orge208c56">Exercise 16.44</h2>
<div class="outline-text-2" id="text-orge208c56">
<div class="highlight"><pre><span></span><span class="c1">// template &lt;typename T&gt; void g(T val);</span>
<span class="c1">// int i = 0; const int ci = i;</span>
<span class="c1">// a. g(i);</span>
<span class="c1">// T: int</span>
<span class="c1">// b. g(ci);</span>
<span class="c1">// T: const int;</span>
<span class="c1">// some one said here should be int and const is ignored.</span>
<span class="c1">// c. g(i * ci);</span>
<span class="c1">// T: int</span>
<span class="c1">// template &lt;typename T&gt; void g(const T&amp; val);</span>
<span class="c1">// int i = 0; const int ci = i;</span>
<span class="c1">// a. g(i);</span>
<span class="c1">// T: int</span>
<span class="c1">// b. g(ci);</span>
<span class="c1">// T: int</span>
<span class="c1">// c. g(i * ci)</span>
<span class="c1">// T: int</span>
</pre></div>
</div>
</div>

<div id="outline-container-orgea2e400" class="outline-2">
<h2 id="orgea2e400">Exercise 16.45</h2>
<div class="outline-text-2" id="text-orgea2e400">
<div class="highlight"><pre><span></span><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span> <span class="kt">void</span> <span class="n">g</span><span class="p">(</span><span class="n">T</span><span class="o">&amp;&amp;</span> <span class="n">val</span><span class="p">)</span> <span class="p">{</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">v</span><span class="p">;}</span>
<span class="c1">// call g with a literal constant of 42;</span>
<span class="c1">// T: int</span>
<span class="c1">// val: int&amp;&amp;</span>
<span class="c1">// initialize a empty vector with element type as int within instantiated function body.</span>
<span class="c1">// call g with a variable of type int;</span>
<span class="c1">// T: int&amp;</span>
<span class="c1">// val: int</span>
<span class="c1">// vector&lt;int&amp;&gt; is not legal.</span>
</pre></div>
</div>
</div>

<div id="outline-container-orgb4eef77" class="outline-2">
<h2 id="orgb4eef77">Exercise 16.46</h2>
<div class="outline-text-2" id="text-orgb4eef77">
<div class="highlight"><pre><span></span><span class="c1">////////////////////////////////////////////////////</span>
<span class="c1">// for(size_t i = 0; i != size(); ++i)		  //</span>
<span class="c1">//   alloc.construct(dest++, std::move(*elem++)); //</span>
<span class="c1">////////////////////////////////////////////////////</span>
<span class="c1">// new string object constructed in new dynamic memory space takes over the resource owned by the original string which is allocated in another dynamic memory;</span>
<span class="c1">// with a for loop and the move constructor of string type, old string objects' resource is now owned by new constructed string objects, then the old could be safely destructed.</span>
</pre></div>
</div>
</div>

<div id="outline-container-org5e3a08c" class="outline-2">
<h2 id="org5e3a08c">Exercise 16.47</h2>
<div class="outline-text-2" id="text-org5e3a08c">
<div class="highlight"><pre><span></span><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">F</span><span class="p">,</span> <span class="k">typename</span> <span class="n">T1</span><span class="p">,</span> <span class="k">typename</span> <span class="n">T2</span><span class="o">&gt;</span>
<span class="kt">void</span> <span class="n">flip</span><span class="p">(</span><span class="n">F</span> <span class="n">f</span><span class="p">,</span> <span class="n">T1</span> <span class="o">&amp;&amp;</span><span class="n">t1</span><span class="p">,</span> <span class="n">T2</span> <span class="o">&amp;&amp;</span><span class="n">t2</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">f</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">forward</span><span class="o">&lt;</span><span class="n">T2</span><span class="o">&gt;</span><span class="p">(</span><span class="n">t2</span><span class="p">),</span> <span class="n">std</span><span class="o">::</span><span class="n">forward</span><span class="o">&lt;</span><span class="n">T1</span><span class="o">&gt;</span><span class="p">(</span><span class="n">t1</span><span class="p">));</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="n">f1</span><span class="p">(</span><span class="kt">int</span> <span class="o">&amp;</span><span class="n">t1</span><span class="p">,</span> <span class="kt">int</span> <span class="o">&amp;</span><span class="n">t2</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">t1</span> <span class="o">&lt;&lt;</span> <span class="s">" "</span> <span class="o">&lt;&lt;</span> <span class="n">t2</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">void</span> <span class="n">f2</span><span class="p">(</span><span class="kt">int</span> <span class="o">&amp;&amp;</span><span class="n">t1</span><span class="p">,</span> <span class="kt">int</span> <span class="o">&amp;&amp;</span><span class="n">t2</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">t1</span> <span class="o">&lt;&lt;</span> <span class="s">" "</span> <span class="o">&lt;&lt;</span> <span class="n">t2</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">4</span><span class="p">;</span>
  <span class="n">flip</span><span class="p">(</span><span class="n">f1</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">);</span>
  <span class="n">flip</span><span class="p">(</span><span class="n">f2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>

<div id="outline-container-org0cddf26" class="outline-2">
<h2 id="org0cddf26">Exercise 16.48</h2>
<div class="outline-text-2" id="text-org0cddf26">
<div class="highlight"><pre><span></span><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span> <span class="n">string</span> <span class="n">debug_rep</span><span class="p">(</span><span class="k">const</span> <span class="n">T</span> <span class="o">&amp;</span><span class="n">t</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">ostringstream</span> <span class="n">ret</span><span class="p">;</span>
  <span class="n">ret</span> <span class="o">&lt;&lt;</span> <span class="n">t</span><span class="p">;</span>
  <span class="k">return</span> <span class="n">ret</span><span class="p">.</span><span class="n">str</span><span class="p">();</span>
<span class="p">}</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span> <span class="n">string</span> <span class="n">debug_rep</span><span class="p">(</span><span class="n">T</span> <span class="o">*</span><span class="n">p</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">ostringstream</span> <span class="n">ret</span><span class="p">;</span>
  <span class="n">ret</span> <span class="o">&lt;&lt;</span> <span class="s">"pointer: "</span> <span class="o">&lt;&lt;</span> <span class="n">p</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="n">ret</span> <span class="o">&lt;&lt;</span> <span class="s">" null pointer"</span><span class="p">;</span>
  <span class="k">return</span> <span class="n">ret</span><span class="p">.</span><span class="n">str</span><span class="p">();</span>
<span class="p">}</span>
<span class="n">string</span> <span class="n">debug_rep</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="n">s</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="sc">'"'</span> <span class="o">+</span> <span class="n">s</span> <span class="o">+</span> <span class="sc">'"'</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">string</span> <span class="n">debug_rep</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">p</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="n">debug_rep</span><span class="p">(</span><span class="n">string</span><span class="p">(</span><span class="n">p</span><span class="p">));</span>
<span class="p">}</span>
<span class="n">string</span> <span class="n">debug_rep</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">p</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="n">debug_rep</span><span class="p">(</span><span class="n">string</span><span class="p">(</span><span class="n">p</span><span class="p">));</span>
<span class="p">}</span>
</pre></div>
</div>
</div>

<div id="outline-container-org88cb3ac" class="outline-2">
<h2 id="org88cb3ac">Exercise 16.49</h2>
<div class="outline-text-2" id="text-org88cb3ac">
<div class="highlight"><pre><span></span><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span> <span class="kt">void</span> <span class="n">f</span><span class="p">(</span><span class="n">T</span><span class="p">);</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span> <span class="kt">void</span> <span class="n">f</span><span class="p">(</span><span class="k">const</span> <span class="n">T</span><span class="o">*</span><span class="p">);</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span> <span class="kt">void</span> <span class="n">g</span><span class="p">(</span><span class="n">T</span><span class="p">);</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span> <span class="kt">void</span> <span class="n">g</span><span class="p">(</span><span class="n">T</span><span class="o">*</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">42</span><span class="p">,</span> <span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">i</span><span class="p">;</span>
<span class="k">const</span> <span class="kt">int</span> <span class="n">ci</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="n">p2</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">ci</span><span class="p">;</span>
<span class="c1">// g(42);</span>
<span class="c1">// call the instance of the third template: void g(int);</span>
<span class="c1">// g(p);</span>
<span class="c1">// call the instance of the fourth template: void g(int*);</span>
<span class="c1">// g(ci);</span>
<span class="c1">// call the instance of the third template: void g(const int);</span>
<span class="c1">// g(p2);</span>
<span class="c1">// call the instance of the fourth template: void g(const int*);</span>
<span class="c1">// f(42);</span>
<span class="c1">// call the instance of the first template: void f(int);</span>
<span class="c1">// f(p);</span>
<span class="c1">// call the instance of the first template: void f(int*);</span>
<span class="c1">// f(ci);</span>
<span class="c1">// call the instance of the first template: void f(const int);</span>
<span class="c1">// f(p2);</span>
<span class="c1">// call the instance of the second template: void f(const int*);</span>
</pre></div>
</div>
</div>

<div id="outline-container-org8f82598" class="outline-2">
<h2 id="org8f82598">Exercise 16.50</h2>
<div class="outline-text-2" id="text-org8f82598">
<div class="highlight"><pre><span></span><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span> <span class="kt">void</span> <span class="n">f</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"f(T)"</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span> <span class="kt">void</span> <span class="n">f</span><span class="p">(</span><span class="k">const</span> <span class="n">T</span><span class="o">*</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"f(const T*)"</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span> <span class="kt">void</span> <span class="n">g</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"g(T)"</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span> <span class="kt">void</span> <span class="n">g</span><span class="p">(</span><span class="n">T</span><span class="o">*</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"g(T*)"</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">42</span><span class="p">,</span> <span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">i</span><span class="p">;</span>
  <span class="k">const</span> <span class="kt">int</span> <span class="n">ci</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="o">*</span><span class="n">p2</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">ci</span><span class="p">;</span>
  <span class="n">g</span><span class="p">(</span><span class="mi">42</span><span class="p">);</span>
  <span class="n">g</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
  <span class="n">g</span><span class="p">(</span><span class="n">ci</span><span class="p">);</span>
  <span class="n">g</span><span class="p">(</span><span class="n">p2</span><span class="p">);</span>
  <span class="n">f</span><span class="p">(</span><span class="mi">42</span><span class="p">);</span>
  <span class="n">f</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
  <span class="n">f</span><span class="p">(</span><span class="n">ci</span><span class="p">);</span>
  <span class="n">f</span><span class="p">(</span><span class="n">p2</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>

<div id="outline-container-org042206e" class="outline-2">
<h2 id="org042206e">Exercise 16.51</h2>
<div class="outline-text-2" id="text-org042206e">
<div class="highlight"><pre><span></span><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="p">,</span> <span class="k">typename</span><span class="p">...</span> <span class="n">Args</span><span class="o">&gt;</span>
<span class="kt">void</span> <span class="n">foo</span><span class="p">(</span><span class="k">const</span> <span class="n">T</span> <span class="o">&amp;</span><span class="n">t</span><span class="p">,</span> <span class="k">const</span> <span class="n">Args</span><span class="o">&amp;</span><span class="p">...</span> <span class="n">rest</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="k">sizeof</span><span class="p">...(</span><span class="n">Args</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="k">sizeof</span><span class="p">...(</span><span class="n">rest</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="kt">double</span> <span class="n">d</span> <span class="o">=</span> <span class="mf">3.14</span><span class="p">;</span>
  <span class="n">string</span> <span class="n">s</span> <span class="o">=</span> <span class="s">"how now brown cow"</span><span class="p">;</span>
  <span class="n">foo</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="n">d</span><span class="p">);</span>		<span class="c1">// 3 3 </span>
  <span class="n">foo</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="s">"hi"</span><span class="p">);</span>		<span class="c1">// 2 2</span>
  <span class="n">foo</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">s</span><span class="p">);</span>			<span class="c1">// 1 1</span>
  <span class="n">foo</span><span class="p">(</span><span class="s">"hi"</span><span class="p">);</span>			<span class="c1">// 0 0</span>
<span class="p">}</span>
</pre></div>
</div>
</div>

<div id="outline-container-org858fc59" class="outline-2">
<h2 id="org858fc59">Exercise 16.52</h2>
<div class="outline-text-2" id="text-org858fc59">
<div class="highlight"><pre><span></span><span class="c1">// See 16.51.cpp.</span>
</pre></div>
</div>
</div>

<div id="outline-container-org7054ca9" class="outline-2">
<h2 id="org7054ca9">16.51.cpp</h2>
<div class="outline-text-2" id="text-org7054ca9">
<div class="highlight"><pre><span></span><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="p">,</span> <span class="k">typename</span><span class="p">...</span> <span class="n">Args</span><span class="o">&gt;</span>
<span class="kt">void</span> <span class="n">foo</span><span class="p">(</span><span class="k">const</span> <span class="n">T</span> <span class="o">&amp;</span><span class="n">t</span><span class="p">,</span> <span class="k">const</span> <span class="n">Args</span><span class="o">&amp;</span><span class="p">...</span> <span class="n">rest</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="k">sizeof</span><span class="p">...(</span><span class="n">Args</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="k">sizeof</span><span class="p">...(</span><span class="n">rest</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="kt">double</span> <span class="n">d</span> <span class="o">=</span> <span class="mf">3.14</span><span class="p">;</span>
  <span class="n">string</span> <span class="n">s</span> <span class="o">=</span> <span class="s">"how now brown cow"</span><span class="p">;</span>
  <span class="n">foo</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="n">d</span><span class="p">);</span>		<span class="c1">// 3 3 </span>
  <span class="n">foo</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="s">"hi"</span><span class="p">);</span>		<span class="c1">// 2 2</span>
  <span class="n">foo</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">s</span><span class="p">);</span>			<span class="c1">// 1 1</span>
  <span class="n">foo</span><span class="p">(</span><span class="s">"hi"</span><span class="p">);</span>			<span class="c1">// 0 0</span>
<span class="p">}</span>
</pre></div>
</div>
</div>

<div id="outline-container-org40a9e5d" class="outline-2">
<h2 id="org40a9e5d">Exercise 16.53</h2>
<div class="outline-text-2" id="text-org40a9e5d">
<div class="highlight"><pre><span></span><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
<span class="n">ostream</span> <span class="o">&amp;</span><span class="n">print</span><span class="p">(</span><span class="n">ostream</span> <span class="o">&amp;</span><span class="n">os</span><span class="p">,</span> <span class="k">const</span> <span class="n">T</span> <span class="o">&amp;</span><span class="n">t</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="n">os</span> <span class="o">&lt;&lt;</span> <span class="n">t</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="p">,</span> <span class="k">typename</span><span class="p">...</span> <span class="n">Args</span><span class="o">&gt;</span>
<span class="n">ostream</span> <span class="o">&amp;</span><span class="n">print</span><span class="p">(</span><span class="n">ostream</span> <span class="o">&amp;</span><span class="n">os</span><span class="p">,</span> <span class="k">const</span> <span class="n">T</span> <span class="o">&amp;</span><span class="n">t</span><span class="p">,</span> <span class="k">const</span> <span class="n">Args</span><span class="o">&amp;</span><span class="p">...</span> <span class="n">rest</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">os</span> <span class="o">&lt;&lt;</span> <span class="n">t</span> <span class="o">&lt;&lt;</span> <span class="s">", "</span><span class="p">;</span>
  <span class="k">return</span> <span class="nf">print</span><span class="p">(</span><span class="n">os</span><span class="p">,</span> <span class="n">rest</span><span class="p">...);</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">print</span><span class="p">(</span><span class="n">cout</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">print</span><span class="p">(</span><span class="n">cout</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="s">"hello world"</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">print</span><span class="p">(</span><span class="n">cout</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mf">3.14</span><span class="p">,</span> <span class="s">"hello"</span><span class="p">,</span> <span class="n">string</span><span class="p">(</span><span class="s">"world"</span><span class="p">),</span> <span class="sc">'!'</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>

<div id="outline-container-orge34ee72" class="outline-2">
<h2 id="orge34ee72">Exercise 16.54</h2>
<div class="outline-text-2" id="text-orge34ee72">
<div class="highlight"><pre><span></span><span class="c1">// compile error.</span>
</pre></div>
</div>
</div>

<div id="outline-container-org8289e24" class="outline-2">
<h2 id="org8289e24">Exercise 16.55</h2>
<div class="outline-text-2" id="text-org8289e24">
<div class="highlight"><pre><span></span><span class="c1">// At last, within the call of print(os, rest...) the function parameter packet contains no function parameter;</span>
<span class="c1">// the this call equals to the form as print(os);</span>
<span class="c1">// there is no match overload version of print in the scope;</span>
<span class="c1">// compile error.</span>
</pre></div>
</div>
</div>

<div id="outline-container-org88967b2" class="outline-2">
<h2 id="org88967b2">Exercise 16.56</h2>
<div class="outline-text-2" id="text-org88967b2">
<div class="highlight"><pre><span></span><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
<span class="n">ostream</span> <span class="o">&amp;</span><span class="n">print</span><span class="p">(</span><span class="n">ostream</span> <span class="o">&amp;</span><span class="n">os</span><span class="p">,</span> <span class="k">const</span> <span class="n">T</span> <span class="o">&amp;</span><span class="n">t</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="n">os</span> <span class="o">&lt;&lt;</span> <span class="n">t</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="p">,</span> <span class="k">typename</span><span class="p">...</span> <span class="n">Args</span><span class="o">&gt;</span>
<span class="n">ostream</span> <span class="o">&amp;</span><span class="n">print</span><span class="p">(</span><span class="n">ostream</span> <span class="o">&amp;</span><span class="n">os</span><span class="p">,</span> <span class="k">const</span> <span class="n">T</span> <span class="o">&amp;</span><span class="n">t</span><span class="p">,</span> <span class="k">const</span> <span class="n">Args</span><span class="o">&amp;</span><span class="p">...</span> <span class="n">rest</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">os</span> <span class="o">&lt;&lt;</span> <span class="n">t</span> <span class="o">&lt;&lt;</span> <span class="s">", "</span><span class="p">;</span>
  <span class="k">return</span> <span class="nf">print</span><span class="p">(</span><span class="n">os</span><span class="p">,</span> <span class="n">rest</span><span class="p">...);</span>
<span class="p">}</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span> <span class="n">string</span> <span class="n">debug_rep</span><span class="p">(</span><span class="k">const</span> <span class="n">T</span> <span class="o">&amp;</span><span class="n">t</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">ostringstream</span> <span class="n">ret</span><span class="p">;</span>
  <span class="n">ret</span> <span class="o">&lt;&lt;</span> <span class="n">t</span><span class="p">;</span>
  <span class="k">return</span> <span class="n">ret</span><span class="p">.</span><span class="n">str</span><span class="p">();</span>
<span class="p">}</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span> <span class="n">string</span> <span class="n">debug_rep</span><span class="p">(</span><span class="n">T</span> <span class="o">*</span><span class="n">p</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">ostringstream</span> <span class="n">ret</span><span class="p">;</span>
  <span class="n">ret</span> <span class="o">&lt;&lt;</span> <span class="s">"pointer: "</span> <span class="o">&lt;&lt;</span> <span class="n">p</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="n">ret</span> <span class="o">&lt;&lt;</span> <span class="s">" null pointer"</span><span class="p">;</span>
  <span class="k">return</span> <span class="n">ret</span><span class="p">.</span><span class="n">str</span><span class="p">();</span>
<span class="p">}</span>
<span class="n">string</span> <span class="n">debug_rep</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="n">s</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="sc">'"'</span> <span class="o">+</span> <span class="n">s</span> <span class="o">+</span> <span class="sc">'"'</span><span class="p">;</span>
<span class="p">}</span>
<span class="n">string</span> <span class="n">debug_rep</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">p</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="n">debug_rep</span><span class="p">(</span><span class="n">string</span><span class="p">(</span><span class="n">p</span><span class="p">));</span>
<span class="p">}</span>
<span class="n">string</span> <span class="n">debug_rep</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">p</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="n">debug_rep</span><span class="p">(</span><span class="n">string</span><span class="p">(</span><span class="n">p</span><span class="p">));</span>
<span class="p">}</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span><span class="p">...</span> <span class="n">Args</span><span class="o">&gt;</span>
<span class="n">ostream</span> <span class="o">&amp;</span><span class="n">errorMsg</span><span class="p">(</span><span class="n">ostream</span> <span class="o">&amp;</span><span class="n">os</span><span class="p">,</span> <span class="k">const</span> <span class="n">Args</span><span class="o">&amp;</span><span class="p">...</span> <span class="n">rest</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="n">print</span><span class="p">(</span><span class="n">os</span><span class="p">,</span> <span class="n">debug_rep</span><span class="p">(</span><span class="n">rest</span><span class="p">)...);</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">errorMsg</span><span class="p">(</span><span class="n">cout</span><span class="p">,</span> <span class="s">"hello"</span><span class="p">,</span> <span class="n">string</span><span class="p">(</span><span class="s">"world"</span><span class="p">),</span> <span class="mi">42</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>

<div id="outline-container-orgea8cfad" class="outline-2">
<h2 id="orgea8cfad">Exercise 16.57</h2>
<div class="outline-text-2" id="text-orgea8cfad">
<div class="highlight"><pre><span></span><span class="c1">// errorMsg version defined in section 16.4.2</span>
<span class="c1">// advantage: arbitrary type(supports '&lt;&lt;' operator), better flexibility;</span>
<span class="c1">// disadvantage: more complicated code;</span>
<span class="c1">// errorMsg version defined in section 6.2.6</span>
<span class="c1">// advantage: simple and easy to understand;</span>
<span class="c1">// disvantage: requires that types of elements contained in a initilaizer_list object must be same or could be converted to a same type.</span>
</pre></div>
</div>
</div>

<div id="outline-container-org62ae345" class="outline-2">
<h2 id="org62ae345">Exercise 16.58</h2>
<div class="outline-text-2" id="text-org62ae345">
<div class="highlight"><pre><span></span><span class="c1">// See StrVec.h and Vec.h.</span>
</pre></div>

<p>
<a href="#org8a607f1">StrVec.h</a>
</p>
</div>
</div>

<div id="outline-container-org9f2fa8c" class="outline-2">
<h2 id="org9f2fa8c">Vec.h</h2>
<div class="outline-text-2" id="text-org9f2fa8c">
<div class="highlight"><pre><span></span><span class="cp">#ifndef VEC_H</span>
<span class="cp">#define VEC_H</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span> <span class="k">class</span> <span class="nc">Vec</span><span class="p">;</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span> <span class="kt">bool</span> <span class="k">operator</span><span class="o">==</span><span class="p">(</span><span class="k">const</span> <span class="n">Vec</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="p">,</span> <span class="k">const</span> <span class="n">Vec</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="p">);</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span> <span class="kt">bool</span> <span class="k">operator</span><span class="o">!=</span><span class="p">(</span><span class="k">const</span> <span class="n">Vec</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="p">,</span> <span class="k">const</span> <span class="n">Vec</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="p">);</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span> <span class="kt">bool</span> <span class="k">operator</span><span class="o">&lt;</span><span class="p">(</span><span class="k">const</span> <span class="n">Vec</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="p">,</span> <span class="k">const</span> <span class="n">Vec</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="p">);</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span> <span class="k">class</span> <span class="nc">Vec</span>
<span class="p">{</span>
  <span class="k">friend</span> <span class="kt">bool</span> <span class="k">operator</span><span class="o">==&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">(</span><span class="k">const</span> <span class="n">Vec</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="p">,</span> <span class="k">const</span> <span class="n">Vec</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="p">);</span>
  <span class="k">friend</span> <span class="kt">bool</span> <span class="k">operator</span><span class="o">!=&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">(</span><span class="k">const</span> <span class="n">Vec</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="p">,</span> <span class="k">const</span> <span class="n">Vec</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="p">);</span>
  <span class="k">friend</span> <span class="kt">bool</span> <span class="k">operator</span><span class="o">&lt;</span> <span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">(</span><span class="k">const</span> <span class="n">Vec</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="p">,</span> <span class="k">const</span> <span class="n">Vec</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="p">);</span>
 <span class="k">public</span><span class="o">:</span>
 <span class="n">Vec</span><span class="p">()</span><span class="o">:</span> <span class="n">elements</span><span class="p">(</span><span class="k">nullptr</span><span class="p">),</span> <span class="n">first_free</span><span class="p">(</span><span class="k">nullptr</span><span class="p">),</span> <span class="n">cap</span><span class="p">(</span><span class="k">nullptr</span><span class="p">)</span> <span class="p">{}</span>
  <span class="n">Vec</span><span class="p">(</span><span class="k">const</span> <span class="n">Vec</span> <span class="o">&amp;</span><span class="p">);</span>
  <span class="n">Vec</span><span class="p">(</span><span class="n">Vec</span> <span class="o">&amp;&amp;</span><span class="p">)</span> <span class="k">noexcept</span><span class="p">;</span>
  <span class="n">Vec</span><span class="p">(</span><span class="k">const</span> <span class="n">initializer_list</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">is</span><span class="p">);</span>
  <span class="n">Vec</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">Vec</span> <span class="o">&amp;</span><span class="p">);</span>
  <span class="n">Vec</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="n">Vec</span> <span class="o">&amp;&amp;</span><span class="p">)</span> <span class="k">noexcept</span><span class="p">;</span>
  <span class="n">Vec</span> <span class="o">&amp;</span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">initializer_list</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="p">);</span>
  <span class="n">T</span> <span class="o">&amp;</span><span class="k">operator</span><span class="p">[](</span><span class="kt">size_t</span> <span class="n">n</span><span class="p">);</span>
  <span class="k">const</span> <span class="n">T</span> <span class="o">&amp;</span><span class="k">operator</span><span class="p">[](</span><span class="kt">size_t</span> <span class="n">n</span><span class="p">)</span> <span class="k">const</span><span class="p">;</span>
  <span class="o">~</span><span class="n">Vec</span><span class="p">();</span>
  <span class="kt">void</span> <span class="nf">push_back</span><span class="p">(</span><span class="k">const</span> <span class="n">T</span> <span class="o">&amp;</span><span class="p">);</span>
  <span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span><span class="p">...</span> <span class="n">Args</span><span class="o">&gt;</span> <span class="kt">void</span> <span class="n">emplace_back</span><span class="p">(</span><span class="n">Args</span><span class="o">&amp;&amp;</span><span class="p">...);</span>
  <span class="kt">size_t</span> <span class="nf">size</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span><span class="k">return</span> <span class="n">first_free</span> <span class="o">-</span> <span class="n">elements</span><span class="p">;}</span>
  <span class="kt">size_t</span> <span class="nf">capacity</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span><span class="k">return</span> <span class="n">cap</span> <span class="o">-</span> <span class="n">elements</span><span class="p">;}</span>
  <span class="kt">void</span> <span class="nf">reserve</span><span class="p">(</span><span class="kt">size_t</span><span class="p">);</span>
  <span class="kt">void</span> <span class="nf">resize</span><span class="p">(</span><span class="kt">size_t</span> <span class="n">n</span><span class="p">,</span> <span class="n">T</span> <span class="n">s</span> <span class="o">=</span> <span class="s">""</span><span class="p">);</span>
  <span class="n">T</span> <span class="o">*</span><span class="nf">begin</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span><span class="k">return</span> <span class="n">elements</span><span class="p">;}</span>
  <span class="n">T</span> <span class="o">*</span><span class="nf">end</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span><span class="k">return</span> <span class="n">first_free</span><span class="p">;}</span>
 <span class="k">private</span><span class="o">:</span>
  <span class="n">allocator</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">alloc</span><span class="p">;</span> <span class="cm">/* it using static, 'undefined reference' reported when compile */</span>
  <span class="kt">void</span> <span class="nf">chk_n_alloc</span><span class="p">()</span>
  <span class="p">{</span><span class="k">if</span><span class="p">(</span><span class="n">size</span><span class="p">()</span> <span class="o">==</span> <span class="n">capacity</span><span class="p">())</span> <span class="n">reallocate</span><span class="p">();}</span>
  <span class="n">pair</span><span class="o">&lt;</span><span class="n">T</span> <span class="o">*</span><span class="p">,</span> <span class="n">T</span> <span class="o">*&gt;</span> <span class="n">alloc_n_copy</span>
    <span class="p">(</span><span class="k">const</span> <span class="n">T</span> <span class="o">*</span><span class="p">,</span> <span class="k">const</span> <span class="n">T</span> <span class="o">*</span><span class="p">);</span>
  <span class="kt">void</span> <span class="nf">free</span><span class="p">();</span>
  <span class="kt">void</span> <span class="nf">reallocate</span><span class="p">(</span><span class="kt">size_t</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span><span class="p">);</span>
  <span class="n">T</span> <span class="o">*</span><span class="n">elements</span><span class="p">;</span>
  <span class="n">T</span> <span class="o">*</span><span class="n">first_free</span><span class="p">;</span>
  <span class="n">T</span> <span class="o">*</span><span class="n">cap</span><span class="p">;</span>
<span class="p">};</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span> <span class="kt">void</span> <span class="n">Vec</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::</span><span class="n">push_back</span><span class="p">(</span><span class="k">const</span> <span class="n">T</span> <span class="o">&amp;</span><span class="n">s</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">chk_n_alloc</span><span class="p">();</span>
  <span class="n">alloc</span><span class="p">.</span><span class="n">construct</span><span class="p">(</span><span class="n">first_free</span><span class="o">++</span><span class="p">,</span> <span class="n">s</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span><span class="p">...</span> <span class="n">Args</span><span class="o">&gt;</span>
<span class="kr">inline</span>
<span class="kt">void</span> <span class="n">Vec</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::</span><span class="n">emplace_back</span><span class="p">(</span><span class="n">Args</span><span class="o">&amp;&amp;</span><span class="p">...</span> <span class="n">args</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">chk_n_alloc</span><span class="p">();</span>
  <span class="n">alloc</span><span class="p">.</span><span class="n">construct</span><span class="p">(</span><span class="n">first_free</span><span class="o">++</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">forward</span><span class="o">&lt;</span><span class="n">Args</span><span class="o">&gt;</span><span class="p">(</span><span class="n">args</span><span class="p">)...);</span>
<span class="p">}</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span> <span class="n">pair</span><span class="o">&lt;</span><span class="n">T</span> <span class="o">*</span><span class="p">,</span> <span class="n">T</span> <span class="o">*&gt;</span>
<span class="n">Vec</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::</span><span class="n">alloc_n_copy</span><span class="p">(</span><span class="k">const</span> <span class="n">T</span> <span class="o">*</span><span class="n">b</span><span class="p">,</span> <span class="k">const</span> <span class="n">T</span> <span class="o">*</span><span class="n">e</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">auto</span> <span class="n">data</span> <span class="o">=</span> <span class="n">alloc</span><span class="p">.</span><span class="n">allocate</span><span class="p">(</span><span class="n">e</span> <span class="o">-</span> <span class="n">b</span><span class="p">);</span>
  <span class="k">return</span> <span class="p">{</span><span class="n">data</span><span class="p">,</span> <span class="n">uninitialized_copy</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">data</span><span class="p">)};</span>
<span class="p">}</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span> <span class="kt">void</span> <span class="n">Vec</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::</span><span class="n">free</span><span class="p">()</span>
<span class="p">{</span>
  <span class="k">if</span><span class="p">(</span><span class="n">elements</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="k">for</span><span class="p">(</span><span class="k">auto</span> <span class="n">p</span> <span class="o">=</span> <span class="n">first_free</span><span class="p">;</span> <span class="n">p</span> <span class="o">!=</span> <span class="n">elements</span><span class="p">;)</span>
      <span class="n">alloc</span><span class="p">.</span><span class="n">destroy</span><span class="p">(</span><span class="o">--</span><span class="n">p</span><span class="p">);</span>
      <span class="n">alloc</span><span class="p">.</span><span class="n">deallocate</span><span class="p">(</span><span class="n">elements</span><span class="p">,</span> <span class="n">cap</span> <span class="o">-</span> <span class="n">elements</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="cm">/* for_each(elements, first_free, [this] (T &amp;s) {alloc.destroy(&amp;s);}); */</span>
  <span class="cm">/* alloc.deallocate(elements, cap - elements); */</span>
<span class="p">}</span>
<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span> <span class="n">Vec</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::</span><span class="n">Vec</span><span class="p">(</span><span class="k">const</span> <span class="n">Vec</span> <span class="o">&amp;</span><span class="n">s</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">auto</span> <span class="n">newdata</span> <span class="o">=</span> <span class="n">alloc_n_copy</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">s</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>
  <span class="n">elements</span> <span class="o">=</span> <span class="n">newdata</span><span class="p">.</span><span class="n">first</span><span class="p">;</span>
  <span class="n">first_free</span> <span class="o">=</span> <span class="n">cap</span> <span class="o">=</span> <span class="n">newdata</span><span class="p">.</span><span class="n">second</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span> <span class="n">Vec</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::</span><span class="n">Vec</span><span class="p">(</span><span class="n">Vec</span> <span class="o">&amp;&amp;</span><span class="n">s</span><span class="p">)</span> <span class="k">noexcept</span><span class="o">:</span> <span class="n">first_free</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">first_free</span><span class="p">),</span> <span class="n">elements</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">elements</span><span class="p">),</span> <span class="n">cap</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="n">cap</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">s</span><span class="p">.</span><span class="n">first_free</span> <span class="o">=</span> <span class="k">nullptr</span><span class="p">;</span>
  <span class="n">s</span><span class="p">.</span><span class="n">elements</span> <span class="o">=</span> <span class="k">nullptr</span><span class="p">;</span>
  <span class="n">s</span><span class="p">.</span><span class="n">cap</span> <span class="o">=</span> <span class="k">nullptr</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span> <span class="n">Vec</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::</span><span class="n">Vec</span><span class="p">(</span><span class="k">const</span> <span class="n">initializer_list</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">is</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">auto</span> <span class="n">newdata</span> <span class="o">=</span> <span class="n">alloc_n_copy</span><span class="p">(</span><span class="n">is</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">is</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>
  <span class="n">elements</span> <span class="o">=</span> <span class="n">newdata</span><span class="p">.</span><span class="n">first</span><span class="p">;</span>
  <span class="n">first_free</span> <span class="o">=</span> <span class="n">cap</span> <span class="o">=</span> <span class="n">newdata</span><span class="p">.</span><span class="n">second</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span> <span class="n">Vec</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::~</span><span class="n">Vec</span><span class="p">()</span> <span class="p">{</span><span class="n">free</span><span class="p">();}</span>
<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span> <span class="n">Vec</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">Vec</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::</span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">Vec</span> <span class="o">&amp;</span><span class="n">rhs</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">auto</span> <span class="n">data</span> <span class="o">=</span> <span class="n">alloc_n_copy</span><span class="p">(</span><span class="n">rhs</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">rhs</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>
  <span class="n">free</span><span class="p">();</span>
  <span class="n">elements</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="n">first</span><span class="p">;</span>
  <span class="n">first_free</span> <span class="o">=</span> <span class="n">cap</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="n">second</span><span class="p">;</span>
  <span class="k">return</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span> <span class="n">T</span> <span class="o">&amp;</span><span class="n">Vec</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::</span><span class="k">operator</span><span class="p">[](</span><span class="kt">size_t</span> <span class="n">n</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span><span class="p">(</span><span class="n">n</span> <span class="o">&gt;=</span> <span class="n">size</span><span class="p">())</span>
    <span class="k">throw</span> <span class="n">runtime_error</span><span class="p">(</span><span class="s">"Out of range"</span><span class="p">);</span>
  <span class="k">else</span>
    <span class="k">return</span> <span class="o">*</span><span class="p">(</span><span class="n">elements</span> <span class="o">+</span> <span class="n">n</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span> <span class="k">const</span> <span class="n">T</span> <span class="o">&amp;</span><span class="n">Vec</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::</span><span class="k">operator</span><span class="p">[](</span><span class="kt">size_t</span> <span class="n">n</span><span class="p">)</span> <span class="k">const</span>
<span class="p">{</span>
  <span class="k">if</span><span class="p">(</span><span class="n">n</span> <span class="o">&gt;=</span> <span class="n">size</span><span class="p">())</span>
    <span class="k">throw</span> <span class="n">runtime_error</span><span class="p">(</span><span class="s">"Out of range"</span><span class="p">);</span>
  <span class="k">else</span>
    <span class="k">return</span> <span class="n">elements</span><span class="p">[</span><span class="n">n</span><span class="p">];</span>
<span class="p">}</span>
<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span> <span class="n">Vec</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">Vec</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::</span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="n">Vec</span> <span class="o">&amp;&amp;</span><span class="n">s</span><span class="p">)</span> <span class="k">noexcept</span>
<span class="p">{</span>
  <span class="k">if</span><span class="p">(</span><span class="o">&amp;</span><span class="n">s</span> <span class="o">!=</span> <span class="k">this</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="n">free</span><span class="p">();</span>
      <span class="n">first_free</span> <span class="o">=</span> <span class="n">s</span><span class="p">.</span><span class="n">first_free</span><span class="p">;</span>
      <span class="n">elements</span> <span class="o">=</span> <span class="n">s</span><span class="p">.</span><span class="n">elements</span><span class="p">;</span>
      <span class="n">cap</span> <span class="o">=</span> <span class="n">s</span><span class="p">.</span><span class="n">cap</span><span class="p">;</span>
      <span class="n">s</span><span class="p">.</span><span class="n">first_free</span> <span class="o">=</span> <span class="n">s</span><span class="p">.</span><span class="n">elements</span> <span class="o">=</span> <span class="n">s</span><span class="p">.</span><span class="n">cap</span> <span class="o">=</span> <span class="k">nullptr</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="k">return</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span> <span class="n">Vec</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">Vec</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::</span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span> <span class="n">initializer_list</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">il</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">auto</span> <span class="n">data</span> <span class="o">=</span> <span class="n">alloc_n_copy</span><span class="p">(</span><span class="n">il</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">il</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>
  <span class="n">free</span><span class="p">();</span>
  <span class="n">elements</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="n">first</span><span class="p">;</span>
  <span class="n">first_free</span> <span class="o">=</span> <span class="n">cap</span> <span class="o">=</span> <span class="n">data</span><span class="p">.</span><span class="n">second</span><span class="p">;</span>
  <span class="k">return</span> <span class="o">*</span><span class="k">this</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span> <span class="kt">void</span> <span class="n">Vec</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::</span><span class="n">reallocate</span><span class="p">(</span><span class="kt">size_t</span> <span class="n">n</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">auto</span> <span class="n">newcapacity</span> <span class="o">=</span> <span class="n">n</span> <span class="o">?</span> <span class="nl">n</span> <span class="p">:</span> <span class="p">(</span><span class="n">size</span><span class="p">()</span> <span class="o">?</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">size</span><span class="p">()</span> <span class="o">:</span> <span class="mi">1</span><span class="p">);</span>
  <span class="k">auto</span> <span class="n">newdata</span> <span class="o">=</span> <span class="n">alloc</span><span class="p">.</span><span class="n">allocate</span><span class="p">(</span><span class="n">newcapacity</span><span class="p">);</span>
  <span class="k">auto</span> <span class="n">dest</span> <span class="o">=</span> <span class="n">newdata</span><span class="p">;</span>
  <span class="k">auto</span> <span class="n">elem</span> <span class="o">=</span> <span class="n">elements</span><span class="p">;</span>
  <span class="k">for</span><span class="p">(</span><span class="kt">size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">!=</span> <span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
    <span class="n">alloc</span><span class="p">.</span><span class="n">construct</span><span class="p">(</span><span class="n">dest</span><span class="o">++</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="o">*</span><span class="n">elem</span><span class="o">++</span><span class="p">));</span>
  <span class="n">free</span><span class="p">();</span>
  <span class="n">elements</span> <span class="o">=</span> <span class="n">newdata</span><span class="p">;</span>
  <span class="n">first_free</span> <span class="o">=</span> <span class="n">dest</span><span class="p">;</span>
  <span class="n">cap</span> <span class="o">=</span> <span class="n">elements</span> <span class="o">+</span> <span class="n">newcapacity</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span> <span class="kt">void</span> <span class="n">Vec</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::</span><span class="n">reserve</span><span class="p">(</span><span class="kt">size_t</span> <span class="n">n</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span><span class="p">(</span><span class="n">n</span> <span class="o">&gt;</span> <span class="n">capacity</span><span class="p">())</span>
    <span class="n">reallocate</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span> <span class="kt">void</span> <span class="n">Vec</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;::</span><span class="n">resize</span><span class="p">(</span><span class="kt">size_t</span> <span class="n">n</span><span class="p">,</span> <span class="n">T</span> <span class="n">s</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">if</span><span class="p">(</span><span class="n">n</span> <span class="o">&gt;</span> <span class="n">size</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="n">n</span> <span class="o">&lt;=</span> <span class="n">capacity</span><span class="p">())</span>
    <span class="p">{</span>
      <span class="n">uninitialized_fill</span><span class="p">(</span><span class="n">first_free</span><span class="p">,</span> <span class="n">elements</span> <span class="o">+</span> <span class="n">n</span><span class="p">,</span> <span class="n">s</span><span class="p">);</span>
      <span class="n">first_free</span> <span class="o">=</span> <span class="n">elements</span> <span class="o">+</span> <span class="n">n</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">n</span> <span class="o">&gt;</span> <span class="n">size</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="n">capacity</span><span class="p">())</span>
    <span class="p">{</span>
      <span class="n">reallocate</span><span class="p">();</span>
      <span class="n">uninitialized_fill</span><span class="p">(</span><span class="n">first_free</span><span class="p">,</span> <span class="n">elements</span> <span class="o">+</span> <span class="n">n</span><span class="p">,</span> <span class="n">s</span><span class="p">);</span>
      <span class="n">first_free</span> <span class="o">=</span> <span class="n">elements</span> <span class="o">+</span> <span class="n">n</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">n</span> <span class="o">&lt;</span> <span class="n">size</span><span class="p">())</span>
    <span class="p">{</span>
      <span class="k">for</span><span class="p">(</span><span class="k">auto</span> <span class="n">p</span> <span class="o">=</span> <span class="n">first_free</span><span class="p">;</span> <span class="n">p</span> <span class="o">!=</span> <span class="n">elements</span> <span class="o">+</span> <span class="n">n</span><span class="p">;)</span>
      <span class="n">alloc</span><span class="p">.</span><span class="n">destroy</span><span class="p">(</span><span class="o">--</span><span class="n">p</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span> <span class="kt">bool</span> <span class="k">operator</span><span class="o">==</span><span class="p">(</span><span class="k">const</span> <span class="n">Vec</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">s1</span><span class="p">,</span> <span class="k">const</span> <span class="n">Vec</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">s2</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">vector</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">temp1</span><span class="p">(</span><span class="n">s1</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">s1</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>
  <span class="n">vector</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">temp2</span><span class="p">(</span><span class="n">s2</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">s2</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>
  <span class="k">return</span> <span class="n">temp1</span> <span class="o">==</span> <span class="n">temp2</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span> <span class="kt">bool</span> <span class="k">operator</span><span class="o">!=</span><span class="p">(</span><span class="k">const</span> <span class="n">Vec</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">s1</span><span class="p">,</span> <span class="k">const</span> <span class="n">Vec</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">s2</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="o">!</span><span class="p">(</span><span class="n">s1</span> <span class="o">==</span> <span class="n">s2</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span> <span class="kt">bool</span> <span class="k">operator</span><span class="o">&lt;</span><span class="p">(</span><span class="k">const</span> <span class="n">Vec</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">s1</span><span class="p">,</span> <span class="k">const</span> <span class="n">Vec</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">s2</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">vector</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">temp1</span><span class="p">(</span><span class="n">s1</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">s1</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>
  <span class="n">vector</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">temp2</span><span class="p">(</span><span class="n">s2</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">s2</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>
  <span class="k">return</span> <span class="n">temp1</span> <span class="o">&lt;</span> <span class="n">temp2</span><span class="p">;</span>
<span class="p">}</span>
<span class="cp">#endif</span>
</pre></div>
</div>
</div>

<div id="outline-container-org440b79e" class="outline-2">
<h2 id="org440b79e">Exercise 16.59</h2>
<div class="outline-text-2" id="text-org440b79e">
<div class="highlight"><pre><span></span><span class="c1">// string s;</span>
<span class="c1">// svec.emplace_back(s);</span>
<span class="c1">// for s is lvalue;</span>
<span class="c1">// would call string class type's copy constructor to copy construct a new string object allocated in dynamic memory.</span>
</pre></div>
</div>
</div>

<div id="outline-container-orgd2783d8" class="outline-2">
<h2 id="orgd2783d8">Exercise 16.60</h2>
<div class="outline-text-2" id="text-orgd2783d8">
<div class="highlight"><pre><span></span><span class="c1">// function make_shared behaves almost like emplace_back illustrated in section 16.4.3;</span>
<span class="c1">// make_shared should be a variadic template function that forwards all arguments to underlying constructors that allocate and initializes an object in dynamic memroy and build a shared_ptr by wrapping the raw pointer.</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="p">,</span> <span class="k">typename</span><span class="p">...</span> <span class="n">Args</span><span class="o">&gt;</span>
<span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">my_make_shared</span><span class="p">(</span><span class="n">Args</span><span class="o">&amp;&amp;</span><span class="p">...</span> <span class="n">args</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">(</span><span class="k">new</span> <span class="n">T</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">forward</span><span class="o">&lt;</span><span class="n">Args</span><span class="o">&gt;</span><span class="p">(</span><span class="n">args</span><span class="p">)...));</span>
<span class="p">}</span>
</pre></div>
</div>
</div>

<div id="outline-container-org2a99047" class="outline-2">
<h2 id="org2a99047">Exercise 16.61</h2>
<div class="outline-text-2" id="text-org2a99047">
<div class="highlight"><pre><span></span><span class="c1">// See function template my_make_shared in 16.60.cpp.</span>
</pre></div>
</div>
</div>

<div id="outline-container-org821374f" class="outline-2">
<h2 id="org821374f">16.60.cpp</h2>
<div class="outline-text-2" id="text-org821374f">
<div class="highlight"><pre><span></span><span class="c1">// function make_shared behaves almost like emplace_back illustrated in section 16.4.3;</span>
<span class="c1">// make_shared should be a variadic template function that forwards all arguments to underlying constructors that allocate and initializes an object in dynamic memroy and build a shared_ptr by wrapping the raw pointer.</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="p">,</span> <span class="k">typename</span><span class="p">...</span> <span class="n">Args</span><span class="o">&gt;</span>
<span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">my_make_shared</span><span class="p">(</span><span class="n">Args</span><span class="o">&amp;&amp;</span><span class="p">...</span> <span class="n">args</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">(</span><span class="k">new</span> <span class="n">T</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">forward</span><span class="o">&lt;</span><span class="n">Args</span><span class="o">&gt;</span><span class="p">(</span><span class="n">args</span><span class="p">)...));</span>
<span class="p">}</span>
</pre></div>
</div>
</div>

<div id="outline-container-org7db5183" class="outline-2">
<h2 id="org7db5183">Exercise 16.62</h2>
<div class="outline-text-2" id="text-org7db5183">
<div class="highlight"><pre><span></span><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">unordered_multiset</span><span class="o">&lt;</span><span class="n">Sales_data</span><span class="o">&gt;</span> <span class="n">ums</span><span class="p">;</span>
  <span class="n">ums</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">Sales_data</span><span class="p">());</span>
  <span class="n">ums</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">Sales_data</span><span class="p">(</span><span class="s">"1234"</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mf">10.1</span><span class="p">));</span>
  <span class="k">for</span><span class="p">(</span><span class="k">auto</span> <span class="n">iter</span> <span class="o">=</span> <span class="n">ums</span><span class="p">.</span><span class="n">cbegin</span><span class="p">();</span> <span class="n">iter</span> <span class="o">!=</span> <span class="n">ums</span><span class="p">.</span><span class="n">cend</span><span class="p">();</span> <span class="o">++</span><span class="n">iter</span><span class="p">)</span>
    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="o">*</span><span class="n">iter</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>

<div id="outline-container-org0de18ee" class="outline-2">
<h2 id="org0de18ee">Exercise 16.63</h2>
<div class="outline-text-2" id="text-org0de18ee">
<div class="highlight"><pre><span></span><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
<span class="kt">size_t</span> <span class="n">count_in_vector</span><span class="p">(</span><span class="k">const</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">vt</span><span class="p">,</span> <span class="n">T</span> <span class="n">i</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="n">count</span><span class="p">(</span><span class="n">vt</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">vt</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">i</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">template</span> <span class="o">&lt;&gt;</span>
<span class="kt">size_t</span> <span class="n">count_in_vector</span><span class="p">(</span><span class="k">const</span> <span class="n">vector</span><span class="o">&lt;</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*&gt;</span> <span class="o">&amp;</span><span class="n">vt</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">i</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">size_t</span> <span class="n">n</span><span class="p">;</span>
  <span class="k">for</span><span class="p">(</span><span class="k">auto</span> <span class="n">iter</span> <span class="o">=</span> <span class="n">vt</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span> <span class="n">iter</span> <span class="o">!=</span> <span class="n">vt</span><span class="p">.</span><span class="n">end</span><span class="p">();</span> <span class="o">++</span><span class="n">iter</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="o">*</span><span class="n">iter</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
      <span class="o">++</span><span class="n">n</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="k">return</span> <span class="n">n</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span> <span class="n">vd</span> <span class="o">=</span> <span class="p">{</span><span class="mf">1.1</span><span class="p">,</span> <span class="mf">2.2</span><span class="p">,</span> <span class="mf">3.3</span><span class="p">,</span> <span class="mf">4.4</span><span class="p">};</span>
  <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">vi</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">};</span>
  <span class="n">vector</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">vs</span> <span class="o">=</span> <span class="p">{</span><span class="n">string</span><span class="p">(</span><span class="s">"hello"</span><span class="p">),</span> <span class="n">string</span><span class="p">(</span><span class="s">"world"</span><span class="p">)};</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">count_in_vector</span><span class="p">(</span><span class="n">vd</span><span class="p">,</span> <span class="mf">2.2</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">count_in_vector</span><span class="p">(</span><span class="n">vi</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">count_in_vector</span><span class="p">(</span><span class="n">vs</span><span class="p">,</span> <span class="s">"hello"</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Exercise 16.64:"</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">vector</span><span class="o">&lt;</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*&gt;</span> <span class="n">vc</span> <span class="o">=</span> <span class="p">{</span><span class="s">"hello"</span><span class="p">,</span> <span class="s">"world"</span><span class="p">};</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">count_in_vector</span><span class="p">(</span><span class="n">vc</span><span class="p">,</span> <span class="s">"world"</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>

<div id="outline-container-orgcc44a47" class="outline-2">
<h2 id="orgcc44a47">Exercise 16.64</h2>
<div class="outline-text-2" id="text-orgcc44a47">
<div class="highlight"><pre><span></span><span class="c1">// See 16.63.cpp.</span>
</pre></div>
</div>
</div>

<div id="outline-container-org3074920" class="outline-2">
<h2 id="org3074920">16.63.cpp</h2>
<div class="outline-text-2" id="text-org3074920">
<div class="highlight"><pre><span></span><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span>
<span class="kt">size_t</span> <span class="n">count_in_vector</span><span class="p">(</span><span class="k">const</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">vt</span><span class="p">,</span> <span class="n">T</span> <span class="n">i</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="n">count</span><span class="p">(</span><span class="n">vt</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">vt</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">i</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">template</span> <span class="o">&lt;&gt;</span>
<span class="kt">size_t</span> <span class="n">count_in_vector</span><span class="p">(</span><span class="k">const</span> <span class="n">vector</span><span class="o">&lt;</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*&gt;</span> <span class="o">&amp;</span><span class="n">vt</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">i</span><span class="p">)</span>
<span class="p">{</span>
  <span class="kt">size_t</span> <span class="n">n</span><span class="p">;</span>
  <span class="k">for</span><span class="p">(</span><span class="k">auto</span> <span class="n">iter</span> <span class="o">=</span> <span class="n">vt</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span> <span class="n">iter</span> <span class="o">!=</span> <span class="n">vt</span><span class="p">.</span><span class="n">end</span><span class="p">();</span> <span class="o">++</span><span class="n">iter</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="k">if</span><span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="o">*</span><span class="n">iter</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
      <span class="o">++</span><span class="n">n</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="k">return</span> <span class="n">n</span><span class="p">;</span>
<span class="p">}</span>
<span class="kt">int</span> <span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
  <span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span> <span class="n">vd</span> <span class="o">=</span> <span class="p">{</span><span class="mf">1.1</span><span class="p">,</span> <span class="mf">2.2</span><span class="p">,</span> <span class="mf">3.3</span><span class="p">,</span> <span class="mf">4.4</span><span class="p">};</span>
  <span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">vi</span> <span class="o">=</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">};</span>
  <span class="n">vector</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">vs</span> <span class="o">=</span> <span class="p">{</span><span class="n">string</span><span class="p">(</span><span class="s">"hello"</span><span class="p">),</span> <span class="n">string</span><span class="p">(</span><span class="s">"world"</span><span class="p">)};</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">count_in_vector</span><span class="p">(</span><span class="n">vd</span><span class="p">,</span> <span class="mf">2.2</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">count_in_vector</span><span class="p">(</span><span class="n">vi</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">count_in_vector</span><span class="p">(</span><span class="n">vs</span><span class="p">,</span> <span class="s">"hello"</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">"Exercise 16.64:"</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
  <span class="n">vector</span><span class="o">&lt;</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*&gt;</span> <span class="n">vc</span> <span class="o">=</span> <span class="p">{</span><span class="s">"hello"</span><span class="p">,</span> <span class="s">"world"</span><span class="p">};</span>
  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">count_in_vector</span><span class="p">(</span><span class="n">vc</span><span class="p">,</span> <span class="s">"world"</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>

<div id="outline-container-org96bc297" class="outline-2">
<h2 id="org96bc297">Exercise 16.65</h2>
<div class="outline-text-2" id="text-org96bc297">
<div class="highlight"><pre><span></span><span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span> <span class="n">string</span> <span class="n">debug_rep</span><span class="p">(</span><span class="k">const</span> <span class="n">T</span> <span class="o">&amp;</span><span class="n">t</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">ostringstream</span> <span class="n">ret</span><span class="p">;</span>
  <span class="n">ret</span> <span class="o">&lt;&lt;</span> <span class="n">t</span><span class="p">;</span>
  <span class="k">return</span> <span class="n">ret</span><span class="p">.</span><span class="n">str</span><span class="p">();</span>
<span class="p">}</span>
<span class="k">template</span> <span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span> <span class="n">string</span> <span class="n">debug_rep</span><span class="p">(</span><span class="n">T</span> <span class="o">*</span><span class="n">p</span><span class="p">)</span>
<span class="p">{</span>
  <span class="n">ostringstream</span> <span class="n">ret</span><span class="p">;</span>
  <span class="n">ret</span> <span class="o">&lt;&lt;</span> <span class="s">"pointer: "</span> <span class="o">&lt;&lt;</span> <span class="n">p</span><span class="p">;</span>
  <span class="k">if</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="n">ret</span> <span class="o">&lt;&lt;</span> <span class="s">" null pointer"</span><span class="p">;</span>
  <span class="k">return</span> <span class="n">ret</span><span class="p">.</span><span class="n">str</span><span class="p">();</span>
<span class="p">}</span>
<span class="n">string</span> <span class="n">debug_rep</span><span class="p">(</span><span class="k">const</span> <span class="n">string</span> <span class="o">&amp;</span><span class="n">s</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="sc">'"'</span> <span class="o">+</span> <span class="n">s</span> <span class="o">+</span> <span class="sc">'"'</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">template</span> <span class="o">&lt;&gt;</span>
<span class="n">string</span> <span class="n">debug_rep</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">p</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="n">debug_rep</span><span class="p">(</span><span class="n">string</span><span class="p">(</span><span class="n">p</span><span class="p">));</span>
<span class="p">}</span>
<span class="k">template</span> <span class="o">&lt;&gt;</span>
<span class="n">string</span> <span class="n">debug_rep</span><span class="p">(</span><span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">p</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">return</span> <span class="n">debug_rep</span><span class="p">(</span><span class="n">string</span><span class="p">(</span><span class="n">p</span><span class="p">));</span>
<span class="p">}</span>
</pre></div>
</div>
</div>

<div id="outline-container-orgeaf4f4c" class="outline-2">
<h2 id="orgeaf4f4c">Exercise 16.66</h2>
<div class="outline-text-2" id="text-orgeaf4f4c">
<div class="highlight"><pre><span></span><span class="c1">// overload version of debub_rep function:</span>
<span class="c1">// advantage:</span>
<span class="c1">// disadvantage: overloading changes the function match.</span>
</pre></div>
</div>
</div>

<div id="outline-container-orgea2624e" class="outline-2">
<h2 id="orgea2624e">Exercise 16.67</h2>
<div class="outline-text-2" id="text-orgea2624e">
<div class="highlight"><pre><span></span><span class="c1">// Template specilization would not influence the mathch process of function;</span>
<span class="c1">// for that template specilization is a instance of a template, not an overload of it.</span>
</pre></div>
</div>
</div>
            
        
        <div id="disqus_thread"></div>
        <script>
        var disqus_shortname ="https-zero4drift-github-io",
            disqus_url="https://zero4drift.github.io/posts/Cpp-Primer-5th-Exercises-Chapter-16/",
        disqus_title="Cpp-Primer-5th-Exercises-Chapter-16",
        disqus_identifier="cache/posts/Cpp-Primer-5th-Exercises-Chapter-16.html",
        disqus_config = function () {
            this.language = "en";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.async = true;
            dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
    <a href="https://disqus.com" class="dsq-brlink" rel="nofollow">Comments powered by <span class="logo-disqus">Disqus</span></a>


        
    


        </div>
    </div>

    
    <footer><div class="container">
            <div class="social">



                <div class="social-entry">
                    <a href="../../rss.xml" target="_blank">
                        <i class="fa fa-rss"></i> 
                    </a>
                </div>
            </div>
                <div class="copyright">
                    Contents © 2018         <a href="mailto:fang0052@e.ntu.edu.sg">zero4drift</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         
                    
                </div>
           
        </div>
    </footer><script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?06e0ade16d98033ac1aad78106d873c8";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script src="../../assets/js/all-nocdn.js" type="text/javascript"></script>
</body>
</html>
